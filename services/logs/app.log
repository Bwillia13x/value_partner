{"asctime": "2025-07-04 08:42:40,045", "name": "services.app", "levelname": "INFO", "message": "Logging configuration initialized", "component": "logging_config", "timestamp": "2025-07-04T14:42:40.045461"}
{"asctime": "2025-07-04 08:42:43,717", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Use pytorch device_name: mps"}
{"asctime": "2025-07-04 08:42:43,717", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Load pretrained SentenceTransformer: all-MiniLM-L6-v2"}
{"asctime": "2025-07-04 08:42:46,813", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:42:46,814", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategies\")"}
{"asctime": "2025-07-04 08:42:46,815", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,815", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategy_holdings\")"}
{"asctime": "2025-07-04 08:42:46,815", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,815", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"users\")"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"custodians\")"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA temp.table_info(\"custodians\")"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"portfolios\")"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA temp.table_info(\"portfolios\")"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"accounts\")"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"holdings\")"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"transactions\")"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,816", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"orders\")"}
{"asctime": "2025-07-04 08:42:46,817", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,817", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA temp.table_info(\"orders\")"}
{"asctime": "2025-07-04 08:42:46,817", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:42:46,818", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "\nCREATE TABLE custodians (\n\tid INTEGER NOT NULL, \n\tname VARCHAR(100) NOT NULL, \n\tdisplay_name VARCHAR(200), \n\tlogo_url VARCHAR(500), \n\twebsite VARCHAR(200), \n\tis_active BOOLEAN DEFAULT (1) NOT NULL, \n\tcreated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, \n\tupdated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, \n\tPRIMARY KEY (id), \n\tUNIQUE (name)\n)\n\n"}
{"asctime": "2025-07-04 08:42:46,818", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[no key 0.00011s] ()"}
{"asctime": "2025-07-04 08:42:46,819", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "CREATE INDEX ix_custodians_id ON custodians (id)"}
{"asctime": "2025-07-04 08:42:46,819", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[no key 0.00008s] ()"}
{"asctime": "2025-07-04 08:42:46,820", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "\nCREATE TABLE portfolios (\n\tid INTEGER NOT NULL, \n\tuser_id INTEGER NOT NULL, \n\tname VARCHAR(100) NOT NULL, \n\tdescription TEXT, \n\tis_primary BOOLEAN DEFAULT (0) NOT NULL, \n\tcreated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, \n\tupdated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, \n\tPRIMARY KEY (id), \n\tFOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE\n)\n\n"}
{"asctime": "2025-07-04 08:42:46,820", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[no key 0.00007s] ()"}
{"asctime": "2025-07-04 08:42:46,821", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "CREATE INDEX ix_portfolios_id ON portfolios (id)"}
{"asctime": "2025-07-04 08:42:46,821", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[no key 0.00006s] ()"}
{"asctime": "2025-07-04 08:42:46,821", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "\nCREATE TABLE orders (\n\tid INTEGER NOT NULL, \n\tuser_id INTEGER NOT NULL, \n\taccount_id INTEGER, \n\tstrategy_id INTEGER, \n\tsymbol VARCHAR NOT NULL, \n\tside VARCHAR(4) NOT NULL, \n\tquantity FLOAT NOT NULL, \n\torder_type VARCHAR(13) NOT NULL, \n\ttime_in_force VARCHAR(3), \n\tlimit_price FLOAT, \n\tstop_price FLOAT, \n\ttrail_percent FLOAT, \n\ttrail_price FLOAT, \n\tfilled_quantity FLOAT, \n\taverage_fill_price FLOAT, \n\tcommission FLOAT, \n\tstatus VARCHAR(16), \n\tbroker_order_id VARCHAR, \n\tclient_order_id VARCHAR, \n\textended_hours BOOLEAN, \n\tcreated_at DATETIME, \n\tupdated_at DATETIME, \n\tsubmitted_at DATETIME, \n\tfilled_at DATETIME, \n\tbroker_data TEXT, \n\tPRIMARY KEY (id), \n\tFOREIGN KEY(user_id) REFERENCES users (id), \n\tFOREIGN KEY(account_id) REFERENCES accounts (id), \n\tFOREIGN KEY(strategy_id) REFERENCES strategies (id)\n)\n\n"}
{"asctime": "2025-07-04 08:42:46,821", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[no key 0.00006s] ()"}
{"asctime": "2025-07-04 08:42:46,822", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "CREATE INDEX ix_orders_id ON orders (id)"}
{"asctime": "2025-07-04 08:42:46,822", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[no key 0.00005s] ()"}
{"asctime": "2025-07-04 08:42:46,822", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "COMMIT"}
{"asctime": "2025-07-04 08:43:39,318", "name": "services.app", "levelname": "INFO", "message": "Logging configuration initialized", "component": "logging_config", "timestamp": "2025-07-04T14:43:39.318880"}
{"asctime": "2025-07-04 08:43:43,271", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Use pytorch device_name: mps"}
{"asctime": "2025-07-04 08:43:43,271", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Load pretrained SentenceTransformer: all-MiniLM-L6-v2"}
{"asctime": "2025-07-04 08:43:46,168", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:43:46,169", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategies\")"}
{"asctime": "2025-07-04 08:43:46,169", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:43:46,171", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategy_holdings\")"}
{"asctime": "2025-07-04 08:43:46,171", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:43:46,171", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"users\")"}
{"asctime": "2025-07-04 08:43:46,171", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:43:46,171", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"custodians\")"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"portfolios\")"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"accounts\")"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"holdings\")"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"transactions\")"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"orders\")"}
{"asctime": "2025-07-04 08:43:46,172", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:43:46,173", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "COMMIT"}
{"asctime": "2025-07-04 08:44:10,794", "name": "services.app", "levelname": "INFO", "message": "Logging configuration initialized", "component": "logging_config", "timestamp": "2025-07-04T14:44:10.794302"}
{"asctime": "2025-07-04 08:44:14,240", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Use pytorch device_name: mps"}
{"asctime": "2025-07-04 08:44:14,240", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Load pretrained SentenceTransformer: all-MiniLM-L6-v2"}
{"asctime": "2025-07-04 08:44:16,742", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:44:16,744", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategies\")"}
{"asctime": "2025-07-04 08:44:16,744", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategy_holdings\")"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"users\")"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"custodians\")"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"portfolios\")"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"accounts\")"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"holdings\")"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:44:16,747", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"transactions\")"}
{"asctime": "2025-07-04 08:44:16,748", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:44:16,748", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"orders\")"}
{"asctime": "2025-07-04 08:44:16,748", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:44:16,748", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "COMMIT"}
{"asctime": "2025-07-04 08:47:24,962", "name": "services.app", "levelname": "INFO", "message": "Logging configuration initialized", "component": "logging_config", "timestamp": "2025-07-04T14:47:24.962206"}
{"asctime": "2025-07-04 08:47:28,731", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Use pytorch device_name: mps"}
{"asctime": "2025-07-04 08:47:28,731", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Load pretrained SentenceTransformer: all-MiniLM-L6-v2"}
{"asctime": "2025-07-04 08:47:31,244", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:47:31,246", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategies\")"}
{"asctime": "2025-07-04 08:47:31,246", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:31,248", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategy_holdings\")"}
{"asctime": "2025-07-04 08:47:31,248", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:31,248", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"users\")"}
{"asctime": "2025-07-04 08:47:31,248", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:31,248", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"custodians\")"}
{"asctime": "2025-07-04 08:47:31,248", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"portfolios\")"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"accounts\")"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"holdings\")"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"transactions\")"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"orders\")"}
{"asctime": "2025-07-04 08:47:31,249", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:31,250", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "COMMIT"}
{"asctime": "2025-07-04 08:47:48,838", "name": "services.app", "levelname": "INFO", "message": "Logging configuration initialized", "component": "logging_config", "timestamp": "2025-07-04T14:47:48.838469"}
{"asctime": "2025-07-04 08:47:52,203", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Use pytorch device_name: mps"}
{"asctime": "2025-07-04 08:47:52,203", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Load pretrained SentenceTransformer: all-MiniLM-L6-v2"}
{"asctime": "2025-07-04 08:47:54,587", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:47:54,590", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategies\")"}
{"asctime": "2025-07-04 08:47:54,590", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:54,592", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategy_holdings\")"}
{"asctime": "2025-07-04 08:47:54,592", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:54,592", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"users\")"}
{"asctime": "2025-07-04 08:47:54,592", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"custodians\")"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"portfolios\")"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"accounts\")"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"holdings\")"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"transactions\")"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"orders\")"}
{"asctime": "2025-07-04 08:47:54,593", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:47:54,594", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "COMMIT"}
{"asctime": "2025-07-04 08:47:54,714", "name": "services.app", "levelname": "INFO", "message": "Request started: GET /health", "request_id": "2b34b735-53b7-4bd0-967d-6953577a6948", "method": "GET", "path": "/health", "client_ip": "testclient"}
{"asctime": "2025-07-04 08:47:54,715", "name": "services.app", "levelname": "INFO", "message": "Request completed: 200", "request_id": "2b34b735-53b7-4bd0-967d-6953577a6948", "status_code": 200}
{"asctime": "2025-07-04 08:47:54,716", "name": "httpx", "levelname": "INFO", "message": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\""}
{"asctime": "2025-07-04 08:47:54,717", "name": "services.app", "levelname": "INFO", "message": "Request started: GET /health/detailed", "request_id": "43abe6cf-05cb-4abe-9d4b-2e3f6ae2fc20", "method": "GET", "path": "/health/detailed", "client_ip": "testclient"}
{"asctime": "2025-07-04 08:47:57,054", "name": "services.app", "levelname": "INFO", "message": "Request completed: 503", "request_id": "43abe6cf-05cb-4abe-9d4b-2e3f6ae2fc20", "status_code": 503}
{"asctime": "2025-07-04 08:47:57,058", "name": "httpx", "levelname": "INFO", "message": "HTTP Request: GET http://testserver/health/detailed \"HTTP/1.1 503 Service Unavailable\""}
{"asctime": "2025-07-04 08:48:20,525", "name": "services.app", "levelname": "INFO", "message": "Logging configuration initialized", "component": "logging_config", "timestamp": "2025-07-04T14:48:20.525880"}
{"asctime": "2025-07-04 08:48:24,174", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Use pytorch device_name: mps"}
{"asctime": "2025-07-04 08:48:24,175", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Load pretrained SentenceTransformer: all-MiniLM-L6-v2"}
{"asctime": "2025-07-04 08:48:26,599", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:48:26,601", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategies\")"}
{"asctime": "2025-07-04 08:48:26,601", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategy_holdings\")"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"users\")"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"custodians\")"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"portfolios\")"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"accounts\")"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"holdings\")"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:48:26,603", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"transactions\")"}
{"asctime": "2025-07-04 08:48:26,604", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:48:26,604", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"orders\")"}
{"asctime": "2025-07-04 08:48:26,604", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:48:26,604", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "COMMIT"}
{"asctime": "2025-07-04 08:48:26,714", "name": "services.app", "levelname": "INFO", "message": "Request started: GET /health/detailed", "request_id": "ebcbf1bd-ce03-4753-954d-580d797505b8", "method": "GET", "path": "/health/detailed", "client_ip": "testclient"}
{"asctime": "2025-07-04 08:48:28,902", "name": "services.app", "levelname": "INFO", "message": "Request completed: 503", "request_id": "ebcbf1bd-ce03-4753-954d-580d797505b8", "status_code": 503}
{"asctime": "2025-07-04 08:48:28,910", "name": "httpx", "levelname": "INFO", "message": "HTTP Request: GET http://testserver/health/detailed \"HTTP/1.1 503 Service Unavailable\""}
{"asctime": "2025-07-04 08:49:10,490", "name": "services.app", "levelname": "INFO", "message": "Logging configuration initialized", "component": "logging_config", "timestamp": "2025-07-04T14:49:10.490003"}
{"asctime": "2025-07-04 08:49:14,353", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Use pytorch device_name: mps"}
{"asctime": "2025-07-04 08:49:14,353", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Load pretrained SentenceTransformer: all-MiniLM-L6-v2"}
{"asctime": "2025-07-04 08:49:16,879", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:49:16,881", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategies\")"}
{"asctime": "2025-07-04 08:49:16,881", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategy_holdings\")"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"users\")"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"custodians\")"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"portfolios\")"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"accounts\")"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"holdings\")"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"transactions\")"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:16,883", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"orders\")"}
{"asctime": "2025-07-04 08:49:16,884", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:16,884", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "COMMIT"}
{"asctime": "2025-07-04 08:49:16,988", "name": "services.app", "levelname": "INFO", "message": "Request started: GET /health/detailed", "request_id": "0b71fa57-3804-4fb2-a63d-9017d5e46303", "method": "GET", "path": "/health/detailed", "client_ip": "testclient"}
{"asctime": "2025-07-04 08:49:16,989", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:49:16,989", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "SELECT 1"}
{"asctime": "2025-07-04 08:49:16,989", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[generated in 0.00012s] ()"}
{"asctime": "2025-07-04 08:49:19,051", "name": "services.app", "levelname": "INFO", "message": "Request completed: 200", "request_id": "0b71fa57-3804-4fb2-a63d-9017d5e46303", "status_code": 200}
{"asctime": "2025-07-04 08:49:19,053", "name": "httpx", "levelname": "INFO", "message": "HTTP Request: GET http://testserver/health/detailed \"HTTP/1.1 200 OK\""}
{"asctime": "2025-07-04 08:49:39,270", "name": "services.app", "levelname": "INFO", "message": "Logging configuration initialized", "component": "logging_config", "timestamp": "2025-07-04T14:49:39.270697"}
{"asctime": "2025-07-04 08:49:42,719", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Use pytorch device_name: mps"}
{"asctime": "2025-07-04 08:49:42,719", "name": "sentence_transformers.SentenceTransformer", "levelname": "INFO", "message": "Load pretrained SentenceTransformer: all-MiniLM-L6-v2"}
{"asctime": "2025-07-04 08:49:45,204", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:49:45,205", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategies\")"}
{"asctime": "2025-07-04 08:49:45,205", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"strategy_holdings\")"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"users\")"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"custodians\")"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"portfolios\")"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"accounts\")"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"holdings\")"}
{"asctime": "2025-07-04 08:49:45,207", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:45,208", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"transactions\")"}
{"asctime": "2025-07-04 08:49:45,208", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:45,208", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "PRAGMA main.table_info(\"orders\")"}
{"asctime": "2025-07-04 08:49:45,208", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[raw sql] ()"}
{"asctime": "2025-07-04 08:49:45,208", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "COMMIT"}
{"asctime": "2025-07-04 08:49:45,321", "name": "services.app", "levelname": "INFO", "message": "Request started: GET /health", "request_id": "caa0a699-10b5-41fe-993f-e71f3d5ccb21", "method": "GET", "path": "/health", "client_ip": "testclient"}
{"asctime": "2025-07-04 08:49:45,321", "name": "services.app", "levelname": "INFO", "message": "Request completed: 200", "request_id": "caa0a699-10b5-41fe-993f-e71f3d5ccb21", "status_code": 200}
{"asctime": "2025-07-04 08:49:45,323", "name": "httpx", "levelname": "INFO", "message": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\""}
{"asctime": "2025-07-04 08:49:45,323", "name": "services.app", "levelname": "INFO", "message": "Request started: GET /health", "request_id": "5538ebc1-e6fc-47f5-a93e-b193c3a6953d", "method": "GET", "path": "/health", "client_ip": "testclient"}
{"asctime": "2025-07-04 08:49:45,324", "name": "services.app", "levelname": "INFO", "message": "Request completed: 200", "request_id": "5538ebc1-e6fc-47f5-a93e-b193c3a6953d", "status_code": 200}
{"asctime": "2025-07-04 08:49:45,324", "name": "httpx", "levelname": "INFO", "message": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\""}
{"asctime": "2025-07-04 08:49:45,325", "name": "services.app", "levelname": "INFO", "message": "Request started: GET /health", "request_id": "5c98fac2-97aa-4aa7-8b3e-f211b913c075", "method": "GET", "path": "/health", "client_ip": "testclient"}
{"asctime": "2025-07-04 08:49:45,325", "name": "services.app", "levelname": "INFO", "message": "Request completed: 200", "request_id": "5c98fac2-97aa-4aa7-8b3e-f211b913c075", "status_code": 200}
{"asctime": "2025-07-04 08:49:45,326", "name": "httpx", "levelname": "INFO", "message": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\""}
{"asctime": "2025-07-04 08:49:45,327", "name": "services.app", "levelname": "INFO", "message": "Request started: GET /plugins", "request_id": "367acb2d-404e-4ec8-a9d9-e256587df8e6", "method": "GET", "path": "/plugins", "client_ip": "testclient"}
{"asctime": "2025-07-04 08:49:45,327", "name": "services.app", "levelname": "INFO", "message": "Request completed: 200", "request_id": "367acb2d-404e-4ec8-a9d9-e256587df8e6", "status_code": 200}
{"asctime": "2025-07-04 08:49:45,328", "name": "httpx", "levelname": "INFO", "message": "HTTP Request: GET http://testserver/plugins \"HTTP/1.1 200 OK\""}
{"asctime": "2025-07-04 08:49:45,328", "name": "services.app", "levelname": "INFO", "message": "Request started: GET /health/detailed", "request_id": "8e2345e8-fa5a-46da-9fef-6e0a3fa6d5e8", "method": "GET", "path": "/health/detailed", "client_ip": "testclient"}
{"asctime": "2025-07-04 08:49:45,329", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "BEGIN (implicit)"}
{"asctime": "2025-07-04 08:49:45,329", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "SELECT 1"}
{"asctime": "2025-07-04 08:49:45,329", "name": "sqlalchemy.engine.Engine", "levelname": "INFO", "message": "[generated in 0.00010s] ()"}
{"asctime": "2025-07-04 08:49:47,408", "name": "services.app", "levelname": "INFO", "message": "Request completed: 200", "request_id": "8e2345e8-fa5a-46da-9fef-6e0a3fa6d5e8", "status_code": 200}
{"asctime": "2025-07-04 08:49:47,411", "name": "httpx", "levelname": "INFO", "message": "HTTP Request: GET http://testserver/health/detailed \"HTTP/1.1 200 OK\""}
{"asctime": "2025-07-04 08:51:33,442", "name": "services.app", "levelname": "INFO", "message": "Logging configuration initialized", "component": "logging_config", "timestamp": "2025-07-04T14:51:33.442486"}
{"asctime": "2025-07-04 08:51:33,442", "name": "services.app", "levelname": "INFO", "message": "Application started", "component": "main", "version": "1.0.0", "user_id": 123}
{"asctime": "2025-07-04 08:51:33,443", "name": "services.app", "levelname": "WARNING", "message": "High memory usage detected", "component": "performance_monitor", "memory_usage_mb": 512.5, "threshold_mb": 500.0, "user_id": 456}
{"asctime": "2025-07-04 08:51:33,443", "name": "services.app", "levelname": "ERROR", "message": "Database connection failed", "component": "database", "error_type": "connection_timeout", "retry_count": 3, "user_id": 789}
2025-07-04 08:52:23,149 - services.app - INFO - Logging configuration initialized
2025-07-04 08:52:23,150 - services.app - INFO - Application test started
2025-07-04 08:52:23,150 - services.app - ERROR - Test database error
2025-07-04 08:52:47,955 - services.app - INFO - Logging configuration initialized
2025-07-04 08:52:47,955 - services.app - DEBUG - Debug message with extra data
2025-07-04 08:52:47,955 - services.app - INFO - Info message
2025-07-04 08:52:47,956 - services.app - WARNING - Warning message
2025-07-04 08:52:47,956 - services.app - ERROR - Error message
2025-07-04 08:55:04,665 - services.app - INFO - Logging configuration initialized
2025-07-04 08:55:08,946 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 08:55:08,946 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 08:55:12,426 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 08:55:12,428 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 08:55:12,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 08:55:12,430 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 08:55:12,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 08:55:12,430 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 08:55:12,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 08:55:12,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 08:55:12,432 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 08:55:12,543 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 08:55:12,558 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 08:55:12,560 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 08:55:12,560 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] (123, 1, 0)
2025-07-04 08:55:12,568 - services.app.error_handling - ERROR - Error recorded [external_api_1751640912560] external_api: (sqlite3.OperationalError) no such column: users.hashed_password
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?]
[parameters: (123, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 08:55:12,568 - root - ERROR - Error creating link token: (sqlite3.OperationalError) no such column: users.hashed_password
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?]
[parameters: (123, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 08:55:12,568 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 08:55:12,569 - services.app - INFO - Request completed: 503
2025-07-04 08:55:12,570 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 08:55:12,570 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 08:55:12,571 - services.app - INFO - Request completed: 200
2025-07-04 08:55:12,571 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 08:55:12,572 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 08:55:12,572 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 08:55:12,572 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 08:55:12,572 - sqlalchemy.engine.Engine - INFO - [generated in 0.00006s] ()
2025-07-04 08:55:14,631 - services.app - INFO - Request completed: 200
2025-07-04 08:55:14,633 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 09:51:56,716 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 09:51:56,718 - services.app - INFO - User password is mysecretpassword123
2025-07-04 09:51:56,718 - services.app - INFO - Access token=***
2025-07-04 09:51:56,719 - services.app - INFO - API key: sk_test_1234567890abcdef1234567890abcdef
2025-07-04 09:51:56,719 - services.app - INFO - Credit card: ****-****-****-****
2025-07-04 09:51:56,719 - services.app - INFO - SSN: ***-**-****
2025-07-04 09:51:56,719 - services.app - INFO - Email: user***@***.example.com
2025-07-04 09:51:56,719 - services.app - INFO - Authorization: *** ***
2025-07-04 09:52:27,608 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 09:52:27,610 - services.app - INFO - User password is ***
2025-07-04 09:52:27,610 - services.app - INFO - Access token=***
2025-07-04 09:52:27,610 - services.app - INFO - API key: ***
2025-07-04 09:52:27,610 - services.app - INFO - Credit card: ****-****-****-****
2025-07-04 09:52:27,610 - services.app - INFO - SSN: ***-**-****
2025-07-04 09:52:27,610 - services.app - INFO - Email: user***@***.example.com
2025-07-04 09:52:27,610 - services.app - INFO - Authorization: *** ***
2025-07-04 10:49:03,479 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 10:49:25,701 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 10:49:25,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 10:49:25,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 10:49:25,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 10:49:25,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 10:49:25,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 10:49:25,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 10:49:25,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:25,706 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 10:49:25,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 10:49:25,708 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 10:49:25,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 10:49:25,708 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 10:49:37,775 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 10:49:41,599 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 10:49:41,599 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 10:49:41,599 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:41,601 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 10:49:41,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:41,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 10:49:41,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:41,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 10:49:41,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:41,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 10:49:41,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:41,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 10:49:41,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:41,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 10:49:41,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:41,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 10:49:41,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:41,604 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 10:49:41,604 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 10:49:41,604 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 10:49:41,680 - services.app - INFO - Application startup: Celery worker initialized
2025-07-04 10:49:41,685 - services.app - ERROR - Error enqueueing test Celery task: cannot import name 'get_alpaca_service' from 'app.integrations' (/Users/benjaminwilliams/value_partner/services/app/integrations/__init__.py)
2025-07-04 10:49:45,296 - services.app - INFO - Request started: GET /health
2025-07-04 10:49:45,297 - services.app - INFO - Request completed: 200
2025-07-04 10:49:52,400 - services.app - INFO - Request started: GET /docs
2025-07-04 10:49:52,400 - services.app - INFO - Request completed: 200
2025-07-04 11:20:23,476 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 11:20:26,098 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:20:26,099 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 11:20:26,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,099 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 11:20:26,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 11:20:26,101 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,101 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 11:20:26,101 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:20:26,102 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 11:20:26,102 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 11:20:26,103 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 11:20:26,103 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 11:20:26,103 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 11:20:26,143 - services.app - INFO - Application startup: Celery worker initialized
2025-07-04 11:20:26,144 - services.app - ERROR - Error enqueueing test Celery task: cannot import name 'get_alpaca_service' from 'app.integrations' (/Users/benjaminwilliams/value_partner/services/app/integrations/__init__.py)
2025-07-04 11:20:28,038 - services.app - INFO - Request started: GET /health
2025-07-04 11:20:28,039 - services.app - INFO - Request completed: 200
2025-07-04 11:20:35,787 - services.app - INFO - Request started: GET /health
2025-07-04 11:20:35,794 - services.app - INFO - Request completed: 200
2025-07-04 11:20:42,709 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 11:20:42,713 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:20:42,714 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 11:20:42,714 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2025-07-04 11:20:44,821 - services.app - INFO - Request completed: 200
2025-07-04 11:27:46,224 - services.app - INFO - Request started: GET /portfolio/accounts
2025-07-04 11:27:46,229 - services.app - INFO - Request started: GET /portfolio/accounts
2025-07-04 11:27:46,261 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:27:46,267 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts 
WHERE accounts.user_id = ? AND accounts.is_active = 1
2025-07-04 11:27:46,268 - sqlalchemy.engine.Engine - INFO - [generated in 0.00124s] (1,)
2025-07-04 11:27:46,275 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:27:46,275 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts 
WHERE accounts.user_id = ? AND accounts.is_active = 1
2025-07-04 11:27:46,275 - sqlalchemy.engine.Engine - INFO - [cached since 0.008282s ago] (1,)
2025-07-04 11:27:46,276 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 11:27:46,276 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 11:27:46,276 - services.app - INFO - Request completed: 200
2025-07-04 11:27:46,276 - services.app - INFO - Request completed: 200
2025-07-04 11:27:46,291 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 11:27:46,294 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 11:27:46,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:27:46,299 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 11:27:46,299 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] (1, 1, 0)
2025-07-04 11:27:46,302 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 11:27:46,303 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1, 'user1@example.com', None, 'User 1', None, None)
2025-07-04 11:27:46,303 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 11:27:46,314 - app.error_handling - ERROR - Error recorded [external_api_1751650066304] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (1, 'user1***@***.example.com', None, 'User 1', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 11:27:46,315 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (1, 'user1***@***.example.com', None, 'User 1', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 11:27:46,316 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:27:46,316 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 11:27:46,316 - sqlalchemy.engine.Engine - INFO - [cached since 0.01703s ago] (1, 1, 0)
2025-07-04 11:27:46,317 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 11:27:46,317 - sqlalchemy.engine.Engine - INFO - [cached since 0.01433s ago] (1, 'user1@example.com', None, 'User 1', None, None)
2025-07-04 11:27:46,317 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 11:27:46,319 - app.error_handling - ERROR - Error recorded [external_api_1751650066317] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (1, 'user1***@***.example.com', None, 'User 1', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 11:27:46,319 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (1, 'user1***@***.example.com', None, 'User 1', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 11:27:46,320 - services.app - INFO - Request completed: 503
2025-07-04 11:27:46,320 - services.app - INFO - Request completed: 503
2025-07-04 11:27:55,521 - services.app - INFO - Request started: GET /portfolio/accounts
2025-07-04 11:27:55,528 - services.app - INFO - Request started: GET /portfolio/accounts
2025-07-04 11:27:55,532 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:27:55,536 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts 
WHERE accounts.user_id = ? AND accounts.is_active = 1
2025-07-04 11:27:55,539 - sqlalchemy.engine.Engine - INFO - [cached since 9.272s ago] (1,)
2025-07-04 11:27:55,547 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:27:55,548 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts 
WHERE accounts.user_id = ? AND accounts.is_active = 1
2025-07-04 11:27:55,548 - sqlalchemy.engine.Engine - INFO - [cached since 9.281s ago] (1,)
2025-07-04 11:27:55,549 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 11:27:55,550 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 11:27:55,551 - services.app - INFO - Request completed: 200
2025-07-04 11:27:55,552 - services.app - INFO - Request completed: 200
2025-07-04 11:27:55,561 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 11:27:55,562 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 11:27:55,562 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:27:55,563 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 11:27:55,563 - sqlalchemy.engine.Engine - INFO - [cached since 9.264s ago] (1, 1, 0)
2025-07-04 11:27:55,565 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 11:27:55,565 - sqlalchemy.engine.Engine - INFO - [cached since 9.262s ago] (1, 'user1@example.com', None, 'User 1', None, None)
2025-07-04 11:27:55,565 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 11:27:55,577 - app.error_handling - ERROR - Error recorded [external_api_1751650075567] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (1, 'user1***@***.example.com', None, 'User 1', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 11:27:55,578 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (1, 'user1***@***.example.com', None, 'User 1', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 11:27:55,579 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:27:55,579 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 11:27:55,579 - sqlalchemy.engine.Engine - INFO - [cached since 9.28s ago] (1, 1, 0)
2025-07-04 11:27:55,580 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 11:27:55,580 - sqlalchemy.engine.Engine - INFO - [cached since 9.278s ago] (1, 'user1@example.com', None, 'User 1', None, None)
2025-07-04 11:27:55,580 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 11:27:55,583 - app.error_handling - ERROR - Error recorded [external_api_1751650075580] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (1, 'user1***@***.example.com', None, 'User 1', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 11:27:55,583 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (1, 'user1***@***.example.com', None, 'User 1', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 11:27:55,584 - services.app - INFO - Request completed: 503
2025-07-04 11:27:55,585 - services.app - INFO - Request completed: 503
2025-07-04 11:28:15,997 - services.app - INFO - Request started: GET /data/factors
2025-07-04 11:28:16,005 - services.app - INFO - Request started: GET /data/factors
2025-07-04 11:28:16,007 - services.app - INFO - Request completed: 404
2025-07-04 11:28:16,008 - services.app - INFO - Request completed: 404
2025-07-04 11:28:23,195 - services.app - INFO - Request started: GET /data/backtest
2025-07-04 11:28:23,218 - services.app - INFO - Request started: GET /data/backtest
2025-07-04 11:28:23,221 - services.app - INFO - Request completed: 404
2025-07-04 11:28:23,224 - services.app - INFO - Request completed: 404
2025-07-04 11:29:13,756 - services.app - INFO - Request started: GET /health
2025-07-04 11:29:13,762 - services.app - INFO - Request completed: 200
2025-07-04 11:29:21,353 - services.app - INFO - Request started: GET /data/backtest
2025-07-04 11:29:21,356 - services.app - INFO - Request completed: 404
2025-07-04 11:29:22,591 - services.app - INFO - Request started: GET /plugins
2025-07-04 11:29:22,592 - services.app - INFO - Request completed: 200
2025-07-04 11:29:27,294 - services.app - INFO - Request started: GET /data/factors
2025-07-04 11:29:27,298 - services.app - INFO - Request completed: 404
2025-07-04 11:30:29,633 - services.app - INFO - Request started: GET /data/factors
2025-07-04 11:30:32,076 - services.app - INFO - Request completed: 200
2025-07-04 11:30:33,310 - services.app - INFO - Request started: GET /data/backtest
2025-07-04 11:30:33,347 - services.app - INFO - Request completed: 200
2025-07-04 11:30:43,755 - services.app - INFO - Request started: GET /market-data/quote/AAPL
2025-07-04 11:30:43,756 - app.market_data - INFO - Subscribed to AAPL
2025-07-04 11:30:45,758 - services.app - INFO - Request completed: 404
2025-07-04 11:30:56,653 - services.app - INFO - Request started: GET /docs
2025-07-04 11:30:56,661 - services.app - INFO - Request completed: 200
2025-07-04 11:31:20,568 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 11:31:23,728 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:31:23,728 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 11:31:23,729 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:23,730 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:23,731 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 11:31:23,732 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:23,732 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 11:31:23,732 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:23,732 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 11:31:23,775 - services.app - INFO - Application startup: Celery worker initialized
2025-07-04 11:31:23,775 - app.market_data - INFO - Market data manager started
2025-07-04 11:31:23,775 - services.app - INFO - Market data manager started successfully
2025-07-04 11:31:23,777 - services.app - ERROR - Error enqueueing test Celery task: cannot import name 'get_alpaca_service' from 'app.integrations' (/Users/benjaminwilliams/value_partner/services/app/integrations/__init__.py)
2025-07-04 11:31:25,916 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 11:31:28,324 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:31:28,325 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 11:31:28,325 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:28,326 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 11:31:28,327 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:28,327 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 11:31:28,327 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:28,327 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 11:31:28,327 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:28,327 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 11:31:28,327 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:28,327 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 11:31:28,327 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:28,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 11:31:28,328 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:28,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 11:31:28,328 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:28,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 11:31:28,328 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:28,328 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 11:31:28,366 - services.app - INFO - Application startup: Celery worker initialized
2025-07-04 11:31:28,366 - app.market_data - INFO - Market data manager started
2025-07-04 11:31:28,366 - services.app - INFO - Market data manager started successfully
2025-07-04 11:31:28,367 - services.app - ERROR - Error enqueueing test Celery task: cannot import name 'get_alpaca_service' from 'app.integrations' (/Users/benjaminwilliams/value_partner/services/app/integrations/__init__.py)
2025-07-04 11:31:35,725 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 11:31:40,183 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 11:31:40,183 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 11:31:42,695 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:31:42,697 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 11:31:42,697 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:42,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 11:31:42,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:42,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:42,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 11:31:42,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:31:42,702 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 11:31:42,771 - services.app - INFO - Application startup: Celery worker initialized
2025-07-04 11:31:42,771 - app.market_data - INFO - Market data manager started
2025-07-04 11:31:42,772 - services.app - INFO - Market data manager started successfully
2025-07-04 11:31:42,773 - services.app - ERROR - Error enqueueing test Celery task: cannot import name 'get_alpaca_service' from 'app.integrations' (/Users/benjaminwilliams/value_partner/services/app/integrations/__init__.py)
2025-07-04 11:31:44,323 - services.app - INFO - Request started: GET /health
2025-07-04 11:31:44,324 - services.app - INFO - Request completed: 200
2025-07-04 11:31:49,692 - services.app - INFO - Request started: GET /market-data/quote/AAPL
2025-07-04 11:31:49,694 - app.market_data - INFO - Subscribed to AAPL
2025-07-04 11:31:50,926 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:31:51,511 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:31:51,696 - services.app - INFO - Request completed: 404
2025-07-04 11:31:53,098 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:31:53,099 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:31:54,672 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:31:54,672 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:31:56,273 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:31:56,275 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:31:57,866 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:31:57,867 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:31:59,459 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:31:59,462 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:01,298 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:01,301 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:02,906 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:02,907 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:03,510 - services.app - INFO - Request started: GET /market-data/quote/AAPL
2025-07-04 11:32:03,511 - app.market_data - INFO - Subscribed to AAPL
2025-07-04 11:32:04,469 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:04,470 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:05,512 - services.app - INFO - Request completed: 404
2025-07-04 11:32:06,223 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:06,225 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:09,544 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:09,545 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:11,831 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:11,832 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:13,416 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:13,417 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:14,999 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:15,000 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:16,555 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:16,556 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:18,134 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:18,136 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:19,712 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:19,714 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:21,300 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:21,301 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:22,885 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:22,885 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:27,890 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 11:32:31,712 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 11:32:31,713 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 11:32:33,988 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:32:33,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 11:32:33,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:33,991 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 11:32:33,991 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:33,991 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 11:32:33,991 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 11:32:33,992 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:33,993 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 11:32:34,053 - services.app - INFO - Application startup: Celery worker initialized
2025-07-04 11:32:34,053 - app.market_data - INFO - Market data manager started
2025-07-04 11:32:34,053 - services.app - INFO - Market data manager started successfully
2025-07-04 11:32:34,055 - services.app - ERROR - Error enqueueing test Celery task: cannot import name 'get_alpaca_service' from 'app.integrations' (/Users/benjaminwilliams/value_partner/services/app/integrations/__init__.py)
2025-07-04 11:32:42,184 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 11:32:45,776 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 11:32:45,777 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 11:32:47,883 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 11:32:47,884 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 11:32:47,884 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 11:32:47,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:47,888 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 11:32:47,888 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:47,888 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 11:32:47,888 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:47,888 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 11:32:47,888 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 11:32:47,889 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 11:32:47,954 - services.app - INFO - Application startup: Celery worker initialized
2025-07-04 11:32:47,954 - app.market_data - INFO - Market data manager started
2025-07-04 11:32:47,954 - services.app - INFO - Market data manager started successfully
2025-07-04 11:32:47,955 - services.app - ERROR - Error enqueueing test Celery task: cannot import name 'get_alpaca_service' from 'app.integrations' (/Users/benjaminwilliams/value_partner/services/app/integrations/__init__.py)
2025-07-04 11:32:47,959 - services.app - INFO - Request started: GET /market-data/quote/AAPL
2025-07-04 11:32:47,961 - app.market_data - INFO - Subscribed to AAPL
2025-07-04 11:32:49,963 - services.app - INFO - Request completed: 200
2025-07-04 11:32:51,367 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:51,953 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:53,557 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:53,559 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:55,152 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:55,153 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:56,771 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:56,772 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:32:56,882 - services.app - INFO - Request started: GET /market-data/quote/TSLA
2025-07-04 11:32:56,884 - app.market_data - INFO - Subscribed to TSLA
2025-07-04 11:32:58,886 - services.app - INFO - Request completed: 200
2025-07-04 11:32:59,895 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:32:59,896 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:00,160 - services.app - INFO - Request started: GET /data/factors
2025-07-04 11:33:00,431 - services.app - INFO - Request completed: 200
2025-07-04 11:33:00,535 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:01,129 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:01,972 - services.app - INFO - Request started: GET /data/backtest
2025-07-04 11:33:01,989 - services.app - INFO - Request completed: 200
2025-07-04 11:33:02,699 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:02,700 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:03,265 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:03,267 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:04,855 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:04,857 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:05,431 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:05,432 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:07,033 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:07,035 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:07,580 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:07,581 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:09,309 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:09,310 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:11,223 - services.app - INFO - Request started: GET /docs
2025-07-04 11:33:11,224 - services.app - INFO - Request completed: 200
2025-07-04 11:33:11,367 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:11,368 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:12,960 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:12,963 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:13,652 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:13,654 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:15,305 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:15,305 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:15,900 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:15,902 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:17,488 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:17,490 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:18,089 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:18,091 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:19,699 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:19,700 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:20,301 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:20,301 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:21,887 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:21,888 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:22,463 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:22,465 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:24,036 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:24,039 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:24,610 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:24,613 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:26,212 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:26,213 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:26,827 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:26,829 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:28,453 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:28,457 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:29,048 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:29,050 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:30,718 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:30,721 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:31,331 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:31,334 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:32,957 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:32,958 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:33,562 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:33,564 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:35,176 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:35,177 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:36,098 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:36,099 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:37,709 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:37,710 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:38,312 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:38,315 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:39,983 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:39,986 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:40,597 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:40,600 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:42,197 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:42,198 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:42,791 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:42,792 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:44,398 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:44,402 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:45,008 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:45,010 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:46,611 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:46,613 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:47,209 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:47,211 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:48,851 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:48,853 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:49,442 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:49,444 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:51,112 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:51,113 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:51,705 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:51,707 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:53,290 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:53,293 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:53,892 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:53,894 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:55,536 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:55,539 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:56,139 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:56,142 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:57,745 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:57,746 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:58,341 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:58,344 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:33:59,973 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:33:59,974 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:00,560 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:00,563 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:02,159 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:02,160 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:02,742 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:02,742 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:04,360 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:04,362 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:05,001 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:05,003 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:06,602 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:06,603 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:07,200 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:07,203 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:08,874 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:08,876 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:09,780 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:09,782 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:11,554 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:11,557 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:12,170 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:12,173 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:13,794 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:13,796 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:14,463 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:14,466 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:16,077 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:16,080 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:16,689 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:16,692 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:18,296 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:18,299 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:18,880 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:18,883 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:20,482 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:20,485 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:21,079 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:21,081 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:22,770 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:22,771 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:23,354 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:23,354 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:25,044 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:25,046 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:25,626 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:25,627 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:27,260 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:27,262 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:27,857 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:27,861 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:29,468 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:29,470 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:30,065 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:30,066 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:31,717 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:31,720 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:33,775 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:33,778 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:35,388 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:35,390 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:35,996 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:35,998 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:37,624 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:37,627 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:38,226 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:38,228 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:39,852 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:39,855 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:40,451 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:40,454 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:42,060 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:42,062 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:42,658 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:42,660 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:44,269 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:44,272 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:44,876 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:44,879 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:46,494 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:46,497 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:47,095 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:47,096 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:48,713 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:48,716 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:49,308 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:49,310 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:50,932 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:50,933 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:51,547 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:51,549 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:53,162 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:53,165 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:53,801 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:53,804 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:55,432 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:55,435 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:56,026 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:56,028 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:57,670 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:57,673 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:58,283 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:58,285 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:34:59,886 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:34:59,887 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:00,491 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:00,494 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:02,116 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:02,118 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:02,734 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:02,737 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:04,332 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:04,335 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:04,918 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:04,919 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:06,508 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:06,511 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:07,093 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:07,094 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:08,818 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:08,821 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:10,735 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:10,738 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:13,990 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:13,992 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:14,565 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:14,568 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:16,170 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:16,173 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:16,787 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:16,790 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:18,408 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:18,411 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:19,031 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:19,033 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:20,639 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:20,642 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:21,238 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:21,240 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:22,860 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:22,861 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:23,484 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:23,486 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:25,138 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:25,141 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:25,767 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:25,770 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:27,387 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:27,391 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:27,995 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:27,997 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:29,597 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:29,600 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:30,247 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:30,250 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:31,881 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:31,883 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:32,482 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:32,485 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:34,126 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:34,128 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:34,777 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:34,780 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:36,415 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:36,417 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:37,035 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:37,037 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:38,644 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:38,647 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:39,260 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:39,263 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:40,921 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:40,922 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:41,512 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:41,515 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:43,189 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:43,190 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:43,812 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:43,815 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:45,405 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:45,408 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:46,014 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:46,017 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:47,603 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:47,604 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:48,177 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:48,178 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:49,773 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:49,776 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:50,389 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:50,391 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:51,986 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:51,988 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:52,580 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:52,583 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:54,194 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:54,196 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:54,775 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:54,776 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:56,413 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:56,414 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:56,989 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:56,990 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:58,585 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:58,586 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:35:59,177 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:35:59,178 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:00,816 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:00,819 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:01,441 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:01,443 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:03,046 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:03,048 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:03,635 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:03,638 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:05,248 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:05,250 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:05,852 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:05,853 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:07,470 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:07,473 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:08,060 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:08,061 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:11,225 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:11,226 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:12,071 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:12,074 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:13,692 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:13,695 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:14,303 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:14,306 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:15,906 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:15,908 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:16,522 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:16,525 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:18,196 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:18,199 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:18,785 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:18,787 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:20,406 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:20,408 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:21,156 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:21,158 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:22,787 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:22,790 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:23,371 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:23,371 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:24,998 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:24,998 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:25,602 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:25,604 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:27,232 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:27,234 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:27,819 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:27,822 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:29,445 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:29,447 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:30,074 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:30,076 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:31,689 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:31,691 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:32,279 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:32,281 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:33,874 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:33,876 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:34,780 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:34,783 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:36,400 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:36,402 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:37,009 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:37,012 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:38,633 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:38,636 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:39,289 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:39,290 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:40,903 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:40,905 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:41,510 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:41,513 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:43,114 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:43,117 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:43,685 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:43,686 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:45,304 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:45,306 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:45,911 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:45,911 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:47,542 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:47,545 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:48,159 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:48,161 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:49,769 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:49,772 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:50,369 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:50,372 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:51,994 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:51,996 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:52,606 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:52,608 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:54,250 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:54,252 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:54,845 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:54,848 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:56,432 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:56,434 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:57,019 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:57,020 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:58,644 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:58,647 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:36:59,227 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:36:59,228 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:00,814 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:00,815 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:01,394 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:01,395 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:02,992 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:02,994 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:03,571 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:03,573 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:05,167 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:05,167 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:05,752 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:05,754 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:07,347 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:07,350 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:07,964 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:07,964 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:09,662 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:09,663 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:11,623 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:11,626 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:13,205 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:13,206 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:13,827 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:13,828 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:15,419 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:15,421 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:16,107 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:16,109 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:17,706 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:17,709 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:18,291 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:18,292 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:19,891 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:19,892 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:20,471 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:20,472 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:22,050 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:22,052 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:22,644 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:22,647 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:24,240 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:24,243 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:24,856 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:24,858 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:26,450 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:26,451 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:27,029 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:27,030 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:28,626 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:28,629 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:29,216 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:29,218 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:30,843 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:30,845 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:31,434 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:31,436 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:33,053 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:33,055 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:33,649 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:33,650 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:35,251 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/AAPL?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=AAPL&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:35,252 - app.market_data - ERROR - Failed to update quote for AAPL: Expecting value: line 1 column 1 (char 0)
2025-07-04 11:37:35,834 - yfinance - ERROR - 429 Client Error: Too Many Requests for url: https://query2.finance.yahoo.com/v10/finance/quoteSummary/TSLA?modules=financialData%2CquoteType%2CdefaultKeyStatistics%2CassetProfile%2CsummaryDetail&corsDomain=finance.yahoo.com&formatted=false&symbol=TSLA&crumb=Edge%3A+Too+Many+Requests
2025-07-04 11:37:35,835 - app.market_data - ERROR - Failed to update quote for TSLA: Expecting value: line 1 column 1 (char 0)
2025-07-04 15:00:39,286 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 15:00:42,283 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 15:00:42,284 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 15:00:42,284 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:42,285 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 15:00:42,285 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:42,285 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 15:00:42,285 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:42,285 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 15:00:42,285 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:42,285 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 15:00:42,286 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:42,286 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 15:00:42,286 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:42,286 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 15:00:42,286 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:42,286 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 15:00:42,286 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:42,286 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 15:00:42,286 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:42,287 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 15:00:42,404 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 15:00:42,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 15:00:42,417 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 15:00:42,417 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (123, 1, 0)
2025-07-04 15:00:42,424 - app.error_handling - ERROR - Error recorded [external_api_1751662842417] external_api: (sqlite3.OperationalError) no such column: users.hashed_password
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?]
[parameters: (123, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 15:00:42,424 - root - ERROR - Error creating link token=*** no such column: users.hashed_password
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?]
[parameters: (123, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 15:00:42,425 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 15:00:42,425 - services.app - INFO - Request completed: 503
2025-07-04 15:00:42,426 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 15:00:42,427 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 15:00:42,427 - services.app - INFO - Request completed: 200
2025-07-04 15:00:42,428 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 15:00:42,428 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 15:00:42,429 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 15:00:42,429 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 15:00:42,429 - sqlalchemy.engine.Engine - INFO - [generated in 0.00008s] ()
2025-07-04 15:00:44,496 - services.app - INFO - Request completed: 200
2025-07-04 15:00:44,498 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 15:00:44,507 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 15:00:44,507 - services.app - DEBUG - Debug message with extra data
2025-07-04 15:00:44,508 - services.app - INFO - Info message
2025-07-04 15:00:44,508 - services.app - WARNING - Warning message
2025-07-04 15:00:44,508 - services.app - ERROR - Error message
2025-07-04 15:00:44,635 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 15:00:44,635 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 15:00:44,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:44,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 15:00:44,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:44,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 15:00:44,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 15:00:44,638 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:19:02,544 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:19:02,546 - services.app - DEBUG - Debug message with extra data
2025-07-04 16:19:02,546 - services.app - INFO - Info message
2025-07-04 16:19:02,546 - services.app - WARNING - Warning message
2025-07-04 16:19:02,546 - services.app - ERROR - Error message
2025-07-04 16:20:01,686 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:20:01,688 - services.app - DEBUG - Debug message with extra data
2025-07-04 16:20:01,688 - services.app - INFO - Info message
2025-07-04 16:20:01,688 - services.app - WARNING - Warning message
2025-07-04 16:20:01,688 - services.app - ERROR - Error message
2025-07-04 16:21:20,600 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:21:23,132 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:23,133 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:21:23,133 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,135 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:21:23,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,137 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:21:23,165 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 16:21:23,249 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:23,250 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 16:21:23,250 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (123, 1, 0)
2025-07-04 16:21:23,258 - app.error_handling - ERROR - Error recorded [external_api_1751667683250] external_api: (sqlite3.OperationalError) no such column: users.hashed_password
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?]
[parameters: (123, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:21:23,259 - root - ERROR - Error creating link token=*** no such column: users.hashed_password
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?]
[parameters: (123, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:21:23,259 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:21:23,260 - services.app - INFO - Request completed: 503
2025-07-04 16:21:23,260 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 16:21:23,261 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 16:21:23,261 - services.app - INFO - Request completed: 200
2025-07-04 16:21:23,262 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 16:21:23,262 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 16:21:23,262 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:23,263 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 16:21:23,263 - sqlalchemy.engine.Engine - INFO - [generated in 0.00007s] ()
2025-07-04 16:21:23,263 - services.app - INFO - Request completed: 206
2025-07-04 16:21:23,263 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 206 Partial Content"
2025-07-04 16:21:23,265 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:21:23,265 - services.app - DEBUG - Debug message with extra data
2025-07-04 16:21:23,265 - services.app - INFO - Info message
2025-07-04 16:21:23,265 - services.app - WARNING - Warning message
2025-07-04 16:21:23,265 - services.app - ERROR - Error message
2025-07-04 16:21:23,436 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:23,436 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:21:23,436 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:21:23,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:23,439 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:21:23,446 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:23,446 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:21:23,446 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ('test@example.com', 1, 0)
2025-07-04 16:21:23,447 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:21:23,581 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:23,583 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 16:21:23,583 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ()
2025-07-04 16:21:23,583 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:21:23,725 - services.app - INFO - Request started: GET /health
2025-07-04 16:21:23,726 - services.app - INFO - Request completed: 200
2025-07-04 16:21:23,726 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 16:21:23,727 - services.app - INFO - Request started: GET /plugins
2025-07-04 16:21:23,728 - services.app - INFO - Request completed: 200
2025-07-04 16:21:23,728 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 16:21:24,127 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:24,127 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:21:24,127 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,127 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:21:24,127 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:21:24,128 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,130 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:21:24,130 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:21:24,130 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:21:24,130 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,132 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:21:24,132 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:21:24,132 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:21:24,133 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,134 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:21:24,134 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,135 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:21:24,135 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:21:24,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:21:24,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,138 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:21:24,138 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,138 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:21:24,138 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,138 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:21:24,138 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,138 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:21:24,138 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:21:24,139 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:21:24,139 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,139 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:21:24,139 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,139 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:21:24,140 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:21:24,140 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:21:24,140 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,140 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:21:24,140 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:21:24,141 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:21:24,141 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,141 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:21:24,141 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,142 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:21:24,142 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:21:24,142 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:21:24,142 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,143 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:21:24,143 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:21:24,143 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:21:24,143 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,144 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:21:24,144 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,144 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:21:24,144 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:21:24,145 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:21:24,145 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,145 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:21:24,146 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:21:24,146 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:21:24,146 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,146 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:21:24,146 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,147 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:21:24,147 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:21:24,148 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:21:24,148 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,148 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:21:24,148 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,148 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:21:24,149 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:21:24,150 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:24,150 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:21:24,150 - sqlalchemy.engine.Engine - INFO - [cached since 0.7043s ago] ('test@example.com', 1, 0)
2025-07-04 16:21:24,151 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:21:24,151 - services.app - ERROR - Request failed: (sqlite3.OperationalError) no such column: users.hashed_password
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?]
[parameters: ('test***@***.example.com', 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:21:24,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,470 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:21:24,470 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,470 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:21:24,470 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,470 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:21:24,470 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:21:24,471 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:21:24,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,472 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:21:24,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,472 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:21:24,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,473 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:21:24,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,473 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:21:24,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,474 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:21:24,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,474 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:21:24,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:21:24,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:21:24,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,477 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:21:24,477 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:21:24,477 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:21:24,477 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,478 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:21:24,478 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,478 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:21:24,478 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:21:24,479 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:21:24,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,479 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:21:24,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:21:24,479 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:21:24,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,480 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:21:24,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,480 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:21:24,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:21:24,481 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:21:24,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,481 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:21:24,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:21:24,482 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:21:24,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:21:24,482 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:21:24,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,483 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:21:24,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:21:24,483 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:21:24,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,484 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:21:24,484 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:21:24,484 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:21:24,484 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,485 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:21:24,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,485 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:21:24,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:21:24,486 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:21:24,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,486 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:21:24,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,487 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:21:24,488 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:21:24,488 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:24,489 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:21:24,489 - sqlalchemy.engine.Engine - INFO - [cached since 1.043s ago] ('test@example.com', 1, 0)
2025-07-04 16:21:24,489 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:21:24,489 - services.app - ERROR - Request failed: (sqlite3.OperationalError) no such column: users.hashed_password
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?]
[parameters: ('test***@***.example.com', 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:21:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:21:24,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:21:24,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,766 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:21:24,766 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,767 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:21:24,767 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,767 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:21:24,767 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,768 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:21:24,768 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,768 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:21:24,768 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,769 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:21:24,769 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,769 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:21:24,769 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:21:24,770 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:21:24,770 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,770 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:21:24,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:24,770 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:21:24,770 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:21:24,771 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:21:24,772 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:21:24,773 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:21:24,773 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:21:24,773 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:21:24,773 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,774 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:21:24,774 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:21:24,774 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:21:24,774 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,775 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:21:24,775 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:21:24,775 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:21:24,775 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,775 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:21:24,775 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:21:24,776 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:21:24,776 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:21:24,776 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:21:24,776 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,777 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:21:24,777 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:21:24,777 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:21:24,777 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,777 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:21:24,777 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,778 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:21:24,778 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:21:24,779 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:21:24,779 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,779 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:21:24,779 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:21:24,780 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:21:24,780 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,780 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:21:24,780 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,781 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:21:24,781 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:21:24,781 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:21:24,781 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:21:24,782 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:21:24,782 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:21:24,782 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:21:24,783 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:21:24,784 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:21:24,784 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:21:24,784 - sqlalchemy.engine.Engine - INFO - [cached since 1.338s ago] ('test@example.com', 1, 0)
2025-07-04 16:21:24,784 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:21:24,785 - services.app - ERROR - Request failed: (sqlite3.OperationalError) no such column: users.hashed_password
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?]
[parameters: ('test***@***.example.com', 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:23:43,756 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:23:46,399 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:23:46,399 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:23:46,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,400 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:23:46,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,400 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:23:46,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,400 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:23:46,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,400 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:23:46,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:23:46,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:23:46,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,402 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:23:46,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:46,402 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:23:46,402 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:23:46,403 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:23:46,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:23:46,403 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:23:46,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:23:46,403 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:23:46,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:23:46,403 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:23:46,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:23:46,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:23:46,405 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:23:46,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:23:46,405 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:23:46,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:23:46,405 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:23:46,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:23:46,405 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:23:46,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:23:46,406 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:23:46,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:23:46,406 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:23:46,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:23:46,406 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:23:46,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:23:46,406 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:23:46,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:23:46,407 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:23:46,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:23:46,407 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:23:46,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:23:46,407 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:23:46,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:23:46,407 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:23:46,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:23:46,408 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:23:46,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:23:46,408 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:23:46,437 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 16:23:46,533 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:23:46,534 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 16:23:46,534 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (123, 1, 0)
2025-07-04 16:23:46,542 - app.error_handling - ERROR - Error recorded [external_api_1751667826534] external_api: (sqlite3.OperationalError) no such table: users
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?]
[parameters: (123, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:23:46,542 - root - ERROR - Error creating link token=*** no such table: users
[SQL: SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?]
[parameters: (123, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:23:46,543 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:23:46,543 - services.app - ERROR - Request failed: (sqlite3.ProgrammingError) SQLite objects created in a thread can only be used in that same thread. The object was created in thread id 6304067584 and this is thread id 6320893952.
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-04 16:23:46,973 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:23:46,974 - services.app - DEBUG - Debug message with extra data
2025-07-04 16:23:46,974 - services.app - INFO - Info message
2025-07-04 16:23:46,974 - services.app - WARNING - Warning message
2025-07-04 16:23:46,974 - services.app - ERROR - Error message
2025-07-04 16:23:47,144 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:23:47,144 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:23:47,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:23:47,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:47,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:23:47,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:47,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:23:47,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:23:47,146 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:23:47,807 - sqlalchemy.pool.impl.SingletonThreadPool - ERROR - Exception during reset or similar
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 988, in _finalize_fairy
    fairy._reset(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1438, in _reset
    pool._dialect.do_rollback(self)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 692, in do_rollback
    dbapi_connection.rollback()
sqlite3.ProgrammingError: SQLite objects created in a thread can only be used in that same thread. The object was created in thread id 6304067584 and this is thread id 8773689088.
2025-07-04 16:23:47,810 - sqlalchemy.pool.impl.SingletonThreadPool - ERROR - Exception terminating connection <sqlite3.Connection object at 0x176ba0310>
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 988, in _finalize_fairy
    fairy._reset(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1438, in _reset
    pool._dialect.do_rollback(self)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 692, in do_rollback
    dbapi_connection.rollback()
sqlite3.ProgrammingError: SQLite objects created in a thread can only be used in that same thread. The object was created in thread id 6304067584 and this is thread id 8773689088.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 377, in _close_connection
    self._dialect.do_terminate(connection)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 698, in do_terminate
    self.do_close(dbapi_connection)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 701, in do_close
    dbapi_connection.close()
sqlite3.ProgrammingError: SQLite objects created in a thread can only be used in that same thread. The object was created in thread id 6304067584 and this is thread id 8773689088.
2025-07-04 16:26:44,796 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:26:44,798 - services.app - DEBUG - Debug message with extra data
2025-07-04 16:26:44,798 - services.app - INFO - Info message
2025-07-04 16:26:44,798 - services.app - WARNING - Warning message
2025-07-04 16:26:44,798 - services.app - ERROR - Error message
2025-07-04 16:28:55,776 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:28:58,555 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:58,556 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:28:58,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:28:58,560 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,561 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:28:58,561 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,561 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:28:58,561 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,561 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:58,591 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 16:28:58,685 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:58,686 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 16:28:58,687 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (123, 1, 0)
2025-07-04 16:28:58,688 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:28:58,688 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 16:28:58,688 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:28:58,696 - app.error_handling - ERROR - Error recorded [external_api_1751668138688] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 16:28:58,697 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 16:28:58,697 - services.app - INFO - Request completed: 503
2025-07-04 16:28:58,698 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 16:28:58,699 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 16:28:58,699 - services.app - INFO - Request completed: 200
2025-07-04 16:28:58,700 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 16:28:58,700 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 16:28:58,701 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:58,701 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 16:28:58,701 - sqlalchemy.engine.Engine - INFO - [generated in 0.00008s] ()
2025-07-04 16:28:58,702 - services.app - INFO - Request completed: 206
2025-07-04 16:28:58,702 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 206 Partial Content"
2025-07-04 16:28:58,704 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:28:58,705 - services.app - DEBUG - Debug message with extra data
2025-07-04 16:28:58,705 - services.app - INFO - Info message
2025-07-04 16:28:58,705 - services.app - WARNING - Warning message
2025-07-04 16:28:58,705 - services.app - ERROR - Error message
2025-07-04 16:28:58,883 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:58,883 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:58,892 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:58,892 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:28:58,892 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,893 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:28:58,894 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:58,894 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:58,901 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:58,902 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:28:58,902 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', 1, 0)
2025-07-04 16:28:58,903 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:28:58,903 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 16:28:58,903 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:58,904 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:58,904 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:28:58,904 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] (1,)
2025-07-04 16:28:58,905 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:28:58,971 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:58,973 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 16:28:58,974 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ()
2025-07-04 16:28:58,974 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:28:58,974 - sqlalchemy.engine.Engine - INFO - [cached since 0.07273s ago] ('test@example.com', 1, 0)
2025-07-04 16:28:58,975 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:28:59,014 - services.app - INFO - Request started: GET /health
2025-07-04 16:28:59,014 - services.app - INFO - Request completed: 200
2025-07-04 16:28:59,015 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 16:28:59,016 - services.app - INFO - Request started: GET /plugins
2025-07-04 16:28:59,016 - services.app - INFO - Request completed: 200
2025-07-04 16:28:59,017 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,306 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:28:59,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,307 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:28:59,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,307 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:28:59,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,307 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:28:59,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,307 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:28:59,307 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,309 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:28:59,309 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,309 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:28:59,309 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,312 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:28:59,312 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:28:59,313 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:28:59,313 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,314 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:28:59,314 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,315 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:28:59,315 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:28:59,315 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:28:59,315 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,316 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:59,316 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,316 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:28:59,316 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,316 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:28:59,316 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,316 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:28:59,316 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:28:59,317 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,318 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:28:59,319 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:28:59,319 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:28:59,319 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,320 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:28:59,320 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,320 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:28:59,320 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:28:59,321 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:28:59,321 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,321 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:28:59,321 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:28:59,322 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:28:59,322 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:28:59,322 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:28:59,322 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,323 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:28:59,323 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:28:59,323 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:28:59,323 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,324 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:28:59,324 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:28:59,324 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:28:59,324 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:28:59,325 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:28:59,325 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,325 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:28:59,325 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:28:59,326 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:28:59,326 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,326 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:28:59,327 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:28:59,327 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:28:59,327 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,327 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:28:59,327 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,328 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:28:59,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:28:59,329 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:28:59,329 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,329 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:28:59,329 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:28:59,330 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:59,330 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:28:59,331 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,331 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:28:59,332 - sqlalchemy.engine.Engine - INFO - [cached since 0.43s ago] ('test@example.com', 1, 0)
2025-07-04 16:28:59,332 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 16:28:59,594 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:28:59,595 - sqlalchemy.engine.Engine - INFO - [cached since 0.692s ago] ('test@example.com', '$2b$12$IcYL.U3AGp/u8ZpWeRAIL.mKp.liL3cS8R0nWqCCP.0c.f94dOr.W', None, None, None)
2025-07-04 16:28:59,595 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:59,596 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,596 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:28:59,596 - sqlalchemy.engine.Engine - INFO - [cached since 0.6916s ago] (1,)
2025-07-04 16:28:59,597 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 16:28:59,598 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1,)
2025-07-04 16:28:59,598 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:28:59,598 - services.app - INFO - Request completed: 201
2025-07-04 16:28:59,599 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 16:28:59,599 - services.app - INFO - Request started: POST /auth/token
2025-07-04 16:28:59,602 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,602 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:28:59,602 - sqlalchemy.engine.Engine - INFO - [cached since 0.7008s ago] ('test@example.com', 1, 0)
2025-07-04 16:28:59,852 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:28:59,852 - services.app - INFO - Request completed: 200
2025-07-04 16:28:59,853 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 200 OK"
2025-07-04 16:28:59,854 - services.app - INFO - Request started: POST /strategies/
2025-07-04 16:28:59,855 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,855 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:28:59,855 - sqlalchemy.engine.Engine - INFO - [cached since 0.9536s ago] ('test@example.com', 1, 0)
2025-07-04 16:28:59,856 - sqlalchemy.engine.Engine - INFO - INSERT INTO strategies (user_id, name, description, rebalance_threshold) VALUES (?, ?, ?, ?)
2025-07-04 16:28:59,856 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] (1, 'Growth', 'Growth strategy', 5.0)
2025-07-04 16:28:59,857 - sqlalchemy.engine.Engine - INFO - INSERT INTO strategy_holdings (strategy_id, symbol, target_weight) VALUES (?, ?, ?) RETURNING id
2025-07-04 16:28:59,857 - sqlalchemy.engine.Engine - INFO - [generated in 0.00004s (insertmanyvalues) 1/2 (ordered; batch not supported)] (1, 'AAPL', 0.5)
2025-07-04 16:28:59,857 - sqlalchemy.engine.Engine - INFO - INSERT INTO strategy_holdings (strategy_id, symbol, target_weight) VALUES (?, ?, ?) RETURNING id
2025-07-04 16:28:59,857 - sqlalchemy.engine.Engine - INFO - [insertmanyvalues 2/2 (ordered; batch not supported)] (1, 'GOOG', 0.5)
2025-07-04 16:28:59,858 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:59,858 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,858 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id, strategies.user_id, strategies.name, strategies.description, strategies.rebalance_threshold 
FROM strategies 
WHERE strategies.id = ?
2025-07-04 16:28:59,859 - sqlalchemy.engine.Engine - INFO - [generated in 0.00011s] (1,)
2025-07-04 16:28:59,859 - sqlalchemy.engine.Engine - INFO - SELECT strategy_holdings.id AS strategy_holdings_id, strategy_holdings.strategy_id AS strategy_holdings_strategy_id, strategy_holdings.symbol AS strategy_holdings_symbol, strategy_holdings.target_weight AS strategy_holdings_target_weight 
FROM strategy_holdings 
WHERE ? = strategy_holdings.strategy_id
2025-07-04 16:28:59,859 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1,)
2025-07-04 16:28:59,860 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:28:59,860 - services.app - INFO - Request completed: 200
2025-07-04 16:28:59,861 - httpx - INFO - HTTP Request: POST http://testserver/strategies/ "HTTP/1.1 200 OK"
2025-07-04 16:28:59,862 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,862 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:28:59,862 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,862 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:28:59,862 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,862 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:28:59,862 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,862 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:28:59,862 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:28:59,863 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,864 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:28:59,864 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:28:59,865 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:28:59,865 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:28:59,866 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:28:59,866 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,866 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:28:59,866 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,867 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:28:59,867 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:28:59,868 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:28:59,868 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:28:59,869 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:28:59,869 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:28:59,869 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:59,869 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,870 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:28:59,871 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:28:59,872 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:28:59,872 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:28:59,872 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,873 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:28:59,873 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,873 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:28:59,873 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:28:59,874 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:28:59,874 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,874 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:28:59,875 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:28:59,875 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:28:59,875 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,876 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:28:59,876 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,876 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:28:59,876 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:28:59,877 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:28:59,877 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,877 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:28:59,877 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:28:59,878 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:28:59,878 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,878 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:28:59,878 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:28:59,879 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:28:59,879 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 16:28:59,880 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:28:59,880 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,880 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:28:59,881 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 16:28:59,881 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:28:59,881 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,882 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:28:59,882 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:28:59,882 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:28:59,883 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:28:59,883 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:28:59,883 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:28:59,884 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:28:59,884 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:28:59,885 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:28:59,886 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:28:59,887 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:28:59,887 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:28:59,887 - sqlalchemy.engine.Engine - INFO - [cached since 0.9855s ago] ('test@example.com', 1, 0)
2025-07-04 16:29:00,155 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:29:00,155 - sqlalchemy.engine.Engine - INFO - [cached since 1.253s ago] ('test@example.com', '$2b$12$ePED1.uXZ6LsMGWqpTDrDeXTucE4ob99uFTcvjxEnss491bi4P/z6', None, None, None)
2025-07-04 16:29:00,156 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:29:00,156 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,156 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:29:00,156 - sqlalchemy.engine.Engine - INFO - [cached since 1.252s ago] (1,)
2025-07-04 16:29:00,157 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 16:29:00,157 - sqlalchemy.engine.Engine - INFO - [cached since 0.5595s ago] (1,)
2025-07-04 16:29:00,157 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:29:00,157 - services.app - INFO - Request completed: 201
2025-07-04 16:29:00,158 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 16:29:00,159 - services.app - INFO - Request started: POST /auth/token
2025-07-04 16:29:00,160 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,161 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:29:00,161 - sqlalchemy.engine.Engine - INFO - [cached since 1.259s ago] ('test@example.com', 1, 0)
2025-07-04 16:29:00,404 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:29:00,404 - services.app - INFO - Request completed: 200
2025-07-04 16:29:00,405 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 200 OK"
2025-07-04 16:29:00,406 - services.app - INFO - Request started: POST /strategies/
2025-07-04 16:29:00,407 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,407 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:29:00,407 - sqlalchemy.engine.Engine - INFO - [cached since 1.506s ago] ('test@example.com', 1, 0)
2025-07-04 16:29:00,408 - sqlalchemy.engine.Engine - INFO - INSERT INTO strategies (user_id, name, description, rebalance_threshold) VALUES (?, ?, ?, ?)
2025-07-04 16:29:00,408 - sqlalchemy.engine.Engine - INFO - [cached since 0.5517s ago] (1, 'Growth', 'Growth strategy', 5.0)
2025-07-04 16:29:00,408 - sqlalchemy.engine.Engine - INFO - INSERT INTO strategy_holdings (strategy_id, symbol, target_weight) VALUES (?, ?, ?) RETURNING id
2025-07-04 16:29:00,408 - sqlalchemy.engine.Engine - INFO - [cached since 0.5514s ago (insertmanyvalues) 1/2 (ordered; batch not supported)] (1, 'AAPL', 0.5)
2025-07-04 16:29:00,409 - sqlalchemy.engine.Engine - INFO - INSERT INTO strategy_holdings (strategy_id, symbol, target_weight) VALUES (?, ?, ?) RETURNING id
2025-07-04 16:29:00,409 - sqlalchemy.engine.Engine - INFO - [insertmanyvalues 2/2 (ordered; batch not supported)] (1, 'GOOG', 0.5)
2025-07-04 16:29:00,409 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:29:00,409 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,410 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id, strategies.user_id, strategies.name, strategies.description, strategies.rebalance_threshold 
FROM strategies 
WHERE strategies.id = ?
2025-07-04 16:29:00,410 - sqlalchemy.engine.Engine - INFO - [cached since 0.5513s ago] (1,)
2025-07-04 16:29:00,410 - sqlalchemy.engine.Engine - INFO - SELECT strategy_holdings.id AS strategy_holdings_id, strategy_holdings.strategy_id AS strategy_holdings_strategy_id, strategy_holdings.symbol AS strategy_holdings_symbol, strategy_holdings.target_weight AS strategy_holdings_target_weight 
FROM strategy_holdings 
WHERE ? = strategy_holdings.strategy_id
2025-07-04 16:29:00,410 - sqlalchemy.engine.Engine - INFO - [cached since 0.5509s ago] (1,)
2025-07-04 16:29:00,411 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:29:00,411 - services.app - INFO - Request completed: 200
2025-07-04 16:29:00,411 - httpx - INFO - HTTP Request: POST http://testserver/strategies/ "HTTP/1.1 200 OK"
2025-07-04 16:29:00,412 - services.app - INFO - Request started: GET /strategies/
2025-07-04 16:29:00,412 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,413 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:29:00,413 - sqlalchemy.engine.Engine - INFO - [cached since 1.511s ago] ('test@example.com', 1, 0)
2025-07-04 16:29:00,413 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE strategies.user_id = ?
 LIMIT ? OFFSET ?
2025-07-04 16:29:00,413 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1, 100, 0)
2025-07-04 16:29:00,414 - sqlalchemy.engine.Engine - INFO - SELECT strategy_holdings.id AS strategy_holdings_id, strategy_holdings.strategy_id AS strategy_holdings_strategy_id, strategy_holdings.symbol AS strategy_holdings_symbol, strategy_holdings.target_weight AS strategy_holdings_target_weight 
FROM strategy_holdings 
WHERE ? = strategy_holdings.strategy_id
2025-07-04 16:29:00,414 - sqlalchemy.engine.Engine - INFO - [cached since 0.5546s ago] (1,)
2025-07-04 16:29:00,414 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:29:00,414 - services.app - INFO - Request completed: 200
2025-07-04 16:29:00,415 - httpx - INFO - HTTP Request: GET http://testserver/strategies/ "HTTP/1.1 200 OK"
2025-07-04 16:29:00,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:29:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,417 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:29:00,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:29:00,417 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:29:00,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:29:00,418 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:29:00,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:29:00,419 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:29:00,419 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:29:00,420 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:29:00,420 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:29:00,420 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:29:00,420 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:29:00,421 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:29:00,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:29:00,421 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:29:00,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:29:00,422 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:29:00,422 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:29:00,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,422 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:29:00,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:29:00,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:29:00,424 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,424 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:29:00,424 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,424 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:29:00,424 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,424 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:29:00,424 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:29:00,424 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:29:00,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:29:00,425 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:29:00,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:29:00,425 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:29:00,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:29:00,426 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:29:00,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 16:29:00,427 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:29:00,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:29:00,427 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:29:00,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:29:00,428 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:29:00,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:29:00,428 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:29:00,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:29:00,429 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:29:00,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:29:00,429 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:29:00,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:29:00,430 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:29:00,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:29:00,430 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:29:00,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:29:00,431 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:29:00,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:29:00,431 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:29:00,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:29:00,432 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:29:00,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:29:00,433 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:29:00,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:29:00,433 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:29:00,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:29:00,434 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:29:00,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:29:00,435 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:29:00,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:29:00,435 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:29:00,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:29:00,436 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:29:00,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:29:00,436 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:29:00,437 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:29:00,438 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,438 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:29:00,438 - sqlalchemy.engine.Engine - INFO - [cached since 1.537s ago] ('test@example.com', 1, 0)
2025-07-04 16:29:00,679 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:29:00,679 - sqlalchemy.engine.Engine - INFO - [cached since 1.776s ago] ('test@example.com', '$2b$12$x7RMbx1ryo3cpMYam7SREOnH9iyYfWFH/X/HT3gUs4YKc8xbQaRJu', None, None, None)
2025-07-04 16:29:00,679 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:29:00,680 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,680 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:29:00,680 - sqlalchemy.engine.Engine - INFO - [cached since 1.776s ago] (1,)
2025-07-04 16:29:00,681 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 16:29:00,681 - sqlalchemy.engine.Engine - INFO - [cached since 1.083s ago] (1,)
2025-07-04 16:29:00,681 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:29:00,681 - services.app - INFO - Request completed: 201
2025-07-04 16:29:00,682 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 16:29:00,682 - services.app - INFO - Request started: POST /auth/token
2025-07-04 16:29:00,684 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,685 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:29:00,685 - sqlalchemy.engine.Engine - INFO - [cached since 1.783s ago] ('test@example.com', 1, 0)
2025-07-04 16:29:00,925 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:29:00,925 - services.app - INFO - Request completed: 200
2025-07-04 16:29:00,926 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 200 OK"
2025-07-04 16:29:00,927 - services.app - INFO - Request started: POST /strategies/
2025-07-04 16:29:00,928 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,928 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:29:00,928 - sqlalchemy.engine.Engine - INFO - [cached since 2.026s ago] ('test@example.com', 1, 0)
2025-07-04 16:29:00,929 - sqlalchemy.engine.Engine - INFO - INSERT INTO strategies (user_id, name, description, rebalance_threshold) VALUES (?, ?, ?, ?)
2025-07-04 16:29:00,929 - sqlalchemy.engine.Engine - INFO - [cached since 1.073s ago] (1, 'Value', 'Value strategy', 5.0)
2025-07-04 16:29:00,929 - sqlalchemy.engine.Engine - INFO - INSERT INTO strategy_holdings (strategy_id, symbol, target_weight) VALUES (?, ?, ?)
2025-07-04 16:29:00,929 - sqlalchemy.engine.Engine - INFO - [generated in 0.00010s] (1, 'MSFT', 1.0)
2025-07-04 16:29:00,930 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:29:00,930 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,930 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id, strategies.user_id, strategies.name, strategies.description, strategies.rebalance_threshold 
FROM strategies 
WHERE strategies.id = ?
2025-07-04 16:29:00,930 - sqlalchemy.engine.Engine - INFO - [cached since 1.072s ago] (1,)
2025-07-04 16:29:00,931 - sqlalchemy.engine.Engine - INFO - SELECT strategy_holdings.id AS strategy_holdings_id, strategy_holdings.strategy_id AS strategy_holdings_strategy_id, strategy_holdings.symbol AS strategy_holdings_symbol, strategy_holdings.target_weight AS strategy_holdings_target_weight 
FROM strategy_holdings 
WHERE ? = strategy_holdings.strategy_id
2025-07-04 16:29:00,931 - sqlalchemy.engine.Engine - INFO - [cached since 1.072s ago] (1,)
2025-07-04 16:29:00,931 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:29:00,931 - services.app - INFO - Request completed: 200
2025-07-04 16:29:00,932 - httpx - INFO - HTTP Request: POST http://testserver/strategies/ "HTTP/1.1 200 OK"
2025-07-04 16:29:00,932 - services.app - INFO - Request started: POST /strategies/1/rebalance
2025-07-04 16:29:00,933 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:29:00,933 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:29:00,933 - sqlalchemy.engine.Engine - INFO - [cached since 2.032s ago] ('test@example.com', 1, 0)
2025-07-04 16:29:00,934 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE strategies.id = ?
 LIMIT ? OFFSET ?
2025-07-04 16:29:00,934 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1, 1, 0)
2025-07-04 16:29:00,936 - sqlalchemy.engine.Engine - INFO - SELECT holdings.id AS holdings_id, holdings.account_id AS holdings_account_id, holdings.symbol AS holdings_symbol, holdings.name AS holdings_name, holdings.security_type AS holdings_security_type, holdings.cusip AS holdings_cusip, holdings.isin AS holdings_isin, holdings.quantity AS holdings_quantity, holdings.market_value AS holdings_market_value, holdings.cost_basis AS holdings_cost_basis, holdings.unit_price AS holdings_unit_price, holdings.cost_basis_per_share AS holdings_cost_basis_per_share, holdings.unrealized_pl AS holdings_unrealized_pl, holdings.unrealized_pl_pct AS holdings_unrealized_pl_pct, holdings.last_updated AS holdings_last_updated, holdings.created_at AS holdings_created_at 
FROM holdings 
WHERE EXISTS (SELECT 1 
FROM accounts 
WHERE accounts.id = holdings.account_id AND accounts.user_id = ?)
2025-07-04 16:29:00,936 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] (1,)
2025-07-04 16:29:00,936 - sqlalchemy.engine.Engine - INFO - SELECT strategy_holdings.id AS strategy_holdings_id, strategy_holdings.strategy_id AS strategy_holdings_strategy_id, strategy_holdings.symbol AS strategy_holdings_symbol, strategy_holdings.target_weight AS strategy_holdings_target_weight 
FROM strategy_holdings 
WHERE ? = strategy_holdings.strategy_id
2025-07-04 16:29:00,937 - sqlalchemy.engine.Engine - INFO - [cached since 1.077s ago] (1,)
2025-07-04 16:29:00,937 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:29:00,938 - services.app - INFO - Request completed: 200
2025-07-04 16:29:00,938 - httpx - INFO - HTTP Request: POST http://testserver/strategies/1/rebalance "HTTP/1.1 200 OK"
2025-07-04 16:34:01,737 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:34:04,358 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:04,359 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:34:04,359 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,361 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:34:04,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,363 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:34:04,363 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:34:04,364 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:34:04,364 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,364 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:34:04,364 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,365 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:34:04,365 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:34:04,365 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:34:04,365 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,366 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:34:04,366 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:34:04,366 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:34:04,366 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:34:04,367 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:34:04,367 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:04,367 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:34:04,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:34:04,368 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:34:04,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,368 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:34:04,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:34:04,369 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:34:04,369 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:04,369 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:34:04,369 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,370 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:34:04,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 16:34:04,370 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:34:04,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,371 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:04,371 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:34:04,372 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:34:04,372 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,372 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:34:04,372 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:04,373 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:04,373 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:34:04,374 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:34:04,374 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:04,374 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:34:04,374 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:04,375 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:34:04,375 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:34:04,376 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:34:04,376 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,376 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:34:04,405 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 16:34:04,493 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:04,494 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 16:34:04,494 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (123, 1, 0)
2025-07-04 16:34:04,495 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:34:04,495 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 16:34:04,496 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:34:04,504 - app.error_handling - ERROR - Error recorded [external_api_1751668444496] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 16:34:04,505 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 16:34:04,505 - services.app - INFO - Request completed: 503
2025-07-04 16:34:04,506 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 16:34:04,507 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 16:34:04,507 - services.app - INFO - Request completed: 200
2025-07-04 16:34:04,507 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 16:34:04,508 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 16:34:04,508 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:04,508 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 16:34:04,508 - sqlalchemy.engine.Engine - INFO - [generated in 0.00006s] ()
2025-07-04 16:34:04,509 - services.app - INFO - Request completed: 206
2025-07-04 16:34:04,509 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 206 Partial Content"
2025-07-04 16:34:04,511 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:34:04,511 - services.app - DEBUG - Debug message with extra data
2025-07-04 16:34:04,511 - services.app - INFO - Info message
2025-07-04 16:34:04,511 - services.app - WARNING - Warning message
2025-07-04 16:34:04,511 - services.app - ERROR - Error message
2025-07-04 16:34:04,679 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:04,679 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:34:04,686 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:04,686 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:34:04,686 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:34:04,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:34:04,688 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:34:04,689 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:34:04,689 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,689 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:34:04,689 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:34:04,690 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:34:04,690 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:34:04,691 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:34:04,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,691 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:34:04,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:34:04,691 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:34:04,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,692 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:34:04,692 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,692 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:34:04,693 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:34:04,693 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:34:04,693 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,693 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:34:04,694 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:34:04,694 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:34:04,694 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:04,694 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:34:04,694 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:04,695 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:34:04,695 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 16:34:04,696 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:34:04,696 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,696 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:04,696 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:34:04,697 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:34:04,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,698 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:34:04,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:04,698 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:04,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:34:04,699 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:34:04,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:04,699 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:34:04,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:04,700 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:34:04,707 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:04,707 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:34:04,708 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ('test@example.com', 1, 0)
2025-07-04 16:34:04,708 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:34:04,708 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 16:34:04,708 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:34:04,921 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:04,923 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 16:34:04,924 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ()
2025-07-04 16:34:04,924 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:34:04,924 - sqlalchemy.engine.Engine - INFO - [cached since 0.2166s ago] ('test@example.com', 1, 0)
2025-07-04 16:34:04,924 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:34:04,925 - sqlalchemy.engine.Engine - INFO - [cached since 0.2164s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 16:34:04,925 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:34:05,106 - services.app - INFO - Request started: GET /health
2025-07-04 16:34:05,106 - services.app - INFO - Request completed: 200
2025-07-04 16:34:05,107 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 16:34:05,108 - services.app - INFO - Request started: GET /plugins
2025-07-04 16:34:05,108 - services.app - INFO - Request completed: 200
2025-07-04 16:34:05,108 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:34:05,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,321 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:34:05,321 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,321 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:34:05,321 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,321 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:34:05,321 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,324 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:34:05,324 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:34:05,325 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:34:05,326 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:34:05,326 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:34:05,326 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:05,327 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:34:05,327 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,328 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:34:05,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,328 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:34:05,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:05,329 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:34:05,329 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:34:05,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:34:05,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,331 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:34:05,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:34:05,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,331 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:34:05,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:34:05,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,333 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:34:05,333 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,333 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:34:05,333 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,333 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:34:05,333 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,334 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:34:05,334 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,335 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:34:05,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,335 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:34:05,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,335 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:34:05,336 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,336 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:34:05,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 16:34:05,337 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:34:05,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:05,338 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:34:05,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,338 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:34:05,339 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:34:05,339 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:34:05,339 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,339 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:34:05,340 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:34:05,340 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:34:05,340 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,341 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:34:05,341 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:05,341 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:34:05,342 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:34:05,342 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:34:05,342 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,342 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:34:05,343 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:34:05,343 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:34:05,343 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:05,344 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:34:05,344 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:05,344 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:34:05,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 16:34:05,345 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:34:05,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,346 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:05,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 16:34:05,346 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:34:05,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,347 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:34:05,347 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:05,349 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:05,350 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 16:34:05,350 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:34:05,350 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:05,351 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:34:05,351 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:05,351 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:34:05,353 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:34:05,357 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:05,358 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:34:05,358 - sqlalchemy.engine.Engine - INFO - [cached since 0.6508s ago] ('test@example.com', 1, 0)
2025-07-04 16:34:05,359 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 16:34:05,629 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:34:05,629 - sqlalchemy.engine.Engine - INFO - [cached since 0.9213s ago] ('test@example.com', '$2b$12$71/kA67bRLx24fnmXcjKge8v/lhNL1bOJ8W7W8z3DkWO1ShPwlY..', None, None, None)
2025-07-04 16:34:05,630 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:34:05,630 - services.app - ERROR - Request failed: (sqlite3.OperationalError) attempt to write a readonly database
[SQL: INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: ('test***@***.example.com', '$2b$12$71/kA67bRLx24fnmXcjKge8v/lhNL1bOJ8W7W8z3DkWO1ShPwlY..', None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:34:05,972 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:34:05,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,974 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:34:05,974 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,974 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:34:05,974 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,974 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:34:05,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,975 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:34:05,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:05,976 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:34:05,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,976 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:34:05,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:34:05,977 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:34:05,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:05,978 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:34:05,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:05,978 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:34:05,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,979 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:34:05,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:05,981 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:34:05,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:34:05,981 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:34:05,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,982 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:34:05,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:34:05,982 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:34:05,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:34:05,983 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:34:05,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,983 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:34:05,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:34:05,983 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:34:05,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,984 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:34:05,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,984 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:34:05,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:34:05,985 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:34:05,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,985 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:34:05,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:34:05,986 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:34:05,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,986 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:34:05,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,987 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:34:05,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 16:34:05,987 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:34:05,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,988 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:05,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:34:05,988 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:34:05,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,989 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:34:05,989 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:05,989 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:05,989 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:34:05,990 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:34:05,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:05,990 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:34:05,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:05,991 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:34:05,992 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:34:05,993 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:05,993 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:34:05,993 - sqlalchemy.engine.Engine - INFO - [cached since 1.286s ago] ('test@example.com', 1, 0)
2025-07-04 16:34:06,236 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:34:06,236 - sqlalchemy.engine.Engine - INFO - [cached since 1.528s ago] ('test@example.com', '$2b$12$KvweNPlSg2Hp6x.badycU.AqT85qGu9Ydo8NESGf5PesL1YyQ4w6a', None, None, None)
2025-07-04 16:34:06,237 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:34:06,237 - services.app - ERROR - Request failed: (sqlite3.OperationalError) attempt to write a readonly database
[SQL: INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: ('test***@***.example.com', '$2b$12$KvweNPlSg2Hp6x.badycU.AqT85qGu9Ydo8NESGf5PesL1YyQ4w6a', None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:34:06,582 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:34:06,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,584 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:34:06,584 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:34:06,584 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:34:06,584 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:06,585 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:34:06,585 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:06,586 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:34:06,586 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:06,586 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:34:06,586 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:34:06,587 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:34:06,587 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,587 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:34:06,587 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,588 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:34:06,588 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:34:06,588 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:34:06,588 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:06,588 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:34:06,588 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,588 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:34:06,589 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:34:06,590 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:34:06,591 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:34:06,591 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:06,591 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:34:06,591 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,592 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:34:06,592 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:34:06,592 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:34:06,592 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,593 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:34:06,593 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:34:06,593 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:34:06,593 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,593 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:34:06,593 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,594 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:34:06,594 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 16:34:06,594 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:34:06,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,595 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:34:06,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:34:06,595 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:34:06,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,596 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:34:06,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:34:06,596 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:34:06,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 16:34:06,597 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:34:06,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,597 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:06,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:34:06,598 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:34:06,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,598 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:34:06,599 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,599 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:34:06,599 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:34:06,600 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:34:06,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:34:06,600 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:34:06,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:34:06,601 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:34:06,601 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:34:06,602 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:34:06,602 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:34:06,602 - sqlalchemy.engine.Engine - INFO - [cached since 1.895s ago] ('test@example.com', 1, 0)
2025-07-04 16:34:06,841 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:34:06,841 - sqlalchemy.engine.Engine - INFO - [cached since 2.133s ago] ('test@example.com', '$2b$12$bLjbVCZaTJIO7lgInOPMr.lr28eM/6LxysRHJSYF2UeA4LcXRc3gG', None, None, None)
2025-07-04 16:34:06,841 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:34:06,841 - services.app - ERROR - Request failed: (sqlite3.OperationalError) attempt to write a readonly database
[SQL: INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: ('test***@***.example.com', '$2b$12$bLjbVCZaTJIO7lgInOPMr.lr28eM/6LxysRHJSYF2UeA4LcXRc3gG', None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-04 16:37:21,466 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:37:24,065 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,065 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:37:24,065 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:37:24,067 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:37:24,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,069 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:37:24,069 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,069 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:37:24,069 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:37:24,070 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:37:24,070 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:24,071 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:37:24,071 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,071 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:37:24,071 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:37:24,072 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:37:24,072 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,072 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:37:24,072 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:37:24,073 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:37:24,073 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:24,073 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:37:24,073 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,074 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:37:24,074 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 16:37:24,074 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:37:24,075 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:37:24,075 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:37:24,075 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:37:24,076 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:37:24,076 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:24,076 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:37:24,076 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:24,077 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:37:24,077 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 16:37:24,077 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:37:24,077 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,078 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:37:24,078 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 16:37:24,078 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:37:24,078 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,079 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:37:24,079 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,079 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:37:24,080 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:37:24,080 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:37:24,080 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,081 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:37:24,081 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:24,081 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:37:24,082 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 16:37:24,082 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:37:24,082 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:24,083 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:24,112 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 16:37:24,200 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,201 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 16:37:24,201 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (123, 1, 0)
2025-07-04 16:37:24,202 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:37:24,202 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 16:37:24,203 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:37:24,212 - app.error_handling - ERROR - Error recorded [external_api_1751668644203] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 16:37:24,212 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 16:37:24,213 - services.app - INFO - Request completed: 503
2025-07-04 16:37:24,214 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 16:37:24,215 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 16:37:24,215 - services.app - INFO - Request completed: 200
2025-07-04 16:37:24,215 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 16:37:24,216 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 16:37:24,216 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,216 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 16:37:24,216 - sqlalchemy.engine.Engine - INFO - [generated in 0.00006s] ()
2025-07-04 16:37:24,217 - services.app - INFO - Request completed: 206
2025-07-04 16:37:24,217 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 206 Partial Content"
2025-07-04 16:37:24,219 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:37:24,219 - services.app - DEBUG - Debug message with extra data
2025-07-04 16:37:24,219 - services.app - INFO - Info message
2025-07-04 16:37:24,219 - services.app - WARNING - Warning message
2025-07-04 16:37:24,220 - services.app - ERROR - Error message
2025-07-04 16:37:24,408 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,409 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:24,417 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:37:24,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:37:24,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,420 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:24,427 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,427 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:37:24,427 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ('test@example.com', 1, 0)
2025-07-04 16:37:24,428 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:37:24,428 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 16:37:24,429 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:24,429 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,429 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:37:24,430 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] (1,)
2025-07-04 16:37:24,430 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:37:24,495 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,498 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 16:37:24,498 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ()
2025-07-04 16:37:24,498 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:37:24,499 - sqlalchemy.engine.Engine - INFO - [cached since 0.07142s ago] ('test@example.com', 1, 0)
2025-07-04 16:37:24,499 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:37:24,540 - services.app - INFO - Request started: GET /health
2025-07-04 16:37:24,541 - services.app - INFO - Request completed: 200
2025-07-04 16:37:24,541 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 16:37:24,542 - services.app - INFO - Request started: GET /plugins
2025-07-04 16:37:24,543 - services.app - INFO - Request completed: 200
2025-07-04 16:37:24,543 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 16:37:24,889 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,889 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:37:24,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,891 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:37:24,891 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,893 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:37:24,893 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,893 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:37:24,893 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:24,895 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:37:24,895 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:37:24,895 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:37:24,895 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,896 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:37:24,896 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:24,896 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:37:24,897 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 16:37:24,897 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:37:24,897 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,898 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:37:24,899 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:24,900 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:37:24,900 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:37:24,900 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:37:24,900 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,901 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:37:24,901 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,901 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:37:24,901 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:37:24,902 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:37:24,902 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,902 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:37:24,902 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:37:24,903 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:37:24,903 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,903 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:37:24,903 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,904 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:37:24,904 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 16:37:24,904 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:37:24,904 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,905 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:37:24,905 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:37:24,905 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:37:24,905 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:24,906 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:37:24,906 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:24,906 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:37:24,907 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 16:37:24,907 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:37:24,907 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,907 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:37:24,908 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 16:37:24,908 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:37:24,908 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,909 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:37:24,909 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,909 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:37:24,909 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:37:24,910 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:37:24,910 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:24,910 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:37:24,910 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:24,911 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:24,912 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:37:24,913 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,913 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:37:24,913 - sqlalchemy.engine.Engine - INFO - [cached since 0.4857s ago] ('test@example.com', 1, 0)
2025-07-04 16:37:24,913 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:37:24,913 - services.app - INFO - Request completed: 400
2025-07-04 16:37:24,914 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 400 Bad Request"
2025-07-04 16:37:24,914 - services.app - INFO - Request started: POST /auth/token
2025-07-04 16:37:24,917 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:24,917 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:37:24,917 - sqlalchemy.engine.Engine - INFO - [cached since 0.4898s ago] ('test@example.com', 1, 0)
2025-07-04 16:37:24,917 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 16:37:25,182 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:37:25,182 - services.app - INFO - Request completed: 401
2025-07-04 16:37:25,183 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 16:37:25,186 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:25,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:37:25,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:37:25,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:37:25,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:37:25,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:37:25,187 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,188 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:37:25,188 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,188 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:37:25,188 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:25,189 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:37:25,189 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,189 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:37:25,189 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:25,190 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:37:25,190 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:25,190 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:37:25,190 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:25,191 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:37:25,191 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,191 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:25,191 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:25,191 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:37:25,191 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,191 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:37:25,191 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,191 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:37:25,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:37:25,193 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:37:25,194 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:37:25,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,194 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:37:25,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,195 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:37:25,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:37:25,195 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:37:25,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,196 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:37:25,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:37:25,196 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:37:25,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,197 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:37:25,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:25,197 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:37:25,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:37:25,198 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:37:25,198 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,198 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:37:25,198 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:37:25,199 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:37:25,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:25,199 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:37:25,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:25,200 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:37:25,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 16:37:25,200 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:37:25,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,201 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:37:25,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:37:25,201 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:37:25,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:25,202 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:37:25,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,202 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:37:25,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:37:25,203 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:37:25,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,204 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:37:25,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:37:25,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:25,205 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:37:25,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:25,206 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:37:25,206 - sqlalchemy.engine.Engine - INFO - [cached since 0.7786s ago] ('test@example.com', 1, 0)
2025-07-04 16:37:25,206 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:37:25,206 - services.app - INFO - Request completed: 400
2025-07-04 16:37:25,207 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 400 Bad Request"
2025-07-04 16:37:25,207 - services.app - INFO - Request started: POST /auth/token
2025-07-04 16:37:25,209 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:25,209 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:37:25,209 - sqlalchemy.engine.Engine - INFO - [cached since 0.7822s ago] ('test@example.com', 1, 0)
2025-07-04 16:37:25,451 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:37:25,451 - services.app - INFO - Request completed: 401
2025-07-04 16:37:25,452 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 16:37:25,454 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:25,454 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:37:25,454 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:37:25,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:25,456 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:37:25,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:25,457 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:37:25,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:25,457 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:37:25,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,458 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:37:25,458 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:25,459 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:37:25,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:37:25,459 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:37:25,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:25,460 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:37:25,460 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,460 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:25,460 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:25,460 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:37:25,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,460 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,461 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR, 
	PRIMARY KEY (id)
)


2025-07-04 16:37:25,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:37:25,463 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:37:25,463 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,463 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:37:25,463 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,464 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:37:25,464 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:37:25,464 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:37:25,464 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,465 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:37:25,465 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:37:25,465 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:37:25,465 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,466 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:37:25,466 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,466 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:37:25,466 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:37:25,467 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:37:25,467 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,467 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:37:25,467 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:37:25,468 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:37:25,468 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:25,468 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:37:25,468 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:37:25,469 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:37:25,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 16:37:25,469 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:37:25,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,470 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:37:25,470 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 16:37:25,470 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:37:25,470 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,471 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:37:25,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,471 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:37:25,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:37:25,472 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:37:25,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:37:25,473 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:37:25,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:37:25,473 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:37:25,474 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:37:25,474 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:25,475 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:37:25,475 - sqlalchemy.engine.Engine - INFO - [cached since 1.048s ago] ('test@example.com', 1, 0)
2025-07-04 16:37:25,475 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:37:25,475 - services.app - INFO - Request completed: 400
2025-07-04 16:37:25,476 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 400 Bad Request"
2025-07-04 16:37:25,476 - services.app - INFO - Request started: POST /auth/token
2025-07-04 16:37:25,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:37:25,478 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:37:25,478 - sqlalchemy.engine.Engine - INFO - [cached since 1.051s ago] ('test@example.com', 1, 0)
2025-07-04 16:37:25,722 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:37:25,723 - services.app - INFO - Request completed: 401
2025-07-04 16:37:25,723 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 16:40:08,570 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:40:11,228 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,233 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:11,233 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,233 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,264 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 16:40:11,264 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,264 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,265 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,266 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:11,266 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,266 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:11,266 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,267 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:11,267 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,268 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:11,268 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,269 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:11,269 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,269 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:11,269 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,270 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:11,270 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,271 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:11,271 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:40:11,274 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:11,274 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,274 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:11,274 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,275 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,276 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:11,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,277 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:11,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,277 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:11,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,277 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:11,277 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:40:11,278 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:11,278 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,278 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:11,278 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,279 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:11,279 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:11,279 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:11,279 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,280 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:11,280 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:40:11,280 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:11,280 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,281 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:11,281 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,281 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,281 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:11,282 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:11,282 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,282 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:11,282 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 16:40:11,283 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:11,283 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,283 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:11,283 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,284 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:11,284 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 16:40:11,285 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:11,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,285 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:40:11,286 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:11,286 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,286 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:11,286 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,287 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,287 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:40:11,288 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:11,288 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:40:11,288 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:11,288 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,289 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:11,289 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 16:40:11,290 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:11,290 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,291 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,387 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,388 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 16:40:11,388 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (123, 1, 0)
2025-07-04 16:40:11,389 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:40:11,389 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 16:40:11,390 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:40:11,398 - app.error_handling - ERROR - Error recorded [external_api_1751668811390] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 16:40:11,398 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 16:40:11,399 - services.app - INFO - Request completed: 503
2025-07-04 16:40:11,400 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 16:40:11,400 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 16:40:11,400 - services.app - INFO - Request completed: 200
2025-07-04 16:40:11,401 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 16:40:11,402 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:11,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,403 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:11,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,404 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:11,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,404 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:11,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,405 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:11,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,405 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:11,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,406 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:11,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,406 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:11,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,407 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:11,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,407 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:11,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,408 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,408 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,408 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,408 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:11,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,408 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:11,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 16:40:11,411 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:11,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,411 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:11,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,411 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:11,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 16:40:11,412 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:11,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,412 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:11,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:11,413 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:11,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,413 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:11,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,414 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:40:11,414 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:11,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,415 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:11,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:11,416 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:11,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,416 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:11,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,417 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:11,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 16:40:11,417 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:11,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,418 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:40:11,418 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:11,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,419 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:11,419 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,419 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,420 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:40:11,420 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:11,420 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,421 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:11,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,421 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:11,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 16:40:11,422 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:11,422 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,422 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,422 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,423 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 16:40:11,423 - sqlalchemy.engine.Engine - INFO - [generated in 0.00005s] ()
2025-07-04 16:40:11,423 - services.app - INFO - Request completed: 206
2025-07-04 16:40:11,424 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 206 Partial Content"
2025-07-04 16:40:11,426 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 16:40:11,426 - services.app - DEBUG - Debug message with extra data
2025-07-04 16:40:11,426 - services.app - INFO - Info message
2025-07-04 16:40:11,426 - services.app - WARNING - Warning message
2025-07-04 16:40:11,426 - services.app - ERROR - Error message
2025-07-04 16:40:11,599 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,599 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,609 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,609 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,609 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,610 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,610 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,611 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,618 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,618 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,620 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:11,620 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,620 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:11,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,620 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:11,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,621 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:11,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,622 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:11,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:11,623 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:11,623 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,624 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:11,624 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 16:40:11,625 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:11,625 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 16:40:11,625 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:11,626 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,626 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:11,626 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,627 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,629 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:11,629 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,629 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:11,629 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,629 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:11,629 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,629 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:11,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:11,630 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:11,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,630 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:11,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,631 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:11,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:11,631 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:11,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,632 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:11,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:11,632 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:11,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,633 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:11,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,633 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 16:40:11,634 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:11,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,634 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:11,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:11,635 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:11,635 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,635 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:11,635 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,636 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:11,636 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 16:40:11,637 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:11,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,637 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:40:11,638 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:11,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,638 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:11,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,639 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:40:11,640 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:11,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:40:11,641 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:11,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,641 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:11,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 16:40:11,642 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:11,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,643 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,643 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,644 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:40:11,644 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ('test@example.com', 1, 0)
2025-07-04 16:40:11,645 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:40:11,645 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 16:40:11,646 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,646 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,647 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:40:11,647 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] (1,)
2025-07-04 16:40:11,647 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,716 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,717 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,717 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,717 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,717 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,717 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,717 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:11,717 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,717 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:11,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,718 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:11,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:11,718 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:11,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,719 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:11,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,720 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:11,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,720 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:11,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,721 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:11,721 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,721 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:11,722 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,722 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:11,722 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,723 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,724 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:11,725 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:11,725 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:11,725 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:11,725 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:11,725 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,726 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:11,726 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,726 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:11,726 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:11,727 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:11,727 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,727 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:11,727 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:11,728 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:11,728 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,728 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:11,728 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:40:11,729 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,729 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:11,729 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:11,729 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,730 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:11,730 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:11,730 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:11,730 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,731 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:11,731 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,731 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:11,732 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 16:40:11,732 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:11,732 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,733 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,733 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 16:40:11,733 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:11,733 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,734 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:11,734 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,734 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:11,734 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:40:11,735 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:11,735 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:11,735 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:11,735 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,736 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:11,736 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:40:11,737 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:11,737 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:11,737 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,737 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,740 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 16:40:11,740 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] ()
2025-07-04 16:40:11,741 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:40:11,741 - sqlalchemy.engine.Engine - INFO - [cached since 0.09715s ago] ('test@example.com', 1, 0)
2025-07-04 16:40:11,741 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:40:11,742 - sqlalchemy.engine.Engine - INFO - [cached since 0.09689s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 16:40:11,742 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:11,743 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:11,743 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:40:11,743 - sqlalchemy.engine.Engine - INFO - [cached since 0.09624s ago] (1,)
2025-07-04 16:40:11,743 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:40:11,783 - services.app - INFO - Request started: GET /health
2025-07-04 16:40:11,783 - services.app - INFO - Request completed: 200
2025-07-04 16:40:11,784 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 16:40:11,785 - services.app - INFO - Request started: GET /plugins
2025-07-04 16:40:11,785 - services.app - INFO - Request completed: 200
2025-07-04 16:40:11,786 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 16:40:12,017 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,017 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,017 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,017 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,017 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,017 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,017 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,018 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,019 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:12,019 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 16:40:12,021 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:12,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,022 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:12,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,026 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:12,026 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,026 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:12,026 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,027 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:12,027 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:40:12,029 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:12,029 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,029 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:12,030 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,030 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,030 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,030 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,030 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,031 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,033 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,033 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:12,034 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,034 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,034 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,034 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,035 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:12,036 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:40:12,036 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:12,036 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,037 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:12,037 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:40:12,037 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:12,042 - sqlalchemy.engine.Engine - INFO - [no key 0.00486s] ()
2025-07-04 16:40:12,043 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:12,043 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:40:12,043 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:12,044 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 16:40:12,044 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:12,044 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,045 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:12,045 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,045 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,045 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:40:12,046 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:12,046 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,046 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,046 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,047 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:12,047 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,047 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:12,047 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,048 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:12,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 16:40:12,049 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:12,049 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,049 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 16:40:12,050 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:12,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,051 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:12,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,053 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:40:12,054 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:12,054 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,055 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:12,055 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,056 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,061 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:40:12,067 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,067 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,067 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,068 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,068 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,068 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,069 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,069 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,069 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,069 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,069 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,070 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,070 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,071 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:12,071 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 16:40:12,072 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:12,072 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,074 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:12,074 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,074 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:12,074 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,075 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:12,075 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,076 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:12,076 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,076 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:12,076 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,077 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:12,077 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,077 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:12,077 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:12,078 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,079 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:12,080 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:40:12,081 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:12,081 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,081 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:12,081 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,082 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:12,082 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:12,082 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:12,082 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,083 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:12,083 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,083 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:12,083 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,084 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:12,084 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,084 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,084 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:40:12,085 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:12,085 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,085 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,085 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,086 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:12,086 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,086 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:12,086 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,087 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:12,087 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 16:40:12,087 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:12,087 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,088 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,088 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 16:40:12,089 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:12,089 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,089 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:12,089 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,090 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,090 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:40:12,091 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:12,091 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,091 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:12,091 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,092 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,092 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:40:12,092 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:12,092 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,093 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,093 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,094 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:40:12,094 - sqlalchemy.engine.Engine - INFO - [cached since 0.4499s ago] ('test@example.com', 1, 0)
2025-07-04 16:40:12,094 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 16:40:12,358 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:40:12,358 - sqlalchemy.engine.Engine - INFO - [cached since 0.7132s ago] ('test@example.com', '$2b$12$q6GBZrVdSeIJVlJfJXQKgegUch5SrhUqyNA2WeQDli5lIZhsUBRQ6', None, None, None)
2025-07-04 16:40:12,359 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,359 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,359 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:40:12,359 - sqlalchemy.engine.Engine - INFO - [cached since 0.7129s ago] (1,)
2025-07-04 16:40:12,361 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 16:40:12,361 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1,)
2025-07-04 16:40:12,362 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:40:12,362 - services.app - INFO - Request completed: 201
2025-07-04 16:40:12,363 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 16:40:12,363 - services.app - INFO - Request started: POST /auth/token
2025-07-04 16:40:12,365 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,367 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,367 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,367 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,367 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,367 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,367 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:12,367 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,368 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:12,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,368 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:12,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,369 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:12,369 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,370 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:12,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,370 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:12,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,370 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:12,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,371 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:12,371 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,372 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:12,372 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,374 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,374 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,374 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,374 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,374 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:12,374 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,375 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:12,376 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:40:12,377 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:12,377 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,378 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:12,378 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,378 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:12,378 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:12,379 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:12,379 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,379 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:12,379 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,380 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:12,380 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,380 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:12,380 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,381 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,381 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:40:12,382 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:12,382 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,382 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,382 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,383 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:12,383 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,383 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:12,383 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,384 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:12,384 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 16:40:12,384 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:12,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,385 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 16:40:12,386 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:12,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,386 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:12,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,387 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 16:40:12,388 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:12,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,389 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:12,389 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,389 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,390 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 16:40:12,390 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:12,390 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,391 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,391 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,392 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:40:12,392 - sqlalchemy.engine.Engine - INFO - [cached since 0.7478s ago] ('test@example.com', 1, 0)
2025-07-04 16:40:12,392 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:40:12,392 - services.app - INFO - Request completed: 401
2025-07-04 16:40:12,393 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 16:40:12,395 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,397 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:12,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,397 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:12,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,398 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:12,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,398 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:12,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,399 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:12,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,400 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:12,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,400 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:12,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,401 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:12,401 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,401 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,401 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,401 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:12,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:40:12,404 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:12,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,404 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:12,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,405 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:12,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 16:40:12,405 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:12,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,406 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:12,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,406 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:12,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,407 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:12,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,408 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 16:40:12,408 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:12,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,409 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,409 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:12,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,410 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:12,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,410 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:12,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 16:40:12,411 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:12,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,411 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 16:40:12,412 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:12,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,413 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:12,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,413 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:40:12,414 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:12,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,414 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:12,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,415 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,415 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:40:12,416 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:12,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,418 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:12,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,419 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:12,419 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,420 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:12,420 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,420 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:12,420 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,421 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:12,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,421 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:12,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,422 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:12,422 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,424 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:12,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:12,425 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:12,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,427 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:12,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,427 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:12,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,428 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:12,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,428 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:12,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 16:40:12,429 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:12,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,429 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:12,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:40:12,430 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:12,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,430 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:12,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,431 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 16:40:12,431 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:12,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,432 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,432 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:12,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,433 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:12,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,434 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:12,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 16:40:12,434 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:12,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,435 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 16:40:12,435 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:12,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,436 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:12,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,437 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:40:12,437 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:12,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,438 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:12,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,438 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,439 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 16:40:12,440 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:12,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,440 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,441 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,441 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:40:12,441 - sqlalchemy.engine.Engine - INFO - [cached since 0.7973s ago] ('test@example.com', 1, 0)
2025-07-04 16:40:12,681 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:40:12,681 - sqlalchemy.engine.Engine - INFO - [cached since 1.036s ago] ('test@example.com', '$2b$12$MXlLBf7XHSwOF/fqjbPuUOMSPYWOvU3gNOEBHNekA25rv5yDhQh1O', None, None, None)
2025-07-04 16:40:12,682 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,682 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,682 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:40:12,682 - sqlalchemy.engine.Engine - INFO - [cached since 1.036s ago] (1,)
2025-07-04 16:40:12,683 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 16:40:12,683 - sqlalchemy.engine.Engine - INFO - [cached since 0.3219s ago] (1,)
2025-07-04 16:40:12,683 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:40:12,683 - services.app - INFO - Request completed: 201
2025-07-04 16:40:12,684 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 16:40:12,685 - services.app - INFO - Request started: POST /auth/token
2025-07-04 16:40:12,686 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,686 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,686 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,688 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:12,688 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,688 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:12,688 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,689 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:12,689 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,690 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:12,690 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,690 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:12,690 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,691 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:12,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,691 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:12,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,692 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:12,692 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,692 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:12,693 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,693 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,693 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,693 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:12,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:12,695 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,696 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:12,696 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,696 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:12,696 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,696 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:12,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:12,697 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:12,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,698 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:12,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,698 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:12,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,699 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:12,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,699 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:12,700 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:12,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,700 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,701 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:12,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,701 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:12,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,702 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:12,702 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 16:40:12,702 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:12,702 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,703 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,703 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 16:40:12,704 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:12,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,704 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:12,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,705 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:40:12,706 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:12,706 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:40:12,706 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:12,706 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,707 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:40:12,708 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:12,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 16:40:12,708 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,709 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:40:12,709 - sqlalchemy.engine.Engine - INFO - [cached since 1.065s ago] ('test@example.com', 1, 0)
2025-07-04 16:40:12,709 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:40:12,710 - services.app - INFO - Request completed: 401
2025-07-04 16:40:12,710 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,713 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,714 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,714 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,714 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:12,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,714 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:12,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,715 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:12,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,716 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:12,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,716 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:12,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,717 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:12,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,717 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:12,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,718 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:12,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,718 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,718 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,718 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,718 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,718 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:12,718 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,718 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,719 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:12,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,721 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:12,721 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,721 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:12,721 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,722 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:12,722 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:12,723 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:12,723 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,724 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:12,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 16:40:12,724 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:12,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,725 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:12,725 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,725 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,725 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:12,726 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:12,726 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,726 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,726 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,727 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:12,727 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,727 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:12,727 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,728 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:12,728 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 16:40:12,728 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:12,729 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,729 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,729 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 16:40:12,730 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:12,730 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,730 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:12,730 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,731 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,731 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:40:12,731 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:12,731 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,732 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:12,732 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,732 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,733 - services.app - INFO - Request started: POST /auth/register
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,735 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,735 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,735 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,735 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,735 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:12,735 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,735 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:12,736 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,736 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:12,736 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,737 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:12,737 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,737 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:12,737 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,738 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:12,738 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,738 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:12,739 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,739 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:12,739 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,740 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:12,740 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:12,740 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,740 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,740 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:12,740 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:12,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:12,742 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:12,743 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:12,743 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:12,743 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,743 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:12,743 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,744 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:12,744 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 16:40:12,745 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:12,745 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,745 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:12,745 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,745 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:12,745 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,746 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:12,746 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,746 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,747 - sqlalchemy.engine.Engine - INFO - [no key 0.00109s] ()
2025-07-04 16:40:12,748 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:12,748 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,749 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,749 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:12,749 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:12,749 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,749 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:12,750 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,750 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:12,753 - sqlalchemy.engine.Engine - INFO - [no key 0.00301s] ()
2025-07-04 16:40:12,754 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:12,754 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,754 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,755 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 16:40:12,757 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:12,757 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 16:40:12,757 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:12,757 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:12,758 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:12,758 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 16:40:12,759 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:12,759 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,759 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:12,759 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,760 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:12,760 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 16:40:12,761 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:12,761 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:12,762 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:12,762 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:12,762 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:40:12,762 - sqlalchemy.engine.Engine - INFO - [cached since 1.119s ago] ('test@example.com', 1, 0)
2025-07-04 16:40:13,002 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 16:40:13,002 - sqlalchemy.engine.Engine - INFO - [cached since 1.357s ago] ('test@example.com', '$2b$12$0hBQ2GxGPkh11B5Q8xznNuu34hTVb8T/9I0II4l3rJrOPrL5QuNpO', None, None, None)
2025-07-04 16:40:13,003 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:13,003 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:13,003 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 16:40:13,003 - sqlalchemy.engine.Engine - INFO - [cached since 1.357s ago] (1,)
2025-07-04 16:40:13,004 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 16:40:13,004 - sqlalchemy.engine.Engine - INFO - [cached since 0.643s ago] (1,)
2025-07-04 16:40:13,004 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:40:13,005 - services.app - INFO - Request completed: 201
2025-07-04 16:40:13,005 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 16:40:13,006 - services.app - INFO - Request started: POST /auth/token
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:13,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,009 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:13,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,009 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:13,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,009 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:13,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,009 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 16:40:13,009 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:13,010 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 16:40:13,010 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:13,010 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 16:40:13,011 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,011 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 16:40:13,011 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:13,012 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 16:40:13,012 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,012 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 16:40:13,012 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:13,013 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 16:40:13,013 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:13,013 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 16:40:13,013 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:13,014 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 16:40:13,014 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 16:40:13,014 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:13,014 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:13,014 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 16:40:13,014 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,015 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 16:40:13,016 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 16:40:13,017 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 16:40:13,017 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 16:40:13,017 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:13,018 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 16:40:13,018 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,018 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 16:40:13,018 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 16:40:13,019 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 16:40:13,019 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,019 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 16:40:13,019 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:13,020 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 16:40:13,020 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:13,020 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 16:40:13,020 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,021 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 16:40:13,021 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 16:40:13,021 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 16:40:13,021 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,022 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:13,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 16:40:13,022 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 16:40:13,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:13,023 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 16:40:13,023 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,023 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 16:40:13,024 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 16:40:13,024 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 16:40:13,024 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:13,025 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:13,025 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 16:40:13,025 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 16:40:13,025 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,026 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 16:40:13,026 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,026 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 16:40:13,026 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 16:40:13,027 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 16:40:13,027 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:13,027 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 16:40:13,027 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 16:40:13,028 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 16:40:13,028 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 16:40:13,029 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 16:40:13,029 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 16:40:13,029 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 16:40:13,030 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 16:40:13,030 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 16:40:13,030 - sqlalchemy.engine.Engine - INFO - [cached since 1.386s ago] ('test@example.com', 1, 0)
2025-07-04 16:40:13,030 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 16:40:13,030 - services.app - INFO - Request completed: 401
2025-07-04 16:40:13,031 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:02:36,073 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:02:42,128 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,131 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,131 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,137 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,137 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,138 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,139 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:42,139 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,139 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,172 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:02:42,172 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,172 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,172 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,172 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:42,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,174 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:42,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,175 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:42,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:42,177 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:42,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:42,177 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:42,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,179 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:42,179 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,180 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:42,180 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,182 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:42,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,184 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:42,184 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,184 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:42,184 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,185 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:42,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,187 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:42,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,187 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:42,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,187 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:42,187 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:42,188 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:42,188 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,188 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:42,188 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,189 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:42,189 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:42,189 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:42,189 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,190 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:42,190 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:42,190 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:42,190 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,191 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:42,191 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,191 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:42,191 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:42,192 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:42,192 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,192 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:42,192 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:42,193 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:42,193 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,193 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:42,193 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,194 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:42,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:02:42,194 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:42,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,195 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:42,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:02:42,196 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:42,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,196 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:42,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,197 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:42,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:02:42,197 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:42,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,198 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:42,198 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,199 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:42,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:02:42,199 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:42,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,200 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,324 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,326 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:02:42,326 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] (123, 1, 0)
2025-07-04 17:02:42,327 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:02:42,327 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:02:42,327 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:02:42,337 - app.error_handling - ERROR - Error recorded [external_api_1751670162327] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:02:42,337 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:02:42,338 - services.app - INFO - Request completed: 503
2025-07-04 17:02:42,338 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:02:42,339 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:02:42,339 - services.app - INFO - Request completed: 200
2025-07-04 17:02:42,340 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:02:42,340 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,341 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,342 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,342 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,342 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:42,342 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,342 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:42,342 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,342 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:42,343 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,343 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:42,343 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,344 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:42,344 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,344 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:42,344 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,345 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:42,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:42,345 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:42,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:42,346 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:42,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,346 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:42,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,347 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:42,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,349 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:42,349 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,349 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:42,349 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:42,349 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:42,349 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,350 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:42,350 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,350 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:42,350 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:42,351 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:42,351 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,351 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:42,351 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:42,352 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:42,352 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,352 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:42,352 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,353 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:42,353 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:42,353 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:42,353 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,354 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:42,354 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:42,354 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:42,354 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,354 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:42,355 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:42,356 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:42,356 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-07-04 17:02:42,357 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:42,357 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:42,358 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:42,358 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:02:42,358 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:42,358 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,359 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:42,359 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:42,360 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:42,361 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:02:42,362 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:42,362 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:42,362 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:42,362 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,363 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:42,364 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:02:42,364 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:42,364 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:42,365 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,365 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,366 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:02:42,366 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ()
2025-07-04 17:02:42,367 - services.app - INFO - Request completed: 206
2025-07-04 17:02:42,368 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 206 Partial Content"
2025-07-04 17:02:42,371 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:02:42,371 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:02:42,371 - services.app - INFO - Info message
2025-07-04 17:02:42,371 - services.app - WARNING - Warning message
2025-07-04 17:02:42,371 - services.app - ERROR - Error message
2025-07-04 17:02:42,811 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,811 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,819 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,822 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,822 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,822 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,830 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:42,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,833 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:42,833 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,833 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:42,834 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:42,834 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:42,834 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:42,835 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:42,835 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,836 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:42,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,836 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:42,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,837 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:42,837 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:42,837 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:42,837 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:42,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:42,840 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:42,841 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:42,841 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,841 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:42,841 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,842 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:42,842 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:42,842 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:42,843 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,843 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:42,843 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:02:42,843 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:42,844 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,844 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:42,844 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,844 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:42,845 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:42,845 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:42,845 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,845 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:42,846 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:02:42,846 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:42,846 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,846 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:42,846 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,847 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:42,847 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:02:42,848 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:42,848 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,848 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:42,848 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:02:42,849 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:42,849 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,849 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:42,849 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,850 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:42,850 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:02:42,850 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:42,850 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:42,851 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:42,851 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,852 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:42,852 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:02:42,852 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:42,852 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,853 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,853 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,853 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:02:42,854 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ('test@example.com', 1, 0)
2025-07-04 17:02:42,854 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:02:42,854 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:02:42,855 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,855 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,855 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:02:42,856 - sqlalchemy.engine.Engine - INFO - [generated in 0.00011s] (1,)
2025-07-04 17:02:42,857 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:02:42,857 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:02:42.856242', '2025-07-04 23:02:42.856245')
2025-07-04 17:02:42,857 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,858 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,858 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:02:42,858 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (1,)
2025-07-04 17:02:42,859 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:02:42,988 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,988 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,988 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,988 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,988 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,988 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:42,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,990 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:42,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,990 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:42,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,991 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:42,991 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,992 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:42,992 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:42,992 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:42,992 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,993 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:42,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:42,993 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:42,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:42,994 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:42,994 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:42,994 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:42,994 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:42,995 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,996 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,997 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:42,998 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,998 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:42,998 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,998 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:42,998 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:42,998 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:42,998 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:02:42,999 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:42,999 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:42,999 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:42,999 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,000 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:43,000 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:02:43,000 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:43,000 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,001 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:43,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:02:43,002 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:43,002 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,002 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:43,002 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,002 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,003 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:02:43,003 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:43,003 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,004 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,004 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:02:43,004 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:43,004 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,005 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:43,005 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,005 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:43,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:02:43,006 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:43,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,007 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,007 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:02:43,008 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:43,008 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,008 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:43,008 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,009 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,009 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:02:43,009 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:43,009 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,010 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:43,010 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,011 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,011 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:02:43,011 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:43,011 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,012 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,012 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,014 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:02:43,015 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] ()
2025-07-04 17:02:43,015 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:02:43,015 - sqlalchemy.engine.Engine - INFO - [cached since 0.1621s ago] ('test@example.com', 1, 0)
2025-07-04 17:02:43,016 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:02:43,016 - sqlalchemy.engine.Engine - INFO - [cached since 0.1618s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:02:43,016 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,017 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,017 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:02:43,017 - sqlalchemy.engine.Engine - INFO - [cached since 0.1614s ago] (1,)
2025-07-04 17:02:43,017 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:02:43,017 - sqlalchemy.engine.Engine - INFO - [cached since 0.1609s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:02:43.017526', '2025-07-04 23:02:43.017529')
2025-07-04 17:02:43,018 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,018 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,018 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:02:43,018 - sqlalchemy.engine.Engine - INFO - [cached since 0.1603s ago] (1,)
2025-07-04 17:02:43,019 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:02:43,120 - services.app - INFO - Request started: GET /health
2025-07-04 17:02:43,120 - services.app - INFO - Request completed: 200
2025-07-04 17:02:43,121 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:02:43,122 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:02:43,122 - services.app - INFO - Request completed: 200
2025-07-04 17:02:43,123 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:02:43,593 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,593 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,593 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,593 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,594 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:43,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,596 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:43,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,597 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:43,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,598 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:43,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,599 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:43,599 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,599 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:43,599 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,600 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:43,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:43,600 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:43,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,601 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,601 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,601 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,601 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:43,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:43,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:43,603 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:43,604 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:43,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,604 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:43,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,605 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:43,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:02:43,606 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:43,606 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,606 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:43,606 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:43,607 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:43,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,607 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:43,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,608 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:43,608 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:43,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,609 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,609 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:43,609 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:43,609 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,610 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:43,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,610 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:43,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:02:43,611 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:43,611 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,611 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:02:43,612 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:43,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,612 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:43,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,613 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:02:43,614 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:43,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,614 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:43,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,615 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,615 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:43,618 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,619 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:43,619 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,619 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:43,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,620 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:43,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,621 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:43,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,621 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:43,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,622 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:43,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,622 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:43,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,623 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:43,623 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,623 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,623 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:43,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,626 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:43,626 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:43,626 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:43,626 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,627 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:43,627 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,627 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:43,627 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:43,628 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:43,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,628 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:43,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:43,629 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:43,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,629 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:43,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,630 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:43,630 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:43,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,631 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:43,631 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:43,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,632 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:43,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,632 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:43,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:02:43,633 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:43,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,634 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:02:43,634 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:43,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,635 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:43,635 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,635 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,636 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:02:43,636 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:43,636 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,637 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:43,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,637 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:02:43,638 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:43,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,639 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,639 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,639 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:02:43,639 - sqlalchemy.engine.Engine - INFO - [cached since 0.7861s ago] ('test@example.com', 1, 0)
2025-07-04 17:02:43,640 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:02:43,905 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:02:43,905 - sqlalchemy.engine.Engine - INFO - [cached since 1.051s ago] ('test@example.com', '$2b$12$ZEiFtJqcGRqYK9ZrSEZXW.AA0TI5tKmJAjiBJNFA2TiMf1a8jQKia', None, None, None)
2025-07-04 17:02:43,905 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,906 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,906 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:02:43,906 - sqlalchemy.engine.Engine - INFO - [cached since 1.05s ago] (1,)
2025-07-04 17:02:43,908 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:02:43,908 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1,)
2025-07-04 17:02:43,908 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:02:43,908 - services.app - INFO - Request completed: 201
2025-07-04 17:02:43,909 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:02:43,910 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,913 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,913 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,913 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,913 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:43,913 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,913 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:43,913 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,914 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:43,914 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,914 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:43,914 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,915 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:43,915 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,915 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:43,916 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:43,916 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:43,916 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,917 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:43,917 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,917 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:43,917 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,918 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:43,918 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,918 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:43,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,921 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:43,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:43,921 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:43,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,922 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:43,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,922 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:43,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:43,923 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:43,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,923 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:43,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:43,924 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:43,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,924 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:43,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,925 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:02:43,925 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:43,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,926 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:43,926 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:43,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,927 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:43,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,927 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:43,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:02:43,928 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:43,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,929 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:02:43,929 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:43,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:43,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,931 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:02:43,931 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:43,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,932 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:43,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,933 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:02:43,933 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:43,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,934 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,935 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,935 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:02:43,935 - sqlalchemy.engine.Engine - INFO - [cached since 1.082s ago] ('test@example.com', 1, 0)
2025-07-04 17:02:43,935 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:02:43,935 - services.app - INFO - Request completed: 401
2025-07-04 17:02:43,936 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:02:43,939 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,941 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:43,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,941 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:43,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,942 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:43,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,943 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:43,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,943 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:43,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,944 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:43,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,944 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:43,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,945 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:43,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,945 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,945 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,945 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,945 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,945 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:43,945 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:43,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:43,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:43,948 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:43,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:43,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,949 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:43,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:02:43,950 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:43,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,951 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:43,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:02:43,951 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:43,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,952 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:43,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,952 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:02:43,953 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:43,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,953 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:43,954 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:43,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,954 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:43,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,955 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:43,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:02:43,956 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:43,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,956 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:02:43,957 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:43,957 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,957 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:43,957 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,958 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,958 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:02:43,959 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:43,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,959 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:43,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,960 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,960 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:43,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:43,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,964 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:43,964 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,964 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:43,964 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,965 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:43,965 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,965 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:43,965 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,966 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:43,966 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,966 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:43,966 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:43,967 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:43,967 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,967 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,967 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:43,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:43,969 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:02:43,970 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:43,970 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,970 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:43,970 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,971 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:43,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:43,971 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:43,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,972 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:43,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:43,972 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:43,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,973 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:43,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,973 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:02:43,974 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:43,974 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,975 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:43,975 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:43,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,975 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:43,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,976 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:43,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:02:43,977 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:43,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,977 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:02:43,978 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:43,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:43,979 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:43,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,979 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:43,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:02:43,980 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:43,980 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,980 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:43,980 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:43,981 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:43,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:02:43,982 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:43,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:43,982 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:43,983 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:43,983 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:02:43,983 - sqlalchemy.engine.Engine - INFO - [cached since 1.13s ago] ('test@example.com', 1, 0)
2025-07-04 17:02:44,233 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:02:44,233 - sqlalchemy.engine.Engine - INFO - [cached since 1.379s ago] ('test@example.com', '$2b$12$g2bXsnCQ0gyy0C0WuB/nm.h7w2ChL9swmOq3h5qG4NhlpB.EvLLTa', None, None, None)
2025-07-04 17:02:44,234 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,235 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,235 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:02:44,235 - sqlalchemy.engine.Engine - INFO - [cached since 1.379s ago] (1,)
2025-07-04 17:02:44,235 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:02:44,235 - sqlalchemy.engine.Engine - INFO - [cached since 0.3278s ago] (1,)
2025-07-04 17:02:44,236 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:02:44,236 - services.app - INFO - Request completed: 201
2025-07-04 17:02:44,237 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:02:44,237 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:44,239 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,240 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:44,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,240 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:44,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,240 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:44,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,240 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:44,240 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-07-04 17:02:44,241 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:44,241 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,241 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:44,241 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,242 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:44,242 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,243 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:44,243 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,243 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:44,243 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,244 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:44,244 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,244 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:44,244 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,245 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:44,245 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,246 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,246 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,246 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:44,246 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,246 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:44,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:44,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:44,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,249 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:44,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,249 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:44,249 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:44,250 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:44,250 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,250 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:44,250 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,251 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:44,251 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:02:44,252 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:44,252 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,252 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:44,252 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:02:44,253 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:44,253 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:44,253 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:44,253 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,254 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,254 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:02:44,255 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:44,255 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,255 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:44,255 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:02:44,256 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:44,256 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,256 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:44,256 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,257 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:44,257 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:02:44,258 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:44,258 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,258 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,258 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:02:44,259 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:44,259 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,259 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:44,260 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,260 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,260 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:02:44,261 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:44,261 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,262 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:44,262 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,262 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:44,263 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:02:44,263 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:44,263 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,264 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,265 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,265 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:02:44,265 - sqlalchemy.engine.Engine - INFO - [cached since 1.412s ago] ('test@example.com', 1, 0)
2025-07-04 17:02:44,266 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:02:44,266 - services.app - INFO - Request completed: 401
2025-07-04 17:02:44,267 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:02:44,270 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,270 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:44,270 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,270 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:44,270 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,271 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:44,271 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,271 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:44,271 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,271 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:44,271 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,272 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:44,272 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,272 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:44,272 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,272 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:44,272 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,272 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:44,272 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,273 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:44,273 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,273 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:44,273 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,274 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:44,274 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,275 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:44,275 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,275 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:44,276 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,276 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:44,276 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,277 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:44,277 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:44,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,279 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:44,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,279 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:44,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,279 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:44,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,279 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:44,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,280 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:44,280 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,280 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:44,280 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,280 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:44,281 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,281 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:44,281 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,281 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:44,281 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,281 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:44,282 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,282 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:44,282 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,282 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:44,282 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:02:44,285 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:44,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00048s] ()
2025-07-04 17:02:44,286 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:44,286 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,287 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:44,288 - sqlalchemy.engine.Engine - INFO - [no key 0.00058s] ()
2025-07-04 17:02:44,289 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:44,289 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:44,290 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:44,290 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:44,290 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:44,290 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,291 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:44,291 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:44,292 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,292 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:02:44,292 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:44,293 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:02:44,293 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:44,293 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:44,294 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:44,294 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:44,294 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:44,294 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,295 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:44,297 - sqlalchemy.engine.Engine - INFO - [no key 0.00131s] ()
2025-07-04 17:02:44,298 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:44,298 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:44,299 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,300 - sqlalchemy.engine.Engine - INFO - [no key 0.00071s] ()
2025-07-04 17:02:44,301 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:44,302 - sqlalchemy.engine.Engine - INFO - [no key 0.00076s] ()
2025-07-04 17:02:44,303 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:44,303 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:44,303 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,304 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:02:44,305 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:44,305 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:02:44,307 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:44,307 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:02:44,309 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,311 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:02:44,318 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:44,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:44,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:44,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:44,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:44,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:44,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:44,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:44,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:44,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,320 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:44,320 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,322 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:44,322 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:02:44,323 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:44,323 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:44,324 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:44,324 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:02:44,325 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:44,326 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:02:44,327 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:44,327 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:44,327 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:44,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:02:44,328 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:44,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,329 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:44,329 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,329 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,329 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:44,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:44,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,332 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:44,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,332 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:44,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,332 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:44,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,332 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:44,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,333 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:44,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:02:44,334 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:44,334 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,334 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:44,334 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,335 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:44,335 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:02:44,335 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:44,335 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,336 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:44,336 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:02:44,336 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:44,336 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,337 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:44,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,337 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:02:44,338 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:44,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,339 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:44,339 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:02:44,339 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:44,339 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,340 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:44,340 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,340 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:44,341 - sqlalchemy.engine.Engine - INFO - [no key 0.00048s] ()
2025-07-04 17:02:44,341 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:44,342 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,342 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,342 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:02:44,343 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:44,343 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,343 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:44,343 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,344 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,344 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:02:44,345 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:44,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,345 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:44,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,346 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:44,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:02:44,347 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:44,347 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,347 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,348 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,348 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:02:44,348 - sqlalchemy.engine.Engine - INFO - [cached since 1.495s ago] ('test@example.com', 1, 0)
2025-07-04 17:02:44,626 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:02:44,627 - sqlalchemy.engine.Engine - INFO - [cached since 1.773s ago] ('test@example.com', '$2b$12$6Qi6i90HZGMTdGK8hLaSYuuHiFEPlUe92PeEhhrbwKIo2GG20kiju', None, None, None)
2025-07-04 17:02:44,627 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,628 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,628 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:02:44,628 - sqlalchemy.engine.Engine - INFO - [cached since 1.773s ago] (1,)
2025-07-04 17:02:44,629 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:02:44,629 - sqlalchemy.engine.Engine - INFO - [cached since 0.7216s ago] (1,)
2025-07-04 17:02:44,630 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:02:44,630 - services.app - INFO - Request completed: 201
2025-07-04 17:02:44,631 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:02:44,633 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:02:44,638 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:44,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:44,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:44,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,640 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:44,640 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,640 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:44,640 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,640 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:02:44,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,641 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:02:44,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:44,642 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:02:44,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,643 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:02:44,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,643 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:02:44,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,644 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:02:44,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:02:44,645 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:02:44,645 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,646 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:02:44,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,646 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:02:44,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:02:44,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:02:44,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:02:44,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:02:44,650 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:02:44,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,650 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:02:44,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:02:44,651 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:02:44,651 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:02:44,652 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:02:44,652 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,653 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:02:44,653 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:44,653 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:02:44,653 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:02:44,654 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:02:44,654 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:02:44,655 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:02:44,656 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:02:44,657 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:02:44,658 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:44,658 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:02:44,659 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:02:44,659 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:02:44,663 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:02:44,663 - sqlalchemy.engine.Engine - INFO - [no key 0.00057s] ()
2025-07-04 17:02:44,666 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:02:44,668 - sqlalchemy.engine.Engine - INFO - [no key 0.00130s] ()
2025-07-04 17:02:44,669 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:02:44,670 - sqlalchemy.engine.Engine - INFO - [no key 0.00048s] ()
2025-07-04 17:02:44,671 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,671 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:02:44,672 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:02:44,672 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:02:44,673 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:02:44,673 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:02:44,674 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:02:44,675 - sqlalchemy.engine.Engine - INFO - [no key 0.00059s] ()
2025-07-04 17:02:44,677 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:02:44,678 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:02:44,680 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:02:44,680 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:02:44,683 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:02:44,683 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:02:44,684 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:02:44,685 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:02:44,685 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:02:44,686 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:02:44,687 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:02:44,687 - sqlalchemy.engine.Engine - INFO - [cached since 1.833s ago] ('test@example.com', 1, 0)
2025-07-04 17:02:44,687 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:02:44,688 - services.app - INFO - Request completed: 401
2025-07-04 17:02:44,690 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:09:19,829 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:09:24,850 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:09:24,851 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:09:27,486 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:27,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:27,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,490 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:27,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:27,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:27,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:27,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:27,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,492 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:27,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,492 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:27,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,492 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:27,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,494 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:27,635 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:09:27,636 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:27,636 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:27,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:27,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:27,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:27,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:27,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:27,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:27,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:27,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:27,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,639 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:27,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,640 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:27,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,642 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:27,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,643 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:27,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,644 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:27,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,645 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:27,645 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,647 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:27,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,648 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:27,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,649 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:27,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,649 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,650 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,651 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:27,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,653 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:27,653 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:27,653 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:27,653 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,654 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:27,654 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,655 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:27,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:09:27,656 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:27,656 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,656 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:27,657 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:27,657 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:27,657 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,658 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:27,658 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,658 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:27,658 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:27,659 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:27,659 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,659 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:27,660 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:27,660 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:27,660 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,661 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:27,661 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,662 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:27,662 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:09:27,663 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:27,663 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,664 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:27,664 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:09:27,664 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:27,664 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,665 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:27,665 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,666 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:27,666 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:09:27,667 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:27,667 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,667 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:27,667 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,668 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:27,668 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:09:27,669 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:27,669 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,669 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:27,682 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:27,683 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:09:27,684 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (123, 1, 0)
2025-07-04 17:09:27,685 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:09:27,685 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:09:27,685 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:09:27,694 - app.error_handling - ERROR - Error recorded [external_api_1751670567685] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:09:27,694 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:09:27,695 - services.app - INFO - Request completed: 503
2025-07-04 17:09:27,696 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:09:27,697 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:09:27,698 - services.app - INFO - Request completed: 200
2025-07-04 17:09:27,698 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:09:27,699 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:09:27,699 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:27,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:27,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:27,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:27,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,701 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:27,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,702 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:27,702 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,702 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:27,703 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:09:27,704 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:27,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:27,705 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:27,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:09:27,706 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:27,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:27,707 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:27,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,708 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:27,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,708 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:27,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:27,709 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:27,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:27,709 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:27,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,709 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:27,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:27,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:27,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,712 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:27,712 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,712 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:27,712 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:27,712 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:27,712 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:27,713 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:27,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,713 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:27,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,714 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:27,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:09:27,715 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:27,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,715 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:27,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:27,716 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:27,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,716 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:27,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,717 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:27,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:09:27,717 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:27,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,718 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:27,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:27,719 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:27,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,719 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:27,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:27,720 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:27,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00051s] ()
2025-07-04 17:09:27,721 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:27,722 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:09:27,722 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:27,723 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:09:27,723 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:27,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,724 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:27,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,725 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:27,725 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:09:27,726 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:27,726 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,726 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:27,726 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:27,727 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:27,727 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:09:27,728 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:27,728 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:27,729 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:27,729 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:27,729 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:09:27,729 - sqlalchemy.engine.Engine - INFO - [generated in 0.00008s] ()
2025-07-04 17:09:27,752 - services.app - INFO - Request completed: 200
2025-07-04 17:09:27,753 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:09:27,763 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:09:27,764 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:09:27,764 - services.app - INFO - Info message
2025-07-04 17:09:27,764 - services.app - WARNING - Warning message
2025-07-04 17:09:27,764 - services.app - ERROR - Error message
2025-07-04 17:09:28,501 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,501 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,511 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,511 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:28,511 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,513 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:28,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,513 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:28,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,513 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:28,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:28,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:28,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:28,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:28,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,514 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,526 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:28,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:28,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:28,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:28,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:28,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:28,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:28,528 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,528 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:28,528 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,528 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:28,528 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,529 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:28,529 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,530 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:28,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:28,531 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:28,531 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,532 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:28,532 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:28,532 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:28,532 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:28,533 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:28,533 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,533 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:28,533 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,534 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:28,534 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,535 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:28,535 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:28,535 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,535 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,535 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:28,536 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:28,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,538 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:28,539 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:28,539 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:28,539 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,540 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:28,540 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,540 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:28,540 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:09:28,541 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:28,541 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,541 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:28,542 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:28,542 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:28,542 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,543 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:28,543 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,543 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:28,543 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:28,544 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:28,544 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,544 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:28,545 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:28,545 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:28,545 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,545 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:28,545 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,546 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:28,546 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:09:28,547 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:28,547 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,547 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:28,548 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:09:28,548 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:28,548 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,549 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:28,549 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,549 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:28,550 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:09:28,550 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:28,550 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,551 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:28,551 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,551 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:28,552 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:09:28,553 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:28,553 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,553 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,554 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,554 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:09:28,554 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', 1, 0)
2025-07-04 17:09:28,555 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:09:28,555 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:09:28,556 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,556 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,557 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:09:28,557 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1,)
2025-07-04 17:09:28,558 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:09:28,558 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:09:28.557660', '2025-07-04 23:09:28.557663')
2025-07-04 17:09:28,559 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,559 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,560 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:09:28,561 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (1,)
2025-07-04 17:09:28,561 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:09:28,566 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,566 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:28,566 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,566 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:28,566 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,567 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:28,567 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,567 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:28,567 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,567 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:28,567 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,567 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:28,567 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,568 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:28,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,568 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:28,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,568 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:28,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,568 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:28,568 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:28,569 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:28,569 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,570 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:28,570 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:28,571 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:28,571 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:09:28,571 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:28,572 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,573 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:28,573 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:09:28,574 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:28,574 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:09:28,575 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:28,575 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:28,576 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:28,576 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,577 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,577 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,577 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:28,577 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:28,578 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:28,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,580 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:28,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,580 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:28,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,580 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:28,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,580 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:28,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:28,580 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:28,581 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:09:28,581 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:28,581 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,582 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:28,582 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:28,583 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:28,583 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:09:28,584 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:28,584 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:28,585 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:28,585 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:28,586 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:28,586 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,587 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:28,587 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:28,588 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:28,589 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:09:28,590 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:28,590 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:09:28,590 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:28,590 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:09:28,591 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:28,591 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:28,592 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:28,592 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,592 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:28,593 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:09:28,594 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:28,594 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,594 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:28,594 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:09:28,595 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:28,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,596 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:28,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,597 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:28,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:09:28,598 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:28,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:28,598 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:28,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,599 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:28,599 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:09:28,600 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:28,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:28,600 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,601 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,603 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:09:28,604 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] ()
2025-07-04 17:09:28,604 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:09:28,604 - sqlalchemy.engine.Engine - INFO - [cached since 0.05024s ago] ('test@example.com', 1, 0)
2025-07-04 17:09:28,605 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:09:28,605 - sqlalchemy.engine.Engine - INFO - [cached since 0.04993s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:09:28,606 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,606 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,606 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:09:28,606 - sqlalchemy.engine.Engine - INFO - [cached since 0.04946s ago] (1,)
2025-07-04 17:09:28,607 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:09:28,607 - sqlalchemy.engine.Engine - INFO - [cached since 0.04884s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:09:28.606921', '2025-07-04 23:09:28.606924')
2025-07-04 17:09:28,608 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:28,608 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:28,608 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:09:28,609 - sqlalchemy.engine.Engine - INFO - [cached since 0.0483s ago] (1,)
2025-07-04 17:09:28,609 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:09:28,613 - services.app - INFO - Request started: GET /health
2025-07-04 17:09:28,614 - services.app - INFO - Request completed: 200
2025-07-04 17:09:28,616 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:09:28,618 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:09:28,618 - services.app - INFO - Request completed: 200
2025-07-04 17:09:28,619 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:09:28,650 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:09:28,650 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:09:30,589 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:30,590 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:30,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,590 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:30,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,590 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:30,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,591 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:30,591 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,591 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:30,591 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,591 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:30,591 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,591 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:30,591 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,592 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:30,592 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,592 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:30,592 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,596 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:30,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:30,598 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:30,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,599 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:30,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,600 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:30,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,601 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:30,601 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,602 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:30,602 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,602 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:30,602 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:30,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:30,604 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,605 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:30,606 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:09:30,606 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:30,606 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,607 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:30,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,607 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:30,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:30,608 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:30,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,609 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:30,609 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:09:30,610 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:30,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,610 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:30,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,611 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:30,611 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:30,611 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:30,611 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,612 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:30,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:30,613 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:30,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,613 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:30,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:30,614 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:30,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:09:30,615 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:30,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,616 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:30,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:09:30,617 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:30,617 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:30,617 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:30,617 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,618 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:30,619 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:09:30,619 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:30,619 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:30,620 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:30,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,620 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:30,621 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:09:30,622 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:30,622 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:30,623 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:30,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:30,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:30,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,624 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:30,625 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:30,625 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:30,625 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,626 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:30,626 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,627 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:30,627 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,627 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:30,627 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,628 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:30,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,629 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:30,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,629 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:30,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,630 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:30,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:09:30,631 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:30,632 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:30,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,634 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:30,635 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:30,635 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:30,635 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,636 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:30,636 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,636 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:30,636 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:09:30,637 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:30,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,638 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:30,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:09:30,639 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:30,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:09:30,640 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:30,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:30,640 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:30,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:09:30,641 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:30,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:30,642 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:30,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:30,643 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:30,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,643 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:30,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:30,644 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:30,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:09:30,645 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:30,645 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,646 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:30,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:09:30,646 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:30,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,647 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:30,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,648 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:30,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:09:30,649 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:30,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,649 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:30,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,650 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:30,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:09:30,651 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:30,651 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,651 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:30,653 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:30,653 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:09:30,653 - sqlalchemy.engine.Engine - INFO - [cached since 2.099s ago] ('test@example.com', 1, 0)
2025-07-04 17:09:30,654 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:09:30,947 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:09:30,947 - sqlalchemy.engine.Engine - INFO - [cached since 2.392s ago] ('test@example.com', '$2b$12$wWZBoi/3vH2btiwKrpuRAuuMEiWhgRUif.qU9GOfbCjLAzyWa14kG', None, None, None)
2025-07-04 17:09:30,948 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:30,949 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:30,949 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:09:30,949 - sqlalchemy.engine.Engine - INFO - [cached since 2.393s ago] (1,)
2025-07-04 17:09:30,952 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:09:30,952 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1,)
2025-07-04 17:09:30,953 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:09:30,953 - services.app - INFO - Request completed: 201
2025-07-04 17:09:30,954 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:09:30,955 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:09:30,960 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:30,960 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:30,960 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,960 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,961 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:30,962 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,962 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:30,962 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,962 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:30,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:30,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:30,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,964 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:30,964 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,965 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:30,965 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,965 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:30,966 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,966 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:30,966 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,967 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:30,967 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,967 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:30,967 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:30,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:30,970 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:30,971 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:30,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:09:30,971 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:30,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,972 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:30,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,973 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:30,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:09:30,973 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:30,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,974 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:30,974 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:30,974 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:30,974 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,975 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:30,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:30,975 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:30,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:09:30,976 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:30,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,976 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:30,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:09:30,977 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:30,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,977 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:30,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,978 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:30,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:09:30,979 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:30,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,979 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:30,980 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:09:30,980 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:30,980 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,981 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:30,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,981 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:30,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:09:30,982 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:30,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:30,983 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:30,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:30,983 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:30,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:09:30,984 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:30,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:30,985 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:30,985 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:30,985 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:09:30,985 - sqlalchemy.engine.Engine - INFO - [cached since 2.431s ago] ('test@example.com', 1, 0)
2025-07-04 17:09:30,986 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:09:30,986 - services.app - INFO - Request completed: 401
2025-07-04 17:09:30,987 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:09:31,061 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,061 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,061 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,061 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,061 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,061 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,061 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,063 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:31,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,063 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:31,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,064 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:31,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,065 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:31,065 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,066 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:31,066 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,066 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:31,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,067 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:31,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,068 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:31,068 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,068 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,069 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,070 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,071 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:31,072 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:31,072 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:31,072 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,073 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:31,073 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,073 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:31,073 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:09:31,074 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:31,074 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,075 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:31,075 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:31,075 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:31,075 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,076 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:31,076 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,076 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,077 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:09:31,077 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:31,077 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,078 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,078 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:31,079 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:31,079 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,079 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:31,079 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,080 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:31,080 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:09:31,081 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:31,081 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,081 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,082 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:09:31,082 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:31,082 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,083 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:31,083 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,084 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,084 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:09:31,085 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:31,085 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:09:31,086 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:31,086 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,086 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,087 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:09:31,089 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,089 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,089 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,089 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,089 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,089 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,089 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,089 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,089 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,090 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:31,091 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,091 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:31,091 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,092 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:31,092 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,093 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:31,093 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,093 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:31,093 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,094 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:31,094 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,095 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:31,095 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,096 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:31,096 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,096 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:31,097 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:31,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,099 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:31,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,101 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:31,101 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:09:31,101 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:31,101 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,102 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:31,102 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,103 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:31,103 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:31,103 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:31,103 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,104 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:31,104 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:31,104 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:31,104 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,105 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:31,106 - sqlalchemy.engine.Engine - INFO - [no key 0.00053s] ()
2025-07-04 17:09:31,107 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,107 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:09:31,108 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:31,108 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:31,109 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,109 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:09:31,110 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:31,110 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,110 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:31,110 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,111 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:31,111 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:09:31,112 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:31,112 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,113 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,113 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:09:31,113 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:31,113 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,114 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:31,114 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,115 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,115 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:09:31,116 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:31,116 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,117 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:31,117 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,117 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,118 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:09:31,118 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:31,118 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,119 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,119 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,119 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:09:31,120 - sqlalchemy.engine.Engine - INFO - [cached since 2.565s ago] ('test@example.com', 1, 0)
2025-07-04 17:09:31,370 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:09:31,370 - sqlalchemy.engine.Engine - INFO - [cached since 2.815s ago] ('test@example.com', '$2b$12$x4f.NgH6hmN8ARkpcHJx7OvqgYkAKmucnLjmGTVsGFJRvWmYM5Kc.', None, None, None)
2025-07-04 17:09:31,371 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,372 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:09:31,372 - sqlalchemy.engine.Engine - INFO - [cached since 2.815s ago] (1,)
2025-07-04 17:09:31,373 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:09:31,373 - sqlalchemy.engine.Engine - INFO - [cached since 0.421s ago] (1,)
2025-07-04 17:09:31,373 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:09:31,374 - services.app - INFO - Request completed: 201
2025-07-04 17:09:31,375 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:09:31,376 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:09:31,378 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,378 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,379 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,381 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,381 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:31,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,381 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:31,381 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:09:31,382 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:31,382 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,385 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:31,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:09:31,387 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:31,387 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:31,388 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:31,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:09:31,390 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:31,390 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:09:31,391 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:31,391 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:09:31,392 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:31,392 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,392 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:31,392 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,393 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,393 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,393 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:31,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,396 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:31,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:31,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,396 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:31,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,396 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:31,396 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:09:31,397 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:31,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,397 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:31,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,398 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:31,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:31,399 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:31,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,399 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:31,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:31,400 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:31,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,400 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:31,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,401 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,401 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:31,401 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:31,401 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,402 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,402 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:09:31,403 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:31,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,403 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:31,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,404 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:31,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00053s] ()
2025-07-04 17:09:31,405 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:31,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,406 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:09:31,406 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:31,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,407 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:31,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,408 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:09:31,409 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:31,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:31,410 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:31,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,412 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:09:31,413 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:31,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,414 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,414 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,415 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:09:31,415 - sqlalchemy.engine.Engine - INFO - [cached since 2.861s ago] ('test@example.com', 1, 0)
2025-07-04 17:09:31,415 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:09:31,415 - services.app - INFO - Request completed: 401
2025-07-04 17:09:31,416 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:09:31,419 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,420 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:31,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,422 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:31,422 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,422 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:31,422 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,423 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:31,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:31,424 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:31,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,425 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:31,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,426 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:31,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,427 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:31,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,427 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,427 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,430 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:31,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,430 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,430 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:31,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,430 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:31,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:09:31,431 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:31,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,432 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:31,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:31,433 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:31,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:09:31,433 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:31,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,434 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:31,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:31,435 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:31,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,436 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:31,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,436 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:09:31,437 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:31,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00051s] ()
2025-07-04 17:09:31,439 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,439 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:09:31,440 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:31,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:31,440 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:31,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,441 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:31,441 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:09:31,442 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:31,442 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,443 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,443 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:09:31,443 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:31,444 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,444 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:31,444 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,445 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,445 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:09:31,446 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:31,446 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,447 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:31,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,448 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,449 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:09:31,449 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,449 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,450 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,451 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,451 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,451 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,451 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:31,451 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,451 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:31,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,452 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:31,452 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,453 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:31,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:09:31,454 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:31,454 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:09:31,455 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:31,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:09:31,455 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:31,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,456 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:31,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,457 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:31,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,457 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:31,458 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,458 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,458 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,458 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,458 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,459 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:31,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,461 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:31,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,461 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:31,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,461 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:31,461 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:09:31,462 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:31,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,462 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:31,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,465 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:31,465 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:09:31,466 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:31,466 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,467 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:31,467 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:31,467 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:31,467 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,468 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:31,468 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,468 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:09:31,469 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:31,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,470 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,470 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:31,470 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:31,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,471 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:31,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,472 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:31,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:09:31,473 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:31,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,474 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:09:31,474 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:31,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,475 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:31,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,476 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,476 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:09:31,476 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:31,477 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,477 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:31,477 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,478 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,478 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:09:31,479 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:31,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,479 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,480 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,480 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:09:31,480 - sqlalchemy.engine.Engine - INFO - [cached since 2.926s ago] ('test@example.com', 1, 0)
2025-07-04 17:09:31,811 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:09:31,811 - sqlalchemy.engine.Engine - INFO - [cached since 3.256s ago] ('test@example.com', '$2b$12$T2WUuTOTRfgblutDmDZes.DWMO1jGcnhlSz/jVX6.aLp8gM6jV8Aa', None, None, None)
2025-07-04 17:09:31,812 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,813 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,813 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:09:31,813 - sqlalchemy.engine.Engine - INFO - [cached since 3.256s ago] (1,)
2025-07-04 17:09:31,813 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:09:31,813 - sqlalchemy.engine.Engine - INFO - [cached since 0.8616s ago] (1,)
2025-07-04 17:09:31,814 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:09:31,814 - services.app - INFO - Request completed: 201
2025-07-04 17:09:31,815 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:09:31,816 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:09:31,818 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,818 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,818 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,818 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,818 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:31,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,820 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:09:31,820 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:09:31,824 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:09:31,824 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:09:31,825 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:09:31,825 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,825 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:09:31,826 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:09:31,827 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:09:31,827 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,827 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:09:31,828 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,828 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:09:31,828 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,829 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:09:31,829 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,830 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:09:31,830 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,831 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,831 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:09:31,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,831 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:09:31,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:09:31,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,832 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:09:31,833 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,833 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:09:31,833 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,833 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:09:31,833 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,833 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:09:31,833 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,833 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:09:31,833 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,834 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:09:31,834 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,834 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:09:31,834 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,834 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:09:31,834 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,834 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:09:31,834 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:09:31,835 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:09:31,835 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:09:31,836 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:09:31,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,836 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:09:31,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,837 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:09:31,837 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:09:31,838 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:09:31,838 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:09:31,839 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:09:31,839 - sqlalchemy.engine.Engine - INFO - [no key 0.00056s] ()
2025-07-04 17:09:31,841 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:09:31,841 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:09:31,841 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:09:31,841 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,842 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,842 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:09:31,843 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:09:31,843 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,844 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,844 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:09:31,844 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:09:31,845 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:09:31,845 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:09:31,845 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,846 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:09:31,846 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-07-04 17:09:31,847 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:09:31,847 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:09:31,848 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,848 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:09:31,848 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:09:31,848 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,849 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:09:31,849 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,850 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:09:31,850 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:09:31,851 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:09:31,851 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:09:31,851 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:09:31,851 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:09:31,852 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:09:31,863 - sqlalchemy.engine.Engine - INFO - [no key 0.01070s] ()
2025-07-04 17:09:31,873 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:09:31,873 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:09:31,873 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:09:31,874 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:09:31,874 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:09:31,874 - sqlalchemy.engine.Engine - INFO - [cached since 3.32s ago] ('test@example.com', 1, 0)
2025-07-04 17:09:31,875 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:09:31,875 - services.app - INFO - Request completed: 401
2025-07-04 17:09:31,876 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:10:09,033 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:10:14,493 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:10:14,494 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:10:17,209 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:17,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:17,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:17,214 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,215 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:17,215 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,215 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:17,215 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,215 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:17,215 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,216 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:17,391 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:10:17,392 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:17,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:17,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:17,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:17,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,394 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:17,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,394 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:17,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,396 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:17,396 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:10:17,398 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:17,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,400 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:17,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,401 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:17,401 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:17,401 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:17,402 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,402 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:17,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,404 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:17,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,407 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:17,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:17,407 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:17,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,408 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:17,408 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:17,408 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:17,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,408 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:17,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:17,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:17,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,411 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:17,411 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,411 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:17,411 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,411 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:17,411 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,411 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:17,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:17,412 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:17,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,413 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:17,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,413 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:17,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:10:17,414 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:17,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,415 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:17,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:17,415 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:17,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,416 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:17,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,416 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:17,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:10:17,417 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:17,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:17,418 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:17,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:17,418 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:17,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:17,419 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:17,419 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,422 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:17,422 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:10:17,422 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:17,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,423 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:17,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:10:17,424 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:17,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,424 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:17,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,425 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:17,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:10:17,426 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:17,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,426 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:17,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,427 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:17,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:10:17,428 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:17,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,429 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:17,445 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:17,447 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:17,448 - sqlalchemy.engine.Engine - INFO - [generated in 0.00098s] (123, 1, 0)
2025-07-04 17:10:17,451 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:10:17,451 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:10:17,451 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:17,461 - app.error_handling - ERROR - Error recorded [external_api_1751670617451] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:10:17,462 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:10:17,463 - services.app - INFO - Request completed: 503
2025-07-04 17:10:17,464 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:10:17,465 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:10:17,466 - services.app - INFO - Request completed: 200
2025-07-04 17:10:17,466 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:10:17,467 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:10:17,467 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:17,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:17,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,468 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:17,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,468 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:17,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,468 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:17,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:17,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:17,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:17,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:17,469 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,470 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:17,470 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,470 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:17,470 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,471 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:17,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,472 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:17,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,472 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:17,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:17,473 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:17,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:17,473 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:17,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:17,474 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:17,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:17,475 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:17,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,475 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:17,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,476 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:17,476 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:17,476 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:17,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,476 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:17,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,476 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:17,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:17,479 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,479 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:17,479 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:17,479 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:17,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:10:17,481 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:17,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:17,481 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:17,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,482 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:17,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:10:17,483 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:17,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:17,484 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:17,484 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:10:17,484 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:17,484 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,485 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:17,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,485 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:17,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:17,486 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:17,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,486 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:17,487 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:17,487 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:17,487 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,487 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:17,488 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:17,488 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:17,488 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:10:17,489 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:17,489 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,490 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:17,490 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:10:17,491 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:17,491 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:17,492 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:17,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:17,493 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:17,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-07-04 17:10:17,494 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:17,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:10:17,495 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:17,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:17,496 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:17,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:10:17,497 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:17,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:17,498 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:17,498 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:17,498 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:10:17,498 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] ()
2025-07-04 17:10:17,726 - services.app - INFO - Request completed: 200
2025-07-04 17:10:17,728 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:10:17,739 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:10:17,739 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:10:17,739 - services.app - INFO - Info message
2025-07-04 17:10:17,739 - services.app - WARNING - Warning message
2025-07-04 17:10:17,739 - services.app - ERROR - Error message
2025-07-04 17:10:18,643 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,644 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,654 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,654 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:18,654 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,656 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:18,656 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,656 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:18,656 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,656 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:18,656 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,656 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:18,656 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,656 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:18,657 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,657 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:18,657 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,657 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:18,657 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,657 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,669 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,669 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:18,669 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,669 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:18,669 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,669 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,670 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:18,671 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,672 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:18,672 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,672 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:18,673 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:18,673 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:18,673 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,674 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:18,674 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:18,674 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:18,674 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,675 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:18,675 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,676 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:18,676 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,676 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:18,676 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:18,677 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:18,677 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:18,678 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,679 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:18,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,681 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:18,681 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:18,681 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:18,681 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,682 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:18,682 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:18,683 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:18,683 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:10:18,683 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:18,683 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,684 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:18,684 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:18,684 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:18,685 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,685 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:18,685 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:18,686 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:18,686 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:10:18,686 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:18,686 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,687 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:18,687 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:10:18,688 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:18,688 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:18,690 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:18,690 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:18,690 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:18,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:10:18,691 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:18,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:18,692 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:18,692 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:10:18,693 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:18,693 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,693 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:18,693 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,694 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:18,694 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:10:18,695 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:18,695 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:18,696 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:18,696 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,697 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:18,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:10:18,697 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:18,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,698 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,698 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,699 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:18,699 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ('test@example.com', 1, 0)
2025-07-04 17:10:18,700 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:10:18,700 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:10:18,701 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,702 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,702 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:10:18,703 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1,)
2025-07-04 17:10:18,704 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:10:18,704 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:10:18.703324', '2025-07-04 23:10:18.703327')
2025-07-04 17:10:18,705 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,706 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,707 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:10:18,707 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] (1,)
2025-07-04 17:10:18,709 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:18,714 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,714 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:18,714 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,714 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:18,714 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,714 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:18,714 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:18,715 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,716 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:18,716 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,716 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:18,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,717 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:18,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,717 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:18,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,718 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:18,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:18,719 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:18,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,719 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:18,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,720 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:18,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,722 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:18,722 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:10:18,724 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:18,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,725 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:18,726 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:18,727 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:18,728 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:18,728 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:10:18,729 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:18,729 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,729 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:18,729 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:18,730 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:18,730 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:10:18,731 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:18,731 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:18,732 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:18,732 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:18,732 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:18,732 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,733 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:18,733 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,733 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:18,733 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:18,734 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:18,734 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,734 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:18,735 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:18,735 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:18,735 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:18,736 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:18,736 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:18,736 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:18,737 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-07-04 17:10:18,738 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:18,738 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,739 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:18,739 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:10:18,740 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:18,740 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,740 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:18,740 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,741 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:18,741 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:10:18,742 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:18,742 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:18,742 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:18,743 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,743 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:18,743 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:10:18,744 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:18,744 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:18,744 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,745 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,747 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:10:18,748 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ()
2025-07-04 17:10:18,748 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:18,749 - sqlalchemy.engine.Engine - INFO - [cached since 0.04959s ago] ('test@example.com', 1, 0)
2025-07-04 17:10:18,749 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:10:18,749 - sqlalchemy.engine.Engine - INFO - [cached since 0.04902s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:10:18,750 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,750 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,750 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:10:18,750 - sqlalchemy.engine.Engine - INFO - [cached since 0.04794s ago] (1,)
2025-07-04 17:10:18,751 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:10:18,751 - sqlalchemy.engine.Engine - INFO - [cached since 0.04713s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:10:18.751000', '2025-07-04 23:10:18.751003')
2025-07-04 17:10:18,752 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:18,752 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:18,752 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:10:18,753 - sqlalchemy.engine.Engine - INFO - [cached since 0.04601s ago] (1,)
2025-07-04 17:10:18,753 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:18,757 - services.app - INFO - Request started: GET /health
2025-07-04 17:10:18,758 - services.app - INFO - Request completed: 200
2025-07-04 17:10:18,759 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:10:18,760 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:10:18,760 - services.app - INFO - Request completed: 200
2025-07-04 17:10:18,761 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:10:18,804 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:10:18,804 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:10:21,098 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,101 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,101 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,101 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,101 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,101 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,101 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,102 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,102 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,102 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,102 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,103 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:21,103 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:21,105 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:21,105 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:21,105 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:21,106 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,108 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:21,108 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:10:21,109 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:21,109 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,110 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:21,110 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,111 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:21,111 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:10:21,114 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:21,114 - sqlalchemy.engine.Engine - INFO - [no key 0.00044s] ()
2025-07-04 17:10:21,116 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,117 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,117 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,117 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,117 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,120 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:21,120 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,120 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,120 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,120 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:21,120 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,120 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:21,121 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:10:21,122 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:21,122 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:21,123 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:21,123 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:21,124 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:21,124 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:10:21,125 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:21,125 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,125 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:21,125 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,126 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:21,126 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,126 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:21,126 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,127 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,127 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:10:21,128 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:21,128 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,128 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:21,128 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,129 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:21,129 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,129 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:21,129 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:21,130 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:21,130 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:10:21,131 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:21,131 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:21,133 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,133 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:10:21,134 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:21,134 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,134 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:21,134 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,135 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,135 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:10:21,136 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:21,136 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,136 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:21,136 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:21,137 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,140 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:10:21,142 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,142 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,142 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,143 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,144 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,144 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:21,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,144 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:21,144 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:21,145 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:21,145 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,147 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:21,147 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:21,148 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:21,148 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,148 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:21,148 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:21,149 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:21,149 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,150 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:21,150 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,150 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:21,150 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,151 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:21,151 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,153 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:21,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,155 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:21,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:21,155 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:21,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,157 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:21,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:10:21,159 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:21,159 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:10:21,160 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:21,160 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:10:21,161 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:21,161 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:10:21,162 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:21,162 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:21,163 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:21,163 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,163 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:10:21,164 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:21,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,165 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:21,165 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:21,166 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:21,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:10:21,168 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:21,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:10:21,169 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:21,169 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-07-04 17:10:21,170 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:21,171 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:21,171 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:10:21,172 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:21,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,173 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:21,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,173 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:10:21,174 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:21,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:10:21,176 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:21,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,178 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:21,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00048s] ()
2025-07-04 17:10:21,179 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:21,179 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:21,180 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,183 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,183 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:21,183 - sqlalchemy.engine.Engine - INFO - [cached since 2.484s ago] ('test@example.com', 1, 0)
2025-07-04 17:10:21,184 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:10:21,520 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:10:21,520 - sqlalchemy.engine.Engine - INFO - [cached since 2.82s ago] ('test@example.com', '$2b$12$snkYYAEjPJyew7DX7igwOue9cXaXKcp4/LAyGDsKRxh02s0lGfAt2', None, None, None)
2025-07-04 17:10:21,523 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,527 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,527 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:10:21,527 - sqlalchemy.engine.Engine - INFO - [cached since 2.825s ago] (1,)
2025-07-04 17:10:21,532 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:10:21,532 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (1,)
2025-07-04 17:10:21,533 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:21,534 - services.app - INFO - Request completed: 201
2025-07-04 17:10:21,537 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:10:21,538 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:10:21,544 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,544 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,544 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:21,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,547 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:21,547 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:21,549 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:21,549 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:10:21,551 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:21,551 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:10:21,552 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:21,553 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:10:21,554 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:21,554 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:21,555 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:21,555 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,557 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:21,557 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:21,558 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:21,559 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:10:21,560 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:21,561 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:21,564 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,564 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,564 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,564 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:21,565 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,566 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,566 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,566 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:21,566 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,566 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,566 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,566 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:21,566 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,567 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,567 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,567 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:21,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,568 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,569 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:21,569 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,569 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,569 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,569 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:21,569 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,570 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:21,570 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,570 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:21,570 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,570 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:21,571 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:10:21,576 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:21,577 - sqlalchemy.engine.Engine - INFO - [no key 0.00061s] ()
2025-07-04 17:10:21,582 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:21,582 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,583 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:21,583 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:21,584 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:21,584 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,585 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:21,585 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:10:21,586 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:21,586 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,592 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:21,592 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:21,593 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,593 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:10:21,594 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:21,594 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,595 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:21,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:21,596 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:21,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:21,597 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:21,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:21,600 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:21,601 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:10:21,602 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:21,602 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:10:21,603 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,603 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:10:21,604 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:21,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:21,605 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:21,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,606 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,606 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:10:21,607 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:21,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,608 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:21,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:10:21,610 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:21,611 - sqlalchemy.engine.Engine - INFO - [no key 0.00057s] ()
2025-07-04 17:10:21,612 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:21,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:21,614 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,614 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,615 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:21,615 - sqlalchemy.engine.Engine - INFO - [cached since 2.916s ago] ('test@example.com', 1, 0)
2025-07-04 17:10:21,615 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:21,616 - services.app - INFO - Request completed: 401
2025-07-04 17:10:21,617 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:10:21,786 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,786 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,786 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,786 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,786 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,787 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,788 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,788 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,788 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:21,788 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,789 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:21,789 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,789 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:21,789 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,790 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:21,790 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,791 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:21,791 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,791 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:21,791 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,792 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:21,792 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,793 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:21,793 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,793 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,793 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,793 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,795 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,796 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:21,796 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,796 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,796 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,796 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:21,796 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,796 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:21,796 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,797 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:21,797 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,797 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:21,797 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:10:21,798 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:21,798 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:21,799 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:21,799 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,799 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:21,799 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:21,800 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:21,800 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,800 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:21,800 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,801 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,801 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:21,801 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:21,802 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,802 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:21,802 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,803 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:21,803 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,803 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:21,803 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,804 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:21,804 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:10:21,805 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:21,805 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,805 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,805 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:10:21,806 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:21,806 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,806 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:21,806 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,807 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,807 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:10:21,808 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:21,808 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,808 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:21,808 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,809 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,810 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:10:21,810 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,810 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,810 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,812 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,812 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,812 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,812 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:21,812 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,812 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:21,812 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:21,813 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:21,813 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:21,814 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:21,814 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,815 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:21,815 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:21,815 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:21,815 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,816 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:21,816 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:21,817 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:21,817 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,818 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:21,818 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:21,819 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:21,819 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:21,819 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,820 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:21,822 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:21,823 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,823 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:21,823 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,824 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:21,824 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,825 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:21,825 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:10:21,825 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:21,825 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,826 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:21,826 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:21,826 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:21,826 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,827 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:21,827 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,827 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,828 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:21,828 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:21,828 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,829 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:21,829 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,829 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:21,829 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,830 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:21,830 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,831 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:21,831 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:10:21,832 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:21,832 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,832 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,833 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:10:21,833 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:21,833 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,834 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:21,834 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:21,834 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:21,835 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:10:21,835 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:21,835 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:21,836 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:21,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,837 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:21,837 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:10:21,838 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:21,838 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:21,838 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:21,839 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:21,839 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:21,839 - sqlalchemy.engine.Engine - INFO - [cached since 3.14s ago] ('test@example.com', 1, 0)
2025-07-04 17:10:22,126 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:10:22,127 - sqlalchemy.engine.Engine - INFO - [cached since 3.426s ago] ('test@example.com', '$2b$12$/KF9Q2VZ/m.3l6wrDhEcueaziSkLxphybD6/HwfPiroBYysosp0FC', None, None, None)
2025-07-04 17:10:22,129 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,130 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,130 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:10:22,130 - sqlalchemy.engine.Engine - INFO - [cached since 3.428s ago] (1,)
2025-07-04 17:10:22,131 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:10:22,131 - sqlalchemy.engine.Engine - INFO - [cached since 0.5991s ago] (1,)
2025-07-04 17:10:22,131 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:22,131 - services.app - INFO - Request completed: 201
2025-07-04 17:10:22,132 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:10:22,133 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:10:22,135 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,135 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:22,135 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,135 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:22,135 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,135 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:22,135 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,135 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:22,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,137 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:22,137 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:10:22,138 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:22,138 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:22,138 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:22,139 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,139 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:22,139 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,140 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:22,140 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:22,141 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:22,141 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:22,141 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:22,141 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,142 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:22,142 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,143 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:22,143 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,143 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,143 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,144 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,145 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:22,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,147 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:22,147 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:22,147 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:22,148 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:22,148 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:22,148 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,149 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:22,149 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:22,149 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:22,149 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,150 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:22,150 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:22,150 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:22,151 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,151 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:22,151 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,152 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,152 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:22,152 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:22,152 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,153 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:22,153 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:22,153 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:22,153 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,154 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:22,154 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,155 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:22,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-07-04 17:10:22,156 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:22,156 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,156 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,156 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:10:22,157 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:22,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,158 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:22,158 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,159 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,159 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:10:22,160 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:22,160 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:22,160 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:22,160 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,161 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:22,161 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:10:22,162 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:22,162 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,162 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,163 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,163 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:22,163 - sqlalchemy.engine.Engine - INFO - [cached since 3.464s ago] ('test@example.com', 1, 0)
2025-07-04 17:10:22,164 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:22,164 - services.app - INFO - Request completed: 401
2025-07-04 17:10:22,165 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:10:22,169 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,169 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:22,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,170 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:22,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,170 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:22,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:22,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,172 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:22,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,173 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:22,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:22,173 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:22,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,174 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:22,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,175 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:22,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,176 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:22,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,176 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:22,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,177 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:22,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,178 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:22,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:22,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,181 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:22,181 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:22,181 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:22,181 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,182 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:22,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,182 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:22,183 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:10:22,183 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:22,183 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,184 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:22,184 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:22,185 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:22,185 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:22,185 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:22,185 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,186 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,186 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:10:22,187 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:22,187 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,187 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:22,187 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:22,188 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:22,188 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,188 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:22,188 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,189 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:22,189 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:10:22,190 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:22,190 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,190 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,190 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:10:22,191 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:22,191 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,191 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:22,192 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,192 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,192 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:10:22,193 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:22,193 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,194 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:22,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:22,194 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,195 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:10:22,196 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,196 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:22,196 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,196 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:22,196 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,196 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:22,196 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,196 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:22,196 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:22,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,198 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:22,198 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,199 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:22,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,199 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:22,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:10:22,200 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:22,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:22,201 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:22,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,201 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:22,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,202 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:22,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,202 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:22,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,203 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:22,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,203 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:22,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:22,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,203 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:22,204 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,204 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:22,204 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,204 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:22,204 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,204 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:22,204 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,204 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:22,204 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:22,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,205 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:22,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:22,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,206 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:22,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:22,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,206 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:22,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:22,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,206 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:22,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,207 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:22,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,207 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:22,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,207 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:22,207 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:22,208 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:22,209 - sqlalchemy.engine.Engine - INFO - [no key 0.00126s] ()
2025-07-04 17:10:22,210 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:22,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,210 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:22,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:22,211 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:22,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,211 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:22,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:22,212 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:22,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,213 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:22,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,214 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:10:22,215 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:22,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,215 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:22,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:22,216 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:22,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:22,216 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:22,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,217 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:22,217 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:10:22,218 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:22,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,220 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,220 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:10:22,220 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:22,220 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,221 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:22,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,222 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:10:22,222 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:22,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,223 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:22,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,224 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:22,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:10:22,224 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:22,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,225 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,226 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,226 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:22,226 - sqlalchemy.engine.Engine - INFO - [cached since 3.527s ago] ('test@example.com', 1, 0)
2025-07-04 17:10:22,488 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:10:22,488 - sqlalchemy.engine.Engine - INFO - [cached since 3.788s ago] ('test@example.com', '$2b$12$lmznuCmWn.HeA/n4iYK9GOqwBbZqj9aoQf7JkmdSOLFq1wxiUt7ne', None, None, None)
2025-07-04 17:10:22,489 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,489 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,489 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:10:22,490 - sqlalchemy.engine.Engine - INFO - [cached since 3.787s ago] (1,)
2025-07-04 17:10:22,490 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:10:22,491 - sqlalchemy.engine.Engine - INFO - [cached since 0.959s ago] (1,)
2025-07-04 17:10:22,491 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:22,491 - services.app - INFO - Request completed: 201
2025-07-04 17:10:22,492 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:10:22,493 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:10:22,496 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,497 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:22,497 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,497 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:22,497 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,497 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:22,497 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,498 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:22,499 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,499 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:22,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:22,500 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:22,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:22,501 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:22,501 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:22,502 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:22,502 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,503 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:22,503 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,503 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:22,504 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,504 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:22,504 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,505 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:22,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,505 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:22,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:22,506 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,506 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,506 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:22,506 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,506 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:22,506 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,507 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:22,508 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:22,509 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:22,510 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:22,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,511 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:22,511 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:10:22,512 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:22,512 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:10:22,513 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:22,513 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:22,514 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:22,514 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:10:22,515 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:22,515 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:22,516 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:22,516 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:22,517 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,517 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:10:22,518 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:22,518 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:22,518 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:22,519 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:22,519 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:22,519 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,519 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:22,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,520 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:22,521 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:10:22,521 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:22,521 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,522 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,522 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:10:22,523 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:22,523 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,523 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:22,523 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,524 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:22,524 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:10:22,525 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:22,525 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:22,525 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:22,525 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:22,526 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:22,526 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:10:22,527 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:22,527 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:10:22,527 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:22,529 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:22,529 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:22,530 - sqlalchemy.engine.Engine - INFO - [cached since 3.831s ago] ('test@example.com', 1, 0)
2025-07-04 17:10:22,530 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:22,530 - services.app - INFO - Request completed: 401
2025-07-04 17:10:22,532 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:10:52,148 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:10:56,709 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:10:56,710 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:10:59,200 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:59,201 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:59,201 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,204 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:59,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:59,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:59,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:59,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:59,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:59,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:59,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:59,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,207 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:59,330 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:10:59,331 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:59,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:59,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:59,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:59,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:59,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:59,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,333 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:59,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,334 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:59,334 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:59,336 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:59,336 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,337 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:59,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,337 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:59,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,338 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:59,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:59,340 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:59,340 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:59,341 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:59,341 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,341 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:59,341 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:59,342 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:59,343 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:59,344 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,345 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:59,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:10:59,346 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:59,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:59,346 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:59,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,347 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:59,347 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:59,347 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:59,347 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,348 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:59,348 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:59,348 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:59,348 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,349 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:59,349 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,349 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:59,350 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:10:59,350 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:59,350 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,350 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:59,351 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:59,351 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:59,351 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:59,352 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:59,352 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:10:59,353 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:59,354 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:10:59,354 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:59,354 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:10:59,355 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:59,355 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:10:59,356 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:59,356 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:59,356 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:59,356 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,357 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:59,358 - sqlalchemy.engine.Engine - INFO - [no key 0.00053s] ()
2025-07-04 17:10:59,360 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:59,360 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:10:59,361 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:59,362 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:10:59,363 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:59,363 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:10:59,364 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:59,364 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:59,364 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:59,376 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:59,378 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:10:59,379 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (123, 1, 0)
2025-07-04 17:10:59,380 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:10:59,380 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:10:59,380 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:10:59,388 - app.error_handling - ERROR - Error recorded [external_api_1751670659380] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:10:59,389 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:10:59,390 - services.app - INFO - Request completed: 503
2025-07-04 17:10:59,391 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:10:59,392 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:10:59,392 - services.app - INFO - Request completed: 200
2025-07-04 17:10:59,393 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:10:59,394 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:10:59,394 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:59,394 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:59,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,394 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:59,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,394 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:59,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:59,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,396 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:10:59,396 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,397 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:10:59,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,397 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:10:59,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,398 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:10:59,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,398 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:10:59,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,399 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:10:59,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,399 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:10:59,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:10:59,400 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:10:59,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:10:59,400 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:10:59,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:59,401 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:59,401 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:59,401 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:10:59,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,401 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:10:59,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:10:59,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:10:59,404 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,404 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:10:59,404 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:10:59,404 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:10:59,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:59,405 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:10:59,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,405 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:10:59,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,406 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:10:59,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:10:59,406 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:10:59,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,407 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:10:59,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:10:59,407 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:10:59,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,408 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:10:59,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,408 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:10:59,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:10:59,409 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:10:59,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,409 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:59,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:10:59,410 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:10:59,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,410 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:10:59,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:10:59,411 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:10:59,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:10:59,412 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:10:59,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,412 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:59,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:10:59,413 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:10:59,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,413 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:10:59,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:59,414 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:10:59,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:10:59,415 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:10:59,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:10:59,415 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:10:59,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,416 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:10:59,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:10:59,417 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:10:59,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:10:59,418 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:10:59,418 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:10:59,418 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:10:59,418 - sqlalchemy.engine.Engine - INFO - [generated in 0.00008s] ()
2025-07-04 17:10:59,423 - services.app - INFO - Request completed: 200
2025-07-04 17:10:59,424 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:10:59,429 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:10:59,429 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:10:59,429 - services.app - INFO - Info message
2025-07-04 17:10:59,429 - services.app - WARNING - Warning message
2025-07-04 17:10:59,429 - services.app - ERROR - Error message
2025-07-04 17:11:00,347 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,348 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,367 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,367 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:00,367 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,368 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:00,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:00,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:00,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:00,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:00,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,370 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:00,370 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,370 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:00,370 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,370 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,390 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,390 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:00,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:00,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:00,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:00,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,393 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:00,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,394 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:00,394 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:00,396 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:00,396 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:11:00,398 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:00,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:00,399 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:00,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:00,399 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:00,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:00,400 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:00,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:00,402 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:00,402 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:11:00,403 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:00,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:11:00,405 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:00,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:11:00,406 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,406 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,406 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:00,406 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,407 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:00,407 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,407 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:00,407 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,407 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:00,407 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,407 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:00,407 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,408 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:00,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,408 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:00,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,408 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:00,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:00,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:00,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:00,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:00,411 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,411 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:00,411 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,411 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:00,414 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,415 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:00,415 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,415 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:00,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,417 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:00,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,418 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:00,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00906s] ()
2025-07-04 17:11:00,430 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:00,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:11:00,445 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:00,445 - sqlalchemy.engine.Engine - INFO - [no key 0.00113s] ()
2025-07-04 17:11:00,450 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:00,450 - sqlalchemy.engine.Engine - INFO - [no key 0.00082s] ()
2025-07-04 17:11:00,452 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:00,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00110s] ()
2025-07-04 17:11:00,456 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:00,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00052s] ()
2025-07-04 17:11:00,457 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:00,458 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:00,458 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:00,458 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,459 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:00,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:11:00,459 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:00,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:00,460 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:00,460 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:00,461 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:00,461 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,461 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:00,461 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:00,462 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:00,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:11:00,463 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:00,463 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,463 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:00,464 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:11:00,464 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:00,464 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:00,465 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:00,465 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,465 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:00,466 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:11:00,466 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:00,466 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,467 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:00,467 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:00,468 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:00,468 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:11:00,469 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:00,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:00,470 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,474 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,474 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:00,475 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ('test@example.com', 1, 0)
2025-07-04 17:11:00,475 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:00,476 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:11:00,477 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,478 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:00,478 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (1,)
2025-07-04 17:11:00,480 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:11:00,480 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:11:00.479114', '2025-07-04 23:11:00.479128')
2025-07-04 17:11:00,480 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,481 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,482 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:11:00,482 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (1,)
2025-07-04 17:11:00,484 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:00,490 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,490 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:00,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:00,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,492 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:00,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,492 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:00,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,492 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:00,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,492 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:00,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,493 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:00,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:00,495 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:00,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:11:00,496 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:00,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,497 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:00,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:00,498 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:00,498 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,499 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:00,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:00,499 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:00,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,500 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:00,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:00,501 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,501 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:00,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,501 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:00,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:00,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,503 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:00,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,503 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:00,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,503 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:00,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,504 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:00,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,504 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:00,505 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,505 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:00,505 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,505 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:00,505 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,505 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:00,505 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,505 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:00,505 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,506 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:00,506 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:00,506 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:00,506 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:00,507 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:00,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:00,508 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:00,508 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:11:00,510 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:00,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:11:00,512 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:00,512 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:11:00,514 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:00,514 - sqlalchemy.engine.Engine - INFO - [no key 0.00063s] ()
2025-07-04 17:11:00,516 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:00,516 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:00,517 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:00,517 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,517 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:00,518 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:11:00,518 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:00,518 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:00,519 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:00,519 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:11:00,520 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:00,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:11:00,522 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:00,522 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:00,523 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:00,524 - sqlalchemy.engine.Engine - INFO - [no key 0.00105s] ()
2025-07-04 17:11:00,528 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:00,528 - sqlalchemy.engine.Engine - INFO - [no key 0.00064s] ()
2025-07-04 17:11:00,530 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:00,531 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:11:00,532 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:00,532 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:00,532 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:00,532 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:00,533 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:00,534 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:11:00,535 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:00,535 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:00,538 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:00,538 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:11:00,539 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:00,540 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:11:00,541 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:00,541 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:00,541 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,542 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,544 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:11:00,545 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] ()
2025-07-04 17:11:00,545 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:00,546 - sqlalchemy.engine.Engine - INFO - [cached since 0.07128s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:00,546 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:00,546 - sqlalchemy.engine.Engine - INFO - [cached since 0.07068s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:11:00,547 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,547 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,547 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:00,547 - sqlalchemy.engine.Engine - INFO - [cached since 0.06938s ago] (1,)
2025-07-04 17:11:00,548 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:11:00,548 - sqlalchemy.engine.Engine - INFO - [cached since 0.06842s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:11:00.548083', '2025-07-04 23:11:00.548086')
2025-07-04 17:11:00,548 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:00,549 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:00,549 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:11:00,549 - sqlalchemy.engine.Engine - INFO - [cached since 0.06738s ago] (1,)
2025-07-04 17:11:00,550 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:00,556 - services.app - INFO - Request started: GET /health
2025-07-04 17:11:00,558 - services.app - INFO - Request completed: 200
2025-07-04 17:11:00,559 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:11:00,560 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:11:00,561 - services.app - INFO - Request completed: 200
2025-07-04 17:11:00,562 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:11:00,620 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:11:00,621 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:11:02,664 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:11:02,666 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:02,666 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:02,666 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,666 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:02,666 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,666 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:02,666 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:02,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,668 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:02,668 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,668 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:02,668 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,669 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:02,669 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:02,670 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:02,670 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,670 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:02,671 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,671 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:02,671 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,672 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:02,672 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,672 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:02,672 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,673 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:02,673 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,674 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:02,674 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,674 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:02,674 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:02,674 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:02,674 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:02,675 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:02,676 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:02,677 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:02,678 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:02,678 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,678 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:02,679 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,679 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:02,679 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:02,680 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:02,680 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,680 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:02,680 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:02,681 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:02,681 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:02,682 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:02,682 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:02,682 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:02,682 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:02,683 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:02,683 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,683 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:02,684 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:02,684 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:02,684 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:02,685 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:02,685 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:02,685 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:02,686 - sqlalchemy.engine.Engine - INFO - [no key 0.00057s] ()
2025-07-04 17:11:02,687 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:02,687 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:02,687 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:02,688 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:11:02,688 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:02,688 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:02,689 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:02,689 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,690 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:02,690 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:02,691 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:02,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:02,691 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:02,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,692 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:02,692 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:11:02,693 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:02,693 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,693 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:02,695 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:02,695 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:02,695 - sqlalchemy.engine.Engine - INFO - [cached since 2.221s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:02,696 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:11:02,967 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:02,967 - sqlalchemy.engine.Engine - INFO - [cached since 2.491s ago] ('test@example.com', '$2b$12$2QqbyAh0hquTqNUwneiLN.0Kp2xvGzUvCK/caIeuTIgFwyw8ZMb5a', None, None, None)
2025-07-04 17:11:02,968 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:02,968 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:02,968 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:02,968 - sqlalchemy.engine.Engine - INFO - [cached since 2.49s ago] (1,)
2025-07-04 17:11:02,971 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:11:02,971 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (1,)
2025-07-04 17:11:02,972 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:02,972 - services.app - INFO - Request completed: 201
2025-07-04 17:11:02,973 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:11:02,974 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:11:02,979 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:02,979 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:02,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,981 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:02,981 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,981 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:02,981 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,981 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:02,981 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,981 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:02,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,982 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:02,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,983 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:02,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,983 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:02,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,984 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:02,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:02,985 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:02,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:02,986 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:02,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:02,987 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:02,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,987 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:02,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,988 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:02,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:02,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:02,991 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:02,992 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:02,992 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:02,992 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,992 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:02,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:02,993 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:02,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:02,994 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:02,994 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,994 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:02,994 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:02,995 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:02,995 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:02,995 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:02,995 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,996 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:02,996 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:11:02,997 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:02,997 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,997 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:02,997 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:02,997 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:02,998 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,998 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:02,998 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:02,999 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:02,999 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:11:03,000 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:03,000 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,000 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,000 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:11:03,001 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:03,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,002 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:03,002 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,003 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,003 - sqlalchemy.engine.Engine - INFO - [no key 0.00048s] ()
2025-07-04 17:11:03,004 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:03,004 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:03,005 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:03,005 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,005 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:03,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:11:03,006 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:03,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,007 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,007 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,008 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:03,008 - sqlalchemy.engine.Engine - INFO - [cached since 2.534s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:03,008 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:03,009 - services.app - INFO - Request completed: 401
2025-07-04 17:11:03,009 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:11:03,086 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:11:03,087 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,087 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:03,087 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,087 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:03,087 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,087 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:03,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,089 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:03,089 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,090 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:03,090 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,090 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:03,090 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,091 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:03,091 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,092 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:03,092 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,093 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:03,093 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,093 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:03,093 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:03,094 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:03,094 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,095 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:03,095 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,095 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,095 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,095 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:03,095 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,096 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:03,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:03,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,098 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:03,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:03,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,098 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:03,098 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:03,099 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:03,099 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,099 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:03,099 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,100 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:03,100 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:11:03,101 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:03,101 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,101 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:03,101 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:03,102 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:03,102 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:03,103 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:03,103 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:03,103 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,104 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:11:03,104 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:03,104 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,105 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:03,105 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:03,105 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:03,105 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,106 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:03,106 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,107 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:03,107 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:11:03,108 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:03,108 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,108 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,108 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:11:03,109 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:03,109 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,109 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:03,109 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,110 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,110 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:03,111 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:03,111 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,111 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:03,111 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,112 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:03,112 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:03,113 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:03,113 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,113 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,114 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:03,114 - sqlalchemy.engine.Engine - INFO - [cached since 2.64s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:03,361 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:03,361 - sqlalchemy.engine.Engine - INFO - [cached since 2.886s ago] ('test@example.com', '$2b$12$nSLENKF2ktE5rJtN5t.TNOIUBK/8zamwR2arqRvBbv9GjLXK.w4fu', None, None, None)
2025-07-04 17:11:03,362 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,363 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,363 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:03,363 - sqlalchemy.engine.Engine - INFO - [cached since 2.885s ago] (1,)
2025-07-04 17:11:03,363 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:11:03,364 - sqlalchemy.engine.Engine - INFO - [cached since 0.3926s ago] (1,)
2025-07-04 17:11:03,364 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:03,364 - services.app - INFO - Request completed: 201
2025-07-04 17:11:03,365 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:11:03,366 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:11:03,368 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,368 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:03,368 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,368 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:03,368 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,368 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:03,368 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:03,370 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,370 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:03,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,371 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:03,371 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,371 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:03,371 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,372 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:03,372 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,373 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:03,373 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,373 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:03,373 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,374 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:03,374 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,375 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:03,375 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,375 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:03,376 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,376 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,376 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:03,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,376 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:03,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,377 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:03,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,379 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:03,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,379 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:03,379 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:03,379 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:03,379 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,380 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:03,380 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,380 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:03,381 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:03,381 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:03,381 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,382 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:03,382 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:03,382 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:03,382 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,383 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:03,383 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,383 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,383 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:03,384 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:03,384 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,385 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:03,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:03,385 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:03,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:03,386 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:03,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,386 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:03,387 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:11:03,387 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:03,387 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,388 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:11:03,389 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:03,389 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,389 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:03,389 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,390 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,390 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:03,391 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:03,391 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,391 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:03,391 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,392 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:03,392 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:11:03,393 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:03,393 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,393 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,394 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:03,394 - sqlalchemy.engine.Engine - INFO - [cached since 2.92s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:03,394 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:03,394 - services.app - INFO - Request completed: 401
2025-07-04 17:11:03,395 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:11:03,398 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:11:03,399 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,399 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:03,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,399 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:03,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,399 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:03,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:03,400 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,401 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:03,401 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,402 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:03,402 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:03,403 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:03,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:03,404 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:03,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,405 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:03,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,405 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:03,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,406 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:03,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:03,406 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:03,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,407 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:03,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:03,408 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,409 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:03,410 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,411 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:03,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:03,411 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:03,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,412 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:03,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,412 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:03,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:03,413 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:03,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,414 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:03,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:03,414 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:03,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,415 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:03,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,416 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:03,416 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:03,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,417 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:03,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:03,417 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:03,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,418 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:03,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,419 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:03,419 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:11:03,421 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:03,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,421 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:11:03,422 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:03,422 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,423 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:03,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:11:03,424 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:11:03,425 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:03,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,425 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:03,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,426 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:03,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:11:03,427 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:03,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,428 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,428 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:03,429 - sqlalchemy.engine.Engine - INFO - [cached since 2.954s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:03,677 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:03,677 - sqlalchemy.engine.Engine - INFO - [cached since 3.202s ago] ('test@example.com', '$2b$12$mwmVX2zAtFLFo0ZM4hnuYu48pn6TAmk2e.euPf.1MTP1G0IZUZgOy', None, None, None)
2025-07-04 17:11:03,678 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,678 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,679 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:03,679 - sqlalchemy.engine.Engine - INFO - [cached since 3.201s ago] (1,)
2025-07-04 17:11:03,679 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:11:03,679 - sqlalchemy.engine.Engine - INFO - [cached since 0.7084s ago] (1,)
2025-07-04 17:11:03,680 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:03,680 - services.app - INFO - Request completed: 201
2025-07-04 17:11:03,681 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:11:03,681 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:11:03,683 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,684 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:03,684 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,684 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:03,684 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,684 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:03,684 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,685 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:03,685 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,685 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:03,685 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,686 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:03,686 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,686 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:03,686 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,686 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:03,686 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,687 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:03,687 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,687 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:03,687 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:11:03,688 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:03,688 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,689 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:03,689 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,691 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:03,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,691 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:03,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,692 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:03,692 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,693 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:03,693 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,693 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:03,693 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:03,694 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:03,694 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:03,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:03,697 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:03,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:03,698 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:03,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,699 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:03,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,699 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:03,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:03,700 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:03,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,700 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:03,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:03,701 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:03,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,702 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:03,702 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:03,703 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,703 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:11:03,703 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:03,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,704 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:03,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:03,705 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:03,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,705 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:03,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,706 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:03,706 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:11:03,707 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:03,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:03,708 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:11:03,708 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:03,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,709 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:03,709 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,710 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:03,710 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:11:03,710 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:03,710 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,711 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:03,711 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:03,712 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:03,712 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:11:03,713 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:03,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:03,714 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:03,714 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:03,715 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:03,715 - sqlalchemy.engine.Engine - INFO - [cached since 3.24s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:03,715 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:03,715 - services.app - INFO - Request completed: 401
2025-07-04 17:11:03,716 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:11:24,170 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:11:28,196 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:11:28,196 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:11:30,707 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:30,708 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:30,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:30,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:30,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:30,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:30,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:30,823 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:11:30,824 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:30,824 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:30,824 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,824 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:30,824 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,824 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:30,824 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,824 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:30,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,826 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:30,826 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,827 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:30,827 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,829 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:30,829 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,829 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:30,829 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,830 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:30,830 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,830 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:30,831 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:11:30,832 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:30,832 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:11:30,835 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:30,835 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:30,836 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:30,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,836 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:30,836 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:30,836 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:30,836 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:30,837 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,838 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:30,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,839 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:30,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,839 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:30,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,839 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:30,839 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:30,840 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:30,840 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,840 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:30,840 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,841 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:30,841 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:30,842 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:30,842 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,842 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:30,842 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:30,843 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:30,843 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,843 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:30,843 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,844 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:30,844 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:11:30,845 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:30,845 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,845 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:30,845 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:30,846 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:30,846 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,846 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:30,846 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,848 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:30,848 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:11:30,849 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:30,849 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,849 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:30,850 - sqlalchemy.engine.Engine - INFO - [no key 0.00049s] ()
2025-07-04 17:11:30,851 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:30,851 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:30,851 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:30,852 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:30,852 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:30,853 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:11:30,853 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:30,853 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,854 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:30,854 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:30,854 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:30,855 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:30,855 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:30,855 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,856 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:30,867 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:30,869 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:30,869 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (123, 1, 0)
2025-07-04 17:11:30,871 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:30,871 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:11:30,871 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:30,880 - app.error_handling - ERROR - Error recorded [external_api_1751670690871] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:11:30,880 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:11:30,881 - services.app - INFO - Request completed: 503
2025-07-04 17:11:30,882 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:11:30,883 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:11:30,884 - services.app - INFO - Request completed: 200
2025-07-04 17:11:30,885 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:11:30,886 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:11:30,886 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:30,886 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:30,886 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,886 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:30,886 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,886 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:30,886 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:30,887 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,888 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:30,888 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,889 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:30,889 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,890 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:30,890 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,890 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:30,891 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,891 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:30,891 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,892 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:30,892 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,892 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:30,892 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,893 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:30,893 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:30,894 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:30,894 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,894 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:30,896 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:30,897 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:30,898 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:30,898 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,898 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:30,898 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,899 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:30,899 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:30,900 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:30,900 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:30,901 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:30,901 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:30,901 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:30,901 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,902 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:30,902 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,903 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:30,903 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:30,903 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:30,903 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,904 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:30,904 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:30,904 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:30,904 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:30,905 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:30,905 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:30,905 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:30,906 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:11:30,906 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:30,906 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,907 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:30,907 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:11:30,908 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:30,908 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,908 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:30,908 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,909 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:30,909 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:11:30,910 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:30,910 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:30,910 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:30,910 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:30,911 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:30,911 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:11:30,912 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:30,912 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:30,912 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:30,913 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:30,913 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:11:30,913 - sqlalchemy.engine.Engine - INFO - [generated in 0.00007s] ()
2025-07-04 17:11:30,989 - services.app - INFO - Request completed: 200
2025-07-04 17:11:30,990 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:11:30,995 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:11:30,995 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:11:30,995 - services.app - INFO - Info message
2025-07-04 17:11:30,995 - services.app - WARNING - Warning message
2025-07-04 17:11:30,995 - services.app - ERROR - Error message
2025-07-04 17:11:31,521 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,521 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,531 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,532 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:31,532 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,533 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:31,533 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,533 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:31,533 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,533 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,534 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,546 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:31,547 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,547 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:31,547 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,549 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:31,549 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,549 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:31,550 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:31,550 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:31,551 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:31,551 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:31,551 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,552 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:31,552 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,553 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:31,553 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:31,553 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:31,553 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,554 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,554 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,554 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:31,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,554 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:31,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,555 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:31,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,557 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:31,557 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,557 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:31,557 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:31,557 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:31,557 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,558 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:31,558 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,558 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:31,559 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:31,559 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:31,559 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,560 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:31,560 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:31,560 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:31,560 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:31,561 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:31,561 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:31,562 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:31,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:31,562 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:31,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,563 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:31,563 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:31,563 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:31,563 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:31,564 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:31,564 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:31,564 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:31,565 - sqlalchemy.engine.Engine - INFO - [no key 0.00055s] ()
2025-07-04 17:11:31,565 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:31,566 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:31,566 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:31,567 - sqlalchemy.engine.Engine - INFO - [no key 0.00068s] ()
2025-07-04 17:11:31,568 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:31,568 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:31,568 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:31,568 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:31,569 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:31,569 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:11:31,570 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:31,570 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:31,570 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:31,571 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:31,571 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:31,571 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:31,572 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:31,572 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,573 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,573 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,574 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:31,574 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ('test@example.com', 1, 0)
2025-07-04 17:11:31,575 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:31,575 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:11:31,575 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,576 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,576 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:31,576 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1,)
2025-07-04 17:11:31,577 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:11:31,578 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:11:31.577037', '2025-07-04 23:11:31.577041')
2025-07-04 17:11:31,578 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,579 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,579 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:11:31,579 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (1,)
2025-07-04 17:11:31,580 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:31,584 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,584 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:31,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,584 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:31,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,584 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:31,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:31,585 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,586 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:31,586 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,587 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:31,587 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:31,588 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:31,588 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:31,589 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:31,589 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:31,590 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:31,590 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:31,591 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:31,591 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,591 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:31,591 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,592 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:31,592 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:31,593 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:31,593 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:31,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,595 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,596 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:31,597 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,597 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:31,597 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,597 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:31,597 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:31,597 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:31,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:31,598 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:31,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,599 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:31,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:11:31,601 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:31,601 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:11:31,602 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:31,602 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:31,603 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:31,603 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:31,604 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:31,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:31,605 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:31,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:31,605 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:31,606 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:11:31,606 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:31,606 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,607 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:31,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:31,607 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:31,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:31,608 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:31,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:31,608 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:31,609 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:11:31,609 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:31,609 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:31,610 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:31,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:11:31,610 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:31,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,611 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:31,611 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,612 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:31,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:11:31,612 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:31,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,613 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:31,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:31,614 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:31,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:11:31,614 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:31,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:31,615 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,615 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,618 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:11:31,619 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ()
2025-07-04 17:11:31,620 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:31,620 - sqlalchemy.engine.Engine - INFO - [cached since 0.04649s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:31,620 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:31,621 - sqlalchemy.engine.Engine - INFO - [cached since 0.04607s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:11:31,621 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,622 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,622 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:31,622 - sqlalchemy.engine.Engine - INFO - [cached since 0.04574s ago] (1,)
2025-07-04 17:11:31,622 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:11:31,622 - sqlalchemy.engine.Engine - INFO - [cached since 0.04507s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:11:31.622552', '2025-07-04 23:11:31.622555')
2025-07-04 17:11:31,623 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:31,623 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:31,623 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:11:31,624 - sqlalchemy.engine.Engine - INFO - [cached since 0.04445s ago] (1,)
2025-07-04 17:11:31,624 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:31,628 - services.app - INFO - Request started: GET /health
2025-07-04 17:11:31,628 - services.app - INFO - Request completed: 200
2025-07-04 17:11:31,629 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:11:31,630 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:11:31,630 - services.app - INFO - Request completed: 200
2025-07-04 17:11:31,631 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:11:31,657 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:11:31,657 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:11:33,379 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,379 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,379 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,381 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,381 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:33,381 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,384 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:33,384 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:33,385 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:33,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,387 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:33,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:33,388 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:33,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,389 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:33,389 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,390 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:33,390 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,391 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:33,391 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,391 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,391 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,393 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:33,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,395 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,395 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:33,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:33,396 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,397 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:33,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:33,397 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:33,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,398 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:33,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,399 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:33,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:33,400 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:33,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:11:33,401 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:33,402 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:11:33,402 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:33,402 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,403 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:33,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,403 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:33,404 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:33,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,405 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:33,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:33,405 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:33,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,406 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:33,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,407 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:33,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:11:33,408 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:33,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,408 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:11:33,409 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:33,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,410 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:33,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,411 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:33,412 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:33,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,412 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:33,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,413 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,414 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:11:33,418 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,418 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,421 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,421 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,421 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,421 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:33,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,423 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:33,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:33,425 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:33,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:33,425 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:33,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,426 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:33,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,427 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:33,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,427 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:33,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,428 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:33,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,429 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:33,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,429 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:33,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,430 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,430 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,430 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:33,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,434 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:33,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:33,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,434 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:33,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,435 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:33,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:33,435 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:33,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,436 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:33,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,437 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:33,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:33,438 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:33,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,438 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:33,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:33,439 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:33,439 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,440 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:33,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,440 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:33,441 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:33,441 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,441 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:33,442 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:33,442 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:33,442 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,443 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:33,443 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,443 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:33,444 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:11:33,444 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:33,444 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,445 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,445 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:11:33,446 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:33,446 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,446 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:33,446 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,447 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:11:33,448 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:33,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,452 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:33,452 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:33,453 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:33,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:11:33,454 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:33,454 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,455 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,455 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,455 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:33,455 - sqlalchemy.engine.Engine - INFO - [cached since 1.882s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:33,456 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:11:33,722 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:33,722 - sqlalchemy.engine.Engine - INFO - [cached since 2.148s ago] ('test@example.com', '$2b$12$dvK4XO/7rUOfCSHGvGOFfepcy9EXfRVN6ICaHT2zl0qUE3INLxsT.', None, None, None)
2025-07-04 17:11:33,723 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,724 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,724 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:33,724 - sqlalchemy.engine.Engine - INFO - [cached since 2.148s ago] (1,)
2025-07-04 17:11:33,726 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:11:33,726 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1,)
2025-07-04 17:11:33,727 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:33,728 - services.app - INFO - Request completed: 201
2025-07-04 17:11:33,728 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:11:33,729 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:11:33,733 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,733 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,733 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,733 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,733 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,733 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,733 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:33,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,735 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:33,735 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,736 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:33,736 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,736 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:33,737 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,737 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:33,737 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,738 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:33,738 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,738 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:33,738 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,739 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:33,739 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,739 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:33,739 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,740 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:33,740 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:33,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:33,743 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:33,744 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:33,744 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,744 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:33,745 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,745 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:33,745 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:33,746 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:33,746 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,746 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:33,746 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:33,747 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:33,747 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,747 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:33,747 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,748 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,748 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:33,749 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:33,749 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,749 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:33,749 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:33,750 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:33,750 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:33,751 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:33,751 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,752 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:33,752 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:11:33,753 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:33,753 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,753 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,754 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:11:33,754 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:33,754 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,755 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:33,755 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,755 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,756 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:33,756 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:33,756 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,757 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:33,757 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:33,757 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:33,758 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:11:33,758 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:33,758 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,759 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,759 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,759 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:33,760 - sqlalchemy.engine.Engine - INFO - [cached since 2.186s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:33,760 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:33,760 - services.app - INFO - Request completed: 401
2025-07-04 17:11:33,761 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:11:33,830 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,831 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,832 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,832 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,832 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:33,832 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,833 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:33,833 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:33,834 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:33,834 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:33,835 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:33,835 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,836 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:33,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,836 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:33,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,837 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:33,837 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,838 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:33,838 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,838 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,838 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,839 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,840 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,841 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,841 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:33,841 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,841 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:33,841 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:33,841 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:33,842 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,842 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:33,842 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,842 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:33,843 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:33,843 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:33,843 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,844 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:33,844 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:33,844 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:33,844 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,845 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:33,845 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,845 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,845 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:33,846 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:33,846 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,846 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:33,846 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:33,847 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:33,847 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,847 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:33,847 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,848 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:33,848 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:11:33,849 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:33,849 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,849 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,850 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:11:33,850 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:33,850 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:33,851 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:33,851 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,852 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,852 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:11:33,852 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:33,853 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,853 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:33,853 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:33,854 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,855 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:11:33,855 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,855 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,856 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,857 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,857 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,857 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,857 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:33,857 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,857 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:33,857 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,858 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:33,858 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,858 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:33,859 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,859 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:33,859 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,860 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:33,860 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,860 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:33,860 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,861 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:33,861 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,862 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:33,862 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,863 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:33,863 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,863 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,863 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,863 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:33,863 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,863 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:33,863 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:33,864 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,865 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:33,866 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,866 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:33,866 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:33,866 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:33,866 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:33,867 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:33,867 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:33,868 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:33,868 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,868 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:33,868 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:33,869 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:33,869 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,869 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:33,869 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:33,870 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:33,870 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,870 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:33,870 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,871 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,871 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:33,872 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:33,872 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,872 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:33,872 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:33,873 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:33,873 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,873 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:33,873 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:33,874 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:33,874 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:11:33,875 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:33,875 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,875 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,875 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:11:33,876 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:33,876 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,876 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:33,876 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,877 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:33,877 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:33,878 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:33,878 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,878 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:33,878 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:33,879 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:33,879 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:33,880 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:33,880 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:33,880 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:33,881 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:33,881 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:33,881 - sqlalchemy.engine.Engine - INFO - [cached since 2.308s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:34,125 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:34,125 - sqlalchemy.engine.Engine - INFO - [cached since 2.551s ago] ('test@example.com', '$2b$12$Q8VJ545ZwtTcDmC/Ml5yMu8oH5.NprONrdN6RWl3STX91aJGN81Pa', None, None, None)
2025-07-04 17:11:34,126 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,127 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,127 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:34,127 - sqlalchemy.engine.Engine - INFO - [cached since 2.551s ago] (1,)
2025-07-04 17:11:34,127 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:11:34,128 - sqlalchemy.engine.Engine - INFO - [cached since 0.402s ago] (1,)
2025-07-04 17:11:34,128 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:34,128 - services.app - INFO - Request completed: 201
2025-07-04 17:11:34,129 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:11:34,130 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:11:34,132 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:34,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:34,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:34,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:34,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:34,133 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,134 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:34,134 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,134 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:34,134 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,135 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:34,135 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,136 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:34,136 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,136 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:34,136 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,137 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:34,137 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,138 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:34,138 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,138 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:34,138 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:34,139 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:34,139 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:34,140 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,141 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:34,142 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,143 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:34,143 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:34,143 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:34,143 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,144 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:34,144 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,144 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:34,144 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:34,145 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:34,145 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,145 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:34,146 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:34,146 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:34,146 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,146 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:34,146 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,147 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,147 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:34,148 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:34,148 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,148 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:34,148 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:34,149 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:34,149 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,149 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:34,149 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:34,151 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:34,151 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-07-04 17:11:34,152 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:34,152 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,152 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,153 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:11:34,153 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:34,153 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,154 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:34,154 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,154 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:11:34,155 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:34,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,156 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:34,156 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,156 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:34,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:11:34,157 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:34,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,157 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,158 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,158 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:34,158 - sqlalchemy.engine.Engine - INFO - [cached since 2.585s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:34,159 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:34,159 - services.app - INFO - Request completed: 401
2025-07-04 17:11:34,160 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:11:34,162 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:34,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,164 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:34,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,164 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:34,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,164 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:34,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,165 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:34,165 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,166 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:34,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:34,167 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:34,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:34,168 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:34,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:34,169 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:34,169 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:34,170 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:34,170 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:34,171 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:34,171 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:34,172 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:34,173 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:34,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:34,175 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:34,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,176 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:34,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,176 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:34,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:34,177 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:34,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:34,178 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:34,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:34,178 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:34,179 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:34,179 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:34,179 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,180 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,180 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:34,181 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:34,181 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:34,181 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:34,181 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:34,182 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:34,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:34,183 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:34,184 - sqlalchemy.engine.Engine - INFO - [no key 0.00051s] ()
2025-07-04 17:11:34,184 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:34,185 - sqlalchemy.engine.Engine - INFO - [no key 0.00051s] ()
2025-07-04 17:11:34,186 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:34,186 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,186 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,187 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:11:34,187 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:34,187 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,188 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:34,188 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:34,188 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,189 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:11:34,189 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:34,189 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:34,190 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:34,190 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,190 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,191 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:11:34,192 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:34,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:34,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:34,194 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,194 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:34,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:11:34,194 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:34,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,195 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:34,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:34,196 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:34,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,197 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:34,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,197 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:34,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,198 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:34,198 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,198 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:34,198 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,200 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:34,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:34,201 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,201 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,201 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:34,201 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,201 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:34,201 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,201 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:34,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:34,204 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,204 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:34,204 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,204 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:34,204 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,204 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:34,204 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,204 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:34,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:34,205 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:34,205 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,206 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:34,206 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,206 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:34,207 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:11:34,207 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:34,207 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,208 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:34,208 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:34,209 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:34,209 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:34,210 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:34,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:34,210 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:11:34,211 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:34,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:34,212 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:34,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:11:34,213 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:34,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,213 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:34,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,214 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:34,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:11:34,215 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:34,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,216 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:11:34,218 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:34,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:11:34,218 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:34,219 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:34,219 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,220 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:11:34,220 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:34,220 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,221 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:34,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:34,222 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:34,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-07-04 17:11:34,223 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:34,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:11:34,224 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,224 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,224 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:34,225 - sqlalchemy.engine.Engine - INFO - [cached since 2.651s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:34,470 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:11:34,471 - sqlalchemy.engine.Engine - INFO - [cached since 2.896s ago] ('test@example.com', '$2b$12$9X2S3rVy8YKHdTwUehhJK.S8XXMKHGUr7ZNork20CGTy5JboD1yAS', None, None, None)
2025-07-04 17:11:34,471 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,472 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,472 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:11:34,472 - sqlalchemy.engine.Engine - INFO - [cached since 2.896s ago] (1,)
2025-07-04 17:11:34,473 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:11:34,473 - sqlalchemy.engine.Engine - INFO - [cached since 0.7473s ago] (1,)
2025-07-04 17:11:34,473 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:34,473 - services.app - INFO - Request completed: 201
2025-07-04 17:11:34,474 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:11:34,475 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:11:34,478 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,479 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:11:34,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,480 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:11:34,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,481 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:11:34,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:11:34,481 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:11:34,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,482 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:11:34,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:11:34,483 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:11:34,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:34,484 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:11:34,484 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,485 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:11:34,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:11:34,486 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:11:34,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:11:34,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:11:34,489 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:11:34,489 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:34,489 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:11:34,489 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,490 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:11:34,490 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,490 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:11:34,491 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:11:34,491 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:11:34,491 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,491 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:11:34,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:34,492 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:11:34,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,493 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:11:34,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,493 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:11:34,494 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:11:34,494 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,494 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:34,494 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:11:34,495 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:11:34,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,495 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:11:34,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,496 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:11:34,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:11:34,497 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:11:34,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:11:34,497 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,498 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:11:34,498 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:11:34,498 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,499 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:11:34,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:11:34,500 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:11:34,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:11:34,502 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:11:34,502 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:11:34,503 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:11:34,503 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:11:34,504 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:11:34,504 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:11:34,505 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:11:34,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:11:34,505 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:11:34,506 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:11:34,506 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:11:34,506 - sqlalchemy.engine.Engine - INFO - [cached since 2.933s ago] ('test@example.com', 1, 0)
2025-07-04 17:11:34,507 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:11:34,507 - services.app - INFO - Request completed: 401
2025-07-04 17:11:34,508 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:11:55,506 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:11:59,742 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:11:59,743 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:12:02,743 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:02,746 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:02,746 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,751 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:02,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,751 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:02,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,751 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:02,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,751 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:02,752 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,752 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:02,752 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,752 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:02,752 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,752 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:02,752 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,752 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:02,752 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,753 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:02,928 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:12:02,930 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:02,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:02,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:02,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:02,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:02,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:02,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:02,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:02,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:02,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:02,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,932 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:02,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,933 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:02,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,935 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:02,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,936 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:02,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,936 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:02,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,937 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:02,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:02,938 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:02,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,940 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:02,940 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:02,941 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:02,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:02,942 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:02,942 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:02,942 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:02,942 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,943 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:02,943 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,943 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:02,943 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:02,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:02,945 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,946 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:02,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,946 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:02,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,946 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:02,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,946 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:02,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:02,947 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:02,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,948 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:02,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:02,948 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:02,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:02,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:02,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,950 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:02,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:02,950 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:02,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,951 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:02,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:02,951 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:02,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:02,952 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:02,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:02,953 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:02,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:02,953 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:02,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:02,954 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:02,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,955 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:02,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:12:02,956 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:02,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,957 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:02,957 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:02,957 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:02,958 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:02,958 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:02,958 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:02,959 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:02,960 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 17:12:02,960 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:02,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:02,961 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:02,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:02,962 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:02,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:12:02,963 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:02,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:02,964 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:02,977 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:02,979 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:02,979 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (123, 1, 0)
2025-07-04 17:12:02,981 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:02,981 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:12:02,982 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:02,993 - app.error_handling - ERROR - Error recorded [external_api_1751670722982] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:12:02,993 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:12:02,995 - services.app - INFO - Request completed: 503
2025-07-04 17:12:02,996 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:12:02,997 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:12:02,997 - services.app - INFO - Request completed: 200
2025-07-04 17:12:02,998 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:12:02,999 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:12:02,999 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:02,999 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:02,999 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,999 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:02,999 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:02,999 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:02,999 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:03,000 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,001 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:03,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:03,002 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:03,002 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,003 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:03,003 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:03,003 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:03,004 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:03,004 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:03,004 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,005 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:03,005 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,005 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:03,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,006 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:03,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,007 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:03,007 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:03,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:03,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,010 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:03,010 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,010 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:03,010 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,010 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:03,010 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,011 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:03,011 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,011 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:03,011 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,011 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:03,011 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,011 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:03,011 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,012 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:03,012 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:03,012 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:03,012 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,013 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:03,013 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:03,014 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:03,014 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:12:03,016 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:03,016 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:03,018 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:03,018 - sqlalchemy.engine.Engine - INFO - [no key 0.00052s] ()
2025-07-04 17:12:03,019 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:03,019 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:03,020 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:03,020 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,020 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:03,020 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:03,021 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:03,021 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,022 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:03,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:03,022 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:03,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,023 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:03,023 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:03,024 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:03,024 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:12:03,025 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:03,025 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:03,026 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:03,026 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:03,027 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:03,027 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:03,028 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:03,028 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,029 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:03,029 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:03,030 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:03,030 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:03,031 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:03,031 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:03,032 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:03,032 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:12:03,034 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:03,034 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:03,035 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:03,035 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,035 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:12:03,035 - sqlalchemy.engine.Engine - INFO - [generated in 0.00009s] ()
2025-07-04 17:12:03,045 - services.app - INFO - Request completed: 200
2025-07-04 17:12:03,047 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:12:03,065 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:12:03,066 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:12:03,066 - services.app - INFO - Info message
2025-07-04 17:12:03,066 - services.app - WARNING - Warning message
2025-07-04 17:12:03,066 - services.app - ERROR - Error message
2025-07-04 17:12:03,894 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,894 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:03,907 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:03,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,909 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:03,909 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,909 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:03,909 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,909 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:03,909 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,909 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:03,909 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,909 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:03,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,910 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:03,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,910 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:03,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,910 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:03,921 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,921 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:03,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:03,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,923 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:03,923 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,923 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:03,923 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,923 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:03,923 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,923 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:03,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,924 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:03,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:03,925 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:03,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:03,926 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:03,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:03,927 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:03,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,927 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:03,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:03,928 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:03,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,929 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:03,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,929 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:03,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:03,930 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:03,930 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:03,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,930 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:03,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:03,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,933 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:03,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,933 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:03,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,933 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:03,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,933 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:03,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:03,934 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:03,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,934 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:03,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,935 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:03,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:03,936 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:03,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:03,936 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:03,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:03,937 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:03,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:12:03,939 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:03,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:03,939 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:03,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:03,940 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:03,940 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,941 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:03,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:12:03,941 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:03,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:03,942 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:03,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:03,943 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:03,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 17:12:03,944 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:03,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,945 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:03,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:03,945 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:03,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,946 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:03,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:03,946 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:03,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:12:03,947 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:03,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:03,948 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:03,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,949 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:03,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:12:03,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:03,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:03,950 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:03,950 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,951 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:03,951 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ('test@example.com', 1, 0)
2025-07-04 17:12:03,952 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:03,952 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:12:03,954 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:03,954 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,955 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:03,955 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1,)
2025-07-04 17:12:03,958 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:12:03,958 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:12:03.956095', '2025-07-04 23:12:03.956100')
2025-07-04 17:12:03,959 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:03,960 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,962 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:12:03,963 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (1,)
2025-07-04 17:12:03,963 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:03,972 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,974 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:03,974 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,974 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:03,974 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,974 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:03,974 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:03,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,976 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:03,976 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,976 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:03,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,977 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:03,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:03,978 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:03,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,980 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:03,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-07-04 17:12:03,982 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:03,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00044s] ()
2025-07-04 17:12:03,984 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:03,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:03,985 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:03,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,985 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:03,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:03,986 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:03,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,987 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:03,987 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:03,987 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:03,987 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,987 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:03,987 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:03,988 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:03,989 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,990 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:03,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,990 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:03,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,990 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:03,990 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:03,990 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:03,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:12:03,991 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:03,991 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,992 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:03,992 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,992 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:03,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:03,993 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:03,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,994 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:03,994 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:03,994 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:03,995 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,995 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:03,995 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,996 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:03,996 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:03,996 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:03,996 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:03,997 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:03,997 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:03,997 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:03,997 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,998 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:03,998 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:03,998 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:03,999 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:12:03,999 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:03,999 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:04,000 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:04,000 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:04,001 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:04,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:04,001 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:04,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:04,002 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:04,002 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:12:04,003 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:04,003 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:04,004 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:04,004 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:04,005 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:04,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-07-04 17:12:04,006 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:04,007 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:04,007 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:04,007 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:04,010 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:12:04,010 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ()
2025-07-04 17:12:04,011 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:04,011 - sqlalchemy.engine.Engine - INFO - [cached since 0.06024s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:04,011 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:04,012 - sqlalchemy.engine.Engine - INFO - [cached since 0.05935s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:12:04,012 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:04,012 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:04,013 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:04,013 - sqlalchemy.engine.Engine - INFO - [cached since 0.05766s ago] (1,)
2025-07-04 17:12:04,013 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:12:04,013 - sqlalchemy.engine.Engine - INFO - [cached since 0.05577s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:12:04.013378', '2025-07-04 23:12:04.013382')
2025-07-04 17:12:04,014 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:04,014 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:04,014 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:12:04,015 - sqlalchemy.engine.Engine - INFO - [cached since 0.05287s ago] (1,)
2025-07-04 17:12:04,015 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:04,020 - services.app - INFO - Request started: GET /health
2025-07-04 17:12:04,020 - services.app - INFO - Request completed: 200
2025-07-04 17:12:04,021 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:12:04,022 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:12:04,023 - services.app - INFO - Request completed: 200
2025-07-04 17:12:04,024 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:12:04,091 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:12:04,092 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:12:06,498 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:06,499 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:06,500 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:06,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,503 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:06,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,503 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:06,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,503 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:06,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,504 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:06,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,504 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:06,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,504 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:06,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,505 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:06,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:06,512 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:06,513 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:06,515 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:06,515 - sqlalchemy.engine.Engine - INFO - [no key 0.00050s] ()
2025-07-04 17:12:06,520 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:06,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:12:06,521 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:06,521 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:12:06,523 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:06,523 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:06,524 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:06,524 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:06,524 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:06,524 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:06,525 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:06,525 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:06,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:06,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,525 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:06,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:06,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,526 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:06,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:06,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,526 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:06,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:06,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,527 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:06,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,528 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:06,528 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,528 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:06,528 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,528 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:06,528 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,528 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:06,529 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,529 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:06,529 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,529 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:06,529 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,529 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:06,530 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,530 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:06,530 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,533 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:06,534 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 17:12:06,535 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:06,535 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:06,535 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:06,535 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:06,536 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:06,536 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:06,537 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:06,537 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:06,551 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:06,552 - sqlalchemy.engine.Engine - INFO - [no key 0.00056s] ()
2025-07-04 17:12:06,554 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:06,555 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:12:06,555 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:06,556 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:12:06,557 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:06,558 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:12:06,559 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:06,559 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:06,560 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:06,561 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:06,562 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:06,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:06,562 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:06,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:06,563 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:06,564 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:12:06,564 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:06,564 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:06,565 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:06,565 - sqlalchemy.engine.Engine - INFO - [no key 0.00050s] ()
2025-07-04 17:12:06,567 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:06,567 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:06,567 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:06,567 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:06,568 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:06,568 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:12:06,569 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:06,569 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:06,570 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:06,570 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:06,570 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:06,575 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:12:06,577 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:06,578 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:06,578 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,579 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:06,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,580 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:06,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,581 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:06,581 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,582 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:06,582 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:06,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,586 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:06,586 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,586 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:06,587 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,587 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:06,587 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,588 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:06,588 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:06,589 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:06,589 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:06,590 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:06,591 - sqlalchemy.engine.Engine - INFO - [no key 0.00053s] ()
2025-07-04 17:12:06,595 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:06,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:06,596 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:06,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:06,597 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:06,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:06,598 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:06,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:06,601 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:06,601 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:12:06,605 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:06,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-07-04 17:12:06,606 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:06,606 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:06,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:06,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,609 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:06,609 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,609 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:06,609 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,610 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:06,610 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,611 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:06,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:06,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,611 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:06,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,613 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:06,613 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,613 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:06,613 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:06,614 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:06,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:06,615 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:06,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:06,615 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:06,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:06,616 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:06,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:06,617 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:06,617 - sqlalchemy.engine.Engine - INFO - [no key 0.00044s] ()
2025-07-04 17:12:06,622 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:06,625 - sqlalchemy.engine.Engine - INFO - [no key 0.00340s] ()
2025-07-04 17:12:06,627 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:06,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:06,628 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:06,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:06,629 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:06,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:06,630 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:06,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:12:06,633 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:06,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00071s] ()
2025-07-04 17:12:06,639 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:06,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:06,640 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:06,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:12:06,642 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:06,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00125s] ()
2025-07-04 17:12:06,645 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:06,645 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:12:06,646 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:06,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:06,647 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:06,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:06,647 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:06,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:06,648 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:06,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:12:06,649 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:06,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:06,650 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:06,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:06,651 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:06,651 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:12:06,652 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:06,652 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:06,652 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:06,658 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:06,659 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:06,660 - sqlalchemy.engine.Engine - INFO - [cached since 2.709s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:06,662 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:12:06,980 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:06,981 - sqlalchemy.engine.Engine - INFO - [cached since 3.028s ago] ('test@example.com', '$2b$12$nBqugL/f2myV8JWe8c9Ucu9H7hib7dfEvurfrRYk/v59RTTVnuF4S', None, None, None)
2025-07-04 17:12:06,981 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:06,982 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:06,982 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:06,982 - sqlalchemy.engine.Engine - INFO - [cached since 3.027s ago] (1,)
2025-07-04 17:12:06,990 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:12:06,990 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] (1,)
2025-07-04 17:12:06,991 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:06,991 - services.app - INFO - Request completed: 201
2025-07-04 17:12:06,993 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:12:06,994 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:12:07,002 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,003 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,003 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,003 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,003 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,003 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,003 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,003 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,003 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,004 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,004 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,004 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,004 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,004 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,005 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,005 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:07,005 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,006 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:07,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:07,007 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:07,007 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,007 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:07,007 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,008 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:07,008 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,009 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:07,009 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,010 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:07,010 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,010 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:07,011 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,011 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:07,011 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:07,012 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,013 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,014 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:07,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,015 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:07,015 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:07,016 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:07,016 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:07,016 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:07,017 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,017 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:07,017 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:07,018 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:07,018 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:07,019 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:07,019 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:07,020 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:07,020 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,020 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:07,020 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,021 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,021 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:07,022 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:07,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,022 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:07,023 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:07,023 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,023 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:07,024 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,024 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:07,025 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:12:07,025 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:07,025 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,026 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,026 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:07,027 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:07,027 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,027 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:07,027 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,028 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,028 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:12:07,029 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:07,029 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,029 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:07,029 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,030 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,030 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:07,031 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:07,031 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,031 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,032 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,032 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:07,032 - sqlalchemy.engine.Engine - INFO - [cached since 3.081s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:07,032 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:07,033 - services.app - INFO - Request completed: 401
2025-07-04 17:12:07,034 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:12:07,177 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,177 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,177 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,178 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,178 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,178 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,179 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,179 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,180 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,180 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,180 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:07,180 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,181 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:07,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:07,182 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:07,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,183 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:07,183 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,184 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:07,184 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,184 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:07,184 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,185 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:07,185 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,185 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:07,185 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,186 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,186 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,186 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,186 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:07,186 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,187 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,188 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,189 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,189 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:07,189 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,189 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:07,189 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:12:07,190 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:07,190 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:12:07,191 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:07,191 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,191 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:07,192 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:07,192 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:07,192 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,193 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:07,193 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:07,194 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:07,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,194 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:07,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,195 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:07,196 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:07,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:07,196 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:07,197 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:07,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,197 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:07,198 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,198 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:07,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:12:07,199 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:07,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,200 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:07,200 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:07,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,201 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:07,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,202 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:12:07,202 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:07,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,203 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:07,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,204 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:12:07,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,212 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:07,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,213 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:07,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,214 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:07,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,215 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:07,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,216 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:07,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,217 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:07,217 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,217 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:07,217 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,218 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:07,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,218 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:07,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,219 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,219 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,219 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:07,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:07,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:07,222 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,223 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,223 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,223 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:07,223 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,223 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:07,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:07,224 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:07,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,224 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:07,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,225 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:07,225 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:07,226 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:07,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,226 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:07,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:07,227 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:07,227 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,227 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:07,227 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,228 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,228 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:07,229 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:07,229 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,229 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,229 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:07,230 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:07,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,231 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:07,231 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,231 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:07,232 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-07-04 17:12:07,233 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:07,233 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,234 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,235 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:12:07,235 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:07,235 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,236 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:07,236 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,237 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,237 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:07,238 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:07,238 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,238 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:07,238 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,239 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,239 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:07,240 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:07,240 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,240 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,241 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,241 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:07,241 - sqlalchemy.engine.Engine - INFO - [cached since 3.29s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:07,546 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:07,546 - sqlalchemy.engine.Engine - INFO - [cached since 3.594s ago] ('test@example.com', '$2b$12$91Y9yM69R3nBlx1XKkd8b.QSu4DTnM5w4UCJDKYwoqkKTLagBuOdy', None, None, None)
2025-07-04 17:12:07,547 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,547 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,547 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:07,547 - sqlalchemy.engine.Engine - INFO - [cached since 3.592s ago] (1,)
2025-07-04 17:12:07,548 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:12:07,548 - sqlalchemy.engine.Engine - INFO - [cached since 0.5585s ago] (1,)
2025-07-04 17:12:07,549 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:07,549 - services.app - INFO - Request completed: 201
2025-07-04 17:12:07,550 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:12:07,551 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:12:07,554 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,554 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,554 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,554 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,556 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,556 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,556 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:07,557 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,558 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:07,558 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:07,559 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:07,559 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,560 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:07,560 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,560 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:07,561 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,561 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:07,561 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,562 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:07,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,562 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:07,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,563 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:07,563 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,565 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,565 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,565 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,565 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,565 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:07,565 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,565 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,567 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,567 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:07,567 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,567 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,567 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,567 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:07,567 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,568 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,569 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:07,570 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:07,570 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:07,570 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,571 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:07,571 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,572 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:07,572 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:12:07,573 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:07,573 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,573 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:07,573 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:07,574 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:07,574 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,575 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:07,575 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,575 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,576 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:07,576 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:07,576 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,577 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,577 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:12:07,577 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:07,577 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,578 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:07,578 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,579 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:07,579 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:12:07,580 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:07,580 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,580 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,581 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:07,581 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:07,581 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,582 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:07,582 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,583 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,583 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:12:07,584 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:07,584 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,584 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:07,584 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,585 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,585 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:12:07,586 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:07,586 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,587 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,588 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,588 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:07,588 - sqlalchemy.engine.Engine - INFO - [cached since 3.637s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:07,589 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:07,589 - services.app - INFO - Request completed: 401
2025-07-04 17:12:07,590 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:12:07,593 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,593 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,593 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,593 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,593 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,594 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,595 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,595 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:07,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,596 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:07,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,596 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:07,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,597 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:07,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,597 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:07,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,598 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:07,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,598 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:07,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,599 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:07,599 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,600 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:07,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:07,602 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:07,603 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:07,603 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,603 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:07,603 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,604 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:07,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:07,604 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:07,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,605 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:07,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:07,605 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:07,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,606 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:07,606 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,606 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:07,607 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:07,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,607 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:07,608 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:07,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,609 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:07,609 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,609 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:07,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:12:07,610 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:07,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,611 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,611 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:07,611 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:07,611 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,612 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:07,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,613 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:12:07,613 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:07,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,614 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:07,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,614 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,615 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:12:07,616 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,616 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,616 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,616 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,616 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,616 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,616 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,616 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,616 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,617 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:07,618 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:07,618 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:07,618 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,619 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:07,619 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,620 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:07,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,620 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:07,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,621 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:07,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,621 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:07,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,622 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:07,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,623 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:07,623 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,623 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,623 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,623 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,623 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,624 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:07,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,626 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:07,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,626 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:07,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,627 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:07,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,627 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:07,627 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:12:07,628 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:07,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,628 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:07,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,629 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:07,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:07,629 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:07,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,630 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:07,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:07,631 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:07,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,631 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:07,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,632 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:07,632 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:07,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,633 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:07,633 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:07,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,634 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:07,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,635 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:07,635 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:12:07,636 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:07,636 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,636 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:12:07,637 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:07,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:12:07,638 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:07,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:07,639 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:07,640 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:07,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,640 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:07,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,641 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:12:07,642 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:07,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,642 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,643 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,643 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:07,644 - sqlalchemy.engine.Engine - INFO - [cached since 3.693s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:07,895 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:07,895 - sqlalchemy.engine.Engine - INFO - [cached since 3.943s ago] ('test@example.com', '$2b$12$fjkV4yihxEDaCCxTMT2/SetIXBJQc1EOro6K3U82Ho6dxSoapJBGm', None, None, None)
2025-07-04 17:12:07,896 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,896 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,896 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:07,896 - sqlalchemy.engine.Engine - INFO - [cached since 3.941s ago] (1,)
2025-07-04 17:12:07,897 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:12:07,897 - sqlalchemy.engine.Engine - INFO - [cached since 0.9076s ago] (1,)
2025-07-04 17:12:07,898 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:07,898 - services.app - INFO - Request completed: 201
2025-07-04 17:12:07,899 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:12:07,899 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:12:07,901 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,903 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,903 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,903 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,903 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,903 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,903 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,903 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,903 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:07,903 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,904 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:07,904 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,905 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:07,905 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,906 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:07,906 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,906 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:07,906 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,907 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:07,907 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,907 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:07,907 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,908 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:07,908 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,908 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:07,909 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:07,909 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,909 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,909 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:07,909 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:07,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:07,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:07,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:07,913 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:07,913 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:07,913 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:07,913 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,914 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:07,914 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,915 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:07,915 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:07,916 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:07,916 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,916 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:07,916 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:07,917 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:07,917 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,918 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:07,918 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,918 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,918 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:12:07,919 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:07,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:07,920 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,920 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:07,921 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:07,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:07,922 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:07,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,923 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:07,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-07-04 17:12:07,924 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:07,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,924 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:07,925 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:07,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,926 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:07,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:07,927 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:07,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:07,928 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:07,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:07,929 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:07,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,929 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:07,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:12:07,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:07,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:07,931 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:07,931 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:07,931 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:07,932 - sqlalchemy.engine.Engine - INFO - [cached since 3.981s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:07,932 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:07,932 - services.app - INFO - Request completed: 401
2025-07-04 17:12:07,933 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:12:35,386 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:12:40,357 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:12:40,358 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:12:42,857 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:42,858 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:42,858 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:42,861 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:42,861 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:42,861 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:42,861 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:42,861 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:42,861 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:42,862 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:42,863 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:43,010 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:12:43,012 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:43,012 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:43,012 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,013 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:43,013 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,013 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:43,013 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,014 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:43,014 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,014 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:43,014 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,018 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:43,018 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,018 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:43,018 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,018 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:43,019 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,019 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:43,019 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,019 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:43,019 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:43,020 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:43,020 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,023 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:43,023 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,024 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:43,024 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,042 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:43,042 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:43,044 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:43,044 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,046 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:43,046 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,047 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:43,047 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,048 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:43,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:43,048 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:43,049 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:43,050 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:43,051 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,052 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:43,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:43,053 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:43,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,053 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:43,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,054 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:43,054 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:43,054 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:43,055 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,055 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:43,055 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:43,056 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:43,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,056 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:43,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:43,057 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:43,057 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:43,057 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:43,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,058 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:43,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:43,059 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:43,059 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,059 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:43,059 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,061 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:43,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:12:43,062 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:43,062 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:43,063 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:43,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:12:43,064 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:43,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,064 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:43,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,065 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:43,065 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:43,066 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:43,066 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:43,070 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:43,070 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,117 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:43,118 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:12:43,118 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:43,118 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:43,119 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:43,132 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:43,134 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:43,134 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (123, 1, 0)
2025-07-04 17:12:43,135 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:43,135 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:12:43,136 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:43,146 - app.error_handling - ERROR - Error recorded [external_api_1751670763136] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:12:43,147 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:12:43,148 - services.app - INFO - Request completed: 503
2025-07-04 17:12:43,149 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:12:43,150 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:12:43,151 - services.app - INFO - Request completed: 200
2025-07-04 17:12:43,152 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:12:43,153 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:12:43,153 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:43,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:43,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:43,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:43,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:43,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:43,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,155 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:43,155 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,155 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:43,155 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,155 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:43,155 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,155 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:43,155 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,155 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:43,156 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:43,157 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:43,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,159 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:43,159 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:43,159 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:43,160 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:43,160 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:43,160 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,161 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:43,161 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,161 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:43,161 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:43,162 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:43,162 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,163 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:43,163 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,163 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:43,163 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:43,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:43,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:43,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:43,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,166 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:43,166 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,166 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:43,166 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,166 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:43,166 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,166 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:43,166 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:43,167 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:43,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:43,167 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:43,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,168 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:43,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,168 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:43,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:43,169 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:43,169 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,171 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:43,171 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:43,171 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:43,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,172 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:43,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,173 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:43,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:43,174 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:43,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,174 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:43,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:43,175 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:43,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,176 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:43,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:43,177 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:43,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:12:43,177 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:43,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:43,178 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:43,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:12:43,179 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:43,179 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,179 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:43,179 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,180 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:43,180 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:43,181 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:43,181 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:43,181 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:43,181 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:43,182 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:43,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:43,183 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:43,183 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:43,184 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:43,184 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:43,184 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:12:43,184 - sqlalchemy.engine.Engine - INFO - [generated in 0.00009s] ()
2025-07-04 17:12:43,253 - services.app - INFO - Request completed: 200
2025-07-04 17:12:43,254 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:12:43,268 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:12:43,268 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:12:43,268 - services.app - INFO - Info message
2025-07-04 17:12:43,268 - services.app - WARNING - Warning message
2025-07-04 17:12:43,268 - services.app - ERROR - Error message
2025-07-04 17:12:44,133 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,133 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,144 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,144 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:44,144 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:44,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:44,145 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,145 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,146 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,159 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,159 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:44,159 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,160 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:44,160 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,160 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:44,160 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,160 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:44,160 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,160 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:44,160 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,161 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:44,161 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,161 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:44,161 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,161 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:44,161 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,161 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:44,161 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,162 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:44,162 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,163 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:44,163 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:44,164 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:44,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,164 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:44,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,165 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:44,165 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,166 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:44,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,166 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:44,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,167 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:44,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,167 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:44,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:44,168 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,168 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,168 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,169 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,170 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,171 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:44,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:44,172 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:44,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,173 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:44,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,173 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:44,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:44,174 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:44,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,174 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:44,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:44,175 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:44,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,175 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:44,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:44,176 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:44,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:44,177 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:44,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,177 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:44,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:44,178 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:44,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,178 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:44,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,179 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:44,179 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:12:44,180 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:44,180 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,180 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:44,181 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:44,181 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:44,181 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,181 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:44,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,182 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:44,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:12:44,183 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:44,183 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,184 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:44,184 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,184 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:44,185 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:12:44,185 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:44,185 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,186 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,186 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,187 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:44,187 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ('test@example.com', 1, 0)
2025-07-04 17:12:44,187 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:44,188 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:12:44,188 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,189 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,189 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:44,189 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1,)
2025-07-04 17:12:44,190 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:12:44,191 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:12:44.189858', '2025-07-04 23:12:44.189861')
2025-07-04 17:12:44,191 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,191 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,192 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:12:44,192 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1,)
2025-07-04 17:12:44,193 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:44,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:44,200 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:44,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,201 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:44,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:44,201 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:44,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:44,202 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:44,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:44,202 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:44,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:44,203 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:44,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:44,204 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:44,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,204 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:44,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:44,205 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:44,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,205 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:44,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:44,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:44,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:44,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,208 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:44,208 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,208 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:44,208 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:44,208 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:44,208 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:44,209 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:44,209 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:44,209 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:44,209 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,210 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:44,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:44,211 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:44,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,211 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:44,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:44,212 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:44,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,212 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:44,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,213 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:44,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:44,214 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:44,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,214 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:44,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:44,215 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:44,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:44,215 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:44,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,216 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:44,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:12:44,217 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:44,217 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,217 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:44,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:12:44,218 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:44,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,219 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:44,219 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,219 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:44,220 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:12:44,220 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:44,220 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:44,221 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:44,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:44,222 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:44,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:44,223 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:44,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:44,223 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,224 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,226 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:12:44,227 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] ()
2025-07-04 17:12:44,227 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:44,227 - sqlalchemy.engine.Engine - INFO - [cached since 0.04064s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:44,228 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:44,228 - sqlalchemy.engine.Engine - INFO - [cached since 0.04031s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:12:44,228 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,229 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,229 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:44,229 - sqlalchemy.engine.Engine - INFO - [cached since 0.03989s ago] (1,)
2025-07-04 17:12:44,229 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:12:44,229 - sqlalchemy.engine.Engine - INFO - [cached since 0.03923s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:12:44.229530', '2025-07-04 23:12:44.229533')
2025-07-04 17:12:44,230 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:44,230 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:44,230 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:12:44,231 - sqlalchemy.engine.Engine - INFO - [cached since 0.0386s ago] (1,)
2025-07-04 17:12:44,231 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:44,235 - services.app - INFO - Request started: GET /health
2025-07-04 17:12:44,236 - services.app - INFO - Request completed: 200
2025-07-04 17:12:44,236 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:12:44,238 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:12:44,238 - services.app - INFO - Request completed: 200
2025-07-04 17:12:44,239 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:12:44,264 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:12:44,264 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:12:46,381 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,384 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,385 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,386 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,386 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,386 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,388 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:46,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,390 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:46,390 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,391 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:46,391 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,393 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:46,393 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:46,394 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:46,394 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,394 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:46,394 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,395 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:46,395 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,396 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:46,396 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:46,397 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,398 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:46,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,400 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:46,401 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:12:46,403 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:46,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:12:46,404 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:46,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,405 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:46,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:12:46,406 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:46,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,407 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:46,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:46,407 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:46,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:46,408 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:46,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,409 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:12:46,409 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:46,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,410 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:46,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:46,411 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:46,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,411 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:46,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:46,413 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:46,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:12:46,415 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:46,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:46,415 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:12:46,416 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:46,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,417 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:46,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,418 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:46,419 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:46,419 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:46,419 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:46,419 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,420 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,426 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:12:46,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,428 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,428 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,428 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,429 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,429 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,429 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,429 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,429 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,430 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,430 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:46,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,430 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:46,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,431 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:46,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,432 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:46,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,433 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:46,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,433 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:46,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,434 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:46,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,435 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:46,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,435 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:46,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,436 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:46,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:46,437 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:46,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,440 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:46,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:46,440 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:46,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,441 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:46,441 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,442 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:46,442 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:46,443 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:46,443 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:12:46,443 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:46,444 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:46,444 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:46,444 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,445 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:46,445 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,446 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,446 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:46,447 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:46,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,447 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:46,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:46,448 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:46,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,448 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:46,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,449 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:46,449 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:12:46,450 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:46,450 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,450 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:12:46,451 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:46,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,452 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:46,452 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,452 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:12:46,453 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:46,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:46,454 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:46,454 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,455 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:46,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:46,456 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:46,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,456 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,459 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:46,459 - sqlalchemy.engine.Engine - INFO - [cached since 2.272s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:46,459 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:12:46,750 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:46,750 - sqlalchemy.engine.Engine - INFO - [cached since 2.562s ago] ('test@example.com', '$2b$12$hQaQfib7dwwrKiZzu/kGa.2mcdISrhSsGJW2UOoe.b6hE7wlNTl9C', None, None, None)
2025-07-04 17:12:46,750 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,751 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,752 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:46,752 - sqlalchemy.engine.Engine - INFO - [cached since 2.563s ago] (1,)
2025-07-04 17:12:46,757 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:12:46,757 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] (1,)
2025-07-04 17:12:46,758 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:46,758 - services.app - INFO - Request completed: 201
2025-07-04 17:12:46,760 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:12:46,761 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:12:46,765 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,767 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,767 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,767 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,767 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,767 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,767 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:46,767 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,768 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:46,768 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:12:46,775 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:46,775 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-07-04 17:12:46,779 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:46,780 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:12:46,783 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:46,783 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:12:46,784 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:46,784 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:46,785 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:46,785 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,786 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:46,786 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,787 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:46,787 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,788 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:46,788 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,789 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,789 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,789 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,789 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,789 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:46,789 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,789 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,789 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,790 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,791 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:46,792 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,792 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:46,792 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,792 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:46,793 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:46,794 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:46,794 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:46,795 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:46,795 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,796 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:46,796 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:46,796 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:46,797 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,797 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:46,797 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:46,798 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:46,798 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,798 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:46,798 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,799 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,799 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:46,800 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:46,800 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,800 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:46,801 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:46,801 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:46,801 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,802 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:46,802 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,803 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:46,803 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:12:46,804 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:46,804 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,804 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,805 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:12:46,806 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:46,806 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,807 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:46,807 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,807 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,808 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:12:46,808 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:46,808 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:46,809 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:46,809 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,810 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:46,810 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:46,811 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:46,811 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,811 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,812 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,812 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:46,812 - sqlalchemy.engine.Engine - INFO - [cached since 2.625s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:46,812 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:46,813 - services.app - INFO - Request completed: 401
2025-07-04 17:12:46,813 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:12:46,929 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,929 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,929 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,929 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,929 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:46,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,931 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:46,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,932 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:46,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,933 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:46,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,933 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:46,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,934 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:46,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,935 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:46,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,937 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:46,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,937 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,937 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,937 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,938 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,940 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:46,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,940 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:46,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,940 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:46,940 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:46,941 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:46,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,942 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:46,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,942 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:46,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:12:46,943 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:46,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,944 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:46,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:46,944 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:46,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,945 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:46,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,946 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:46,946 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:46,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,947 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:46,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:46,948 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:46,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:46,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:46,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:46,949 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:46,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:12:46,951 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:46,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,951 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:46,952 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:46,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,953 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:46,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,953 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:12:46,954 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:46,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,955 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:46,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,956 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,956 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:12:46,957 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,959 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,959 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,959 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,959 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,959 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,959 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:46,959 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,959 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:46,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,960 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:46,960 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,961 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:46,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,962 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:46,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:46,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:46,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,964 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:46,964 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,965 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:46,965 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,965 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:46,965 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:46,966 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,966 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:46,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:46,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:46,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:46,969 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:46,970 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:46,970 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,971 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:46,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,971 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:46,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:46,972 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:46,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,972 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:46,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:46,973 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:46,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,974 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:46,974 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,974 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:12:46,975 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:46,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:46,976 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:46,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:46,976 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:46,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,977 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:46,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,977 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:46,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:12:46,979 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:46,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,981 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:46,982 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:46,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,983 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:46,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,984 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:46,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:12:46,985 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:46,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:46,985 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:46,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,986 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:46,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:46,987 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:46,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:46,988 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:46,988 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:46,988 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:46,988 - sqlalchemy.engine.Engine - INFO - [cached since 2.802s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:47,241 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:47,242 - sqlalchemy.engine.Engine - INFO - [cached since 3.054s ago] ('test@example.com', '$2b$12$xwQ.XPAjMyXCKtedvR1aBOAKEKnpMn0SuDe38xWvENJxt6onrgybO', None, None, None)
2025-07-04 17:12:47,243 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,243 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,243 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:47,244 - sqlalchemy.engine.Engine - INFO - [cached since 3.055s ago] (1,)
2025-07-04 17:12:47,244 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:12:47,244 - sqlalchemy.engine.Engine - INFO - [cached since 0.4873s ago] (1,)
2025-07-04 17:12:47,245 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:47,245 - services.app - INFO - Request completed: 201
2025-07-04 17:12:47,246 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:12:47,247 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:12:47,249 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:47,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:47,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,251 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:47,251 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,251 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:47,251 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,251 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:47,251 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,252 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:47,252 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,254 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:47,254 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:47,255 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:47,255 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,255 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:47,256 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,256 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:47,256 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,257 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:47,257 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,258 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:47,258 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,258 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:47,258 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,259 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,259 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,259 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:47,259 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,259 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:47,259 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,259 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,260 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,261 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:47,262 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,262 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:47,262 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,262 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:47,262 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,262 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:47,262 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:47,263 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:47,263 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,263 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:47,264 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:47,264 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:47,264 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:12:47,265 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:47,265 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:47,265 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:47,266 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:47,266 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:47,266 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,267 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:47,267 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,267 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,267 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:47,268 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:47,268 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,268 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:47,269 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:47,269 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:47,269 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,269 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:47,270 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,270 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:47,270 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:12:47,271 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:47,271 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,272 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,272 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:12:47,272 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:47,272 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,273 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:47,273 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:47,274 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,274 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:47,275 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:47,275 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,275 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:47,275 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,276 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:47,276 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:47,277 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:47,277 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,278 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,278 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,278 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:47,278 - sqlalchemy.engine.Engine - INFO - [cached since 3.092s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:47,279 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:47,279 - services.app - INFO - Request completed: 401
2025-07-04 17:12:47,280 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:12:47,283 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,283 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:47,283 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,283 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:47,283 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:47,284 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,285 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:47,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,285 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:47,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,286 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:47,286 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,287 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:47,287 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,287 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:47,287 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,288 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:47,288 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,289 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:47,289 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:47,289 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:47,289 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,290 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,290 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,290 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:47,290 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,290 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:47,290 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,291 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:47,292 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,293 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:47,293 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,293 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:47,293 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:47,294 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:47,294 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:47,294 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:47,294 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,295 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:47,295 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:47,296 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:47,296 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:47,297 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:47,297 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:47,297 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:47,297 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,298 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:47,298 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,298 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,298 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:12:47,299 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:47,299 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,299 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:47,299 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:12:47,300 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:47,300 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,300 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:47,300 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,301 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:47,301 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:12:47,302 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:47,302 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,302 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,303 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:47,303 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:47,303 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,304 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:47,304 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,305 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,305 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:12:47,306 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:47,306 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,306 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:47,306 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,307 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,308 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,309 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,310 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:47,311 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:12:47,311 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:47,311 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,313 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:47,313 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,313 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:47,313 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,314 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:47,315 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,315 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:47,315 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,316 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:47,316 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,317 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:47,317 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:47,317 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:47,317 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,318 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,318 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:47,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,318 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:47,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:47,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,321 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:47,321 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,321 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:47,321 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,321 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:47,321 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,321 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:47,321 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:47,322 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:47,322 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,322 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:47,322 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:47,323 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:47,323 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:47,324 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:47,324 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,324 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:47,325 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:47,325 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:47,325 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,326 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:47,326 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,326 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,326 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:12:47,327 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:47,327 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,328 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:47,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:47,328 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:47,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,329 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:47,329 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:47,330 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:47,330 - sqlalchemy.engine.Engine - INFO - [no key 0.00051s] ()
2025-07-04 17:12:47,331 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:47,331 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,332 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,332 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:12:47,333 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:47,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,333 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:47,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,334 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,334 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:12:47,335 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:47,335 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:47,336 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:47,336 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,336 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:47,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:12:47,337 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:47,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,338 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,339 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,339 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:47,339 - sqlalchemy.engine.Engine - INFO - [cached since 3.152s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:47,687 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:12:47,687 - sqlalchemy.engine.Engine - INFO - [cached since 3.5s ago] ('test@example.com', '$2b$12$8wWhs4ewmBLqiwgstygcJOmA/Hce6RnYuBeHTMC2vZi4Q.PAWYixW', None, None, None)
2025-07-04 17:12:47,688 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,688 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,688 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:12:47,689 - sqlalchemy.engine.Engine - INFO - [cached since 3.5s ago] (1,)
2025-07-04 17:12:47,689 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:12:47,689 - sqlalchemy.engine.Engine - INFO - [cached since 0.9323s ago] (1,)
2025-07-04 17:12:47,690 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:47,690 - services.app - INFO - Request completed: 201
2025-07-04 17:12:47,691 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:12:47,691 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:12:47,693 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:47,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:47,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:47,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:47,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:47,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,695 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:12:47,696 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,696 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:12:47,696 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:12:47,697 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:12:47,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,698 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:12:47,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,699 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:12:47,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,700 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:12:47,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,701 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:12:47,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,701 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:12:47,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,702 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:12:47,702 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,703 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,703 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,703 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:12:47,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:12:47,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:12:47,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,706 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:12:47,706 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,706 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:12:47,706 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,706 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:12:47,706 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:12:47,706 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:12:47,706 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:12:47,707 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:12:47,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:12:47,707 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:12:47,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:47,708 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:12:47,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:12:47,709 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:12:47,709 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,709 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:12:47,709 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:47,710 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:12:47,710 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:47,711 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:12:47,711 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,712 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:12:47,713 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:12:47,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:12:47,714 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:47,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:12:47,715 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:12:47,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,715 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:12:47,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,716 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:12:47,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00055s] ()
2025-07-04 17:12:47,718 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:12:47,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:12:47,718 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:12:47,719 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:12:47,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,720 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:12:47,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,720 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:12:47,721 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:12:47,721 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:12:47,721 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:12:47,723 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:12:47,723 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,723 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:12:47,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:12:47,724 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:12:47,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:12:47,725 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:12:47,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:12:47,726 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:12:47,726 - sqlalchemy.engine.Engine - INFO - [cached since 3.539s ago] ('test@example.com', 1, 0)
2025-07-04 17:12:47,726 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:12:47,726 - services.app - INFO - Request completed: 401
2025-07-04 17:12:47,727 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:13:30,673 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:13:35,239 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:13:35,239 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:13:37,835 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:13:37,837 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:13:37,837 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,841 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:13:37,841 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,841 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:13:37,841 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,841 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:13:37,841 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,842 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:13:37,842 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,842 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:13:37,842 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,842 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:13:37,842 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,842 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:13:37,842 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,843 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:13:37,843 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,844 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:13:37,971 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:13:37,972 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:13:37,972 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:13:37,972 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,972 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:13:37,972 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,972 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:13:37,972 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,972 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:13:37,972 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:13:37,973 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,974 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:13:37,974 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:37,975 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:13:37,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:37,977 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:13:37,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:37,977 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:13:37,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:37,978 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:13:37,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:13:37,979 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:13:37,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:37,980 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:13:37,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:13:37,982 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:13:37,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:37,983 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:13:37,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:37,983 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:13:37,983 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:13:37,983 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:13:37,983 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,984 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:13:37,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,986 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:13:37,986 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,986 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:13:37,986 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,986 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:13:37,986 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:37,986 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:13:37,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:13:37,987 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:13:37,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:37,988 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:13:37,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:37,988 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:13:37,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:13:37,990 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:13:37,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:37,990 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:13:37,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:13:37,991 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:13:37,991 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:13:37,991 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:13:37,992 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:37,992 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:13:37,992 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:13:37,993 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:13:37,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:37,993 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:13:37,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:13:37,994 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:13:37,994 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:37,994 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:13:37,995 - sqlalchemy.engine.Engine - INFO - [no key 0.00105s] ()
2025-07-04 17:13:37,996 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:13:37,996 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:13:37,997 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:13:37,997 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:37,998 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:13:37,998 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:13:37,998 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:13:37,998 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:37,999 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:13:37,999 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,000 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:13:38,000 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:13:38,001 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:13:38,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:38,001 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:13:38,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,002 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:13:38,002 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:13:38,003 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:13:38,003 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,004 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:13:38,019 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:13:38,021 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:13:38,021 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] (123, 1, 0)
2025-07-04 17:13:38,023 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:13:38,023 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:13:38,023 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:13:38,032 - app.error_handling - ERROR - Error recorded [external_api_1751670818023] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:13:38,032 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:13:38,033 - services.app - INFO - Request completed: 503
2025-07-04 17:13:38,035 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:13:38,035 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:13:38,036 - services.app - INFO - Request completed: 200
2025-07-04 17:13:38,036 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:13:38,037 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:13:38,037 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:13:38,037 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:13:38,037 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,038 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:13:38,039 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,039 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:13:38,039 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,039 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:13:38,039 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,039 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:13:38,039 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:38,040 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:13:38,040 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,041 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:13:38,041 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:38,041 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:13:38,041 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:38,042 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:13:38,042 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:38,042 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:13:38,042 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:38,043 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:13:38,043 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:38,043 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:13:38,043 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:13:38,044 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:13:38,044 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,044 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:13:38,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,046 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:13:38,047 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:13:38,048 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:13:38,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:38,048 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:13:38,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:13:38,049 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:13:38,049 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:13:38,050 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:13:38,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,050 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:13:38,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:13:38,051 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:13:38,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,051 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:13:38,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:38,052 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:13:38,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:13:38,052 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:13:38,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,053 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:13:38,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:13:38,053 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:13:38,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:38,054 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:13:38,054 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,054 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:13:38,055 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:13:38,055 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:13:38,055 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,056 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:13:38,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:13:38,057 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:13:38,057 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:13:38,057 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:13:38,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:38,058 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:13:38,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:13:38,059 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:13:38,059 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:13:38,060 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:13:38,060 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,060 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:13:38,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:13:38,061 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:13:38,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:13:38,062 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:13:38,062 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:13:38,062 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:13:38,062 - sqlalchemy.engine.Engine - INFO - [generated in 0.00008s] ()
2025-07-04 17:13:38,119 - services.app - INFO - Request completed: 200
2025-07-04 17:13:38,120 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:13:38,126 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:13:38,126 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:13:38,126 - services.app - INFO - Info message
2025-07-04 17:13:38,126 - services.app - WARNING - Warning message
2025-07-04 17:13:38,126 - services.app - ERROR - Error message
2025-07-04 17:15:38,764 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:15:43,366 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:15:43,366 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:15:46,146 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:46,148 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:46,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:46,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:46,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:46,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:15:46,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,154 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:46,328 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:15:46,329 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:46,329 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:46,329 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,329 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:46,329 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:46,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:15:46,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,331 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:15:46,331 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:15:46,333 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:15:46,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:15:46,336 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:15:46,336 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:15:46,337 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:15:46,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,338 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:15:46,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:46,338 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:15:46,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:46,340 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:15:46,340 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:46,343 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:15:46,344 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:15:46,345 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:15:46,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,345 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:46,346 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:46,346 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:46,346 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,346 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:15:46,346 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,346 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:46,346 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,346 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:15:46,346 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,347 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:46,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,347 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:15:46,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,347 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:46,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,347 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:15:46,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:46,348 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:15:46,349 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,350 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:15:46,350 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:15:46,351 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:15:46,351 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:46,351 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:15:46,351 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:46,352 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:15:46,353 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:15:46,353 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:15:46,353 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:46,354 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:15:46,354 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:15:46,354 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:15:46,354 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,355 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:15:46,355 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:46,356 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:15:46,356 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:15:46,357 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:15:46,357 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:46,357 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:46,358 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:15:46,358 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:15:46,358 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:46,359 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:15:46,359 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:46,361 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:15:46,362 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-07-04 17:15:46,362 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:15:46,362 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:46,363 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:46,363 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:15:46,364 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:15:46,364 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,364 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:15:46,364 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,365 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:46,365 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:15:46,366 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:15:46,366 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,366 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:15:46,366 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:46,367 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:46,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:15:46,368 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:15:46,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,369 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:46,384 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:46,386 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:15:46,386 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (123, 1, 0)
2025-07-04 17:15:46,387 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:15:46,388 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:15:46,388 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:15:46,403 - app.error_handling - ERROR - Error recorded [external_api_1751670946388] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:15:46,403 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:15:46,404 - services.app - INFO - Request completed: 503
2025-07-04 17:15:46,407 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:15:46,408 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:15:46,409 - services.app - INFO - Request completed: 200
2025-07-04 17:15:46,410 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:15:46,411 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:15:46,411 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:46,411 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:46,411 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,411 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:46,411 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:46,412 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,413 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:15:46,413 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,413 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:15:46,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:46,414 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:15:46,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:46,415 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:15:46,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:46,415 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:15:46,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:46,416 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:15:46,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:46,416 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:15:46,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:46,417 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:15:46,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,417 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:15:46,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,418 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:15:46,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,419 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:46,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,421 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:15:46,421 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,421 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:46,421 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,421 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:15:46,421 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:46,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,422 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:15:46,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:15:46,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,422 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:15:46,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:46,423 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:15:46,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:15:46,423 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:15:46,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,424 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:15:46,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,425 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:15:46,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:15:46,425 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:15:46,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,426 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:15:46,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:15:46,427 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:15:46,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,427 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:15:46,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,428 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:15:46,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:15:46,429 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:15:46,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:46,429 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:46,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:15:46,430 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:15:46,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:46,431 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:15:46,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:15:46,432 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:15:46,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:15:46,433 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:15:46,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:46,433 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:46,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:15:46,434 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:15:46,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:46,435 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:15:46,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:46,436 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:46,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:15:46,438 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:15:46,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:15:46,439 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:15:46,439 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:15:46,440 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:46,441 - sqlalchemy.engine.Engine - INFO - [no key 0.00072s] ()
2025-07-04 17:15:46,442 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:15:46,442 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:15:46,443 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:46,443 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:46,444 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:15:46,444 - sqlalchemy.engine.Engine - INFO - [generated in 0.00009s] ()
2025-07-04 17:15:46,658 - services.app - INFO - Request completed: 200
2025-07-04 17:15:46,661 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:15:46,669 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:15:46,669 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:15:46,669 - services.app - INFO - Info message
2025-07-04 17:15:46,669 - services.app - WARNING - Warning message
2025-07-04 17:15:46,669 - services.app - ERROR - Error message
2025-07-04 17:15:47,403 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,404 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,414 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,415 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:47,415 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:47,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:47,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:47,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:47,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:47,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:47,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:47,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,417 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,430 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,430 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:47,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,430 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:47,430 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,430 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:47,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:47,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:47,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:47,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:47,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,432 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:47,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,432 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:15:47,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,432 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:15:47,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,433 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:15:47,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,434 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:15:47,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,435 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:15:47,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,436 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:15:47,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:15:47,436 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:15:47,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:47,437 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:15:47,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,438 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:15:47,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,438 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:15:47,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,439 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,439 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,439 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:47,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,439 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:15:47,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,439 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:47,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,441 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:15:47,442 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,442 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:15:47,442 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,442 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:15:47,442 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:15:47,443 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:15:47,443 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,443 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:15:47,443 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,444 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:15:47,444 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:15:47,445 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:15:47,445 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,445 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:15:47,445 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:15:47,446 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:15:47,446 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,447 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:15:47,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:47,447 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:15:47,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:15:47,448 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:15:47,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,449 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:47,449 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:15:47,449 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:15:47,449 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,450 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:15:47,450 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,450 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:15:47,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:15:47,451 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:15:47,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,452 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:47,452 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:15:47,453 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:15:47,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,453 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:15:47,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,454 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:47,454 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:15:47,455 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:15:47,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,456 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:15:47,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:47,456 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:47,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:15:47,457 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:15:47,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,457 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,458 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:15:47,459 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', 1, 0)
2025-07-04 17:15:47,459 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:15:47,459 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:15:47,460 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,461 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,461 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:15:47,461 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1,)
2025-07-04 17:15:47,463 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:15:47,463 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:15:47.462252', '2025-07-04 23:15:47.462255')
2025-07-04 17:15:47,463 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,464 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,465 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:15:47,465 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (1,)
2025-07-04 17:15:47,467 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:15:47,471 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,471 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:47,471 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,471 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:47,471 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,474 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:47,474 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,474 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:47,474 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,475 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:47,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,475 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:47,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,475 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:47,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,476 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:47,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,476 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:15:47,476 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,476 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:15:47,476 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,477 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:15:47,477 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,477 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:15:47,478 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,478 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:15:47,478 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,479 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:15:47,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,480 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:15:47,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,480 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:15:47,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,481 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:15:47,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,482 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:15:47,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,482 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,482 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,482 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,483 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:47,484 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:47,485 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:15:47,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:15:47,486 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:15:47,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,487 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:15:47,487 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,487 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:15:47,488 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:15:47,488 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:15:47,488 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,489 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:15:47,489 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:15:47,489 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:15:47,489 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,490 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:15:47,490 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,490 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:15:47,491 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:15:47,491 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:15:47,491 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,492 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:47,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:15:47,492 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:15:47,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,493 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:15:47,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,496 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:15:47,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:15:47,497 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:15:47,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,498 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:47,498 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:15:47,498 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:15:47,498 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:47,499 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:15:47,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,500 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:47,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:15:47,501 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:15:47,501 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:47,501 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:15:47,501 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:47,502 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:47,502 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:15:47,503 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:15:47,503 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:47,504 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,504 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,507 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:15:47,507 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ()
2025-07-04 17:15:47,508 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:15:47,508 - sqlalchemy.engine.Engine - INFO - [cached since 0.04946s ago] ('test@example.com', 1, 0)
2025-07-04 17:15:47,508 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:15:47,508 - sqlalchemy.engine.Engine - INFO - [cached since 0.04908s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:15:47,509 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,509 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,510 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:15:47,510 - sqlalchemy.engine.Engine - INFO - [cached since 0.04835s ago] (1,)
2025-07-04 17:15:47,510 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:15:47,510 - sqlalchemy.engine.Engine - INFO - [cached since 0.0476s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:15:47.510320', '2025-07-04 23:15:47.510322')
2025-07-04 17:15:47,512 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:47,513 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:47,513 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:15:47,513 - sqlalchemy.engine.Engine - INFO - [cached since 0.04868s ago] (1,)
2025-07-04 17:15:47,514 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:15:47,518 - services.app - INFO - Request started: GET /health
2025-07-04 17:15:47,518 - services.app - INFO - Request completed: 200
2025-07-04 17:15:47,519 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:15:47,520 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:15:47,520 - services.app - INFO - Request completed: 200
2025-07-04 17:15:47,522 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:15:47,567 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:15:47,567 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:15:49,403 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:49,404 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:49,404 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,404 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:49,404 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,404 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:49,404 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:49,405 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,406 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:15:49,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:49,408 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:15:49,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:49,409 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:15:49,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,412 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:15:49,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,414 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:15:49,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:15:49,415 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:15:49,415 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:49,416 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:15:49,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,417 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:15:49,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,418 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:49,418 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:49,418 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:49,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,418 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:15:49,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,418 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:49,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:15:49,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:15:49,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,421 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:15:49,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:15:49,422 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:15:49,422 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,422 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:15:49,422 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,423 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:15:49,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:15:49,424 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:15:49,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,424 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:15:49,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:15:49,425 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:15:49,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,426 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:15:49,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:49,428 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:15:49,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:15:49,429 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:15:49,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:49,430 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:49,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:15:49,430 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:15:49,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:49,431 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:15:49,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,432 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:15:49,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:15:49,433 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:15:49,433 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,434 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:49,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:15:49,435 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:15:49,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:49,436 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:15:49,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,437 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:49,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:15:49,438 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:15:49,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,438 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:15:49,439 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,440 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:49,517 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:49,517 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:49,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,517 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:49,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,517 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:49,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,517 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:49,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:15:49,518 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,519 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:15:49,519 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,520 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:15:49,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,520 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:15:49,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,521 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:15:49,521 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,522 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:15:49,522 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,524 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:15:49,524 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,524 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:15:49,524 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,525 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:49,525 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:49,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:49,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,525 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:15:49,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:49,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,525 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,527 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:15:49,528 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:15:49,528 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:15:49,528 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,528 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:15:49,529 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,529 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:15:49,529 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:15:49,530 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:15:49,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,530 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:15:49,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:15:49,532 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:15:49,532 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,532 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:15:49,532 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,533 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:15:49,533 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:15:49,534 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:15:49,534 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,536 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:49,536 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:15:49,537 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:15:49,537 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,537 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:15:49,537 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,538 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:15:49,538 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:15:49,539 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:15:49,539 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,539 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:49,540 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:15:49,540 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:15:49,540 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,542 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:15:49,542 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:49,543 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:49,543 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:15:49,544 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:15:49,544 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:49,545 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:15:49,545 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,546 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:49,549 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:49,549 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:49,549 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,549 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:49,549 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,549 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:49,549 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,550 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:15:49,551 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,551 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:15:49,552 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:49,552 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:15:49,552 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,553 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:15:49,553 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,553 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:15:49,553 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,554 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:15:49,554 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,555 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:15:49,555 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,555 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:15:49,555 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,556 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:15:49,556 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:15:49,556 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:15:49,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,556 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:15:49,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,556 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:15:49,556 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:15:49,557 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,558 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:15:49,558 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,558 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:15:49,558 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,558 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:15:49,558 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,558 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:15:49,558 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,559 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:15:49,559 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,559 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:15:49,559 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:15:49,559 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:15:49,559 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:15:49,560 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:15:49,560 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,561 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:15:49,561 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,562 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:15:49,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:15:49,562 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:15:49,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,563 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:15:49,563 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:15:49,564 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:15:49,564 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,564 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:15:49,564 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,565 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:15:49,565 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:15:49,565 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:15:49,566 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:15:49,566 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:15:49,567 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:15:49,567 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:15:49,567 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,568 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:15:49,568 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:49,568 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:15:49,569 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:15:49,569 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:15:49,569 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,570 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:49,570 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:15:49,570 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:15:49,570 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:15:49,571 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:15:49,571 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:15:49,571 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:15:49,572 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:15:49,572 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:15:49,572 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:15:49,573 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:15:49,573 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:15:49,573 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:06,967 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:16:11,095 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:16:11,096 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:16:13,726 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:13,729 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:13,729 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,731 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:13,732 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,733 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:13,733 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,733 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:13,733 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,735 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:13,905 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:16:13,906 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:13,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:13,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:13,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:13,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:13,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:13,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,908 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:13,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,908 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:13,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,908 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:13,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,908 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:13,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,909 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:13,909 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:13,910 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:13,910 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:13,912 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:13,912 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:13,913 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:13,913 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:13,914 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:13,914 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:13,914 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:13,914 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:13,917 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:13,917 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:16:13,919 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:13,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:13,920 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:13,920 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:13,920 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,921 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:13,922 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:13,923 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:13,924 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:13,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:16:13,925 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:13,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:13,925 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:13,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:13,926 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:13,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:16:13,927 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:13,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:13,928 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:13,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:13,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:13,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:16:13,932 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:13,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:13,932 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:13,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:16:13,933 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:13,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:13,934 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:13,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:13,935 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:13,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:13,935 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:13,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:13,938 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:13,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-07-04 17:16:13,939 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:13,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:13,940 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:13,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:16:13,941 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:13,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:13,942 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:13,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:13,943 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:13,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-07-04 17:16:13,946 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:13,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-07-04 17:16:13,947 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:13,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:13,948 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:13,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:16:13,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:13,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:13,950 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:13,975 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:13,981 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:13,981 - sqlalchemy.engine.Engine - INFO - [generated in 0.00088s] (123, 1, 0)
2025-07-04 17:16:13,988 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:13,988 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:16:13,991 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:14,004 - app.error_handling - ERROR - Error recorded [external_api_1751670973992] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:16:14,005 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:16:14,006 - services.app - INFO - Request completed: 503
2025-07-04 17:16:14,008 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:16:14,011 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:16:14,012 - services.app - INFO - Request completed: 200
2025-07-04 17:16:14,013 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:16:14,014 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:16:14,015 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:14,015 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:14,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,015 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:14,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,015 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:14,015 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:14,016 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,017 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:14,017 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:14,018 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:14,018 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:14,019 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:14,019 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:14,020 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:14,020 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:14,021 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:14,021 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:14,021 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:14,021 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:14,022 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:14,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:14,023 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:14,023 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:14,024 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:14,024 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:14,024 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:14,024 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:14,025 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,026 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:14,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:14,028 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:14,028 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:14,028 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:14,029 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:14,029 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:14,029 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:14,030 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:14,030 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:16:14,035 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:14,035 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:16:14,036 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:14,036 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:16:14,037 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:14,037 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:14,038 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:14,038 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:14,040 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:14,040 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:16:14,041 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:14,041 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:14,042 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:14,042 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:16:14,042 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:14,042 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:14,043 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:14,043 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:14,044 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:14,045 - sqlalchemy.engine.Engine - INFO - [no key 0.00049s] ()
2025-07-04 17:16:14,046 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:14,046 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:16:14,047 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:14,047 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:16:14,048 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:14,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:14,049 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:14,049 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:14,049 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:14,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:16:14,050 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:14,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:14,051 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:14,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:14,052 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:14,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:16:14,053 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:14,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:14,053 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:14,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:14,054 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:16:14,054 - sqlalchemy.engine.Engine - INFO - [generated in 0.00010s] ()
2025-07-04 17:16:14,105 - services.app - INFO - Request completed: 200
2025-07-04 17:16:14,106 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:16:14,116 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:16:14,117 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:16:14,117 - services.app - INFO - Info message
2025-07-04 17:16:14,117 - services.app - WARNING - Warning message
2025-07-04 17:16:14,117 - services.app - ERROR - Error message
2025-07-04 17:16:15,357 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,358 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,383 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,384 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:15,384 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,386 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:15,386 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,386 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:15,386 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,387 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,401 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:15,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:15,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,403 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:15,403 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,404 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:15,405 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,405 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:15,406 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,406 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:15,406 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,406 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:15,406 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,406 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:15,406 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,407 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:15,407 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,407 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:15,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:15,408 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:15,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,409 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:15,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,410 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:15,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,410 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:15,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,411 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:15,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,412 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:15,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,412 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:15,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,413 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:15,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,413 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,413 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,413 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:15,414 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:15,415 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:15,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,416 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:15,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:15,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,417 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:15,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:15,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,417 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:15,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,418 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:15,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:15,419 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:15,419 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,419 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:15,420 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:16:15,420 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:15,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:16:15,421 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:15,421 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:15,422 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:15,422 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:15,422 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:15,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:15,423 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:15,423 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,424 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:15,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:16:15,424 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:15,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,425 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:15,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:15,425 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:15,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,426 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:15,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:15,426 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:15,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:16:15,427 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:15,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:15,428 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:15,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:16:15,429 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:15,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:15,429 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:15,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:15,430 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:15,431 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:16:15,432 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:15,432 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:15,433 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:15,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:16:15,435 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:15,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:16:15,436 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:15,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:15,437 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,438 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,438 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:15,439 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ('test@example.com', 1, 0)
2025-07-04 17:16:15,439 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:15,440 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:16:15,440 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,441 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,442 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:15,442 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1,)
2025-07-04 17:16:15,444 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:16:15,444 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:16:15.442612', '2025-07-04 23:16:15.442620')
2025-07-04 17:16:15,444 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,445 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,446 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:16:15,446 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] (1,)
2025-07-04 17:16:15,449 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:15,453 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:15,454 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:15,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:15,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,455 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:15,455 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,455 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:15,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:15,456 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:15,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,457 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:15,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,457 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:15,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,458 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:15,458 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,459 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:15,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,460 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:15,460 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:15,461 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:15,461 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,463 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:15,463 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:15,464 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,464 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,464 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:15,464 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,464 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,465 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,466 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:15,467 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:15,468 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:15,468 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:15,468 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:15,469 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:15,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,469 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:15,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:15,470 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:15,470 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,470 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:15,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:15,471 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:15,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,471 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:15,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,472 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:15,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:15,473 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:15,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:15,474 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:15,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:15,474 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:15,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,475 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:15,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:15,476 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:15,476 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:16:15,476 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:15,476 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,477 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:15,477 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:16:15,478 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:15,478 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,478 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:15,478 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:15,479 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:15,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:16:15,480 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:15,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:15,481 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:15,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:15,481 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:15,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:16:15,482 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:15,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:15,483 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,483 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,486 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:16:15,486 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] ()
2025-07-04 17:16:15,487 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:15,487 - sqlalchemy.engine.Engine - INFO - [cached since 0.04856s ago] ('test@example.com', 1, 0)
2025-07-04 17:16:15,487 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:15,487 - sqlalchemy.engine.Engine - INFO - [cached since 0.04789s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:16:15,488 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,488 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,488 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:15,488 - sqlalchemy.engine.Engine - INFO - [cached since 0.04665s ago] (1,)
2025-07-04 17:16:15,489 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:16:15,489 - sqlalchemy.engine.Engine - INFO - [cached since 0.04542s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:16:15.488944', '2025-07-04 23:16:15.488947')
2025-07-04 17:16:15,489 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:15,490 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:15,490 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:16:15,490 - sqlalchemy.engine.Engine - INFO - [cached since 0.04408s ago] (1,)
2025-07-04 17:16:15,490 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:15,498 - services.app - INFO - Request started: GET /health
2025-07-04 17:16:15,499 - services.app - INFO - Request completed: 200
2025-07-04 17:16:15,500 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:16:15,502 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:16:15,502 - services.app - INFO - Request completed: 200
2025-07-04 17:16:15,503 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:16:15,543 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:16:15,544 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:16:17,466 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:17,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:17,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:17,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:17,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:17,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:17,468 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,471 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:17,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:17,472 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:17,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,473 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:17,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,474 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:17,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,475 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:17,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,475 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:17,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,476 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:17,476 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,476 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:17,476 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:17,477 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:17,479 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,479 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:17,479 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,479 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:17,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:17,480 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:17,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,480 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:17,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,481 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:17,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:17,481 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:17,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,482 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:17,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:17,482 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:17,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,483 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:17,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,483 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:17,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:17,484 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:17,484 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,484 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:17,484 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:17,485 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:17,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,485 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:17,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,486 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:17,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:16:17,487 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:17,487 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,487 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:17,487 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:16:17,492 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:17,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:17,493 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:17,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,493 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:17,494 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:16:17,494 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:17,494 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,495 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:17,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,495 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:17,498 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:16:17,779 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:17,780 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:17,780 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ('test@example.com', '$2b$12$ZmM/LzJBefwldY0jurFbOu07MohfYEC72PMDjQTabMDDB5q4L7UKS', 'Test User', None, None)
2025-07-04 17:16:17,781 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:17,782 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:17,783 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:17,783 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (1,)
2025-07-04 17:16:17,788 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:16:17,793 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:17,793 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:17,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,795 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:17,795 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,795 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:17,795 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,795 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:17,795 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,795 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:17,795 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:17,796 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:17,796 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,797 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:17,797 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,797 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:17,797 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:17,798 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:17,798 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,799 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:17,799 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,799 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:17,799 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,801 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:17,801 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,801 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:17,801 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,802 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:17,802 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:17,802 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:17,802 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,802 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:17,802 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:17,803 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:17,804 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:17,805 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:17,806 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:17,806 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,807 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:17,807 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,807 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:17,807 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:17,808 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:17,808 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,809 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:17,809 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:17,810 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:17,811 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,811 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:17,811 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,812 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:17,812 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:16:17,812 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:17,812 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,813 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:17,813 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:17,814 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:17,814 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,814 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:17,814 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,815 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:17,815 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:16:17,816 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:17,816 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,817 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:17,817 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:16:17,817 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:17,817 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,818 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:17,818 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,819 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:17,819 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:16:17,820 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:17,820 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,820 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:17,820 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:17,822 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:17,822 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:16:17,823 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:17,823 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,823 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:17,824 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:17,824 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:17,824 - sqlalchemy.engine.Engine - INFO - [cached since 2.386s ago] ('test@example.com', 1, 0)
2025-07-04 17:16:17,824 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:17,825 - services.app - INFO - Request completed: 401
2025-07-04 17:16:17,825 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:16:17,916 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:17,916 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:17,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:17,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,918 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:17,918 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,918 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:17,918 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,918 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:17,918 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,919 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:17,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,920 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:17,920 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,921 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:17,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,922 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:17,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,922 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:17,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,923 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:17,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,924 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:17,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,924 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:17,924 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:17,924 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:17,924 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:17,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:17,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:17,927 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:17,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:17,927 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:17,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,928 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:17,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,928 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:17,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:17,929 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:17,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,929 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:17,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:17,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:17,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:17,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,931 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:17,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:17,931 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:17,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:17,932 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:17,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:16:17,933 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:17,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,934 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:17,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:17,935 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:17,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:16:17,935 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:17,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,936 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:17,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:16:17,936 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:17,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,937 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:17,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:17,938 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:17,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:16:17,938 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:17,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,939 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:17,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:17,939 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:18,183 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,183 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:18,184 - sqlalchemy.engine.Engine - INFO - [cached since 0.4034s ago] ('test@example.com', '$2b$12$U12X3ghYnZddG/U/30nFKOwRK.uvr.Ti4TWEqNu46nxn3TGlFwkRG', 'Test User', None, None)
2025-07-04 17:16:18,184 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:18,185 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,185 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:18,185 - sqlalchemy.engine.Engine - INFO - [cached since 0.4023s ago] (1,)
2025-07-04 17:16:18,187 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:16:18,189 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,189 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:18,189 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,189 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:18,189 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,190 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:18,191 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,191 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:18,191 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,191 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:18,192 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,192 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:18,192 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,193 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:18,193 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,193 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:18,193 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,194 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:18,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,194 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:18,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:18,195 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:18,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,195 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:18,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,196 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:18,196 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,196 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:18,196 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,196 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:18,196 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,196 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:18,196 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,197 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:18,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,199 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:18,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:18,199 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:18,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,200 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:18,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,200 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:18,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:16:18,201 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:18,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,201 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:18,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:18,202 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:18,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,202 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:18,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,203 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:18,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:18,203 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:18,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,204 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:18,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:18,204 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:18,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,205 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:18,205 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,205 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:18,206 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:16:18,206 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:18,206 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,207 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:18,207 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:16:18,209 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:18,209 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,209 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:18,209 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,210 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:18,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:16:18,211 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:18,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:18,211 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:18,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,212 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:18,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:16:18,213 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:18,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,213 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:18,213 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,214 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:18,214 - sqlalchemy.engine.Engine - INFO - [cached since 2.775s ago] ('test@example.com', 1, 0)
2025-07-04 17:16:18,214 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:18,214 - services.app - INFO - Request completed: 401
2025-07-04 17:16:18,215 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:16:18,218 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:18,218 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,218 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:18,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:18,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:18,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,220 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:18,220 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,221 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:18,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,221 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:18,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,222 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:18,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,224 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:18,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,224 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:18,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,225 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:18,225 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,226 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:18,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:18,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:18,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,229 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:18,229 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,229 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:18,229 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,229 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:18,229 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,229 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:18,229 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,229 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:18,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:18,230 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:18,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,231 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:18,231 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,231 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:18,231 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:18,232 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:18,232 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,232 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:18,233 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:18,233 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:18,233 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,234 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:18,234 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,234 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:18,234 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:16:18,235 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:18,235 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:18,235 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:18,236 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:18,236 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:18,236 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:18,237 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:18,237 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,238 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:18,239 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:16:18,239 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:18,239 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,240 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:18,240 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:16:18,240 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:18,240 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,241 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:18,241 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:18,242 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:18,242 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:16:18,243 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:18,243 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,243 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:18,243 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,244 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:18,489 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,490 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:18,490 - sqlalchemy.engine.Engine - INFO - [cached since 0.7097s ago] ('test@example.com', '$2b$12$O3a0hCXuCwcS1r1eY/V0kO2oR1O/Fq1yOYV9wdqtojeC9tDnDxP/e', 'Test User', None, None)
2025-07-04 17:16:18,490 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:18,491 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,491 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:18,491 - sqlalchemy.engine.Engine - INFO - [cached since 0.7084s ago] (1,)
2025-07-04 17:16:18,492 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:16:18,494 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,494 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:18,494 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,494 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:18,494 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,494 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:18,494 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:18,495 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,496 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:18,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:18,496 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:18,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,498 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:18,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,499 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:18,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:18,500 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:18,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,500 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:18,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,501 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:18,501 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:18,501 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:18,501 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,502 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:18,502 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,502 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:18,502 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:18,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:18,504 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,505 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:18,505 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,505 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:18,505 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,505 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:18,505 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:18,505 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:18,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:18,506 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:18,506 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,506 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:18,506 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,507 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:18,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:16:18,507 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:18,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,508 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:18,508 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:18,508 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:18,508 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,509 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:18,509 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,509 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:18,509 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:16:18,510 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:18,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,510 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:18,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:18,511 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:18,511 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,511 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:18,511 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,512 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:18,512 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:16:18,513 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:18,513 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,513 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:18,513 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:16:18,514 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:18,514 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,514 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:18,514 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:18,515 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:18,515 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:16:18,516 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:18,516 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:18,516 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:18,516 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,517 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:18,517 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:16:18,518 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:18,518 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:18,518 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:18,519 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:18,519 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:18,519 - sqlalchemy.engine.Engine - INFO - [cached since 3.081s ago] ('test@example.com', 1, 0)
2025-07-04 17:16:18,519 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:18,520 - services.app - INFO - Request completed: 401
2025-07-04 17:16:18,520 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:16:18,523 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:43,370 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:16:47,611 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:16:47,611 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:16:50,156 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:50,158 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:50,158 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:50,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:50,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:50,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:50,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:50,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:50,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:50,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:50,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,164 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:50,299 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:16:50,300 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:50,300 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:50,300 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,300 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:50,300 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,300 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:50,301 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,302 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:50,302 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,303 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:50,303 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:50,305 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:50,305 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,306 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:50,306 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,306 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:50,306 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,307 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:50,307 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,309 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:50,309 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,310 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:50,310 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,311 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:50,311 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,311 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:50,311 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:50,311 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:50,311 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:50,312 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,313 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:50,313 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,313 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:50,313 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,313 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:50,313 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,313 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:50,313 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,313 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:50,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,315 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:50,315 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:50,316 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:50,316 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,316 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:50,316 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,317 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:50,317 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:50,317 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:50,317 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,318 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:50,318 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:50,318 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:50,318 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,319 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:50,319 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,320 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:50,321 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:16:50,321 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:50,321 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,321 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:50,322 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:50,322 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:50,322 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,322 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:50,323 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:50,324 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:50,324 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:16:50,325 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:50,325 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,328 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:50,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:16:50,328 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:50,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,329 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:50,329 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:50,330 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:50,330 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:16:50,330 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:50,330 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,331 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:50,331 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:50,332 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:50,332 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:16:50,332 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:50,332 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,333 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:50,345 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:50,347 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:50,347 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (123, 1, 0)
2025-07-04 17:16:50,348 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:50,349 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:16:50,349 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:50,366 - app.error_handling - ERROR - Error recorded [external_api_1751671010349] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:16:50,366 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:16:50,367 - services.app - INFO - Request completed: 503
2025-07-04 17:16:50,369 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:16:50,370 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:16:50,371 - services.app - INFO - Request completed: 200
2025-07-04 17:16:50,371 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:16:50,372 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:16:50,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:50,372 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:50,372 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,372 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:50,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,374 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:50,374 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,374 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:50,374 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,374 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:50,374 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,376 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:50,376 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:50,377 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:50,377 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,377 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:50,377 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,378 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:50,378 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,378 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:50,379 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:50,379 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:50,379 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:50,380 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:50,380 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,381 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:50,381 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:50,381 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:50,381 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:50,381 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:50,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:50,382 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,383 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:50,384 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,384 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:50,384 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,384 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:50,384 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,384 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:50,384 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:50,384 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:50,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:50,385 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:50,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,386 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:50,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,386 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:50,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:16:50,387 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:50,387 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,388 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:50,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:50,389 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:50,389 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:50,389 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:50,389 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,390 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:50,390 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:50,390 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:50,390 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,391 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:50,391 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:16:50,392 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:50,392 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:50,392 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:50,392 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:50,393 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:50,393 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:16:50,394 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:50,394 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:50,395 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:50,395 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:16:50,395 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:50,395 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,396 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:50,396 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,396 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:50,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:16:50,397 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:50,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,398 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:50,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:50,398 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:50,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:16:50,399 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:50,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:50,399 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:50,400 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:50,400 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:16:50,400 - sqlalchemy.engine.Engine - INFO - [generated in 0.00007s] ()
2025-07-04 17:16:50,428 - services.app - INFO - Request completed: 200
2025-07-04 17:16:50,429 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:16:50,437 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:16:50,437 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:16:50,437 - services.app - INFO - Info message
2025-07-04 17:16:50,437 - services.app - WARNING - Warning message
2025-07-04 17:16:50,437 - services.app - ERROR - Error message
2025-07-04 17:16:50,990 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:50,990 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,006 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,007 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:51,007 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:51,008 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,009 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:51,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,009 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:51,009 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,009 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,020 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,020 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:51,020 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,020 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:51,020 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:51,021 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,022 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:51,022 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,022 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:51,022 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:51,023 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:51,023 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,023 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:51,024 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:51,024 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:51,024 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:51,025 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:51,025 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:51,025 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:51,025 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:51,026 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:51,026 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:51,026 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:51,026 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:51,027 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:51,027 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,027 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:51,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:51,029 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,030 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:51,030 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,030 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:51,030 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,030 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:51,030 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,030 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:51,030 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,030 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:51,031 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:51,032 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:51,032 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,033 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:51,033 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:51,034 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:51,034 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:16:51,041 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:51,041 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:16:51,042 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:51,042 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:51,044 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:51,044 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:16:51,045 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:51,045 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,045 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:51,046 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:16:51,046 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:51,046 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:51,047 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:51,047 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:51,047 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:51,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:51,048 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:51,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,049 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:51,049 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:16:51,050 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:51,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:51,052 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:51,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:16:51,053 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:51,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:51,053 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:51,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:51,055 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:51,055 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:16:51,056 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:51,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:51,056 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:51,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,057 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:51,057 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:16:51,058 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:51,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,059 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,059 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,060 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:51,060 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', 1, 0)
2025-07-04 17:16:51,060 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:51,061 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:16:51,061 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,062 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,063 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:51,063 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1,)
2025-07-04 17:16:51,065 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:16:51,068 - sqlalchemy.engine.Engine - INFO - [generated in 0.00320s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:16:51.063534', '2025-07-04 23:16:51.063537')
2025-07-04 17:16:51,070 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,072 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,073 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:16:51,073 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (1,)
2025-07-04 17:16:51,079 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:51,085 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,085 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:51,085 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,086 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:51,086 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,086 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:51,086 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,087 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:51,087 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,087 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:51,087 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,087 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:51,087 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:51,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:51,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:51,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,089 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:51,089 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,089 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:51,090 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:51,090 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:51,090 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:51,091 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:51,091 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:51,092 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:51,092 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:16:51,094 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:51,094 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:51,094 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:51,094 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,095 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:51,095 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:51,095 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:51,096 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:51,096 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,096 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,096 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:51,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,096 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:51,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:51,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,098 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:51,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:51,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,099 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:51,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,099 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:51,099 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:51,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,100 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:51,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,100 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:51,100 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,100 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:51,101 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,101 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:51,101 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,101 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:51,101 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:51,101 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:51,101 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:51,102 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:51,102 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:51,103 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:51,103 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:16:51,105 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:51,105 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:16:51,106 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:51,106 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:51,107 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:51,107 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:16:51,108 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:51,109 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:16:51,110 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:51,110 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,111 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:51,112 - sqlalchemy.engine.Engine - INFO - [no key 0.00057s] ()
2025-07-04 17:16:51,113 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:51,113 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:51,114 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:51,114 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:51,114 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:51,114 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:51,115 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:51,115 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:16:51,116 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:51,116 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:16:51,117 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:51,117 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,118 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:51,118 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:16:51,119 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:51,119 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,119 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:51,119 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,120 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:51,120 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:16:51,121 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:51,121 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:51,122 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:51,123 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:51,124 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:51,124 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:16:51,125 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:51,125 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:51,125 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,126 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,129 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:16:51,130 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ()
2025-07-04 17:16:51,130 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:51,131 - sqlalchemy.engine.Engine - INFO - [cached since 0.07107s ago] ('test@example.com', 1, 0)
2025-07-04 17:16:51,131 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:51,131 - sqlalchemy.engine.Engine - INFO - [cached since 0.07081s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:16:51,132 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,133 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,133 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:51,133 - sqlalchemy.engine.Engine - INFO - [cached since 0.07049s ago] (1,)
2025-07-04 17:16:51,134 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:16:51,134 - sqlalchemy.engine.Engine - INFO - [cached since 0.06916s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:16:51.133707', '2025-07-04 23:16:51.133711')
2025-07-04 17:16:51,134 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:51,135 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:51,135 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:16:51,135 - sqlalchemy.engine.Engine - INFO - [cached since 0.06234s ago] (1,)
2025-07-04 17:16:51,136 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:51,141 - services.app - INFO - Request started: GET /health
2025-07-04 17:16:51,142 - services.app - INFO - Request completed: 200
2025-07-04 17:16:51,142 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:16:51,144 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:16:51,144 - services.app - INFO - Request completed: 200
2025-07-04 17:16:51,145 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:16:51,175 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:16:51,175 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:16:53,219 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,222 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:53,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,225 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:53,225 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,226 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:53,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,228 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:53,228 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:53,228 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:53,229 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,229 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:53,229 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,230 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:53,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,231 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:53,231 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:53,231 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,231 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,231 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,231 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,232 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:53,233 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,234 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,234 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,234 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:53,234 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,235 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:53,235 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:53,236 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:53,236 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,236 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:53,236 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,237 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:53,237 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:53,237 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:53,237 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,238 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:53,238 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:53,238 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:53,238 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,239 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:53,239 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,240 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,240 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:16:53,240 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:53,240 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,241 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:53,241 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:53,241 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:53,241 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,242 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:53,242 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,243 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:53,243 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:16:53,244 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:53,244 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,244 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,245 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:16:53,245 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:53,245 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,246 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:53,246 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,246 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,247 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:16:53,247 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:53,247 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,248 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:53,248 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,249 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,250 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:16:53,525 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,526 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:53,526 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ('test@example.com', '$2b$12$a5NTv2MrwKgE/97eBL3aA.eY3D/PfcOW/AmpHVxSwODNJGWEN/D2i', 'Test User', None, None)
2025-07-04 17:16:53,527 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,527 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,528 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:53,528 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1,)
2025-07-04 17:16:53,529 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:16:53,536 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,536 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,536 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,536 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,538 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,538 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:53,538 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,538 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:53,538 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,539 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:53,539 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,540 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:53,540 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,540 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:53,540 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:53,541 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:53,541 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,541 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:53,542 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:53,542 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:53,542 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,543 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:53,543 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,543 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:53,543 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:53,544 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,544 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,544 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,544 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:53,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:53,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:53,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,547 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:53,547 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,547 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:53,547 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,547 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:53,547 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:53,548 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:53,548 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,548 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:53,548 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,548 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:53,549 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:53,549 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:53,549 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,550 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:53,550 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:53,550 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:53,550 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,551 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:53,551 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:16:53,552 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,552 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:53,552 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:53,552 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,553 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:53,553 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:53,553 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:53,553 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,554 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:53,554 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,554 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:53,555 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:16:53,555 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:53,555 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,556 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,556 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:16:53,556 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:53,557 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,557 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:53,557 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,558 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,558 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:16:53,558 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:53,558 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,559 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:53,559 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,560 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:53,560 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:16:53,561 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:53,561 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,561 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,562 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,562 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:53,562 - sqlalchemy.engine.Engine - INFO - [cached since 2.503s ago] ('test@example.com', 1, 0)
2025-07-04 17:16:53,563 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:53,563 - services.app - INFO - Request completed: 401
2025-07-04 17:16:53,564 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:16:53,644 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:53,644 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,644 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,644 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,644 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,644 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,645 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:53,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,646 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:53,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,647 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:53,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,647 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:53,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,648 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:53,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,648 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:53,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,649 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:53,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:53,650 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:53,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,650 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,650 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,650 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,650 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:53,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,652 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,652 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,653 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,654 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:53,654 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,654 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,654 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,654 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:53,654 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,654 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:53,654 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:53,655 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:53,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,655 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:53,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,656 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:53,656 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:16:53,656 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:53,656 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,657 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:53,657 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:53,657 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:53,657 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,658 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:53,658 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,658 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,659 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:16:53,659 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:53,659 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,659 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:53,660 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:16:53,660 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:53,660 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,660 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:53,660 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,661 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:53,661 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:16:53,662 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:53,662 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,662 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,663 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:16:53,663 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:53,663 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,663 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:53,663 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,664 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,664 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:16:53,665 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:53,665 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,665 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:53,666 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:53,666 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,907 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,907 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:53,907 - sqlalchemy.engine.Engine - INFO - [cached since 0.3813s ago] ('test@example.com', '$2b$12$4kppMPvnUeADN4BxDo1WTOBD3xN9ItgIR.nZK400fXuFjmVlcA0Qe', 'Test User', None, None)
2025-07-04 17:16:53,908 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,908 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,908 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:53,908 - sqlalchemy.engine.Engine - INFO - [cached since 0.3807s ago] (1,)
2025-07-04 17:16:53,909 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:16:53,911 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,911 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,913 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,913 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,913 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:53,913 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,913 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:53,913 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:53,914 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:53,914 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,915 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:53,915 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,915 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:53,915 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,916 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:53,916 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,916 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:53,916 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,917 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:53,917 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:53,917 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:53,917 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:53,918 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:53,918 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,918 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,918 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,918 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:53,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,920 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:53,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,921 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:53,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,921 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:53,921 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,921 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:53,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:53,922 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:53,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,922 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:53,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,922 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:53,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:16:53,923 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:53,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,923 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:53,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:53,924 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:53,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,924 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:53,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,925 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:53,926 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:53,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,926 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:53,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:53,927 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:53,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,927 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:53,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,928 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:53,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:16:53,928 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:53,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,929 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:16:53,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:53,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:53,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,931 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:16:53,931 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:53,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,932 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:53,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,932 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:53,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:16:53,933 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:53,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,934 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,934 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,934 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:53,934 - sqlalchemy.engine.Engine - INFO - [cached since 2.875s ago] ('test@example.com', 1, 0)
2025-07-04 17:16:53,935 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:53,935 - services.app - INFO - Request completed: 401
2025-07-04 17:16:53,936 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:16:53,938 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:53,938 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,940 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:53,940 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,941 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:53,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,941 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:53,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,942 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:53,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,942 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:53,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:53,943 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:53,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,943 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:53,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,946 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:53,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,946 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:53,946 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:53,946 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:53,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,946 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:53,946 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:53,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:53,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:53,949 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:53,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:53,949 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:53,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,950 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:53,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,950 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:53,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:53,951 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:53,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,951 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:53,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:53,952 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:53,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,952 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:53,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,953 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:53,955 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:53,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,956 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:53,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:16:53,956 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:53,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,957 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:53,957 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,957 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:53,958 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:16:53,958 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:53,958 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,959 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:16:53,959 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:53,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,960 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:53,960 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:53,960 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:53,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:16:53,961 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:53,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:53,962 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:53,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:53,962 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:54,204 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:54,204 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:16:54,204 - sqlalchemy.engine.Engine - INFO - [cached since 0.6785s ago] ('test@example.com', '$2b$12$tAtqopb2S77bg8ZsmuLwYuTjLzVSC3kFvNjpgCQ5BWN.3ExiE3xu2', 'Test User', None, None)
2025-07-04 17:16:54,205 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:54,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:54,205 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:16:54,206 - sqlalchemy.engine.Engine - INFO - [cached since 0.6778s ago] (1,)
2025-07-04 17:16:54,206 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:16:54,209 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:54,209 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:54,209 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,209 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:54,209 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,209 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:54,209 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,209 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:54,209 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:16:54,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:54,211 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:16:54,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:54,212 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:16:54,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:54,212 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:16:54,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:54,213 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:16:54,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:54,213 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:16:54,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:16:54,214 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:16:54,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:54,214 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:16:54,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:54,215 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:16:54,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:54,216 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:54,216 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:54,216 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:16:54,216 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,216 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:16:54,216 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,216 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:16:54,217 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,218 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:16:54,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:16:54,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,219 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:16:54,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:16:54,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,219 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:16:54,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:16:54,220 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:16:54,220 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:16:54,221 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:16:54,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:54,221 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:16:54,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:54,222 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:16:54,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:54,223 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:16:54,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:54,223 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:16:54,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:54,224 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:16:54,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:54,224 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:16:54,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:54,225 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:16:54,225 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:16:54,226 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:16:54,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:54,226 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:54,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:16:54,227 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:16:54,227 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:16:54,227 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:16:54,227 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:54,228 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:16:54,228 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:16:54,229 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:16:54,229 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:54,229 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:54,229 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:16:54,230 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:16:54,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:54,230 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:16:54,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:54,231 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:16:54,231 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:16:54,232 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:16:54,232 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:16:54,232 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:16:54,232 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:16:54,233 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:16:54,233 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:16:54,234 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:16:54,234 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:16:54,234 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:16:54,235 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:16:54,235 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:16:54,235 - sqlalchemy.engine.Engine - INFO - [cached since 3.176s ago] ('test@example.com', 1, 0)
2025-07-04 17:16:54,235 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:16:54,236 - services.app - INFO - Request completed: 401
2025-07-04 17:16:54,236 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:16:54,239 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:17:52,494 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:17:56,676 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:17:56,677 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:17:59,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:17:59,378 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:17:59,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,383 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:17:59,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,383 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:17:59,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,383 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:17:59,383 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,384 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:17:59,384 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,384 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:17:59,384 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,384 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:17:59,384 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,384 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:17:59,385 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,385 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:17:59,385 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,385 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:17:59,528 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:17:59,529 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:17:59,529 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:17:59,529 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,529 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:17:59,529 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,529 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,530 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:17:59,531 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,531 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:17:59,531 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,533 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:17:59,533 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:17:59,535 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:17:59,535 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:17:59,536 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:17:59,536 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,536 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:17:59,536 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,537 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:17:59,537 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:17:59,539 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:17:59,539 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:17:59,541 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:17:59,542 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:17:59,542 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:17:59,542 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,543 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:17:59,543 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:17:59,543 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:17:59,543 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,543 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:17:59,543 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,543 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:17:59,543 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:17:59,544 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:17:59,545 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,546 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:17:59,546 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,546 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:17:59,546 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:17:59,547 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:17:59,547 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,548 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:17:59,548 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,548 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:17:59,549 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:17:59,549 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:17:59,549 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,550 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:17:59,550 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:17:59,550 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:17:59,550 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,551 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:17:59,551 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,552 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:17:59,552 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:17:59,552 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:17:59,552 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,553 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:17:59,553 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:17:59,553 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:17:59,554 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,554 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:17:59,554 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,556 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:17:59,556 - sqlalchemy.engine.Engine - INFO - [no key 0.00089s] ()
2025-07-04 17:17:59,558 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:17:59,558 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:17:59,559 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:17:59,559 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:17:59,560 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:17:59,560 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,560 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:17:59,560 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,561 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:17:59,561 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:17:59,562 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:17:59,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,563 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:17:59,563 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,564 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:17:59,565 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:17:59,565 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:17:59,565 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,566 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:17:59,580 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:17:59,581 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:17:59,581 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (123, 1, 0)
2025-07-04 17:17:59,583 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:17:59,583 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:17:59,583 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:17:59,592 - app.error_handling - ERROR - Error recorded [external_api_1751671079583] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:17:59,592 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:17:59,593 - services.app - INFO - Request completed: 503
2025-07-04 17:17:59,595 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:17:59,596 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:17:59,596 - services.app - INFO - Request completed: 200
2025-07-04 17:17:59,597 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:17:59,597 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:17:59,598 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:17:59,598 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:17:59,598 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,598 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:17:59,598 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,598 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:17:59,598 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,598 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:17:59,598 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:17:59,599 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,600 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:17:59,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,601 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:17:59,601 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,602 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:17:59,602 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,602 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:17:59,603 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,603 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:17:59,603 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,604 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:17:59,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,604 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:17:59,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,605 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:17:59,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,605 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:17:59,605 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:17:59,606 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,607 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:17:59,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:17:59,609 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:17:59,609 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,610 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:17:59,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:17:59,611 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:17:59,611 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:17:59,612 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:17:59,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,612 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:17:59,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:17:59,613 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:17:59,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,614 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:17:59,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,614 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:17:59,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:17:59,615 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:17:59,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,615 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:17:59,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:17:59,616 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:17:59,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,616 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:17:59,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,617 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:17:59,617 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:17:59,618 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:17:59,618 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,619 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:17:59,619 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:17:59,619 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:17:59,619 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,620 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:17:59,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,621 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:17:59,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:17:59,621 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:17:59,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:17:59,622 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:17:59,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:17:59,623 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:17:59,623 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:17:59,623 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:17:59,623 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:17:59,624 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:17:59,624 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:17:59,624 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:17:59,624 - sqlalchemy.engine.Engine - INFO - [generated in 0.00009s] ()
2025-07-04 17:17:59,643 - services.app - INFO - Request completed: 200
2025-07-04 17:17:59,644 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:17:59,650 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:17:59,650 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:17:59,651 - services.app - INFO - Info message
2025-07-04 17:17:59,651 - services.app - WARNING - Warning message
2025-07-04 17:17:59,651 - services.app - ERROR - Error message
2025-07-04 17:18:00,343 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,344 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,363 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,364 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:00,364 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,365 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:00,365 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,365 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:00,365 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:00,366 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:00,366 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,366 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:00,366 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,367 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:00,367 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,367 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:00,367 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,367 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,379 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:00,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:00,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:00,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:00,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:00,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,381 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:00,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,381 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:00,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,382 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:00,382 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,382 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:00,382 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,383 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:00,383 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,384 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:00,384 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,385 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:00,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,385 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:00,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,386 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:00,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,386 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:00,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,387 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:00,387 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,387 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:00,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,388 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:00,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:00,389 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,390 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:00,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,390 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:00,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,390 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:00,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,390 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:00,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:00,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:00,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,392 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:00,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,392 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:00,392 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:00,393 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:00,393 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,393 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:00,393 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,394 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:00,394 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:18:00,394 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:00,394 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,395 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:00,395 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:00,395 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:00,395 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,396 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:00,396 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,397 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:00,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:18:00,398 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:00,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:00,398 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:00,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:00,399 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:00,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,399 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:00,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,400 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:00,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:18:00,401 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:00,401 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,402 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:00,402 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:18:00,402 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:00,403 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,404 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:00,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,405 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:00,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:18:00,406 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:00,406 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:00,407 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:00,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,408 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:00,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:18:00,409 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:00,409 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,410 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,410 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,411 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:00,411 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ('test@example.com', 1, 0)
2025-07-04 17:18:00,411 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:00,412 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:18:00,412 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,413 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,413 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:00,413 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1,)
2025-07-04 17:18:00,415 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:18:00,415 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:18:00.414222', '2025-07-04 23:18:00.414225')
2025-07-04 17:18:00,415 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,416 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,417 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:18:00,417 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (1,)
2025-07-04 17:18:00,418 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:00,422 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:00,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:00,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:00,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,424 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:00,424 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,424 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:00,424 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:00,425 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:00,425 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,426 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:00,426 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,427 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:00,427 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,428 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:00,428 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:00,428 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:00,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,429 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:00,429 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,430 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:00,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,430 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:00,430 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,431 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,431 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,431 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:00,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,431 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:00,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:00,432 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:00,433 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:00,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,434 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:00,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:00,434 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:00,434 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:18:00,435 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:00,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,435 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:00,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,436 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:00,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:18:00,436 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:00,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:00,437 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:00,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:00,438 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:00,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:18:00,440 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:00,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:00,440 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:00,441 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:18:00,441 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:00,441 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:00,447 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:00,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:18:00,447 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:00,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:00,448 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:00,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:00,449 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:00,449 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:18:00,450 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:00,450 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,450 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:00,450 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:18:00,451 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:00,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,451 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:00,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,452 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:00,452 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:18:00,453 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:00,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:00,453 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:00,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:00,454 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:00,454 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:18:00,455 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:00,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:00,455 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,456 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,458 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:18:00,459 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] ()
2025-07-04 17:18:00,459 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:00,459 - sqlalchemy.engine.Engine - INFO - [cached since 0.04859s ago] ('test@example.com', 1, 0)
2025-07-04 17:18:00,459 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:00,460 - sqlalchemy.engine.Engine - INFO - [cached since 0.04822s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:18:00,460 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,461 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,461 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:00,461 - sqlalchemy.engine.Engine - INFO - [cached since 0.04758s ago] (1,)
2025-07-04 17:18:00,461 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:18:00,462 - sqlalchemy.engine.Engine - INFO - [cached since 0.04688s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:18:00.461596', '2025-07-04 23:18:00.461599')
2025-07-04 17:18:00,462 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:00,462 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:00,462 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:18:00,463 - sqlalchemy.engine.Engine - INFO - [cached since 0.04613s ago] (1,)
2025-07-04 17:18:00,463 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:00,472 - services.app - INFO - Request started: GET /health
2025-07-04 17:18:00,473 - services.app - INFO - Request completed: 200
2025-07-04 17:18:00,473 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:18:00,475 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:18:00,475 - services.app - INFO - Request completed: 200
2025-07-04 17:18:00,476 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:18:00,504 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:18:00,504 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:18:02,477 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:02,478 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,479 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:02,479 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,479 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:02,479 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,479 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:02,479 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,479 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:02,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,482 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:02,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,483 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:02,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:02,485 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:02,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,487 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:02,487 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,487 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:02,487 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,488 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:02,488 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,489 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:02,489 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,489 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:02,489 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:02,489 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:02,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:02,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,492 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:02,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,492 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:02,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,492 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:02,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:18:02,493 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:02,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,495 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:02,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:18:02,495 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:02,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:18:02,496 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:02,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,497 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:02,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:02,497 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:02,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,498 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:02,498 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:02,498 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:02,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:02,499 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:02,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,500 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:02,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:18:02,500 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:02,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,501 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:02,501 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,502 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:02,502 - sqlalchemy.engine.Engine - INFO - [no key 0.00051s] ()
2025-07-04 17:18:02,503 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:02,503 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,503 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:02,504 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:18:02,505 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:02,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,506 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:02,506 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,506 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:02,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:18:02,507 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:02,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,508 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:02,508 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,508 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:02,509 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:18:02,797 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:02,798 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:02,798 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ('test@example.com', '$2b$12$1U66rF7BIMOrffH48nElZec.Ahf4zsjJ2JKp87SEgbh5BzRJnTYyK', 'Test User', None, None)
2025-07-04 17:18:02,799 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:02,800 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:02,801 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:02,801 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1,)
2025-07-04 17:18:02,802 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:18:02,809 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,810 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:02,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:02,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:02,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:02,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,811 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:02,811 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,812 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:02,812 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:18:02,813 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:02,813 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,814 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:02,814 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,814 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:02,814 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,815 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:02,815 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,816 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:02,816 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,817 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:02,817 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,817 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:02,817 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,818 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:02,818 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:02,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:02,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,819 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:02,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:02,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,819 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:02,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,819 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,820 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,821 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:02,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,822 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:02,822 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:02,823 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:02,823 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,823 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:02,823 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,825 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:02,825 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:02,826 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:02,826 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,826 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:02,826 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:02,827 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:02,827 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,827 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:02,827 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,828 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:02,828 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:02,829 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:02,829 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:02,829 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:02,829 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:02,830 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:02,830 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,830 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:02,830 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,831 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:02,831 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:18:02,832 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:02,832 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,832 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:02,833 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:18:02,833 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:02,833 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,834 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:02,834 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,834 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:02,835 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:18:02,835 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:02,835 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,836 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:02,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,836 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:02,837 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:18:02,837 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:02,837 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,838 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:02,839 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:02,839 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:02,839 - sqlalchemy.engine.Engine - INFO - [cached since 2.429s ago] ('test@example.com', 1, 0)
2025-07-04 17:18:02,839 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:02,840 - services.app - INFO - Request completed: 401
2025-07-04 17:18:02,841 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:18:02,932 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:02,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,934 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:02,934 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,934 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:02,934 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,934 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:02,934 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,934 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:02,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,935 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:02,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,936 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:02,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,936 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:02,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,937 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:02,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,938 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:02,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,938 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:02,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,939 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:02,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:02,939 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:02,939 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:02,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,942 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:02,942 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,942 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:02,942 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:02,942 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:02,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:18:02,943 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:02,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:18:02,943 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:02,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,944 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:02,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:02,944 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:02,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,945 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:02,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:02,946 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:02,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:02,946 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:02,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,947 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:02,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:02,947 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:02,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,948 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:02,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:02,948 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:02,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:02,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,950 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:02,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:18:02,950 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:02,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:02,953 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:02,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:18:02,954 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:02,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,954 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:02,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:02,955 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:02,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:18:02,956 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:02,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,956 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:02,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:02,957 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:03,204 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,205 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:03,205 - sqlalchemy.engine.Engine - INFO - [cached since 0.4072s ago] ('test@example.com', '$2b$12$0JM0dQ8dOWsoG6CFrbeMPOaBIHmoJqpuVbZUGhWbmFtcZjM1Gd8fO', 'Test User', None, None)
2025-07-04 17:18:03,206 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:03,207 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,207 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:03,208 - sqlalchemy.engine.Engine - INFO - [cached since 0.407s ago] (1,)
2025-07-04 17:18:03,208 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:18:03,211 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:03,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:03,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:03,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:03,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:03,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,213 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:03,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,213 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:03,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,214 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:03,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,215 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:03,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,215 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:03,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,216 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:03,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:18:03,217 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:03,217 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,217 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:03,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:03,218 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:03,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,219 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:03,219 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:03,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,219 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:03,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,219 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:03,219 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:03,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,222 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:03,222 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,222 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:03,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:18:03,223 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:03,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,224 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:03,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,224 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:03,225 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:18:03,225 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:03,225 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:03,226 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:03,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:03,226 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:03,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,227 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:03,227 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,228 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:03,228 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:03,228 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:03,228 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,229 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:03,229 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:03,229 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:03,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,230 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:03,231 - sqlalchemy.engine.Engine - INFO - [no key 0.00075s] ()
2025-07-04 17:18:03,231 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:03,232 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:18:03,232 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:03,232 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,233 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:03,233 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:18:03,234 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:03,234 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,234 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:03,234 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,235 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:03,235 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:18:03,236 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:03,236 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:03,236 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:03,236 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,237 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:03,237 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:18:03,238 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:03,238 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,239 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:03,240 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,240 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:03,240 - sqlalchemy.engine.Engine - INFO - [cached since 2.83s ago] ('test@example.com', 1, 0)
2025-07-04 17:18:03,240 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:03,241 - services.app - INFO - Request completed: 401
2025-07-04 17:18:03,241 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:18:03,244 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:03,244 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:03,245 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,246 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:03,246 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,246 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:03,246 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,246 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:03,246 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,247 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:03,247 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,247 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:03,247 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,248 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:03,248 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,249 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:03,249 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,249 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:03,249 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,250 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:03,250 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,250 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:03,250 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:03,251 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:03,252 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:03,253 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:03,254 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:03,254 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:03,255 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:03,255 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,256 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:03,256 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:03,257 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:03,257 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,258 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:03,258 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:03,258 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:03,258 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,259 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:03,259 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:03,259 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:03,260 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:03,260 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:03,260 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,261 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:03,261 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:03,261 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:03,261 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:03,262 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:03,262 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:03,262 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:03,263 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:18:03,263 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:03,263 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,264 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:03,264 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:18:03,265 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:03,265 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,265 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:03,265 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,266 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:03,266 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:18:03,267 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:03,267 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,267 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:03,267 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:18:03,268 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:03,510 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,511 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:03,511 - sqlalchemy.engine.Engine - INFO - [cached since 0.7133s ago] ('test@example.com', '$2b$12$rBeMnQzzkm1S8DoYTJ.i6.7dbYXHIjw52fMjsLU5B0vNtHYCJ3RgW', 'Test User', None, None)
2025-07-04 17:18:03,512 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:03,512 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,512 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:03,512 - sqlalchemy.engine.Engine - INFO - [cached since 0.7119s ago] (1,)
2025-07-04 17:18:03,513 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:03,516 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:03,517 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:18:03,518 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:03,518 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,519 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:03,519 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,519 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:03,519 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,520 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:03,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,520 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:03,521 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:18:03,521 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:03,521 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:18:03,522 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:03,522 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:03,523 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:03,523 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:18:03,524 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:03,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,524 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:03,524 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,524 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:03,524 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,524 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:03,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:03,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,527 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:03,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:03,527 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:03,527 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:03,527 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:03,527 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,528 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:03,528 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,528 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:03,528 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:03,529 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:03,529 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,529 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:03,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:03,530 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:03,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,530 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:03,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,531 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:03,531 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:18:03,532 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:03,532 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,533 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:03,533 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:03,533 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:03,533 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,534 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:03,534 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,534 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:03,535 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:18:03,535 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:03,535 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,536 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:03,536 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:18:03,537 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:03,537 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,538 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:03,538 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,538 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:03,538 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:18:03,539 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:03,539 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:03,540 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:03,540 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:03,540 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:03,541 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:18:03,541 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:03,541 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:03,542 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:03,542 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:03,542 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:03,542 - sqlalchemy.engine.Engine - INFO - [cached since 3.132s ago] ('test@example.com', 1, 0)
2025-07-04 17:18:03,543 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:03,543 - services.app - INFO - Request completed: 401
2025-07-04 17:18:03,544 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:18:03,546 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:30,875 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:18:35,592 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:18:35,592 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:18:38,197 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:38,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:38,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:38,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:38,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,207 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:38,207 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,207 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:38,353 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:18:38,354 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:38,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:38,355 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:38,355 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:38,355 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:38,355 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:38,356 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,356 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:38,356 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,356 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:38,356 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,356 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:38,356 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,356 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:38,356 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,357 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:38,357 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,358 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:38,358 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,360 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:38,360 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,361 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:38,361 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:38,362 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:38,362 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:38,362 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:38,363 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,373 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:38,373 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:38,374 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:38,375 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,375 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:38,376 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:38,377 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:38,377 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:38,377 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:38,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:38,378 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,379 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:38,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,379 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:38,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,379 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:38,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,379 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:38,379 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:38,380 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,381 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:38,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,381 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:38,381 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,381 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:38,382 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:18:38,382 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:38,382 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,383 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:38,383 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,384 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:38,384 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:18:38,384 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:38,384 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,385 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:38,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:38,386 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:38,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,386 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:38,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,387 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:38,387 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:38,388 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:38,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:38,389 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:38,389 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:18:38,389 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:38,389 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:38,390 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:38,391 - sqlalchemy.engine.Engine - INFO - [no key 0.00107s] ()
2025-07-04 17:18:38,392 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:38,392 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:18:38,393 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:38,393 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,393 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:38,394 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:18:38,394 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:38,394 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:38,395 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:38,395 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,396 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:38,396 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:18:38,397 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:38,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:38,398 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:38,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,398 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:38,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 17:18:38,399 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:38,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:38,400 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:38,414 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:38,416 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:38,416 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (123, 1, 0)
2025-07-04 17:18:38,417 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:38,418 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:18:38,418 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:38,429 - app.error_handling - ERROR - Error recorded [external_api_1751671118418] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:18:38,429 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:18:38,430 - services.app - INFO - Request completed: 503
2025-07-04 17:18:38,431 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:18:38,432 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:18:38,433 - services.app - INFO - Request completed: 200
2025-07-04 17:18:38,433 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:18:38,434 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:18:38,434 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:38,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:38,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:38,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:38,436 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,436 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:38,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:38,437 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:38,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,437 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:38,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,438 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:38,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,439 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:38,439 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,439 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:38,439 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,440 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:38,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,440 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:38,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:38,441 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:38,441 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,442 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,443 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,444 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:38,445 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,445 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:38,445 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,445 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:38,445 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:38,445 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:38,445 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:38,446 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:38,446 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,447 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:38,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,447 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:38,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:38,448 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:38,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,449 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:38,449 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:38,449 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:38,449 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,449 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:38,450 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:38,450 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:38,450 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:18:38,451 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:38,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,451 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:38,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:38,452 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:38,452 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,453 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:38,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,453 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:38,454 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:18:38,454 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:38,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,455 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:38,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:18:38,456 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:38,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,456 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:38,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:38,458 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:38,458 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:18:38,459 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:38,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,459 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:38,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:38,461 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:38,461 - sqlalchemy.engine.Engine - INFO - [no key 0.00051s] ()
2025-07-04 17:18:38,462 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:38,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:38,462 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:38,463 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:38,463 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:18:38,463 - sqlalchemy.engine.Engine - INFO - [generated in 0.00007s] ()
2025-07-04 17:18:38,475 - services.app - INFO - Request completed: 200
2025-07-04 17:18:38,476 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:18:38,487 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:18:38,487 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:18:38,487 - services.app - INFO - Info message
2025-07-04 17:18:38,487 - services.app - WARNING - Warning message
2025-07-04 17:18:38,487 - services.app - ERROR - Error message
2025-07-04 17:18:39,120 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,121 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,138 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,138 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:39,138 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,139 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:39,139 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,139 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:39,139 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,140 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:39,140 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,140 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:39,140 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,140 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:39,140 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,141 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:39,141 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,141 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:39,141 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,141 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,152 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:39,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:39,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:39,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:39,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,154 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:39,154 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,155 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:39,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,156 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:39,156 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:39,157 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:39,158 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,158 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:39,158 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,159 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:39,159 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,160 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:39,160 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:18:39,161 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:39,161 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,161 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:39,162 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,162 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,162 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:39,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,162 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:39,164 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,165 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:39,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,165 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:39,165 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,165 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:39,165 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:39,166 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:39,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,166 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:39,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,167 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:39,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:39,168 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:39,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,168 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:39,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:39,169 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:39,169 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,169 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:39,169 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,169 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:39,170 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:39,170 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:39,170 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,171 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:39,171 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:39,171 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:39,171 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,172 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:39,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,172 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:39,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:18:39,173 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:39,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,174 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:39,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00079s] ()
2025-07-04 17:18:39,176 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:39,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,176 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:39,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,177 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:39,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:18:39,178 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:39,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,178 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:39,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,179 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:39,179 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:18:39,180 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:39,180 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,180 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,180 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,181 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:39,181 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', 1, 0)
2025-07-04 17:18:39,182 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:39,182 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:18:39,183 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,183 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,184 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:39,184 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1,)
2025-07-04 17:18:39,185 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:18:39,185 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:18:39.184492', '2025-07-04 23:18:39.184495')
2025-07-04 17:18:39,186 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,186 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,187 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:18:39,187 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] (1,)
2025-07-04 17:18:39,189 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:39,193 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:39,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:39,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:39,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:39,194 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,195 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:39,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,195 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:39,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,196 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:39,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,197 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:39,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,197 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:39,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,198 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:39,198 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,199 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:39,199 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,200 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:39,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,200 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:39,200 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:39,201 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:39,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:39,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:39,204 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:39,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:39,204 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:39,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,205 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:39,205 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:39,206 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:39,206 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:39,206 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:39,206 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,207 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:39,207 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:39,208 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:39,208 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:39,208 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:39,208 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,209 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:39,209 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:39,209 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:39,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,210 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:39,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:39,211 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:39,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:39,212 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:39,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:18:39,213 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:39,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:18:39,214 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:39,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,215 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:39,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:18:39,215 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:39,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:39,216 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:39,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,217 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:39,217 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:18:39,218 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:39,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,218 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:39,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:39,219 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:39,219 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:18:39,220 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:39,220 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:39,220 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,221 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,223 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:18:39,224 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] ()
2025-07-04 17:18:39,224 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:39,224 - sqlalchemy.engine.Engine - INFO - [cached since 0.04337s ago] ('test@example.com', 1, 0)
2025-07-04 17:18:39,225 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:39,225 - sqlalchemy.engine.Engine - INFO - [cached since 0.04307s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:18:39,226 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,226 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,226 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:39,226 - sqlalchemy.engine.Engine - INFO - [cached since 0.04286s ago] (1,)
2025-07-04 17:18:39,227 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:18:39,227 - sqlalchemy.engine.Engine - INFO - [cached since 0.04228s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:18:39.227214', '2025-07-04 23:18:39.227217')
2025-07-04 17:18:39,228 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:39,228 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:39,229 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:18:39,229 - sqlalchemy.engine.Engine - INFO - [cached since 0.04185s ago] (1,)
2025-07-04 17:18:39,229 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:39,234 - services.app - INFO - Request started: GET /health
2025-07-04 17:18:39,236 - services.app - INFO - Request completed: 200
2025-07-04 17:18:39,236 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:18:39,238 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:18:39,238 - services.app - INFO - Request completed: 200
2025-07-04 17:18:39,239 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:18:39,278 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:18:39,278 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:18:41,226 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,227 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:41,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:41,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:41,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:41,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:41,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,229 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:41,229 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,229 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:41,229 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,229 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:41,229 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,230 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:41,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,232 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:41,232 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,233 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:41,233 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,235 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:41,235 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,236 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:41,236 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,237 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:41,237 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,238 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:41,238 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,239 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:41,239 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,239 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,239 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,239 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:41,239 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,240 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:41,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,242 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:41,242 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,242 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:41,242 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,242 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:41,242 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:41,244 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:41,244 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:41,246 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:41,246 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:18:41,247 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:41,247 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:18:41,247 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:41,247 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,248 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:41,248 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:41,249 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:41,249 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,249 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:41,249 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,250 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,250 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:41,251 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:41,251 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,251 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:41,251 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:41,252 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:41,252 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,253 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:41,253 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,254 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:41,254 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:18:41,254 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:41,254 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,255 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,255 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:18:41,261 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:41,261 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:41,261 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:41,261 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,262 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,262 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:18:41,263 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:41,263 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,264 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:41,264 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,264 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,265 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:18:41,556 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,557 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:41,557 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] ('test@example.com', '$2b$12$VHHULZepm9DH10sTcRYhMeGoauA0XaJM8AdgLoOTIHRXs.1oeDuba', 'Test User', None, None)
2025-07-04 17:18:41,560 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,561 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,562 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:41,562 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1,)
2025-07-04 17:18:41,564 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:18:41,570 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,570 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:41,570 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:41,571 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,572 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:41,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,572 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:41,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,572 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:41,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,572 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:41,572 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,573 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:41,573 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,574 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:41,574 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,575 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:41,575 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,575 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:41,575 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,576 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:41,576 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,576 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:41,577 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,577 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:41,577 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,578 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:41,578 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,578 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,578 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,578 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,579 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:41,580 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:41,581 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,582 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:41,582 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:18:41,582 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:41,582 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:41,583 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:41,583 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,584 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:41,584 - sqlalchemy.engine.Engine - INFO - [no key 0.00055s] ()
2025-07-04 17:18:41,585 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:41,585 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,585 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:41,585 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:41,586 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:41,586 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,586 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:41,586 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,587 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,587 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:41,588 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:41,588 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,588 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:41,588 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:41,589 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:41,589 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,589 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:41,589 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,590 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:41,590 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:18:41,591 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:41,591 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:18:41,591 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,592 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:18:41,592 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:41,592 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,593 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:41,593 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,593 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,594 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:18:41,594 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:41,594 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,595 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:41,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,596 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:41,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:18:41,596 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:41,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,597 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,598 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,598 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:41,598 - sqlalchemy.engine.Engine - INFO - [cached since 2.417s ago] ('test@example.com', 1, 0)
2025-07-04 17:18:41,598 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:41,599 - services.app - INFO - Request completed: 401
2025-07-04 17:18:41,600 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:18:41,695 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:41,695 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:41,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:41,695 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,695 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:41,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,697 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:41,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,697 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:41,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,698 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:41,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,699 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:41,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,699 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:41,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,700 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:41,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,701 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:41,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,701 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:41,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,702 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,702 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,702 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:41,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,702 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:41,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,702 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:41,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:41,703 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:41,704 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,705 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:41,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:18:41,705 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:41,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,706 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:41,706 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,707 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:41,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:41,707 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:41,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,708 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:41,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:41,708 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:41,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,709 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:41,709 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,710 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,710 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:41,710 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:41,710 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,711 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:41,711 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:41,711 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:41,711 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,712 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:41,712 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,713 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:41,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:18:41,714 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:41,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,714 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:18:41,715 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:41,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,716 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:41,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,716 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:18:41,717 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:41,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,718 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:41,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,718 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,961 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,962 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:41,962 - sqlalchemy.engine.Engine - INFO - [cached since 0.4046s ago] ('test@example.com', '$2b$12$hgpFCJXLOwSjo6W7gjirduwJlcPf/vd.gd6k771M3gZmiIbU6GDvm', 'Test User', None, None)
2025-07-04 17:18:41,962 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,963 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,963 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:41,963 - sqlalchemy.engine.Engine - INFO - [cached since 0.4015s ago] (1,)
2025-07-04 17:18:41,964 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:18:41,966 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:41,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:41,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:41,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,968 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:41,968 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,969 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:41,969 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,969 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:41,969 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,970 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:41,970 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,970 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:41,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,971 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:41,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,972 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:41,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,972 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:41,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,973 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:41,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,974 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,974 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,974 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:41,974 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,974 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:41,974 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,975 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,976 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:41,977 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,977 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:41,977 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,977 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:41,977 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,977 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:41,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:41,978 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:41,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,978 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:41,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,979 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:41,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:41,979 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:41,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,980 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:41,980 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:41,980 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:41,980 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,981 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:41,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,981 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:41,982 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:41,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,982 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:41,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:18:41,983 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:41,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,983 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:41,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,984 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:41,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:18:41,985 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:41,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,985 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:18:41,986 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:41,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,987 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:41,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,987 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:41,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:18:41,988 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:41,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:41,988 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:41,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:41,989 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:41,989 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:18:41,990 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:41,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,990 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:41,991 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,991 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:41,991 - sqlalchemy.engine.Engine - INFO - [cached since 2.81s ago] ('test@example.com', 1, 0)
2025-07-04 17:18:41,991 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:41,992 - services.app - INFO - Request completed: 401
2025-07-04 17:18:41,992 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:18:41,995 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:41,996 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:41,996 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:41,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,996 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:41,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,996 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:41,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,996 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:41,997 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:41,998 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:41,998 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,999 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:41,999 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:41,999 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:41,999 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,000 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:42,000 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,001 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:42,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,002 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:42,002 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:42,002 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:42,002 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,003 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:42,003 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:42,003 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:42,003 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,003 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:42,003 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:42,004 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:42,005 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,006 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:42,006 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,006 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:42,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:42,006 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:42,007 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,007 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:42,007 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,008 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:42,008 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:42,008 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:42,009 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:42,009 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:42,009 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:42,010 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:42,010 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:42,010 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:42,010 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,011 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:42,011 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:42,011 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:42,011 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,012 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:42,012 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:42,012 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:42,012 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:42,013 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:42,013 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,013 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:42,014 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-07-04 17:18:42,014 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:42,014 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,015 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:42,015 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:18:42,016 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:42,016 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,016 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:42,016 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,017 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:42,017 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:18:42,018 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:42,018 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,018 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:42,018 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:42,019 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:42,264 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:42,264 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:18:42,264 - sqlalchemy.engine.Engine - INFO - [cached since 0.707s ago] ('test@example.com', '$2b$12$8gn9ocw8zum0ew7I0sQ6qOu3Wimc58BOTLnw7kFs66WHgCkJ54WdW', 'Test User', None, None)
2025-07-04 17:18:42,265 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:42,265 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:42,266 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:18:42,266 - sqlalchemy.engine.Engine - INFO - [cached since 0.7041s ago] (1,)
2025-07-04 17:18:42,267 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,269 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:18:42,270 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,271 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:18:42,271 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,272 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:18:42,272 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,273 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:18:42,273 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,273 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:18:42,273 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,274 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:18:42,274 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,274 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:18:42,274 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,275 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:18:42,275 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:42,276 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:18:42,276 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,276 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:42,276 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:42,276 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:18:42,276 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:18:42,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,278 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:18:42,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,279 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:18:42,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,279 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:18:42,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:18:42,279 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:18:42,279 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:18:42,280 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:18:42,280 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,280 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:18:42,280 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,281 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:18:42,281 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:18:42,281 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:18:42,282 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:42,282 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:18:42,282 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:42,283 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:18:42,283 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:42,283 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:18:42,283 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,284 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:18:42,284 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:18:42,284 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:18:42,284 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,285 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:42,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:18:42,285 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:18:42,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:18:42,286 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:18:42,286 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:42,288 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:18:42,288 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:18:42,289 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:18:42,289 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,289 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:42,290 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 17:18:42,290 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:18:42,290 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,290 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:18:42,291 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:18:42,292 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:18:42,292 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:18:42,292 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:18:42,293 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:18:42,293 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:18:42,293 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,295 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:18:42,295 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:18:42,296 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:18:42,296 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:18:42,298 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:18:42,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:18:42,298 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:18:42,299 - sqlalchemy.engine.Engine - INFO - [cached since 3.118s ago] ('test@example.com', 1, 0)
2025-07-04 17:18:42,299 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:18:42,299 - services.app - INFO - Request completed: 401
2025-07-04 17:18:42,300 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:18:42,303 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:24:18,754 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:24:23,507 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:24:23,508 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:24:26,519 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:26,521 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:26,522 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:26,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:26,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:26,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:26,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:26,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:26,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:26,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:26,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,528 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:26,735 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:24:26,737 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:26,737 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:26,737 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,737 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:26,737 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,737 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:26,738 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,738 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:26,738 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,738 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:26,738 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,738 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:26,739 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,739 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:26,739 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,739 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:26,739 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,739 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:26,739 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:26,740 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:24:26,741 - sqlalchemy.engine.Engine - INFO - [no key 0.00070s] ()
2025-07-04 17:24:26,745 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:26,745 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:24:26,748 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:26,749 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:24:26,751 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:26,751 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:26,755 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:26,755 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:24:27,240 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:27,240 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:24:27,243 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:27,243 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:27,245 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:27,245 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:27,245 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:27,245 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:27,246 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:27,247 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:27,247 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:27,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,247 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:27,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:27,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,249 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:27,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:27,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,250 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:27,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:27,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,251 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:24:27,251 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,252 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:27,252 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:24:27,253 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:27,253 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:27,254 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:27,254 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:27,255 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:27,255 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:24:27,256 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:27,256 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:27,256 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:27,256 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:24:27,257 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:27,257 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:27,258 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:27,258 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:27,259 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:27,259 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:24:27,259 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:27,259 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:27,260 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:27,260 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:24:27,261 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:27,261 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:27,262 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:27,262 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:24:27,265 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:27,266 - sqlalchemy.engine.Engine - INFO - [no key 0.00113s] ()
2025-07-04 17:24:27,269 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:27,269 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:27,271 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:27,271 - sqlalchemy.engine.Engine - INFO - [no key 0.00080s] ()
2025-07-04 17:24:27,273 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:27,273 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:27,274 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:27,274 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:27,275 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:27,276 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:24:27,278 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:27,278 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:27,280 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:27,280 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:27,282 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:27,283 - sqlalchemy.engine.Engine - INFO - [no key 0.00132s] ()
2025-07-04 17:24:27,285 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:24:27,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:27,286 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:27,326 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:27,330 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:24:27,330 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] (123, 1, 0)
2025-07-04 17:24:27,334 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:24:27,334 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:24:27,335 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:24:27,351 - app.error_handling - ERROR - Error recorded [external_api_1751671467335] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:24:27,353 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:24:27,356 - services.app - INFO - Request completed: 503
2025-07-04 17:24:27,361 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:24:27,364 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:24:27,365 - services.app - INFO - Request completed: 200
2025-07-04 17:24:27,368 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:24:27,371 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:24:27,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:27,373 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:27,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,373 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:27,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,373 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:27,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,374 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:27,374 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,374 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:27,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,375 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:27,375 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:27,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:27,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,377 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:27,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,377 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:24:27,377 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:27,378 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:27,378 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:27,380 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:27,380 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:27,381 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:27,381 - sqlalchemy.engine.Engine - INFO - [no key 0.00049s] ()
2025-07-04 17:24:27,382 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:27,382 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:27,383 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:27,384 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:24:27,385 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:27,385 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:27,386 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:27,386 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:24:27,388 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:27,388 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:27,389 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:27,389 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:27,389 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:27,389 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,390 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:27,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,390 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:27,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,390 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:27,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,390 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:27,390 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,390 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:27,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,391 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:27,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,391 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:27,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,391 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:27,391 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,392 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:27,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,392 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:27,392 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:27,393 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,394 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:27,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,394 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:24:27,394 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:27,394 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:27,394 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:24:27,395 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:27,395 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:27,396 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:27,396 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:27,397 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:27,397 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:24:27,398 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:27,398 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:27,399 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:27,399 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:27,400 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:27,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:27,400 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:27,400 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:27,401 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:27,401 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:24:27,402 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:27,402 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:24:27,403 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:27,404 - sqlalchemy.engine.Engine - INFO - [no key 0.00053s] ()
2025-07-04 17:24:27,404 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:27,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:27,405 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:27,405 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:27,406 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:27,407 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:24:27,408 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:27,408 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:24:27,410 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:27,410 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:24:27,411 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:27,411 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:27,412 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:27,412 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:27,413 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:27,413 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:24:27,414 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:27,414 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:24:27,415 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:27,416 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:27,417 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:27,417 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:24:27,418 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:24:27,418 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:24:27,419 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:27,420 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:27,420 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:24:27,420 - sqlalchemy.engine.Engine - INFO - [generated in 0.00011s] ()
2025-07-04 17:24:27,453 - services.app - INFO - Request completed: 200
2025-07-04 17:24:27,457 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:24:27,475 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:24:27,475 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:24:27,475 - services.app - INFO - Info message
2025-07-04 17:24:27,475 - services.app - WARNING - Warning message
2025-07-04 17:24:27,475 - services.app - ERROR - Error message
2025-07-04 17:24:28,383 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,383 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,418 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:28,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:28,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:28,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:28,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:28,421 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,421 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:28,421 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:28,424 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,425 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:28,425 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,425 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,445 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,446 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:28,446 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,446 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:28,446 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,446 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:28,446 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,446 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:28,446 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,446 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:28,447 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,447 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:28,447 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,447 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:28,447 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,448 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:28,448 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,448 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:28,448 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,449 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:24:28,449 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:24:28,450 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:28,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:24:28,453 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:28,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:24:28,454 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:28,454 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:28,454 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:28,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:24:28,455 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:28,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:28,456 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:28,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:28,457 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:28,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:28,457 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:28,458 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:28,458 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,458 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:28,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,459 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:28,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,459 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:28,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,459 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:28,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,459 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:28,459 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:28,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,461 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:28,462 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,462 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:24:28,462 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,462 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:28,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:24:28,463 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:28,463 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:28,463 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:28,463 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:28,464 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:28,464 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:24:28,465 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:28,465 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:28,465 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:28,465 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:28,466 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:28,466 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:28,466 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:28,467 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:28,467 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:28,467 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:24:28,468 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:28,468 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:24:28,469 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:28,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:24:28,469 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:28,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:28,470 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:28,470 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:28,471 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:28,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:24:28,472 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:28,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:28,473 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:28,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00050s] ()
2025-07-04 17:24:28,474 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:28,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:28,474 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:28,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:28,475 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:28,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:24:28,476 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:28,476 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:28,477 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:28,477 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:24:28,479 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:28,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00050s] ()
2025-07-04 17:24:28,480 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:24:28,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:24:28,481 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,481 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,482 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:24:28,482 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ('test@example.com', 1, 0)
2025-07-04 17:24:28,483 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:24:28,484 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:24:28,485 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,486 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,487 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:24:28,487 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (1,)
2025-07-04 17:24:28,489 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:24:28,490 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:24:28.488109', '2025-07-04 23:24:28.488113')
2025-07-04 17:24:28,490 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,491 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,492 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:24:28,492 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] (1,)
2025-07-04 17:24:28,495 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:24:28,499 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,500 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:28,500 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,500 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:28,500 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,500 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:28,500 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:28,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:28,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,502 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:24:28,502 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:28,503 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:28,503 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:28,504 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:28,504 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:28,504 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:28,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:24:28,505 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:28,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:28,506 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:28,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:28,507 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:28,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:28,510 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:28,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:28,510 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:28,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:28,511 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,511 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,511 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:28,511 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:28,512 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:28,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:28,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,515 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:24:28,515 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:28,515 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:28,515 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:24:28,516 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:28,516 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:24:28,516 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:28,517 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:28,517 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:28,517 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:24:28,518 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:28,518 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:28,519 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:28,519 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:24:28,520 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:28,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:24:28,521 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:28,521 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:28,522 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:28,522 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:24:28,522 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:28,523 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:28,523 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:28,523 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:24:28,524 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:28,524 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:28,525 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:28,525 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:28,526 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:28,526 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-07-04 17:24:28,528 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:28,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00105s] ()
2025-07-04 17:24:28,532 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:28,533 - sqlalchemy.engine.Engine - INFO - [no key 0.00056s] ()
2025-07-04 17:24:28,534 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:28,535 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:24:28,536 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:28,536 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:28,537 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:28,537 - sqlalchemy.engine.Engine - INFO - [no key 0.00050s] ()
2025-07-04 17:24:28,538 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:28,538 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:28,538 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:28,538 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:28,539 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:28,539 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:24:28,540 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:24:28,540 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:28,541 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,541 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,544 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:24:28,544 - sqlalchemy.engine.Engine - INFO - [generated in 0.00088s] ()
2025-07-04 17:24:28,545 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:24:28,545 - sqlalchemy.engine.Engine - INFO - [cached since 0.06347s ago] ('test@example.com', 1, 0)
2025-07-04 17:24:28,546 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:24:28,546 - sqlalchemy.engine.Engine - INFO - [cached since 0.06269s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:24:28,547 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,547 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,547 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:24:28,547 - sqlalchemy.engine.Engine - INFO - [cached since 0.06057s ago] (1,)
2025-07-04 17:24:28,548 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:24:28,548 - sqlalchemy.engine.Engine - INFO - [cached since 0.05897s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:24:28.548092', '2025-07-04 23:24:28.548096')
2025-07-04 17:24:28,549 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:28,549 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:28,549 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:24:28,549 - sqlalchemy.engine.Engine - INFO - [cached since 0.05749s ago] (1,)
2025-07-04 17:24:28,550 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:24:28,554 - services.app - INFO - Request started: GET /health
2025-07-04 17:24:28,556 - services.app - INFO - Request completed: 200
2025-07-04 17:24:28,557 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:24:28,559 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:24:28,560 - services.app - INFO - Request completed: 200
2025-07-04 17:24:28,562 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:24:28,597 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:24:28,597 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:24:30,594 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:30,599 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:30,599 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,600 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:30,600 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,600 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:30,600 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,600 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:30,600 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,600 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:30,600 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,600 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:30,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,601 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:30,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,601 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:30,601 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,601 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:30,601 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,604 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:30,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,605 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:30,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:30,607 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:30,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-07-04 17:24:30,608 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:30,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,610 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:30,610 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:30,611 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:30,611 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:30,612 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:30,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,612 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:30,612 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:30,612 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:30,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,612 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,613 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:30,614 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,615 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:30,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:24:30,616 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:30,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,616 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:30,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,617 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:30,617 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:30,617 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:30,618 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,618 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:30,618 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:30,619 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:30,619 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,619 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:30,619 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,620 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:30,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:30,620 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:30,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,621 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:30,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:30,622 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:30,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,622 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:30,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:30,623 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:30,623 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:24:30,624 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:30,624 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,624 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:30,624 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:24:30,630 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:30,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:30,630 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:30,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,631 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:30,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:24:30,632 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:30,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:30,633 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:30,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,633 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:30,634 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:24:30,912 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:30,913 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:24:30,913 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ('test@example.com', '$2b$12$BMbq3KMzotg5Yr.RsUbrBO0ysQPhQ/uVJ/mfrOGnl8K2YH71NCbuu', 'Test User', None, None)
2025-07-04 17:24:30,914 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:30,914 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:30,915 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:24:30,915 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (1,)
2025-07-04 17:24:30,916 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:24:30,916 - sqlalchemy.engine.Engine - INFO - [cached since 0.0007709s ago] (1,)
2025-07-04 17:24:30,921 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:24:30,927 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,928 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:30,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,929 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:30,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,929 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:30,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,929 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:30,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,929 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:24:30,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:30,930 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:30,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:30,931 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:30,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,932 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:30,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:30,932 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:30,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:30,933 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:30,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:30,933 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:30,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:30,934 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:30,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,935 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:30,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,936 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:30,936 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:30,936 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:30,936 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,936 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:30,936 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,936 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:30,936 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:30,937 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:30,938 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,939 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:24:30,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:30,939 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:30,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:30,940 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:30,940 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,940 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:30,940 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,941 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:30,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:30,941 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:30,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,942 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:30,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:30,942 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:30,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:30,943 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:30,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,944 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:30,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:24:30,944 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:30,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:30,945 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:30,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:30,945 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:30,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,946 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:30,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,947 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:30,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:24:30,947 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:30,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,948 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:30,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:24:30,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:30,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:30,950 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:30,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:30,950 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:30,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:24:30,951 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:30,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,952 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:30,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,952 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:30,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:24:30,953 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:24:30,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:30,954 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:30,954 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:30,955 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:24:30,955 - sqlalchemy.engine.Engine - INFO - [cached since 2.473s ago] ('test@example.com', 1, 0)
2025-07-04 17:24:30,955 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:24:30,956 - services.app - INFO - Request completed: 401
2025-07-04 17:24:30,956 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:24:31,046 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:24:31,046 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:31,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:31,048 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,048 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:31,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,049 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:31,049 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,049 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:31,049 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:24:31,050 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:31,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,050 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:31,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,051 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:31,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,052 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:31,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,052 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:31,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,053 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,053 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:31,053 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,053 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:31,053 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,053 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:31,053 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,053 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:31,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,055 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:31,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:31,056 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:31,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,056 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:31,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,057 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:31,057 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:24:31,058 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:31,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,058 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:31,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:31,059 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:31,059 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,059 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:31,059 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,060 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,060 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:24:31,060 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:31,060 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,061 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:31,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:31,061 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:31,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,062 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:31,062 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,062 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:31,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:24:31,063 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:31,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,064 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:24:31,064 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:31,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,065 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:31,065 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,066 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,066 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:24:31,066 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:31,066 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,067 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:31,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,067 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,313 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,313 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:24:31,313 - sqlalchemy.engine.Engine - INFO - [cached since 0.4005s ago] ('test@example.com', '$2b$12$rfcnT12KqSUOLhbWbvpS/O5B27Ov.iLr/3N8VbalNuGXuPrynBmry', 'Test User', None, None)
2025-07-04 17:24:31,314 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,315 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,315 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:24:31,315 - sqlalchemy.engine.Engine - INFO - [cached since 0.3998s ago] (1,)
2025-07-04 17:24:31,315 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:24:31,315 - sqlalchemy.engine.Engine - INFO - [cached since 0.4002s ago] (1,)
2025-07-04 17:24:31,316 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:24:31,318 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:31,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:31,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:31,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,320 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:31,320 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,320 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:24:31,320 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,321 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:31,321 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,322 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:31,322 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:31,323 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:31,323 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,324 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:31,324 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:31,326 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:31,326 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:31,327 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:31,327 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,327 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:31,327 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,328 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:31,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,329 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,329 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,329 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:31,329 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,329 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:31,329 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,329 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:31,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:31,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,332 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:31,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,332 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:24:31,332 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,332 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:31,332 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:31,333 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:31,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,333 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:31,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,334 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:31,334 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:31,334 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:31,334 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,335 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:31,335 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:31,336 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:31,336 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,336 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:31,336 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:31,337 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:24:31,337 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:31,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,338 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:31,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:31,338 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:31,339 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,339 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:31,339 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,340 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:31,340 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:24:31,340 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:31,341 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,341 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,341 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:24:31,342 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:31,342 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,342 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:31,342 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:31,343 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,343 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:24:31,344 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:31,344 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,344 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:31,344 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,345 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:31,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:24:31,346 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:24:31,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,346 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,347 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,347 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:24:31,347 - sqlalchemy.engine.Engine - INFO - [cached since 2.865s ago] ('test@example.com', 1, 0)
2025-07-04 17:24:31,347 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:24:31,347 - services.app - INFO - Request completed: 401
2025-07-04 17:24:31,348 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:24:31,351 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:24:31,352 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,352 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:31,352 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,352 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:31,352 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,352 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:31,352 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:31,353 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,354 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:31,354 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,355 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:31,355 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,355 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:31,355 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,356 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:31,356 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,357 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:31,357 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,358 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:31,358 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,359 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:31,359 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,359 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,359 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,359 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:31,359 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,359 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,360 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:31,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,362 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:31,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,362 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:31,362 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:31,362 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:31,363 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,363 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:31,363 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,364 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:31,364 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:24:31,364 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:31,364 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,365 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:31,365 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:31,365 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:31,365 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,366 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:31,366 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,366 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,366 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:24:31,367 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:31,367 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,367 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:31,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:24:31,368 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:31,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:31,369 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:31,369 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,369 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:31,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:24:31,370 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:31,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,371 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,371 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:24:31,371 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:31,371 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,372 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:31,372 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,372 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,373 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:24:31,373 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:31,373 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,373 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:31,374 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,374 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,620 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,620 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:24:31,620 - sqlalchemy.engine.Engine - INFO - [cached since 0.7075s ago] ('test@example.com', '$2b$12$FENCzP2UIEVB3sPKzSF61Oh83K4FtvQqrpUwlSaIvtX2Ry1CreRKi', 'Test User', None, None)
2025-07-04 17:24:31,621 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,622 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,622 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:24:31,622 - sqlalchemy.engine.Engine - INFO - [cached since 0.7069s ago] (1,)
2025-07-04 17:24:31,622 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:24:31,622 - sqlalchemy.engine.Engine - INFO - [cached since 0.7073s ago] (1,)
2025-07-04 17:24:31,623 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:24:31,625 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,625 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:31,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:31,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:31,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,627 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:24:31,627 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,628 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:24:31,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,628 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:24:31,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,629 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:24:31,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,630 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:24:31,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,630 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:24:31,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,631 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:24:31,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,631 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:24:31,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,632 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:24:31,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:24:31,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,634 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:24:31,635 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:24:31,636 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:24:31,636 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:24:31,636 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,637 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:24:31,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,637 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:24:31,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:24:31,638 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:24:31,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,638 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:24:31,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:24:31,639 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:24:31,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,639 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:24:31,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,640 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:24:31,641 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:24:31,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,641 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:31,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:24:31,642 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:24:31,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,642 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:24:31,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:24:31,643 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:24:31,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:24:31,644 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:24:31,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,644 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:24:31,645 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:24:31,645 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,645 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:24:31,645 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,646 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:24:31,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:24:31,647 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:24:31,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:24:31,647 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:24:31,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:24:31,648 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:24:31,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:24:31,649 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:24:31,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:24:31,649 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:24:31,650 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:24:31,650 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:24:31,650 - sqlalchemy.engine.Engine - INFO - [cached since 3.168s ago] ('test@example.com', 1, 0)
2025-07-04 17:24:31,650 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:24:31,651 - services.app - INFO - Request completed: 401
2025-07-04 17:24:31,651 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:24:31,654 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:26,015 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:25:30,291 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:25:30,292 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:25:32,894 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:32,897 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:32,897 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:32,901 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:32,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:32,903 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:32,903 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:32,903 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:32,903 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:32,903 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:32,903 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:33,041 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:25:33,043 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:33,043 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:33,044 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:33,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:33,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,047 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:33,048 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,048 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:33,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:33,050 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:33,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:33,052 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:33,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,053 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:33,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:33,054 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:33,054 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:33,055 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:33,055 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:33,057 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:33,057 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:33,058 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:33,059 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:33,060 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:33,060 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,061 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,062 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:33,063 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,064 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:33,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:33,065 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:33,065 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,066 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:33,066 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:33,067 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:33,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:25:33,068 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:33,068 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:25:33,069 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:33,069 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:25:33,070 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:33,070 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,070 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:33,070 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:33,071 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:33,072 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:25:33,073 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:33,073 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:33,074 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:33,074 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:25:33,075 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:33,075 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:33,076 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:33,076 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,079 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:33,079 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-07-04 17:25:33,080 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:33,080 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:33,081 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:33,082 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:25:33,082 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:33,082 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:33,083 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:33,083 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:33,085 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:33,086 - sqlalchemy.engine.Engine - INFO - [no key 0.00103s] ()
2025-07-04 17:25:33,087 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:33,087 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:33,088 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:33,088 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,089 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:33,089 - sqlalchemy.engine.Engine - INFO - [no key 0.00063s] ()
2025-07-04 17:25:33,090 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:33,090 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:33,091 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:33,104 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:33,105 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:25:33,106 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (123, 1, 0)
2025-07-04 17:25:33,107 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:25:33,107 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:25:33,108 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:33,120 - app.error_handling - ERROR - Error recorded [external_api_1751671533108] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:25:33,121 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:25:33,122 - services.app - INFO - Request completed: 503
2025-07-04 17:25:33,127 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:25:33,128 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:25:33,128 - services.app - INFO - Request completed: 200
2025-07-04 17:25:33,129 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:25:33,130 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:25:33,130 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:33,130 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:33,130 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,131 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:33,131 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,131 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:33,131 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:33,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:33,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:33,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,133 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:33,133 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,133 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:33,133 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,133 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:33,133 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,133 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:33,133 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:33,135 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:33,135 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,136 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:33,136 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:33,137 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:33,137 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,138 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:33,138 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:33,138 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:33,139 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,142 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:33,142 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:25:33,144 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:33,144 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:25:33,146 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:33,146 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:33,147 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:33,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:33,147 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:33,147 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,147 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:33,147 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,147 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,148 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:33,149 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,149 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:33,149 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,149 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:33,149 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,149 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:33,150 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,150 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:33,150 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,150 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:33,150 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,150 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:33,150 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,151 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:33,151 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,151 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:33,151 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:33,151 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:33,151 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:33,152 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:33,152 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:33,152 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:33,152 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:33,153 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:33,153 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:25:33,154 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:33,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:25:33,156 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:33,156 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:25:33,157 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:33,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,157 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:33,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:33,158 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:33,158 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:25:33,159 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:33,159 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:33,159 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:33,160 - sqlalchemy.engine.Engine - INFO - [no key 0.00089s] ()
2025-07-04 17:25:33,161 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:33,162 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:33,162 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:33,163 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:25:33,166 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:33,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00096s] ()
2025-07-04 17:25:33,169 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:33,169 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:33,170 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:33,170 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:25:33,172 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:33,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:33,172 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:33,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:33,174 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:33,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00055s] ()
2025-07-04 17:25:33,175 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:33,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00049s] ()
2025-07-04 17:25:33,177 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:33,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:33,178 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:33,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:25:33,180 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:33,180 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:25:33,181 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:33,181 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:33,182 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:25:33,182 - sqlalchemy.engine.Engine - INFO - [generated in 0.00010s] ()
2025-07-04 17:25:33,190 - services.app - INFO - Request completed: 200
2025-07-04 17:25:33,192 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:25:33,198 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:25:33,198 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:25:33,198 - services.app - INFO - Info message
2025-07-04 17:25:33,198 - services.app - WARNING - Warning message
2025-07-04 17:25:33,198 - services.app - ERROR - Error message
2025-07-04 17:25:34,008 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,009 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,023 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,023 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:34,023 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,025 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:34,025 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,025 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:34,025 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,026 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:34,026 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,027 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:34,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,027 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:34,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,027 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:34,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,027 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:34,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,028 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,044 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,044 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:34,044 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:34,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:34,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:34,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,046 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:34,046 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:34,047 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:34,047 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:34,048 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:34,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,049 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:34,049 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:34,049 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:34,049 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,050 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:34,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,051 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:34,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:34,051 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:34,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,052 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:34,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,053 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,053 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:34,053 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,053 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:34,053 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,053 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:34,053 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:34,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:34,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,056 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:34,056 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,056 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:34,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:34,056 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:34,057 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,057 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:34,057 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:34,057 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:34,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:25:34,058 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:34,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:34,060 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:34,060 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:25:34,061 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:34,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:34,061 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:34,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,062 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:34,062 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:34,062 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:34,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:34,063 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:34,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:25:34,064 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:34,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:34,064 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:34,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,065 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:34,065 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:25:34,066 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:34,066 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,066 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:34,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:25:34,067 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:34,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,068 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:34,068 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,068 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:34,069 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:25:34,069 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:34,069 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:34,070 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:34,070 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,070 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:34,070 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:25:34,071 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:34,071 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:34,071 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,072 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,072 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:25:34,073 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', 1, 0)
2025-07-04 17:25:34,073 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:25:34,073 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:25:34,074 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,076 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,077 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:25:34,077 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1,)
2025-07-04 17:25:34,079 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:25:34,079 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:25:34.077825', '2025-07-04 23:25:34.077836')
2025-07-04 17:25:34,079 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,080 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,081 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:25:34,081 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] (1,)
2025-07-04 17:25:34,083 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:34,087 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,087 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:34,087 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,087 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:34,087 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,087 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:34,087 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:34,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:34,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:34,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:34,088 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,088 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:34,089 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,089 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:34,089 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,089 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:34,089 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:34,090 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:34,090 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,090 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:34,090 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:34,091 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:34,091 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:34,092 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:34,092 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:34,093 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:34,093 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:25:34,094 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:34,094 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,095 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:34,095 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:34,095 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:34,095 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:34,096 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,096 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,096 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:34,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,096 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:34,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,096 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:34,096 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,096 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:34,097 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:34,098 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:34,099 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:34,099 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:34,099 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:34,099 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,100 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:34,100 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:34,100 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:34,100 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:25:34,101 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:34,101 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,101 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:34,102 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:34,102 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:34,102 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:34,103 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:34,103 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,103 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:34,103 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:25:34,104 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:34,104 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,104 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:34,104 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:25:34,105 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:34,105 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:34,106 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:34,106 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,106 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:34,107 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:25:34,107 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:34,107 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:34,108 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:34,108 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:25:34,109 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:34,109 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:25:34,110 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:34,110 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:34,111 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:34,111 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:25:34,112 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:34,112 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:34,112 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:34,112 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:34,113 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:34,114 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:25:34,114 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:34,114 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:34,115 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,115 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,117 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:25:34,118 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ()
2025-07-04 17:25:34,119 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:25:34,119 - sqlalchemy.engine.Engine - INFO - [cached since 0.04631s ago] ('test@example.com', 1, 0)
2025-07-04 17:25:34,119 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:25:34,119 - sqlalchemy.engine.Engine - INFO - [cached since 0.0459s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:25:34,120 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,120 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,120 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:25:34,120 - sqlalchemy.engine.Engine - INFO - [cached since 0.04355s ago] (1,)
2025-07-04 17:25:34,121 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:25:34,121 - sqlalchemy.engine.Engine - INFO - [cached since 0.04246s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:25:34.120947', '2025-07-04 23:25:34.120950')
2025-07-04 17:25:34,121 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:34,122 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:34,122 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:25:34,122 - sqlalchemy.engine.Engine - INFO - [cached since 0.04113s ago] (1,)
2025-07-04 17:25:34,122 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:34,129 - services.app - INFO - Request started: GET /health
2025-07-04 17:25:34,129 - services.app - INFO - Request completed: 200
2025-07-04 17:25:34,130 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:25:34,131 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:25:34,132 - services.app - INFO - Request completed: 200
2025-07-04 17:25:34,132 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:25:34,160 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:25:34,160 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:25:36,101 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,102 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,103 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,103 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,103 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,103 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,103 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,103 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,103 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:36,103 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,105 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:36,105 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,106 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:36,106 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,107 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:36,107 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,109 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:36,109 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:25:36,111 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:36,111 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:25:36,112 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:36,112 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:36,113 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:36,113 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:36,114 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,114 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,114 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,114 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,115 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:36,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,117 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:36,117 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:36,118 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:36,118 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,119 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:36,119 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:36,119 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:36,119 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:25:36,120 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:36,120 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,121 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:36,121 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,121 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:36,121 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,122 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:36,122 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,122 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,122 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:36,123 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:36,123 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,123 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,124 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,124 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:36,124 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,124 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:36,124 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,127 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:36,128 - sqlalchemy.engine.Engine - INFO - [no key 0.00093s] ()
2025-07-04 17:25:36,129 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:36,129 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:36,129 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,130 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:25:36,130 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:36,130 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,131 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:36,131 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,131 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,132 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:25:36,132 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:36,132 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,133 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:36,133 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,133 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,134 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:25:36,135 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,135 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,135 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,135 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,135 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,135 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,136 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,137 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,137 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:36,137 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,138 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:36,138 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:36,138 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:36,138 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,139 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:36,139 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,140 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:36,140 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,140 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:36,140 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,141 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:36,141 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,141 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:36,142 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:25:36,144 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:36,144 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:36,146 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,147 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:36,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,149 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:36,149 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:36,150 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:36,150 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,150 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:36,150 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,151 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:36,151 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:36,152 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:36,152 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:25:36,153 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:36,153 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:36,153 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:36,153 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,154 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:36,154 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,155 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:25:36,155 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:36,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,156 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,156 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:36,157 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:36,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,157 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:36,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,158 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:36,160 - sqlalchemy.engine.Engine - INFO - [no key 0.00186s] ()
2025-07-04 17:25:36,161 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:36,162 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:25:36,163 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,163 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:25:36,164 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:36,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:36,165 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:36,165 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,166 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:25:36,166 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:36,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,167 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:36,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,168 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:25:36,170 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:36,170 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:25:36,171 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,171 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,172 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:25:36,172 - sqlalchemy.engine.Engine - INFO - [cached since 2.099s ago] ('test@example.com', 1, 0)
2025-07-04 17:25:36,173 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:25:36,483 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:25:36,484 - sqlalchemy.engine.Engine - INFO - [cached since 2.41s ago] ('test@example.com', '$2b$12$S1eP9ATJVBBMwUsUTP4Hv.4WhT2K7DbFyJvOu90TdvD1HIgmDmbBq', None, None, None)
2025-07-04 17:25:36,485 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,486 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,486 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:25:36,486 - sqlalchemy.engine.Engine - INFO - [cached since 2.41s ago] (1,)
2025-07-04 17:25:36,488 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:25:36,489 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1,)
2025-07-04 17:25:36,490 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:36,491 - services.app - INFO - Request completed: 201
2025-07-04 17:25:36,493 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:25:36,495 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:25:36,501 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,501 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,501 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,502 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,503 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,503 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:36,503 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,504 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:36,504 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:25:36,505 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:36,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:25:36,506 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:36,506 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,507 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:36,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,507 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:36,508 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,508 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:36,509 - sqlalchemy.engine.Engine - INFO - [no key 0.00055s] ()
2025-07-04 17:25:36,510 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:36,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:25:36,511 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:36,511 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:25:36,512 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,512 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,512 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,512 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,513 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,514 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:36,515 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,516 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:36,516 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:36,516 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:36,516 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,517 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:36,517 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,518 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:36,518 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:36,518 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:36,518 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,519 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:36,519 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:36,520 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:36,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,520 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:36,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,521 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,521 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:36,521 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:36,522 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,522 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,522 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:36,523 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:36,523 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,523 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:36,523 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,524 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:36,524 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:25:36,524 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:36,525 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,526 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,526 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:25:36,527 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:36,527 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,528 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:36,528 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,529 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,529 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:25:36,530 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:36,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,530 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:36,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,531 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,531 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:25:36,532 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:36,532 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,532 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,533 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,533 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:25:36,533 - sqlalchemy.engine.Engine - INFO - [cached since 2.46s ago] ('test@example.com', 1, 0)
2025-07-04 17:25:36,533 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:36,533 - services.app - INFO - Request completed: 401
2025-07-04 17:25:36,534 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:25:36,602 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,602 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,602 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,603 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,604 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,604 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,604 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,604 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:36,604 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,605 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:36,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,605 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:36,605 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,606 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:36,606 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,606 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:36,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,607 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:36,607 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,608 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:36,608 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,609 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:36,609 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:25:36,610 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,610 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,610 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,610 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,610 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:36,610 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,610 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,610 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:36,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:36,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,613 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:36,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:36,613 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:36,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,614 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:36,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,614 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:36,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:36,615 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:36,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,615 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:36,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,616 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:36,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,616 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:36,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,617 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,617 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:25:36,617 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:36,617 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,618 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,618 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:36,618 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:36,618 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,619 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:36,619 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,619 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:36,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:25:36,620 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:36,620 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,621 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:25:36,621 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:36,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,622 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:36,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,622 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,623 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:25:36,623 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:36,623 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,624 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:36,624 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:25:36,625 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,626 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:25:36,627 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:36,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:25:36,629 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:36,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,630 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:36,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,630 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:36,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,631 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:36,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,632 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:36,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,632 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:36,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,633 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:36,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,633 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:36,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:25:36,634 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,634 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,634 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,634 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:36,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,634 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:36,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,637 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:36,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,637 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:36,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:36,637 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:36,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,638 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:36,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,639 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:36,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:25:36,640 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:36,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,640 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:36,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:25:36,642 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:36,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:25:36,644 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:36,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:25:36,645 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,645 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:25:36,646 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:36,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,646 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,647 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:36,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,647 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:36,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,648 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:36,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:25:36,649 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:36,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,650 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:25:36,650 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:36,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,651 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:36,651 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,652 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,652 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:25:36,652 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:36,652 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,653 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:36,653 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,654 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,654 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:25:36,654 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:36,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,655 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,655 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,656 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:25:36,656 - sqlalchemy.engine.Engine - INFO - [cached since 2.583s ago] ('test@example.com', 1, 0)
2025-07-04 17:25:36,912 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:25:36,912 - sqlalchemy.engine.Engine - INFO - [cached since 2.839s ago] ('test@example.com', '$2b$12$c/7RNZsTP78W9x0C/E0KtuAfouNQ9cxRwBAD1nbVqOP8yIeiPEhPq', None, None, None)
2025-07-04 17:25:36,913 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,914 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,914 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:25:36,914 - sqlalchemy.engine.Engine - INFO - [cached since 2.837s ago] (1,)
2025-07-04 17:25:36,915 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:25:36,915 - sqlalchemy.engine.Engine - INFO - [cached since 0.4264s ago] (1,)
2025-07-04 17:25:36,915 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:36,915 - services.app - INFO - Request completed: 201
2025-07-04 17:25:36,916 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:25:36,917 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:25:36,919 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,919 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,919 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,920 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,921 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:36,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,922 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:36,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,922 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:36,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,923 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:36,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,924 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:36,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,925 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:36,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:25:36,926 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:36,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:25:36,927 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:36,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:25:36,928 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:36,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,929 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,929 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,929 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,929 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:36,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,929 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,929 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,930 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:36,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,930 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:36,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,930 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,930 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,931 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,932 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:36,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,932 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:36,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,932 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:36,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:36,933 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:36,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,933 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:36,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,934 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:36,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:25:36,935 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:36,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,935 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:36,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,936 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:36,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,936 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:36,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,937 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:25:36,937 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:36,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,938 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,939 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:36,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,939 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:36,940 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,940 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:36,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:25:36,941 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:36,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,943 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-07-04 17:25:36,944 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:36,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:36,945 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:36,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,946 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:25:36,947 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:36,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,948 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:36,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,948 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:25:36,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:36,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,950 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,951 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,951 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:25:36,951 - sqlalchemy.engine.Engine - INFO - [cached since 2.878s ago] ('test@example.com', 1, 0)
2025-07-04 17:25:36,951 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:36,951 - services.app - INFO - Request completed: 401
2025-07-04 17:25:36,952 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:25:36,955 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,955 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,955 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,955 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,955 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,955 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,955 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,956 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:36,957 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,957 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:36,958 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,959 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:36,960 - sqlalchemy.engine.Engine - INFO - [no key 0.00048s] ()
2025-07-04 17:25:36,961 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:36,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:36,962 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:36,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:36,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:36,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:36,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,964 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:36,964 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,965 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,965 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,965 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,965 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:36,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,965 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:36,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:36,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,968 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:36,968 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:36,968 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:36,968 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,969 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:36,969 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,970 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:36,970 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:36,970 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:36,970 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,971 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:36,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,971 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:36,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,972 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:36,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,973 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:25:36,973 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:36,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,974 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:36,974 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:36,976 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:36,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:25:36,976 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:36,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:36,977 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:36,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:25:36,978 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:36,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,978 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:25:36,979 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:36,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,980 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:36,980 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,981 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:36,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:25:36,981 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:36,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,982 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:36,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,982 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,983 - services.app - INFO - Request started: POST /auth/register
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,985 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,985 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,985 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,985 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:36,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:25:36,986 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:36,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,986 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:36,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,987 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:36,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:25:36,987 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:36,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,988 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:36,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,989 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:36,989 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,989 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:36,989 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:36,990 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:36,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:25:36,993 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:36,993 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:36,993 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:36,993 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,993 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:36,993 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,993 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:36,993 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:36,994 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,995 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:36,996 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:36,996 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:36,996 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:36,997 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:36,997 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:25:36,998 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:36,998 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:36,998 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:36,998 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:36,999 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:36,999 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:36,999 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:37,000 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:25:37,000 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:37,000 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:37,001 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:37,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,001 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:37,001 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:37,002 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:37,002 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:37,003 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:37,003 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:37,003 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:37,004 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:37,004 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:37,004 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:37,005 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:37,005 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:25:37,006 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:37,006 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,006 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:37,007 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:25:37,008 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:37,008 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:37,009 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:37,009 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-07-04 17:25:37,010 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:37,011 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:25:37,011 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:37,012 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:37,012 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:37,012 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,013 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:37,013 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:25:37,014 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:37,014 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,014 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:37,015 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:37,015 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:25:37,015 - sqlalchemy.engine.Engine - INFO - [cached since 2.943s ago] ('test@example.com', 1, 0)
2025-07-04 17:25:37,269 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:25:37,269 - sqlalchemy.engine.Engine - INFO - [cached since 3.195s ago] ('test@example.com', '$2b$12$u7t59S2NvJl42SdvmDbHN.eoANuPm3cC..wcjjU9mf0JU2vSS4dj6', None, None, None)
2025-07-04 17:25:37,269 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:37,270 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:37,270 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:25:37,270 - sqlalchemy.engine.Engine - INFO - [cached since 3.194s ago] (1,)
2025-07-04 17:25:37,271 - sqlalchemy.engine.Engine - INFO - SELECT strategies.id AS strategies_id, strategies.user_id AS strategies_user_id, strategies.name AS strategies_name, strategies.description AS strategies_description, strategies.rebalance_threshold AS strategies_rebalance_threshold 
FROM strategies 
WHERE ? = strategies.user_id
2025-07-04 17:25:37,271 - sqlalchemy.engine.Engine - INFO - [cached since 0.7826s ago] (1,)
2025-07-04 17:25:37,272 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:37,272 - services.app - INFO - Request completed: 201
2025-07-04 17:25:37,273 - httpx - INFO - HTTP Request: POST http://testserver/auth/register "HTTP/1.1 201 Created"
2025-07-04 17:25:37,273 - services.app - INFO - Request started: POST /auth/token
2025-07-04 17:25:37,277 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:37,277 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:37,277 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:37,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:37,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:37,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:37,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,278 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:37,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,279 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:37,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,279 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:37,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,279 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:37,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,280 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:25:37,280 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,281 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:25:37,281 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,282 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:25:37,282 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:37,283 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:25:37,283 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,284 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:25:37,284 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,285 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:25:37,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:25:37,285 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:25:37,285 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:37,286 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:25:37,286 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,287 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:25:37,287 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:37,287 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:37,287 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:37,287 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:25:37,287 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,288 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,289 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:25:37,290 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,290 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:25:37,290 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,290 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:25:37,290 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,290 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:25:37,290 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,290 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:25:37,290 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:25:37,291 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:25:37,292 - sqlalchemy.engine.Engine - INFO - [no key 0.00082s] ()
2025-07-04 17:25:37,293 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:25:37,293 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:25:37,294 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:25:37,294 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:37,294 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:25:37,295 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:37,295 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:25:37,295 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,296 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:25:37,296 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:25:37,296 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:25:37,296 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,297 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:25:37,297 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,297 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:25:37,297 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:25:37,298 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:25:37,298 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,298 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:37,299 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:25:37,299 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:25:37,299 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:25:37,300 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:25:37,300 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:37,300 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:25:37,301 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:25:37,301 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:25:37,301 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,302 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:37,302 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:25:37,302 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:25:37,302 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,303 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:25:37,303 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:37,304 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:25:37,304 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:25:37,304 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:25:37,304 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:25:37,305 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:25:37,305 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:25:37,305 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:25:37,306 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:25:37,306 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:25:37,306 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:25:37,307 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:25:37,308 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:25:37,309 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:25:37,309 - sqlalchemy.engine.Engine - INFO - [cached since 3.237s ago] ('test@example.com', 1, 0)
2025-07-04 17:25:37,310 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:25:37,310 - services.app - INFO - Request completed: 401
2025-07-04 17:25:37,311 - httpx - INFO - HTTP Request: POST http://testserver/auth/token "HTTP/1.1 401 Unauthorized"
2025-07-04 17:26:42,840 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:26:47,832 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:26:47,832 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:26:50,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:50,517 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:50,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,520 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:50,520 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,520 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:50,520 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,521 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:50,521 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,521 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:50,521 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,521 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:50,521 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,521 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:50,521 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,522 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:50,522 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,522 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:26:50,522 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,523 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:50,678 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:26:50,679 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:50,679 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:50,680 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,681 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:50,681 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,681 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:50,681 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,681 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:26:50,681 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,682 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:26:50,682 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:50,683 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:26:50,683 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:50,684 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:26:50,684 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,685 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:26:50,685 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:50,686 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:26:50,686 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:50,686 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:26:50,686 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,688 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:26:50,688 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:26:50,690 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:26:50,690 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:26:50,691 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:26:50,691 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:26:50,692 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:50,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:26:50,694 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,695 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:26:50,695 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:26:50,696 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:26:50,696 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,696 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:26:50,696 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,697 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:26:50,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:26:50,697 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:26:50,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,698 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:26:50,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:50,698 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:26:50,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,699 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:26:50,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,700 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:26:50,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:26:50,700 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:26:50,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,701 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:50,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:26:50,701 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:26:50,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:50,702 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:26:50,702 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,704 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:26:50,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:26:50,705 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:26:50,706 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:26:50,706 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:50,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:26:50,707 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:26:50,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:26:50,708 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:26:50,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,709 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:50,709 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:26:50,709 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:26:50,709 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:50,710 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:26:50,710 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:26:50,711 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:50,711 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:26:50,712 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:26:50,712 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:50,726 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:50,728 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:26:50,728 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (123, 1, 0)
2025-07-04 17:26:50,730 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:26:50,730 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:26:50,730 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:26:50,739 - app.error_handling - ERROR - Error recorded [external_api_1751671610730] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:26:50,740 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:26:50,740 - services.app - INFO - Request completed: 503
2025-07-04 17:26:50,742 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:26:50,743 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:26:50,743 - services.app - INFO - Request completed: 200
2025-07-04 17:26:50,744 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:26:50,744 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:26:50,745 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:50,745 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:50,745 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,745 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:50,745 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,745 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:50,745 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,745 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:50,745 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,746 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:26:50,747 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,748 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:26:50,748 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:50,748 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:26:50,749 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,749 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:26:50,749 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:50,750 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:26:50,750 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:50,750 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:26:50,750 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,751 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:26:50,751 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:50,751 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:26:50,751 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,752 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:26:50,752 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,753 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:50,753 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:50,753 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:50,753 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,753 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:26:50,753 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,753 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:50,753 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,754 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:26:50,754 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,754 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:50,754 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,754 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:26:50,755 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,755 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:50,755 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,755 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:26:50,755 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,755 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:50,755 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,755 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:26:50,755 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:26:50,756 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,757 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:26:50,757 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:50,757 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:26:50,757 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:26:50,758 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:26:50,758 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,758 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:26:50,758 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:26:50,759 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:26:50,759 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:26:50,760 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:26:50,760 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,760 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:26:50,760 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:50,761 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:26:50,761 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:50,761 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:26:50,761 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:50,762 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:26:50,762 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:26:50,762 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:26:50,762 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:50,763 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:50,763 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:26:50,763 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:26:50,763 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:50,764 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:26:50,764 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,764 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:26:50,765 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:26:50,765 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:26:50,765 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:50,766 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:50,766 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:26:50,767 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:26:50,767 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,767 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:26:50,767 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,768 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:50,768 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:26:50,769 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:26:50,769 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:50,769 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:26:50,769 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:50,770 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:50,770 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:26:50,772 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:26:50,772 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:26:50,772 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:50,773 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:50,773 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:26:50,773 - sqlalchemy.engine.Engine - INFO - [generated in 0.00009s] ()
2025-07-04 17:26:50,782 - services.app - INFO - Request completed: 200
2025-07-04 17:26:50,783 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:26:50,789 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:26:50,789 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:26:50,789 - services.app - INFO - Info message
2025-07-04 17:26:50,790 - services.app - WARNING - Warning message
2025-07-04 17:26:50,790 - services.app - ERROR - Error message
2025-07-04 17:26:51,885 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,886 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,900 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,900 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:51,900 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,901 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:51,901 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,901 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:51,901 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,902 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,915 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:51,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:51,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:51,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:51,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:26:51,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,918 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:26:51,918 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,919 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:26:51,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:26:51,919 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:26:51,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,920 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:26:51,920 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,921 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:26:51,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,922 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:26:51,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:26:51,923 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:26:51,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:26:51,924 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:26:51,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,924 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:26:51,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,925 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,925 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,925 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:51,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,925 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:26:51,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,925 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:51,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,925 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:51,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:26:51,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,928 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:26:51,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:26:51,928 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:26:51,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,929 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:26:51,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,930 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:26:51,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:26:51,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:26:51,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,931 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:26:51,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:26:51,931 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:26:51,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,932 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:26:51,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,932 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:26:51,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:26:51,933 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:26:51,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,934 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:51,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:26:51,934 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:26:51,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:51,935 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:26:51,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:51,936 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:26:51,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:26:51,936 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:26:51,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,937 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:51,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:26:51,938 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:26:51,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:26:51,940 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:26:51,940 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:51,940 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:51,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:26:51,941 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:26:51,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:26:51,942 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:26:51,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:51,943 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:51,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:26:51,943 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:26:51,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,944 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,945 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,945 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:26:51,946 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', 1, 0)
2025-07-04 17:26:51,946 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:26:51,946 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:26:51,947 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,948 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,949 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:26:51,949 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1,)
2025-07-04 17:26:51,950 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:26:51,950 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:26:51.949568', '2025-07-04 23:26:51.949572')
2025-07-04 17:26:51,951 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,951 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,952 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:26:51,953 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (1,)
2025-07-04 17:26:51,953 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:26:51,958 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:51,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:51,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:51,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:51,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:26:51,959 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,960 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:26:51,960 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,960 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:26:51,960 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,961 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:26:51,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,962 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:26:51,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,962 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:26:51,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:26:51,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:51,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:26:51,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:51,964 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:26:51,965 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:51,965 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:26:51,965 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:26:51,968 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:51,969 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:26:51,969 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:26:51,969 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:26:51,969 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,970 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:26:51,970 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,970 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:26:51,970 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:26:51,971 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:26:51,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 17:26:51,973 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:26:51,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:26:51,974 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:26:51,974 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:26:51,975 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:26:51,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,975 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:26:51,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:26:51,976 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:26:51,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,976 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:51,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:26:51,977 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:26:51,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:51,978 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:26:51,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:26:51,979 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:26:51,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:26:51,979 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:26:51,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,980 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:51,980 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:26:51,981 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:26:51,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:51,981 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:26:51,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,982 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:51,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:26:51,983 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:26:51,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:26:51,983 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:26:51,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:51,984 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:51,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:26:51,985 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:26:51,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:51,985 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,985 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,989 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:26:51,989 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] ()
2025-07-04 17:26:51,990 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:26:51,990 - sqlalchemy.engine.Engine - INFO - [cached since 0.04478s ago] ('test@example.com', 1, 0)
2025-07-04 17:26:51,990 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:26:51,991 - sqlalchemy.engine.Engine - INFO - [cached since 0.04431s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:26:51,991 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,992 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,992 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:26:51,992 - sqlalchemy.engine.Engine - INFO - [cached since 0.04328s ago] (1,)
2025-07-04 17:26:51,992 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:26:51,993 - sqlalchemy.engine.Engine - INFO - [cached since 0.04243s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:26:51.992537', '2025-07-04 23:26:51.992540')
2025-07-04 17:26:51,993 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:51,993 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:51,994 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:26:51,994 - sqlalchemy.engine.Engine - INFO - [cached since 0.04163s ago] (1,)
2025-07-04 17:26:51,994 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:26:51,999 - services.app - INFO - Request started: GET /health
2025-07-04 17:26:51,999 - services.app - INFO - Request completed: 200
2025-07-04 17:26:52,000 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:26:52,001 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:26:52,002 - services.app - INFO - Request completed: 200
2025-07-04 17:26:52,003 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:26:52,033 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:26:52,034 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:26:54,043 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:54,044 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:54,044 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,044 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:54,044 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,044 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:54,044 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,044 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:54,044 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:26:54,045 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,048 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:26:54,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:26:54,049 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:26:54,049 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,050 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:26:54,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:26:54,051 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:26:54,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,052 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:26:54,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,052 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:26:54,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,053 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:26:54,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,053 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:54,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:54,054 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:54,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,054 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:26:54,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,054 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:54,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,054 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:26:54,054 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:54,055 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,056 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:26:54,057 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,057 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:26:54,057 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:26:54,058 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:26:54,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:26:54,058 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:26:54,058 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,059 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:26:54,059 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:26:54,060 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:26:54,060 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,060 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:26:54,060 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:26:54,061 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:26:54,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,061 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:26:54,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,062 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:26:54,062 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:26:54,063 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:26:54,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,063 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:54,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:54,064 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:26:54,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,064 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:26:54,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,065 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:26:54,065 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:26:54,066 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:26:54,066 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,066 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:54,066 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:26:54,067 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:26:54,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,068 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:26:54,068 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,068 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:54,068 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:26:54,069 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:26:54,069 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,069 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:26:54,070 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,070 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:54,162 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:54,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:54,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:54,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:54,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,163 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:26:54,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,164 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:26:54,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:26:54,165 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:26:54,165 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,165 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:26:54,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,166 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:26:54,166 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,167 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:26:54,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:26:54,167 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:26:54,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,168 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:26:54,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,168 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:54,168 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:54,168 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:54,168 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,169 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,170 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:54,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,171 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:26:54,171 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,171 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:26:54,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:26:54,173 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:26:54,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:54,173 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:26:54,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,174 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:26:54,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:26:54,174 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:26:54,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,175 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:26:54,175 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:54,176 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:26:54,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:26:54,176 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:26:54,176 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,177 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:26:54,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:26:54,177 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:26:54,177 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,178 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:54,178 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:26:54,179 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:26:54,179 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:26:54,180 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:26:54,180 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:26:54,181 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:26:54,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00044s] ()
2025-07-04 17:26:54,182 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:26:54,182 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:26:54,183 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:54,183 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:26:54,184 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:26:54,184 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,184 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:26:54,184 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,185 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:54,185 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:26:54,186 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:26:54,186 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:26:54,186 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:26:54,186 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,187 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:54,191 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:54,191 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:54,191 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,191 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:54,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,193 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:54,193 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,193 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:26:54,193 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,194 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:26:54,194 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:26:54,195 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:26:54,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,195 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:26:54,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,196 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:26:54,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,196 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:26:54,196 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,197 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:26:54,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,197 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:26:54,197 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,198 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:26:54,198 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:26:54,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:26:54,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,198 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:26:54,198 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,198 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,199 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:26:54,200 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:26:54,201 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:26:54,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:26:54,201 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:26:54,201 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:26:54,202 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:26:54,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,202 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:26:54,202 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:26:54,203 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:26:54,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,203 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:26:54,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:54,204 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:26:54,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,204 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:26:54,205 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:26:54,206 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:26:54,206 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:26:54,207 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:26:54,207 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:26:54,207 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:26:54,207 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:26:54,208 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:26:54,208 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,209 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:26:54,209 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,209 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:26:54,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:26:54,210 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:26:54,210 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,211 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:54,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:26:54,212 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:26:54,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,212 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:26:54,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:26:54,213 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:26:54,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:26:54,213 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:26:54,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:26:54,214 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:26:54,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:26:54,214 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:17,530 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:27:22,039 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:27:22,039 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:27:24,548 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:24,549 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:24,549 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,552 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:24,553 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,553 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:24,553 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,553 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:24,553 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,553 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:24,553 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,554 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:24,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,554 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:24,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,554 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:24,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:27:24,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,558 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:24,691 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:27:24,692 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:24,692 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:24,692 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,692 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:24,692 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,692 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:24,692 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,692 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:27:24,693 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,694 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:27:24,694 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,695 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:27:24,695 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,697 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:27:24,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,698 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:27:24,698 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,699 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:27:24,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,699 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:27:24,699 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:24,701 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:27:24,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,703 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:27:24,703 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:27:24,704 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:27:24,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:27:24,705 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:24,705 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:24,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:24,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,705 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:27:24,705 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,705 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,706 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,707 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:24,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,708 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:27:24,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,708 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:27:24,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,708 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:27:24,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,709 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:27:24,709 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:27:24,710 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:27:24,710 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,710 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:27:24,710 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,711 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:27:24,712 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:27:24,712 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:27:24,712 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,713 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:27:24,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:27:24,714 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:27:24,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,714 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:27:24,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:24,715 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:27:24,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:27:24,716 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:27:24,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,717 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:24,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 17:27:24,719 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:27:24,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:27:24,720 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:27:24,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:27:24,722 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:27:24,723 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-07-04 17:27:24,724 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:27:24,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:27:24,725 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:24,725 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:27:24,726 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:27:24,726 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,726 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:27:24,726 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,727 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:24,728 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:27:24,728 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:27:24,728 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:24,729 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:27:24,729 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,730 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:24,730 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:27:24,731 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:27:24,731 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,732 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:24,746 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:24,748 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:27:24,748 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] (123, 1, 0)
2025-07-04 17:27:24,749 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:27:24,749 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:27:24,750 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:27:24,758 - app.error_handling - ERROR - Error recorded [external_api_1751671644750] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:27:24,759 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:27:24,760 - services.app - INFO - Request completed: 503
2025-07-04 17:27:24,762 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:27:24,762 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:27:24,763 - services.app - INFO - Request completed: 200
2025-07-04 17:27:24,763 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:27:24,764 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:24,765 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:27:24,766 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:24,767 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:27:24,767 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,768 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:27:24,768 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,769 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:27:24,769 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:24,769 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:27:24,769 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,770 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:27:24,770 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:24,770 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:27:24,771 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:24,771 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:27:24,771 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,772 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:27:24,772 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,772 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:24,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:27:24,773 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,774 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:27:24,775 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:24,776 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:27:24,776 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:27:24,776 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:27:24,776 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,777 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:27:24,777 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,777 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:27:24,777 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:27:24,778 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:27:24,778 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:24,778 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:27:24,779 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:27:24,779 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:27:24,779 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,780 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:27:24,780 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:24,780 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:27:24,780 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:27:24,781 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:27:24,781 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:24,782 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:24,782 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:27:24,782 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:27:24,782 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,783 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:27:24,783 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,784 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:27:24,784 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:27:24,785 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:27:24,785 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,785 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:24,786 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:27:24,786 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:27:24,786 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,787 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:27:24,787 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,788 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:24,788 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:27:24,788 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:27:24,789 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,789 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:27:24,789 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:24,790 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:24,790 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-07-04 17:27:24,791 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:27:24,792 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:24,792 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:24,793 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:24,793 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:27:24,793 - sqlalchemy.engine.Engine - INFO - [generated in 0.00010s] ()
2025-07-04 17:27:24,806 - services.app - INFO - Request completed: 200
2025-07-04 17:27:24,807 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:27:24,815 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:27:24,816 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:27:24,816 - services.app - INFO - Info message
2025-07-04 17:27:24,816 - services.app - WARNING - Warning message
2025-07-04 17:27:24,816 - services.app - ERROR - Error message
2025-07-04 17:27:25,403 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,404 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,420 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:25,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:25,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:25,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:25,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:25,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:25,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:25,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,423 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:25,423 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,423 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:25,434 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:25,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:25,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:25,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:27:25,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,435 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:27:25,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,436 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:27:25,436 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,437 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:27:25,437 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,438 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:27:25,438 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:25,439 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:27:25,439 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,439 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:27:25,439 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,440 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:27:25,440 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,440 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:27:25,441 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:25,441 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:27:25,441 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,442 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,442 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,442 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:25,442 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,442 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:27:25,442 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,442 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:25,442 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:25,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:27:25,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,445 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:27:25,445 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,445 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:27:25,445 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,445 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:27:25,445 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:27:25,446 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:27:25,446 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:27:25,447 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:27:25,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,447 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:27:25,447 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:27:25,448 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:27:25,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,449 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:27:25,449 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:27:25,449 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:27:25,449 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,450 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:27:25,450 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,451 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:27:25,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:27:25,451 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:27:25,451 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,452 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:25,452 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:27:25,452 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:27:25,452 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,453 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:27:25,453 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:25,454 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:27:25,456 - sqlalchemy.engine.Engine - INFO - [no key 0.00206s] ()
2025-07-04 17:27:25,457 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:27:25,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,457 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:25,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:27:25,458 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:27:25,458 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,459 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:27:25,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,459 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:25,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:27:25,460 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:27:25,460 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,461 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:27:25,461 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,461 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:25,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:27:25,462 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:27:25,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,463 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,463 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,464 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:27:25,464 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ('test@example.com', 1, 0)
2025-07-04 17:27:25,465 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:27:25,465 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:27:25,467 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,468 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,469 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:27:25,469 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1,)
2025-07-04 17:27:25,470 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:27:25,470 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:27:25.469431', '2025-07-04 23:27:25.469434')
2025-07-04 17:27:25,471 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,471 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,472 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:27:25,473 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (1,)
2025-07-04 17:27:25,474 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:27:25,479 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,479 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:25,479 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,479 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:25,479 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:25,480 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,481 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:27:25,481 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,481 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:27:25,481 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,482 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:27:25,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,482 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:27:25,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,483 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:27:25,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,484 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:27:25,484 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:25,485 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:27:25,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:25,485 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:27:25,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:25,486 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:27:25,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:25,486 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:27:25,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,487 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,487 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,487 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:25,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,487 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:27:25,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:27:25,489 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,490 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:25,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,490 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:27:25,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,490 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:27:25,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,490 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:27:25,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:25,491 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:27:25,491 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:27:25,492 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:27:25,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:25,493 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:27:25,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:25,494 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:27:25,494 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:27:25,495 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:27:25,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:25,495 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:27:25,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:27:25,496 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:27:25,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,497 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:27:25,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:27:25,498 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:27:25,498 - sqlalchemy.engine.Engine - INFO - [no key 0.00022s] ()
2025-07-04 17:27:25,499 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:27:25,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:25,499 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:25,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:27:25,500 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:27:25,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:25,501 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:27:25,501 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:27:25,502 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:27:25,502 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:27:25,503 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:27:25,503 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,504 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:25,504 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:27:25,505 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:27:25,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,505 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:27:25,506 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,506 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:25,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:27:25,508 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:27:25,508 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:25,508 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:27:25,508 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:25,509 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:25,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:27:25,510 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:27:25,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:25,511 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,511 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,514 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:27:25,514 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ()
2025-07-04 17:27:25,515 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:27:25,515 - sqlalchemy.engine.Engine - INFO - [cached since 0.05096s ago] ('test@example.com', 1, 0)
2025-07-04 17:27:25,515 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:27:25,515 - sqlalchemy.engine.Engine - INFO - [cached since 0.05057s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:27:25,516 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,516 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,516 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:27:25,516 - sqlalchemy.engine.Engine - INFO - [cached since 0.04797s ago] (1,)
2025-07-04 17:27:25,517 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:27:25,517 - sqlalchemy.engine.Engine - INFO - [cached since 0.04723s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:27:25.517160', '2025-07-04 23:27:25.517163')
2025-07-04 17:27:25,517 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:25,518 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:25,518 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:27:25,518 - sqlalchemy.engine.Engine - INFO - [cached since 0.04604s ago] (1,)
2025-07-04 17:27:25,519 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:27:25,523 - services.app - INFO - Request started: GET /health
2025-07-04 17:27:25,524 - services.app - INFO - Request completed: 200
2025-07-04 17:27:25,525 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:27:25,527 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:27:25,528 - services.app - INFO - Request completed: 200
2025-07-04 17:27:25,528 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:27:25,568 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:27:25,568 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:27:27,472 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:27,473 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:27,473 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:27,474 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,475 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:27,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,475 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:27:27,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:27:27,478 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:27:27,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:27:27,479 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:27:27,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,482 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:27:27,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:27:27,482 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:27:27,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,483 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:27:27,483 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,484 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:27:27,484 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:27:27,485 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:27:27,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,486 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:27,486 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:27,486 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:27,486 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,486 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:27:27,486 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,486 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:27,486 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,487 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:27:27,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,489 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:27:27,489 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:27:27,490 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:27:27,490 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:27:27,491 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:27:27,491 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:27,491 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:27:27,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:27:27,492 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:27:27,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:27,493 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:27:27,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:27:27,494 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:27:27,494 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:27:27,494 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:27:27,494 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:27,495 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:27:27,495 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:27:27,496 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:27:27,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:27,496 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:27,496 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:27:27,497 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:27:27,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,497 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:27:27,498 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:27,498 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:27:27,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-07-04 17:27:27,499 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:27:27,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:27,500 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:27,500 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:27:27,508 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:27:27,508 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:27:27,509 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:27:27,509 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:27:27,510 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:27,510 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-07-04 17:27:27,511 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:27:27,511 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:27,511 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:27:27,511 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:27:27,512 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:27,513 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:27:27,846 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:27,847 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:27:27,848 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ('test@example.com', '$2b$12$0v8t9py7D3/2anSuaoikFeN4aESQDAZydBrKvkECIf37H6iPNYnxS', 'Test User', None, None)
2025-07-04 17:27:27,850 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:27,852 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:27,856 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:27:27,857 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (1,)
2025-07-04 17:27:27,857 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:27:27,857 - sqlalchemy.engine.Engine - INFO - [cached since 0.001109s ago] (1,)
2025-07-04 17:27:27,956 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:27:27,957 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:27,957 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:27,957 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,957 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:27,957 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,957 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:27,958 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,959 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:27:27,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:27,960 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:27:27,960 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:27,960 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:27:27,960 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,961 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:27:27,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,962 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:27:27,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:27,962 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:27:27,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:27:27,963 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:27:27,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:27,964 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:27:27,964 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,964 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:27,964 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:27,964 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:27:27,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,966 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:27,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:27:27,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,967 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:27,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,967 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:27:27,967 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:27,967 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:27:27,967 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:27:27,968 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:27:27,968 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:27,968 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:27:27,968 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,969 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:27:27,969 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:27:27,970 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:27:27,970 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:27:27,971 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:27:27,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:27:27,971 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:27:27,971 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,972 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:27:27,972 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:27,973 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:27:27,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:27:27,974 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:27:27,974 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:27,975 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:27,975 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:27:27,976 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:27:27,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:27,976 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:27:27,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:27,977 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:27:27,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00044s] ()
2025-07-04 17:27:27,978 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:27:27,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,979 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:27,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:27:27,979 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:27:27,979 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,980 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:27:27,980 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,981 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:27,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:27:27,981 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:27:27,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,982 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:27:27,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:27,982 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:28,235 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:28,235 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:27:28,235 - sqlalchemy.engine.Engine - INFO - [cached since 0.3879s ago] ('test@example.com', '$2b$12$IWAec/K3NpeioHdR9yrZG.twjTau/Ucrpik33wi.LJ/y3nGVPJTLe', 'Test User', None, None)
2025-07-04 17:27:28,236 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:28,237 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:28,237 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:27:28,237 - sqlalchemy.engine.Engine - INFO - [cached since 0.3806s ago] (1,)
2025-07-04 17:27:28,237 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:27:28,237 - sqlalchemy.engine.Engine - INFO - [cached since 0.381s ago] (1,)
2025-07-04 17:27:28,240 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:27:28,240 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:28,240 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:28,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,240 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:28,240 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,240 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,241 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:28,242 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,242 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:27:28,242 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:28,242 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:27:28,243 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:28,243 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:27:28,243 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:28,244 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:27:28,244 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:28,245 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:27:28,245 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:28,245 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:27:28,245 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:28,246 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:27:28,246 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:28,246 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:27:28,246 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:27:28,247 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:28,247 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:28,247 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:27:28,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,247 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:27:28,247 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:27:28,248 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:27:28,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:27:28,250 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:27:28,250 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:27:28,250 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:27:28,251 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:27:28,251 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:27:28,251 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:28,252 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:27:28,252 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:27:28,252 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:27:28,252 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:28,253 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:27:28,253 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:27:28,253 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:27:28,253 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:28,254 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:27:28,254 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:28,255 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:27:28,255 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:27:28,255 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:27:28,255 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:28,256 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:27:28,256 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:27:28,256 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:27:28,256 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:28,257 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:27:28,257 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:27:28,258 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:27:28,259 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:27:28,259 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:27:28,259 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:28,260 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:28,260 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:27:28,260 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:27:28,260 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:28,261 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:27:28,261 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:28,261 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:27:28,262 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:27:28,262 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:27:28,262 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:27:28,263 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:27:28,263 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:27:28,263 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:28,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:28,515 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:27:28,515 - sqlalchemy.engine.Engine - INFO - [cached since 0.6682s ago] ('test@example.com', '$2b$12$qM7uLWoG1fPjPJn.gv.fHenxBoXTkEsv09YqSVz9CRZLOislTJEyy', 'Test User', None, None)
2025-07-04 17:27:28,516 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:27:28,516 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:27:28,517 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:27:28,517 - sqlalchemy.engine.Engine - INFO - [cached since 0.6605s ago] (1,)
2025-07-04 17:27:28,517 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:27:28,517 - sqlalchemy.engine.Engine - INFO - [cached since 0.6609s ago] (1,)
2025-07-04 17:27:28,520 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:27:59,478 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:28:04,267 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:28:04,268 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:28:06,905 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:06,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:06,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:06,910 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:06,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:06,910 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:06,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:06,912 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:06,912 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:06,912 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,041 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:28:07,044 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,044 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,045 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:07,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:07,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:07,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:07,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,047 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:28:07,047 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:07,048 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:07,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,050 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:07,050 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,051 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:07,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,051 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:07,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,052 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:07,052 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,053 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:07,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:07,055 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:07,055 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,055 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:07,056 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,056 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,056 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,056 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:07,056 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,056 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:07,056 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,057 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:07,058 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,059 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:07,059 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,059 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:07,059 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,059 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:28:07,059 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,061 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:07,061 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:28:07,062 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:07,062 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:07,062 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:07,062 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,063 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:07,063 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:28:07,063 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:07,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,064 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:07,064 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:07,065 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:07,065 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,065 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:07,065 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,066 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,066 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:28:07,067 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:07,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,067 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:07,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:07,068 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:07,068 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,068 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:07,068 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,070 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:07,070 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:28:07,071 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:07,071 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,072 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,072 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:28:07,072 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:07,072 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,073 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:07,073 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,073 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,074 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:28:07,074 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:07,074 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,075 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:07,075 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,075 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:07,076 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:28:07,076 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:28:07,076 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,077 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,091 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,093 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:07,093 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (123, 1, 0)
2025-07-04 17:28:07,095 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:28:07,095 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:28:07,096 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:28:07,104 - app.error_handling - ERROR - Error recorded [external_api_1751671687096] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:28:07,104 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:28:07,106 - services.app - INFO - Request completed: 503
2025-07-04 17:28:07,107 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:28:07,108 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:28:07,108 - services.app - INFO - Request completed: 200
2025-07-04 17:28:07,109 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:28:07,110 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:28:07,110 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,110 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:07,110 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,110 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:07,110 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,110 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:07,111 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,112 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:28:07,112 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,113 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:07,113 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,113 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:07,113 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,114 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:07,114 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,114 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:07,114 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,115 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:07,115 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,115 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:07,115 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,116 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:07,116 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:07,116 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:07,116 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,117 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,117 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,117 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:07,117 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,117 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:07,117 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,117 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,118 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:28:07,119 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,120 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:07,120 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:28:07,120 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:07,120 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,121 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:07,121 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,121 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:07,122 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:28:07,122 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:07,122 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,123 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:07,123 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:07,123 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:07,123 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,124 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:07,124 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,124 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,124 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:28:07,125 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:07,125 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,125 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:07,125 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:07,126 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:07,126 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,126 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:07,126 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,127 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:07,127 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:28:07,128 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:07,128 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,128 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,128 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:28:07,129 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:07,129 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,129 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:07,129 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,130 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,130 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:28:07,130 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:07,131 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,131 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:07,131 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,132 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:07,132 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:28:07,132 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:28:07,132 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,133 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,133 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,133 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:28:07,133 - sqlalchemy.engine.Engine - INFO - [generated in 0.00007s] ()
2025-07-04 17:28:07,139 - services.app - INFO - Request completed: 200
2025-07-04 17:28:07,140 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:28:07,148 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:28:07,148 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:28:07,148 - services.app - INFO - Info message
2025-07-04 17:28:07,148 - services.app - WARNING - Warning message
2025-07-04 17:28:07,148 - services.app - ERROR - Error message
2025-07-04 17:28:07,872 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,872 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,892 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,893 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:07,893 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,894 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:07,894 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,894 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:07,894 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,894 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:07,894 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,894 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:07,894 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:07,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:07,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:07,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,895 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,906 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,906 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:07,906 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,906 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:07,906 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,906 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:07,906 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,906 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:07,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,908 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:28:07,908 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,908 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:07,908 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,909 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:07,909 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,910 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:07,910 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,910 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:07,910 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,911 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:07,911 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,911 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:07,911 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:07,912 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:07,912 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:28:07,913 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:07,913 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,913 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,913 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,913 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:07,914 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,915 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:07,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,916 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:07,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:07,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,916 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:28:07,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,916 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:07,916 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:28:07,917 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:07,917 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,917 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:07,917 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,918 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:07,918 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:28:07,919 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:07,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,919 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:07,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:07,920 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:07,920 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,920 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:07,920 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,921 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:28:07,922 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:07,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,922 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:07,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:07,923 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:07,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:07,923 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:07,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,924 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:07,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:28:07,925 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:07,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,925 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:28:07,926 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:07,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,926 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:07,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,927 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:28:07,928 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:07,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,928 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:07,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:07,929 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:07,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:28:07,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:28:07,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,931 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,931 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,931 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:07,932 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] ('test@example.com', 1, 0)
2025-07-04 17:28:07,932 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:28:07,932 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:28:07,933 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,934 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,934 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:28:07,934 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1,)
2025-07-04 17:28:07,935 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:28:07,936 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:28:07.934904', '2025-07-04 23:28:07.934908')
2025-07-04 17:28:07,936 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,936 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,937 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:28:07,937 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (1,)
2025-07-04 17:28:07,939 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:28:07,943 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,943 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:07,943 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,943 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:07,943 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,943 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:07,943 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,943 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:07,943 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:28:07,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,945 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:07,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,946 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:07,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,946 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:07,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,947 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:07,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,947 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:07,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,948 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:07,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,948 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:07,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,949 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:07,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:07,949 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:07,950 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:07,951 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:28:07,952 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:07,953 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:07,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:28:07,953 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:07,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:07,954 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:07,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,954 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:07,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:28:07,955 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:07,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,955 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:07,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:07,956 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:07,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,956 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:07,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,957 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,957 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:28:07,958 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:07,958 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,958 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:07,958 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:07,959 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:07,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,959 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:07,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:07,960 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:07,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:28:07,961 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:07,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,962 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:28:07,962 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:07,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,963 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:07,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:07,963 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:07,964 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:28:07,964 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:07,964 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:07,965 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:07,965 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,965 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:07,965 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:28:07,966 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:28:07,966 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:07,966 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,967 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,970 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:28:07,970 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] ()
2025-07-04 17:28:07,971 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:07,971 - sqlalchemy.engine.Engine - INFO - [cached since 0.03943s ago] ('test@example.com', 1, 0)
2025-07-04 17:28:07,971 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:28:07,971 - sqlalchemy.engine.Engine - INFO - [cached since 0.03915s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:28:07,972 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,972 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,972 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:28:07,972 - sqlalchemy.engine.Engine - INFO - [cached since 0.03837s ago] (1,)
2025-07-04 17:28:07,973 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:28:07,973 - sqlalchemy.engine.Engine - INFO - [cached since 0.03777s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:28:07.973100', '2025-07-04 23:28:07.973103')
2025-07-04 17:28:07,973 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:07,974 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:07,974 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:28:07,974 - sqlalchemy.engine.Engine - INFO - [cached since 0.03721s ago] (1,)
2025-07-04 17:28:07,975 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:28:07,978 - services.app - INFO - Request started: GET /health
2025-07-04 17:28:07,979 - services.app - INFO - Request completed: 200
2025-07-04 17:28:07,980 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:28:07,981 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:28:07,981 - services.app - INFO - Request completed: 200
2025-07-04 17:28:07,982 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:28:08,015 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:28:08,015 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:28:10,877 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:10,878 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:10,878 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:10,879 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,880 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:10,880 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,880 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:10,880 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,880 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:10,880 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:10,883 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:10,883 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:28:10,884 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:10,884 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:10,886 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:10,886 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:28:10,886 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:10,886 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:10,887 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:10,887 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:10,887 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:10,888 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:10,888 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:10,888 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:10,889 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:10,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:10,891 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:10,892 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:10,892 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:28:10,892 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:10,892 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:10,893 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:10,893 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:10,893 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:10,894 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:28:10,894 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:10,894 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:10,895 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:10,895 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:10,895 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:10,895 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:10,896 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:10,896 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:10,896 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:10,896 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:28:10,897 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:10,897 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:10,897 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:10,897 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:10,898 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:10,898 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:28:10,898 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:10,898 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:10,899 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:10,899 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:28:10,900 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:10,900 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:10,900 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:10,901 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:28:10,901 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:10,901 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:10,902 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:10,902 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:10,902 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:10,903 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:28:10,903 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:10,903 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:10,904 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:10,904 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:10,904 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:10,905 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:28:11,180 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,181 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:28:11,181 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ('test@example.com', '$2b$12$XT/ztC846ubvrA0S7ZqpWON/RsQmCN6fh.DTmK7BNXx94QbJXEMvW', 'Test User', None, None)
2025-07-04 17:28:11,182 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,182 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,183 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:28:11,183 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1,)
2025-07-04 17:28:11,184 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:28:11,184 - sqlalchemy.engine.Engine - INFO - [cached since 0.0009506s ago] (1,)
2025-07-04 17:28:11,185 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:11,185 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ('test@example.com', 1, 0)
2025-07-04 17:28:11,199 - services.app - INFO - Request started: POST /strategies/
2025-07-04 17:28:11,200 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,200 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,201 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,203 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:11,203 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,203 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:28:11,203 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,204 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:11,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,205 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:11,205 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,205 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:11,205 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,206 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:11,206 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,207 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:11,207 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:11,207 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:11,207 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,208 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:11,208 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,209 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:11,209 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:11,209 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,209 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:11,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:11,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:28:11,213 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:11,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,213 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:11,213 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,214 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:11,214 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:28:11,215 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:11,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,215 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:11,215 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:28:11,216 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:11,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,216 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:11,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,217 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,217 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:28:11,217 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:11,217 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,218 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,218 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:11,219 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:11,219 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,219 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:11,219 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,220 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:11,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:28:11,221 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:11,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,222 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:28:11,222 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:11,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,223 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:11,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,224 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:28:11,225 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:11,225 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,225 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:11,225 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,226 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:28:11,227 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:28:11,227 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,227 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,228 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,228 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:11,229 - sqlalchemy.engine.Engine - INFO - [cached since 3.297s ago] ('test@example.com', 1, 0)
2025-07-04 17:28:11,229 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:28:11,229 - services.app - INFO - Request completed: 401
2025-07-04 17:28:11,230 - httpx - INFO - HTTP Request: POST http://testserver/strategies/ "HTTP/1.1 401 Unauthorized"
2025-07-04 17:28:11,310 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:28:11,312 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,312 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,312 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,313 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,314 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,314 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,314 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,314 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:11,314 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,316 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:11,316 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:11,317 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:11,317 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,318 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:11,318 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,318 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:11,318 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:28:11,319 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:11,319 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,320 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:11,320 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,320 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:11,320 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,321 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,321 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,321 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,322 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,323 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,324 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,324 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:11,324 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,324 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,324 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,324 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:11,324 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,324 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:11,325 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:28:11,326 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:11,326 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:11,326 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:11,326 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,327 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:11,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-07-04 17:28:11,328 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:11,328 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:11,329 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:11,329 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:28:11,330 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:11,330 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:11,331 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:11,331 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,331 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,332 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:28:11,332 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:11,332 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,333 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:28:11,333 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:11,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,334 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:11,334 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:28:11,334 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:11,335 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:28:11,335 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:11,335 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,336 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,336 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:28:11,337 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:11,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,337 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:11,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,338 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:28:11,339 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:11,339 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:11,340 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:11,340 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:11,340 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,606 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,606 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:28:11,606 - sqlalchemy.engine.Engine - INFO - [cached since 0.4252s ago] ('test@example.com', '$2b$12$CdOcw6ot1dNWERPWbkk2ee6YbWGCLKetzCsuQ8Rc0Hj8yFKb8XWw.', 'Test User', None, None)
2025-07-04 17:28:11,607 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,607 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,607 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:28:11,608 - sqlalchemy.engine.Engine - INFO - [cached since 0.4247s ago] (1,)
2025-07-04 17:28:11,608 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:28:11,608 - sqlalchemy.engine.Engine - INFO - [cached since 0.4252s ago] (1,)
2025-07-04 17:28:11,608 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:11,609 - sqlalchemy.engine.Engine - INFO - [cached since 0.4238s ago] ('test@example.com', 1, 0)
2025-07-04 17:28:11,610 - services.app - INFO - Request started: POST /strategies/
2025-07-04 17:28:11,610 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,610 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,610 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,611 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,612 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,612 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:11,612 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,612 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:28:11,612 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,613 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:11,613 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,613 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:11,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,614 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:11,614 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:11,615 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:11,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,615 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:11,615 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,616 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:11,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,616 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:11,616 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,617 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:11,617 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,618 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,618 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,618 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,618 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:11,618 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,618 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,618 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,619 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:28:11,620 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,621 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:11,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:28:11,621 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:11,621 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,622 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:11,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,622 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:11,622 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:28:11,623 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:11,623 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,623 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:11,624 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:11,624 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:11,624 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:11,624 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:11,624 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,625 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,625 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:28:11,626 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:11,626 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,626 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,626 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:11,627 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:11,627 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,627 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:11,627 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,628 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:11,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:28:11,629 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:11,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,629 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:28:11,630 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:11,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,630 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:11,630 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,631 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:28:11,632 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:11,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,632 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:11,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:11,633 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:28:11,634 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:28:11,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,634 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,635 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,635 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:11,635 - sqlalchemy.engine.Engine - INFO - [cached since 3.704s ago] ('test@example.com', 1, 0)
2025-07-04 17:28:11,635 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:28:11,636 - services.app - INFO - Request completed: 401
2025-07-04 17:28:11,637 - httpx - INFO - HTTP Request: POST http://testserver/strategies/ "HTTP/1.1 401 Unauthorized"
2025-07-04 17:28:11,637 - services.app - INFO - Request started: GET /strategies/
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:28:11,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:11,640 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:11,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,641 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:11,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,642 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:11,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:11,642 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:11,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,643 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:11,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:11,643 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:11,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,644 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:11,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,644 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:11,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:11,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,646 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:28:11,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,648 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:11,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:28:11,648 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:11,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,649 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:11,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,649 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:11,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:28:11,650 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:11,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,650 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:11,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:11,651 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:11,651 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,651 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:11,651 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,652 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,652 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:28:11,652 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:11,653 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,653 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,653 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:11,653 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:11,654 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,654 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:11,654 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,654 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:11,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:28:11,655 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:11,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,656 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,656 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:28:11,657 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:11,657 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,657 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:11,657 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,658 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,658 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:28:11,658 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:11,659 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,659 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:11,659 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,660 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,660 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:28:11,661 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:28:11,661 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,661 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,662 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,662 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:11,662 - sqlalchemy.engine.Engine - INFO - [cached since 3.731s ago] ('test@example.com', 1, 0)
2025-07-04 17:28:11,662 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:28:11,662 - services.app - INFO - Request completed: 401
2025-07-04 17:28:11,663 - httpx - INFO - HTTP Request: GET http://testserver/strategies/ "HTTP/1.1 401 Unauthorized"
2025-07-04 17:28:11,665 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:28:11,666 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,666 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,666 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,666 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,666 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,666 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,666 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,666 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:11,667 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,668 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:11,668 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,669 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:11,669 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,669 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:11,669 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,670 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:11,670 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,670 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:11,671 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,671 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:11,671 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,672 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:11,672 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,672 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,672 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,672 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,673 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,674 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,675 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,675 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:11,675 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,675 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:11,675 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:28:11,676 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:11,676 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:11,676 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:11,676 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,677 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:11,677 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:28:11,677 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:11,677 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,678 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:11,678 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:11,678 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:11,678 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,679 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:11,679 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,679 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,680 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:28:11,680 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:11,680 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,681 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,681 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:11,681 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:11,681 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,682 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:11,682 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,682 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:11,683 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:28:11,683 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:11,683 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,684 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,684 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:28:11,684 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:11,684 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,685 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:11,685 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,685 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,686 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:28:11,686 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:11,686 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,687 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:11,687 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,687 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,927 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,927 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:28:11,927 - sqlalchemy.engine.Engine - INFO - [cached since 0.7462s ago] ('test@example.com', '$2b$12$jZsZA3sbhL1riEtMd7d0c.0a9kt7wlcTUnth8adKgewKVE27mjLDW', 'Test User', None, None)
2025-07-04 17:28:11,928 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,928 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,929 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:28:11,929 - sqlalchemy.engine.Engine - INFO - [cached since 0.7458s ago] (1,)
2025-07-04 17:28:11,929 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:28:11,929 - sqlalchemy.engine.Engine - INFO - [cached since 0.7462s ago] (1,)
2025-07-04 17:28:11,929 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:11,930 - sqlalchemy.engine.Engine - INFO - [cached since 0.7448s ago] ('test@example.com', 1, 0)
2025-07-04 17:28:11,931 - services.app - INFO - Request started: POST /strategies/
2025-07-04 17:28:11,931 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,931 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,932 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,933 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,933 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:11,933 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,933 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:28:11,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,934 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:28:11,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,935 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:28:11,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,935 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:28:11,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,936 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:28:11,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:11,937 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:28:11,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,937 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:28:11,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,938 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:28:11,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,939 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:28:11,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,939 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,939 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,939 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:28:11,939 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:28:11,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:28:11,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,942 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:28:11,942 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,942 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:28:11,942 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,942 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:28:11,942 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:28:11,942 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:28:11,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:28:11,943 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:28:11,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:28:11,943 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:28:11,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,944 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:28:11,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:28:11,944 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:28:11,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,945 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:28:11,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:28:11,946 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:28:11,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,946 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:28:11,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,947 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:28:11,947 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:28:11,947 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,948 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,948 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:28:11,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:28:11,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,949 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:28:11,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,950 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:28:11,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:28:11,951 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:28:11,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,951 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:28:11,952 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:28:11,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:28:11,953 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:28:11,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,953 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:28:11,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:28:11,954 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:28:11,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,955 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:28:11,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:28:11,955 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:28:11,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:28:11,956 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:28:11,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:28:11,957 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:28:11,957 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:28:11,958 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:28:11,958 - sqlalchemy.engine.Engine - INFO - [cached since 4.026s ago] ('test@example.com', 1, 0)
2025-07-04 17:28:11,958 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:28:11,958 - services.app - INFO - Request completed: 401
2025-07-04 17:28:11,959 - httpx - INFO - HTTP Request: POST http://testserver/strategies/ "HTTP/1.1 401 Unauthorized"
2025-07-04 17:28:11,961 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:30:15,497 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:30:21,395 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:30:21,396 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:30:24,455 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:24,459 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:24,460 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,465 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:24,465 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:24,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:30:24,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,467 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:24,631 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:30:24,632 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:24,632 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:24,632 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,632 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:24,632 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:24,633 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,634 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:30:24,634 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,634 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:30:24,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,635 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:30:24,636 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:24,637 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:30:24,637 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,638 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:30:24,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,639 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:30:24,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,640 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:30:24,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:24,641 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:30:24,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:24,643 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:30:24,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,644 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:30:24,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:24,644 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:24,644 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:30:24,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:30:24,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,648 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:30:24,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:30:24,649 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:30:24,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:24,649 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:30:24,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,650 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:30:24,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00020s] ()
2025-07-04 17:30:24,651 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:30:24,651 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:24,652 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:30:24,652 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:24,652 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:30:24,652 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,653 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:30:24,653 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:24,654 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:30:24,654 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:30:24,654 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:30:24,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,655 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:24,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:24,656 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:30:24,656 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:24,656 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:30:24,657 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:24,658 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:30:24,659 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:30:24,659 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:30:24,659 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,660 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:24,660 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:30:24,661 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:30:24,661 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,661 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:30:24,661 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,662 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:24,662 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:30:24,663 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:30:24,663 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:24,663 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:30:24,664 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:24,664 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:24,665 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:30:24,665 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:30:24,665 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,666 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:24,681 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:24,683 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:30:24,683 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (123, 1, 0)
2025-07-04 17:30:24,684 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:30:24,684 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:30:24,685 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:30:24,695 - app.error_handling - ERROR - Error recorded [external_api_1751671824685] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:30:24,696 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:30:24,697 - services.app - INFO - Request completed: 503
2025-07-04 17:30:24,698 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:30:24,699 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:30:24,699 - services.app - INFO - Request completed: 200
2025-07-04 17:30:24,700 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:30:24,701 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:30:24,701 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:24,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:24,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:24,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:24,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:30:24,702 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,703 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:30:24,703 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:24,703 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:30:24,703 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,704 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:30:24,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:24,705 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:30:24,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:24,705 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:30:24,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:24,706 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:30:24,706 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:24,707 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:30:24,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:24,707 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:30:24,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,708 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:30:24,708 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:24,708 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:24,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:30:24,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:30:24,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:24,712 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:30:24,712 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:30:24,712 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:30:24,712 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:24,713 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:30:24,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:24,714 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:30:24,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:30:24,715 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:30:24,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:24,715 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:30:24,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:30:24,716 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:30:24,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:24,717 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:30:24,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:24,718 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:30:24,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:30:24,718 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:30:24,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:24,719 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:24,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:30:24,720 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:30:24,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:24,720 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:30:24,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:24,722 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:30:24,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00167s] ()
2025-07-04 17:30:24,725 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:30:24,725 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:30:24,726 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:24,727 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:30:24,729 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:30:24,729 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:30:24,730 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:30:24,731 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:30:24,732 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:24,732 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:30:24,733 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:30:24,733 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:30:24,733 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:30:24,734 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:30:24,735 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:24,735 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:30:24,736 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:30:24,736 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:30:24,737 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:24,737 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:24,738 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:30:24,738 - sqlalchemy.engine.Engine - INFO - [generated in 0.00010s] ()
2025-07-04 17:30:24,779 - services.app - INFO - Request completed: 200
2025-07-04 17:30:24,780 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:30:24,791 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:30:24,791 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:30:24,791 - services.app - INFO - Info message
2025-07-04 17:30:24,792 - services.app - WARNING - Warning message
2025-07-04 17:30:24,792 - services.app - ERROR - Error message
2025-07-04 17:30:25,665 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,665 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,683 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,683 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:25,683 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,684 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:25,684 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:25,685 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,686 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,698 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,698 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:25,698 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,698 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:25,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:25,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:30:25,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,700 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:30:25,700 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,701 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:30:25,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:25,702 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:30:25,702 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:25,703 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:30:25,703 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,704 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:30:25,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,704 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:30:25,704 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,705 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:30:25,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,705 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:30:25,705 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,706 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:30:25,706 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,707 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,707 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,707 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:25,707 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,707 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:30:25,707 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:25,708 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,709 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:30:25,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,710 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:30:25,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,710 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:30:25,710 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:25,711 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:30:25,711 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,711 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:30:25,711 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:30:25,712 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:30:25,712 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:30:25,712 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:30:25,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,713 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:30:25,713 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:25,714 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:30:25,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,714 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:30:25,714 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,715 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:30:25,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:30:25,715 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:30:25,715 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,716 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:25,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:30:25,716 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:30:25,716 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,717 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:30:25,717 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,717 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:30:25,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:30:25,718 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:30:25,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,719 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:25,719 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:30:25,720 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:30:25,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,720 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:30:25,720 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:25,721 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:25,721 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:30:25,722 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:30:25,722 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:25,722 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:30:25,723 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,723 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:25,723 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:30:25,724 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:30:25,724 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,725 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,725 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:30:25,726 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', 1, 0)
2025-07-04 17:30:25,726 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:30:25,726 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:30:25,727 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,728 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,728 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:30:25,728 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1,)
2025-07-04 17:30:25,730 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:30:25,730 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:30:25.729200', '2025-07-04 23:30:25.729203')
2025-07-04 17:30:25,730 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,731 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,731 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:30:25,732 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] (1,)
2025-07-04 17:30:25,734 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:30:25,740 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,740 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:25,740 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:25,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:25,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:25,741 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:25,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:25,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:25,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:25,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,742 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:30:25,743 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,743 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:30:25,743 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,743 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:30:25,744 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,744 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:30:25,744 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,745 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:30:25,745 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,746 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:30:25,746 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,746 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:30:25,746 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,747 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:30:25,747 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,748 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:30:25,748 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,748 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:30:25,748 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,749 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,749 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,749 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:25,749 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,749 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:30:25,749 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:25,750 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,751 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:30:25,752 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,752 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:30:25,752 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,752 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:30:25,752 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:25,752 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:30:25,752 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:25,753 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:30:25,753 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:25,753 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:30:25,753 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,754 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:30:25,754 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:30:25,754 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:30:25,755 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,755 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:30:25,755 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:30:25,756 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:30:25,756 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:25,756 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:30:25,756 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,757 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:30:25,757 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:30:25,758 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:30:25,758 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,759 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:25,759 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:25,760 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:30:25,760 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:25,761 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:30:25,761 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:25,762 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:30:25,762 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:30:25,763 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:30:25,763 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:25,763 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:25,763 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:30:25,764 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:30:25,764 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:25,764 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:30:25,764 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,765 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:25,765 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:30:25,766 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:30:25,766 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:25,767 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:30:25,767 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:25,767 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:25,768 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-07-04 17:30:25,769 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:30:25,769 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:25,770 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,772 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:30:25,773 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] ()
2025-07-04 17:30:25,774 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:30:25,774 - sqlalchemy.engine.Engine - INFO - [cached since 0.0483s ago] ('test@example.com', 1, 0)
2025-07-04 17:30:25,774 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:30:25,774 - sqlalchemy.engine.Engine - INFO - [cached since 0.04805s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:30:25,775 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,775 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,775 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:30:25,776 - sqlalchemy.engine.Engine - INFO - [cached since 0.04725s ago] (1,)
2025-07-04 17:30:25,776 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:30:25,776 - sqlalchemy.engine.Engine - INFO - [cached since 0.04662s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:30:25.776249', '2025-07-04 23:30:25.776252')
2025-07-04 17:30:25,777 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:25,777 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:25,777 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:30:25,777 - sqlalchemy.engine.Engine - INFO - [cached since 0.04594s ago] (1,)
2025-07-04 17:30:25,778 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:30:25,783 - services.app - INFO - Request started: GET /health
2025-07-04 17:30:25,784 - services.app - INFO - Request completed: 200
2025-07-04 17:30:25,785 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:30:25,786 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:30:25,787 - services.app - INFO - Request completed: 200
2025-07-04 17:30:25,788 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:30:25,827 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:30:25,827 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:30:28,427 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:28,452 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:28,452 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,453 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:28,454 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,454 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:28,454 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,454 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:30:28,454 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,458 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:30:28,458 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:30:28,458 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:30:28,459 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:28,461 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:30:28,461 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:28,461 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:30:28,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,462 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:30:28,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,463 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:30:28,464 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,464 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:30:28,464 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:28,465 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:28,465 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:28,465 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:28,465 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,465 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:30:28,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:28,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,466 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:30:28,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,466 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:28,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,466 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:30:28,466 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,467 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:28,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,468 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:30:28,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,468 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:28,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,468 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:30:28,468 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,469 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:30:28,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:30:28,469 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:30:28,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,470 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:30:28,470 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,471 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:30:28,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:30:28,471 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:30:28,471 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,472 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:30:28,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:30:28,473 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:30:28,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,473 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:30:28,473 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,474 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:30:28,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:30:28,474 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:30:28,474 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:28,475 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:28,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:28,475 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:30:28,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:28,476 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:30:28,476 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,477 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:30:28,477 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:30:28,478 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:30:28,478 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,478 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:28,479 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:30:28,484 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:30:28,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:30:28,485 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:30:28,485 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:28,486 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:28,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00033s] ()
2025-07-04 17:30:28,487 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:30:28,487 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:28,487 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:30:28,488 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,488 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:28,490 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:30:28,779 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:28,780 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:30:28,780 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] ('test@example.com', '$2b$12$i18Otp9iPH9if4hBjT4oMe3VBlnVpqqnvRDyX1bnrrGI7iTHqQIhq', 'Test User', None, None)
2025-07-04 17:30:28,780 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:28,781 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:28,782 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:30:28,782 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1,)
2025-07-04 17:30:28,782 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:30:28,782 - sqlalchemy.engine.Engine - INFO - [cached since 0.0006435s ago] (1,)
2025-07-04 17:30:28,940 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:30:28,940 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:28,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:28,940 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,940 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:28,941 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,942 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:28,942 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,942 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:30:28,942 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,943 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:30:28,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,943 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:30:28,943 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:28,944 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:30:28,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,944 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:30:28,944 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:28,945 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:30:28,945 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:28,946 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:30:28,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:28,946 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:30:28,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,947 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:30:28,948 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:30:28,949 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:28,950 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:30:28,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,950 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:30:28,950 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:28,951 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:30:28,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:30:28,951 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:30:28,951 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,952 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:30:28,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:30:28,952 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:30:28,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,953 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:30:28,953 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,953 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:30:28,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:30:28,954 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:30:28,954 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:28,954 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:28,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:30:28,955 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:30:28,955 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:28,956 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:30:28,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:28,956 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:30:28,957 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-07-04 17:30:28,957 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:30:28,957 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:28,958 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:28,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:30:28,959 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:30:28,959 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:30:28,961 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:30:28,961 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:30:28,961 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:28,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:30:28,962 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:30:28,962 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:28,963 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:30:28,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:30:28,964 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:29,214 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:29,214 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:30:29,214 - sqlalchemy.engine.Engine - INFO - [cached since 0.4346s ago] ('test@example.com', '$2b$12$.316RqyMi2kx485GFxygfuFLo0nofitKUEpehaSqV6Tzgi84UHM5C', 'Test User', None, None)
2025-07-04 17:30:29,215 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:29,215 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:29,215 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:30:29,216 - sqlalchemy.engine.Engine - INFO - [cached since 0.4339s ago] (1,)
2025-07-04 17:30:29,216 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:30:29,216 - sqlalchemy.engine.Engine - INFO - [cached since 0.4344s ago] (1,)
2025-07-04 17:30:29,219 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:30:29,219 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:29,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:29,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:29,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:29,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,221 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:30:29,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:29,222 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:30:29,222 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:29,223 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:30:29,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:29,223 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:30:29,223 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:29,224 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:30:29,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:29,224 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:30:29,224 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:29,225 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:30:29,225 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:29,226 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:30:29,226 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:29,226 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:29,226 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:29,226 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:30:29,227 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:30:29,228 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,229 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:30:29,229 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,229 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:30:29,229 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:30:29,229 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:30:29,229 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:29,230 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:30:29,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:29,230 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:30:29,230 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:30:29,230 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:30:29,231 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:30:29,231 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:30:29,231 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:29,232 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:30:29,232 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:30:29,232 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:30:29,232 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:30:29,233 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:30:29,233 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:29,233 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:30:29,233 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:30:29,234 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:30:29,234 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:29,235 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:30:29,235 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:30:29,235 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:30:29,235 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:29,236 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:30:29,236 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:29,236 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:30:29,237 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:30:29,237 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:30:29,237 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:29,238 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:29,238 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:30:29,239 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:30:29,239 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:29,239 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:30:29,239 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:30:29,240 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:30:29,240 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:30:29,240 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:30:29,241 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:29,241 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:30:29,241 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:30:29,241 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:29,493 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:29,493 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:30:29,493 - sqlalchemy.engine.Engine - INFO - [cached since 0.7138s ago] ('test@example.com', '$2b$12$YqNNLCN2rRv4vSIUFFhEgeLmCyGy6fAzbM.u2zb9WVE4qmOSad5m2', 'Test User', None, None)
2025-07-04 17:30:29,494 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:30:29,494 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:30:29,495 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:30:29,495 - sqlalchemy.engine.Engine - INFO - [cached since 0.7131s ago] (1,)
2025-07-04 17:30:29,495 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:30:29,495 - sqlalchemy.engine.Engine - INFO - [cached since 0.7135s ago] (1,)
2025-07-04 17:30:29,497 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:09,582 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:31:13,952 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:31:13,952 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:31:17,674 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:17,684 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:17,685 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:17,698 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:17,698 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:17,698 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:17,698 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:17,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:17,700 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:18,113 - services.app - INFO - Request started: POST /portfolio/link/token
2025-07-04 17:31:18,114 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:18,115 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:18,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,115 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:18,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,115 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:18,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,115 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:18,115 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:18,116 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,121 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:31:18,121 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:31:18,124 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:18,124 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:18,136 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:18,136 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:31:18,137 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:18,137 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:18,139 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:18,139 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-07-04 17:31:18,140 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:18,140 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:31:18,146 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:18,146 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:31:18,150 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:18,150 - sqlalchemy.engine.Engine - INFO - [no key 0.00021s] ()
2025-07-04 17:31:18,151 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:18,151 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:18,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,153 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:31:18,154 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,155 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:18,155 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:31:18,156 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:18,156 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:18,156 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:18,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:31:18,157 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:18,157 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:31:18,159 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:18,159 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,160 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:18,160 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:18,161 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:18,161 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,161 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:18,161 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,162 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:18,162 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:31:18,162 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:18,162 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,163 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:18,163 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:18,163 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:18,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:18,164 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:18,164 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:18,166 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:18,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:31:18,167 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:18,167 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,168 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:18,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:31:18,168 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:18,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,170 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:18,170 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:18,171 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:18,171 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:31:18,172 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:18,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,172 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:18,172 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:18,173 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:18,173 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:31:18,174 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:31:18,174 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,174 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:18,188 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:18,189 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.id = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:18,190 - sqlalchemy.engine.Engine - INFO - [generated in 0.00086s] (123, 1, 0)
2025-07-04 17:31:18,191 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:31:18,192 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (123, 'user123@example.com', None, 'User 123', None, None)
2025-07-04 17:31:18,193 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:18,237 - app.error_handling - ERROR - Error recorded [external_api_1751671878193] external_api: (sqlite3.IntegrityError) NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:31:18,238 - root - ERROR - Error creating link token=*** NOT NULL constraint failed: users.hashed_password
[SQL: INSERT INTO users (id, email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at]
[parameters: (123, 'user123***@***.example.com', None, 'User 123', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-04 17:31:18,239 - services.app - INFO - Request completed: 503
2025-07-04 17:31:18,240 - httpx - INFO - HTTP Request: POST http://testserver/portfolio/link/token?user_id=123 "HTTP/1.1 503 Service Unavailable"
2025-07-04 17:31:18,241 - services.app - INFO - Request started: GET /admin/performance
2025-07-04 17:31:18,241 - services.app - INFO - Request completed: 200
2025-07-04 17:31:18,242 - httpx - INFO - HTTP Request: GET http://testserver/admin/performance "HTTP/1.1 200 OK"
2025-07-04 17:31:18,243 - services.app - INFO - Request started: GET /health/detailed
2025-07-04 17:31:18,243 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:18,243 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:18,243 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,243 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:18,243 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,243 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:18,243 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:18,244 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,245 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:31:18,245 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,246 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:18,246 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:18,247 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:18,247 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,247 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:18,247 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,248 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:18,248 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:18,249 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:18,249 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:18,249 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:18,249 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,253 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:18,253 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,254 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:18,254 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,254 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:18,254 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:18,254 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:18,254 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:18,255 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:18,256 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,257 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:18,257 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,257 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:18,257 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,257 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:31:18,257 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:18,257 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:18,257 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:31:18,258 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:18,258 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,259 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:18,259 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,259 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:18,259 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:31:18,260 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:18,260 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,260 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:18,260 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:18,261 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:18,261 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,261 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:18,262 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,262 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:18,262 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:31:18,263 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:18,263 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,264 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:18,264 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:18,264 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:18,265 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,265 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:18,265 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:18,266 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:18,266 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:31:18,267 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:18,267 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,267 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:18,267 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:31:18,268 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:18,268 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:18,268 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:18,268 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:18,269 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:18,269 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:31:18,270 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:18,270 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,270 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:18,270 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,271 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:18,271 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:31:18,275 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:31:18,275 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:18,276 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:18,276 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:18,276 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-07-04 17:31:18,276 - sqlalchemy.engine.Engine - INFO - [generated in 0.00007s] ()
2025-07-04 17:31:18,543 - services.app - INFO - Request completed: 200
2025-07-04 17:31:18,545 - httpx - INFO - HTTP Request: GET http://testserver/health/detailed "HTTP/1.1 200 OK"
2025-07-04 17:31:18,561 - services.app - INFO - Logging configuration initialized with sensitive data filtering
2025-07-04 17:31:18,561 - services.app - DEBUG - Debug message with extra data
2025-07-04 17:31:18,561 - services.app - INFO - Info message
2025-07-04 17:31:18,561 - services.app - WARNING - Warning message
2025-07-04 17:31:18,562 - services.app - ERROR - Error message
2025-07-04 17:31:21,866 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:21,866 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:21,892 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:21,892 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:21,892 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,894 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:21,894 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,894 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:21,894 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,894 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:21,894 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,894 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:21,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:21,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:21,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,895 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:21,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,895 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:21,907 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:21,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:21,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:21,907 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,907 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,908 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:21,909 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,909 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:21,909 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,909 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:31:21,909 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,910 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:21,910 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:21,911 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:21,911 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,912 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:21,912 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,912 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:21,912 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:21,913 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:21,913 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,914 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:21,914 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:31:21,914 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:21,915 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,915 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:21,915 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,917 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:31:21,918 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,919 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:21,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:31:21,920 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:21,920 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:21,920 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:21,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,921 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:21,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:31:21,922 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:21,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:21,923 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:21,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:31:21,923 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:21,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:21,924 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:21,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:31:21,925 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:21,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:31:21,925 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:21,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,926 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:21,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:21,926 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:21,926 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:21,927 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:21,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,927 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:21,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-07-04 17:31:21,928 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:21,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:21,929 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:21,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:31:21,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:21,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,932 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:21,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:21,932 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:21,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:31:21,933 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:21,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:21,934 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:21,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:21,935 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:21,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:31:21,936 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:31:21,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,936 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:21,936 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:21,937 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:21,937 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ('test@example.com', 1, 0)
2025-07-04 17:31:21,938 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:31:21,938 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:31:21,939 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:21,939 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:21,940 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:31:21,940 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1,)
2025-07-04 17:31:21,941 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:31:21,942 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:31:21.940731', '2025-07-04 23:31:21.940736')
2025-07-04 17:31:21,943 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:21,944 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:21,945 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:31:21,945 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (1,)
2025-07-04 17:31:21,949 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:21,954 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:21,954 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:21,954 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,955 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:21,956 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,956 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:21,956 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,956 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:21,956 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,956 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:31:21,956 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:21,958 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:21,958 - sqlalchemy.engine.Engine - INFO - [no key 0.00019s] ()
2025-07-04 17:31:21,960 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:21,960 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:21,968 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:21,968 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:31:21,973 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:21,973 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:31:21,976 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:21,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:21,976 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:21,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:21,977 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:21,977 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:21,978 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:21,978 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:21,978 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:21,978 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:21,978 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:21,978 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,979 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:21,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:21,981 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:21,982 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:21,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:21,983 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:21,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,983 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:21,983 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:31:21,984 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:21,984 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,984 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:21,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:21,985 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:21,985 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,985 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:21,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:21,986 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:21,986 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:31:21,987 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:21,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,987 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:21,987 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:21,988 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:21,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:21,988 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:21,988 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,989 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:21,989 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-07-04 17:31:21,990 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:21,990 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,990 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:21,991 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:31:21,991 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:21,991 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,992 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:21,992 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,992 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:21,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:31:21,993 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:21,993 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,994 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:21,994 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:21,995 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:21,995 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:31:21,996 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:31:21,996 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:21,996 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:21,996 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:22,000 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT accounts.id AS accounts_id, accounts.user_id AS accounts_user_id, accounts.custodian_id AS accounts_custodian_id, accounts.portfolio_id AS accounts_portfolio_id, accounts.external_id AS accounts_external_id, accounts.name AS accounts_name, accounts.official_name AS accounts_official_name, accounts.account_type AS accounts_account_type, accounts.account_subtype AS accounts_account_subtype, accounts.mask AS accounts_mask, accounts.plaid_account_id AS accounts_plaid_account_id, accounts.plaid_access_token AS accounts_plaid_access_token, accounts.alpaca_account_id AS accounts_alpaca_account_id, accounts.alpaca_access_token AS accounts_alpaca_access_token, accounts.plaid_item_id AS accounts_plaid_item_id, accounts.current_balance AS accounts_current_balance, accounts.available_balance AS accounts_available_balance, accounts.iso_currency_code AS accounts_iso_currency_code, accounts.is_manual AS accounts_is_manual, accounts.is_active AS accounts_is_active, accounts.last_synced_at AS accounts_last_synced_at, accounts.created_at AS accounts_created_at, accounts.updated_at AS accounts_updated_at 
FROM accounts) AS anon_1
2025-07-04 17:31:22,001 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ()
2025-07-04 17:31:22,002 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:22,002 - sqlalchemy.engine.Engine - INFO - [cached since 0.06508s ago] ('test@example.com', 1, 0)
2025-07-04 17:31:22,003 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:31:22,003 - sqlalchemy.engine.Engine - INFO - [cached since 0.06484s ago] ('test@example.com', '$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW', 'Test User', None, None)
2025-07-04 17:31:22,003 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:22,004 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:22,004 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:31:22,004 - sqlalchemy.engine.Engine - INFO - [cached since 0.06415s ago] (1,)
2025-07-04 17:31:22,004 - sqlalchemy.engine.Engine - INFO - INSERT INTO accounts (user_id, custodian_id, portfolio_id, external_id, name, official_name, account_type, account_subtype, mask, plaid_account_id, plaid_access_token, alpaca_account_id, alpaca_access_token, plaid_item_id, current_balance, available_balance, iso_currency_code, is_active, last_synced_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING id, is_manual
2025-07-04 17:31:22,005 - sqlalchemy.engine.Engine - INFO - [cached since 0.06342s ago] (1, None, None, None, 'Test Investment Account', None, 'investment', None, None, 'test-account-123', 'test-access-token-123', None, None, 'test-item-123', 10000.0, None, 'USD', 1, None, '2025-07-04 23:31:22.004699', '2025-07-04 23:31:22.004702')
2025-07-04 17:31:22,005 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:22,006 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:22,006 - sqlalchemy.engine.Engine - INFO - SELECT accounts.id, accounts.user_id, accounts.custodian_id, accounts.portfolio_id, accounts.external_id, accounts.name, accounts.official_name, accounts.account_type, accounts.account_subtype, accounts.mask, accounts.plaid_account_id, accounts.plaid_access_token, accounts.alpaca_account_id, accounts.alpaca_access_token, accounts.plaid_item_id, accounts.current_balance, accounts.available_balance, accounts.iso_currency_code, accounts.is_manual, accounts.is_active, accounts.last_synced_at, accounts.created_at, accounts.updated_at 
FROM accounts 
WHERE accounts.id = ?
2025-07-04 17:31:22,006 - sqlalchemy.engine.Engine - INFO - [cached since 0.06146s ago] (1,)
2025-07-04 17:31:22,007 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:22,012 - services.app - INFO - Request started: GET /health
2025-07-04 17:31:22,012 - services.app - INFO - Request completed: 200
2025-07-04 17:31:22,013 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
2025-07-04 17:31:22,014 - services.app - INFO - Request started: GET /plugins
2025-07-04 17:31:22,015 - services.app - INFO - Request completed: 200
2025-07-04 17:31:22,015 - httpx - INFO - HTTP Request: GET http://testserver/plugins "HTTP/1.1 200 OK"
2025-07-04 17:31:22,049 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-07-04 17:31:22,050 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-07-04 17:31:24,570 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:24,571 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:24,571 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,571 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:24,571 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,571 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:24,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,573 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:24,573 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,576 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:24,576 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,576 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:24,577 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,578 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:24,578 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,579 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:24,579 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,580 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:24,580 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:31:24,581 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:24,581 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,581 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:24,581 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:24,582 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:24,582 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:24,582 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:24,582 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:24,583 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,584 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:24,585 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,585 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:24,585 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:31:24,586 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:24,586 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:24,587 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:24,587 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,587 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:24,587 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:31:24,588 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:24,588 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,588 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:24,589 - sqlalchemy.engine.Engine - INFO - [no key 0.00014s] ()
2025-07-04 17:31:24,589 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:24,589 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:24,590 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:24,590 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:31:24,591 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:24,591 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:31:24,592 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:24,592 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:24,592 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:24,593 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:24,593 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:24,593 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:24,594 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:24,594 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:24,595 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:24,595 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-07-04 17:31:24,596 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:24,596 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,596 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:24,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:31:24,597 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:24,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:24,598 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:24,598 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:24,599 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:24,599 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:31:24,600 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:24,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:24,600 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:24,600 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:24,601 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:24,602 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/benjaminwilliams/value_partner/.venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-07-04 17:31:24,892 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:24,894 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:31:24,894 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ('test@example.com', '$2b$12$XsB4JtbAkXT3KQFT8EXoYeiQXr6tDytuM/JCR460O33tbmIPG83aS', 'Test User', None, None)
2025-07-04 17:31:24,894 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:24,895 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:24,896 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:31:24,896 - sqlalchemy.engine.Engine - INFO - [generated in 0.00015s] (1,)
2025-07-04 17:31:24,896 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:31:24,896 - sqlalchemy.engine.Engine - INFO - [cached since 0.0006485s ago] (1,)
2025-07-04 17:31:24,897 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:24,897 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('test@example.com', 1, 0)
2025-07-04 17:31:24,912 - services.app - INFO - Request started: POST /strategies/
2025-07-04 17:31:24,914 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:24,914 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:24,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,915 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:24,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,915 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:24,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,915 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:24,915 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:24,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:24,916 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,916 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:24,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:24,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,917 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:24,917 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,918 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:31:24,918 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,919 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:24,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:24,920 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:24,920 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:24,921 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:24,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:24,921 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:24,921 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,922 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:24,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,922 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:24,922 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,923 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:24,923 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,924 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:24,924 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,924 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:24,924 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:24,924 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:24,924 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,924 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:24,925 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:24,926 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:24,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:24,928 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:24,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,928 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:24,928 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,929 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:24,929 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:31:24,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:24,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,930 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:24,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:24,931 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:24,931 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,931 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:24,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,932 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:24,932 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:31:24,933 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:24,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:24,933 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:24,933 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:24,934 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:24,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:24,934 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:24,934 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,935 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:24,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-07-04 17:31:24,936 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:24,936 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,936 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:24,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00028s] ()
2025-07-04 17:31:24,937 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:24,937 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,937 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:24,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,938 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:24,938 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:31:24,939 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:24,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:24,939 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:24,939 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:24,940 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:24,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:31:24,941 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:31:24,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:24,942 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:24,943 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:24,943 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:24,943 - sqlalchemy.engine.Engine - INFO - [cached since 3.006s ago] ('test@example.com', 1, 0)
2025-07-04 17:31:24,943 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:24,944 - services.app - INFO - Request completed: 401
2025-07-04 17:31:24,944 - httpx - INFO - HTTP Request: POST http://testserver/strategies/ "HTTP/1.1 401 Unauthorized"
2025-07-04 17:31:25,026 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:25,027 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,027 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,027 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,027 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,028 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,029 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:25,029 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,029 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:25,029 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,030 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:25,030 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,031 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:25,031 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,031 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:25,031 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,032 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:25,032 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,033 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:25,033 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,033 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:25,033 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,034 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,034 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,034 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,034 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,034 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,035 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:25,036 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,037 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:25,037 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:25,037 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:25,037 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,038 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:25,038 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,038 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:25,039 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:31:25,039 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:25,039 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,039 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:25,040 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:25,040 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:25,040 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,041 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:25,041 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,041 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,041 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:31:25,042 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:25,042 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,042 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:25,042 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:25,043 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:25,043 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,043 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:25,043 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,044 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:25,044 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:31:25,045 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:25,045 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,045 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,045 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:31:25,046 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:25,046 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,046 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:25,046 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,047 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,047 - sqlalchemy.engine.Engine - INFO - [no key 0.00029s] ()
2025-07-04 17:31:25,048 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:25,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,048 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:25,048 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,049 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,292 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,292 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:31:25,292 - sqlalchemy.engine.Engine - INFO - [cached since 0.3988s ago] ('test@example.com', '$2b$12$UHwtwPDXMx9yuXRzeJMW9.K8j4A0uRCOoT/jIqo98pWV/rHLclJ1a', 'Test User', None, None)
2025-07-04 17:31:25,293 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,293 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,293 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:31:25,293 - sqlalchemy.engine.Engine - INFO - [cached since 0.3978s ago] (1,)
2025-07-04 17:31:25,294 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:31:25,294 - sqlalchemy.engine.Engine - INFO - [cached since 0.3982s ago] (1,)
2025-07-04 17:31:25,294 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:25,294 - sqlalchemy.engine.Engine - INFO - [cached since 0.3973s ago] ('test@example.com', 1, 0)
2025-07-04 17:31:25,295 - services.app - INFO - Request started: POST /strategies/
2025-07-04 17:31:25,296 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,296 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,296 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,296 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,296 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,297 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,298 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:25,298 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,298 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:31:25,298 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,299 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:25,299 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:25,299 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:25,300 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,300 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:25,300 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,301 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:25,301 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,302 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:25,302 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,303 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:25,303 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,303 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:25,303 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,304 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:25,304 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,305 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,306 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:31:25,307 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,308 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:25,308 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:25,308 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:25,308 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,309 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:25,309 - sqlalchemy.engine.Engine - INFO - [no key 0.00010s] ()
2025-07-04 17:31:25,309 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:25,310 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:31:25,310 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:25,310 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,311 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:25,311 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:25,311 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:25,312 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,312 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:25,312 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,313 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,313 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:31:25,313 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:25,313 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,314 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:25,314 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:25,314 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:25,314 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,315 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:25,315 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,315 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:25,316 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:31:25,316 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:25,316 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:25,317 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,317 - sqlalchemy.engine.Engine - INFO - [no key 0.00027s] ()
2025-07-04 17:31:25,318 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:25,318 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:25,319 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:25,319 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,319 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,320 - sqlalchemy.engine.Engine - INFO - [no key 0.00032s] ()
2025-07-04 17:31:25,320 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:25,320 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,321 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:25,321 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:25,322 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:25,322 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-07-04 17:31:25,323 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:31:25,323 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,323 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,324 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,324 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:25,324 - sqlalchemy.engine.Engine - INFO - [cached since 3.388s ago] ('test@example.com', 1, 0)
2025-07-04 17:31:25,325 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:25,325 - services.app - INFO - Request completed: 401
2025-07-04 17:31:25,326 - httpx - INFO - HTTP Request: POST http://testserver/strategies/ "HTTP/1.1 401 Unauthorized"
2025-07-04 17:31:25,327 - services.app - INFO - Request started: GET /strategies/
2025-07-04 17:31:25,327 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,327 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,327 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,327 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,327 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,328 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:25,329 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,329 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:31:25,329 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:31:25,329 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:25,329 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,330 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:25,330 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,331 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:25,331 - sqlalchemy.engine.Engine - INFO - [no key 0.00005s] ()
2025-07-04 17:31:25,331 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:25,331 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,332 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:25,332 - sqlalchemy.engine.Engine - INFO - [no key 0.00023s] ()
2025-07-04 17:31:25,332 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:25,332 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,333 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:25,333 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,334 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:25,334 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,334 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,334 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,334 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,334 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,334 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,335 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:25,336 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,337 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:25,337 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,337 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:31:25,337 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,337 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:25,337 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:25,337 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:25,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,338 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:25,338 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,338 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:25,339 - sqlalchemy.engine.Engine - INFO - [no key 0.00015s] ()
2025-07-04 17:31:25,339 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:25,339 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,339 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:25,340 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:25,340 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:25,340 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,340 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:25,341 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,341 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,341 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:31:25,342 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:25,342 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,342 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:25,342 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:25,343 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:25,343 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,343 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:25,343 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,344 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:25,344 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-07-04 17:31:25,345 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:25,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,345 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,345 - sqlalchemy.engine.Engine - INFO - [no key 0.00025s] ()
2025-07-04 17:31:25,346 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:25,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,346 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:25,346 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,347 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,347 - sqlalchemy.engine.Engine - INFO - [no key 0.00031s] ()
2025-07-04 17:31:25,348 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:25,348 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,348 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:25,348 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,349 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:25,349 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:31:25,349 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:31:25,349 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,350 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,350 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,351 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:25,351 - sqlalchemy.engine.Engine - INFO - [cached since 3.414s ago] ('test@example.com', 1, 0)
2025-07-04 17:31:25,351 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:25,351 - services.app - INFO - Request completed: 401
2025-07-04 17:31:25,352 - httpx - INFO - HTTP Request: GET http://testserver/strategies/ "HTTP/1.1 401 Unauthorized"
2025-07-04 17:31:25,354 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,355 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,356 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,356 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,356 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,356 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,356 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,356 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,356 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,356 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:25,356 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,357 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:25,357 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,357 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:25,358 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,358 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:25,358 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,359 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:25,359 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,359 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:25,359 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,360 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:25,360 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,360 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:25,361 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,361 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,361 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,361 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,361 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:25,361 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,362 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,363 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:25,363 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,364 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,365 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:25,365 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,365 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:25,365 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:25,366 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:25,366 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,366 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:25,366 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,367 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:25,367 - sqlalchemy.engine.Engine - INFO - [no key 0.00017s] ()
2025-07-04 17:31:25,367 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:25,367 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,368 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:25,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:25,368 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:25,368 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,369 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:25,369 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,369 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00018s] ()
2025-07-04 17:31:25,370 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:25,370 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,371 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:25,371 - sqlalchemy.engine.Engine - INFO - [no key 0.00013s] ()
2025-07-04 17:31:25,371 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:25,371 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,372 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:25,372 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:25,372 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:25,373 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-07-04 17:31:25,373 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:25,373 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,374 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,374 - sqlalchemy.engine.Engine - INFO - [no key 0.00026s] ()
2025-07-04 17:31:25,374 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:25,374 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,375 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:25,375 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,376 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,376 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:31:25,377 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:25,377 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,378 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:25,378 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,379 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,620 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,621 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (email, hashed_password, name, created_at, updated_at, plaid_access_token, plaid_item_id) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?) RETURNING id, created_at, updated_at
2025-07-04 17:31:25,621 - sqlalchemy.engine.Engine - INFO - [cached since 0.7277s ago] ('test@example.com', '$2b$12$clZDNNdmJ.5rrjiMM6SgpecOIXpgf2FCgDIAOTcY8b2KPivO3UtGe', 'Test User', None, None)
2025-07-04 17:31:25,622 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,622 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,622 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:31:25,622 - sqlalchemy.engine.Engine - INFO - [cached since 0.7269s ago] (1,)
2025-07-04 17:31:25,623 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.email, users.hashed_password, users.name, users.created_at, users.updated_at, users.plaid_access_token, users.plaid_item_id 
FROM users 
WHERE users.id = ?
2025-07-04 17:31:25,623 - sqlalchemy.engine.Engine - INFO - [cached since 0.7273s ago] (1,)
2025-07-04 17:31:25,623 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:25,624 - sqlalchemy.engine.Engine - INFO - [cached since 0.7266s ago] ('test@example.com', 1, 0)
2025-07-04 17:31:25,625 - services.app - INFO - Request started: POST /strategies/
2025-07-04 17:31:25,625 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,625 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,625 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,626 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,627 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:25,627 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,627 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE orders
2025-07-04 17:31:25,627 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,628 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE transactions
2025-07-04 17:31:25,628 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,629 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE holdings
2025-07-04 17:31:25,629 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:25,631 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE accounts
2025-07-04 17:31:25,631 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:25,631 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategy_holdings
2025-07-04 17:31:25,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00009s] ()
2025-07-04 17:31:25,632 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE portfolios
2025-07-04 17:31:25,632 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,633 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE strategies
2025-07-04 17:31:25,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,633 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE custodians
2025-07-04 17:31:25,633 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,634 - sqlalchemy.engine.Engine - INFO - 
DROP TABLE users
2025-07-04 17:31:25,634 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,635 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,635 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,635 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategies")
2025-07-04 17:31:25,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,635 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategies")
2025-07-04 17:31:25,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,635 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("strategy_holdings")
2025-07-04 17:31:25,635 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("strategy_holdings")
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("custodians")
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("custodians")
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("portfolios")
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("portfolios")
2025-07-04 17:31:25,636 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("accounts")
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("accounts")
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("holdings")
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("holdings")
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("transactions")
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("transactions")
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("orders")
2025-07-04 17:31:25,637 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,638 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("orders")
2025-07-04 17:31:25,638 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-07-04 17:31:25,638 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR NOT NULL, 
	hashed_password VARCHAR NOT NULL, 
	name VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	plaid_access_token VARCHAR, 
	plaid_item_id VARCHAR(100), 
	PRIMARY KEY (id)
)


2025-07-04 17:31:25,638 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:31:25,639 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_email ON users (email)
2025-07-04 17:31:25,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,639 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_id ON users (id)
2025-07-04 17:31:25,639 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,640 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE custodians (
	id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	display_name VARCHAR(200), 
	logo_url VARCHAR(500), 
	website VARCHAR(200), 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-07-04 17:31:25,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:31:25,640 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_custodians_id ON custodians (id)
2025-07-04 17:31:25,640 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,641 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategies (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR, 
	description TEXT, 
	rebalance_threshold NUMERIC(5, 2), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-07-04 17:31:25,641 - sqlalchemy.engine.Engine - INFO - [no key 0.00012s] ()
2025-07-04 17:31:25,641 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_name ON strategies (name)
2025-07-04 17:31:25,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,642 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategies_id ON strategies (id)
2025-07-04 17:31:25,642 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,643 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE portfolios (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	description TEXT, 
	is_primary BOOLEAN DEFAULT (0) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,643 - sqlalchemy.engine.Engine - INFO - [no key 0.00016s] ()
2025-07-04 17:31:25,644 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_portfolios_id ON portfolios (id)
2025-07-04 17:31:25,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,644 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE strategy_holdings (
	id INTEGER NOT NULL, 
	strategy_id INTEGER, 
	symbol VARCHAR, 
	target_weight NUMERIC(5, 4), 
	PRIMARY KEY (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:25,644 - sqlalchemy.engine.Engine - INFO - [no key 0.00011s] ()
2025-07-04 17:31:25,645 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_symbol ON strategy_holdings (symbol)
2025-07-04 17:31:25,645 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,645 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_strategy_holdings_id ON strategy_holdings (id)
2025-07-04 17:31:25,645 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,646 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE accounts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	custodian_id INTEGER, 
	portfolio_id INTEGER, 
	external_id VARCHAR(100), 
	name VARCHAR(200) NOT NULL, 
	official_name VARCHAR(500), 
	account_type VARCHAR(10) NOT NULL, 
	account_subtype VARCHAR(100), 
	mask VARCHAR(20), 
	plaid_account_id VARCHAR(100), 
	plaid_access_token VARCHAR(255), 
	alpaca_account_id VARCHAR(100), 
	alpaca_access_token VARCHAR(255), 
	plaid_item_id VARCHAR(100), 
	current_balance NUMERIC(15, 2), 
	available_balance NUMERIC(15, 2), 
	iso_currency_code VARCHAR(3), 
	is_manual BOOLEAN DEFAULT (0) NOT NULL, 
	is_active BOOLEAN DEFAULT (1) NOT NULL, 
	last_synced_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(custodian_id) REFERENCES custodians (id) ON DELETE SET NULL, 
	FOREIGN KEY(portfolio_id) REFERENCES portfolios (id) ON DELETE SET NULL
)


2025-07-04 17:31:25,646 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-07-04 17:31:25,647 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_accounts_id ON accounts (id)
2025-07-04 17:31:25,647 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-07-04 17:31:25,648 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE holdings (
	id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	symbol VARCHAR(50) NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	security_type VARCHAR(50), 
	cusip VARCHAR(20), 
	isin VARCHAR(20), 
	quantity NUMERIC(15, 6) NOT NULL, 
	market_value NUMERIC(15, 2) NOT NULL, 
	cost_basis NUMERIC(15, 2), 
	unit_price NUMERIC(12, 4), 
	cost_basis_per_share NUMERIC(12, 4), 
	unrealized_pl NUMERIC(15, 2), 
	unrealized_pl_pct NUMERIC(8, 4), 
	last_updated DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00024s] ()
2025-07-04 17:31:25,648 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_id ON holdings (id)
2025-07-04 17:31:25,648 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,649 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_holdings_symbol ON holdings (symbol)
2025-07-04 17:31:25,649 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,650 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER NOT NULL, 
	external_id VARCHAR(100), 
	transaction_type VARCHAR(10) NOT NULL, 
	amount NUMERIC(15, 2) NOT NULL, 
	description VARCHAR(500) NOT NULL, 
	merchant_name VARCHAR(200), 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	date DATETIME NOT NULL, 
	symbol VARCHAR(50), 
	quantity NUMERIC(15, 6), 
	unit_price NUMERIC(12, 4), 
	fee NUMERIC(10, 2), 
	is_pending BOOLEAN DEFAULT (0) NOT NULL, 
	is_recurring BOOLEAN DEFAULT (0) NOT NULL, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	updated_at DATETIME DEFAULT (CURRENT_TIMESTAMP) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id) ON DELETE CASCADE, 
	FOREIGN KEY(account_id) REFERENCES accounts (id) ON DELETE CASCADE
)


2025-07-04 17:31:25,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00030s] ()
2025-07-04 17:31:25,651 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_transactions_id ON transactions (id)
2025-07-04 17:31:25,651 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,651 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_transactions_external_id ON transactions (external_id)
2025-07-04 17:31:25,651 - sqlalchemy.engine.Engine - INFO - [no key 0.00008s] ()
2025-07-04 17:31:25,652 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE orders (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	account_id INTEGER, 
	strategy_id INTEGER, 
	symbol VARCHAR NOT NULL, 
	side VARCHAR(4) NOT NULL, 
	quantity NUMERIC(15, 6) NOT NULL, 
	order_type VARCHAR(13) NOT NULL, 
	time_in_force VARCHAR(3), 
	limit_price NUMERIC(12, 4), 
	stop_price NUMERIC(12, 4), 
	trail_percent NUMERIC(5, 4), 
	trail_price NUMERIC(12, 4), 
	filled_quantity NUMERIC(15, 6), 
	average_fill_price NUMERIC(12, 4), 
	commission NUMERIC(10, 2), 
	status VARCHAR(16), 
	broker_order_id VARCHAR, 
	client_order_id VARCHAR, 
	extended_hours BOOLEAN, 
	created_at DATETIME, 
	updated_at DATETIME, 
	submitted_at DATETIME, 
	filled_at DATETIME, 
	broker_data TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(account_id) REFERENCES accounts (id), 
	FOREIGN KEY(strategy_id) REFERENCES strategies (id)
)


2025-07-04 17:31:25,653 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-07-04 17:31:25,654 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_orders_id ON orders (id)
2025-07-04 17:31:25,654 - sqlalchemy.engine.Engine - INFO - [no key 0.00007s] ()
2025-07-04 17:31:25,655 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-07-04 17:31:25,656 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-07-04 17:31:25,656 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.hashed_password AS users_hashed_password, users.name AS users_name, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.plaid_access_token AS users_plaid_access_token, users.plaid_item_id AS users_plaid_item_id 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-07-04 17:31:25,656 - sqlalchemy.engine.Engine - INFO - [cached since 3.719s ago] ('test@example.com', 1, 0)
2025-07-04 17:31:25,656 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:31:25,657 - services.app - INFO - Request completed: 401
2025-07-04 17:31:25,658 - httpx - INFO - HTTP Request: POST http://testserver/strategies/ "HTTP/1.1 401 Unauthorized"
2025-07-04 17:31:25,660 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-07-04 17:34:13,459 - services.app - INFO - Logging configuration initialized with sensitive data filtering
